Tracuubaogia As screen:

    danhsachnhom As gallery.variableTemplateHeightGallery:
        BorderThickness: =1
        DelayItemLoading: =true
        Height: =512
        Items: =tempSPKH
        Layout: =Layout.Vertical
        LoadingSpinner: =LoadingSpinner.Data
        TemplateSize: =282
        Width: =1266
        X: =40
        Y: =117
        ZIndex: =1

        Label12 As label:
            FontWeight: =FontWeight.Bold
            Height: =31
            OnSelect: =Select(Parent)
            Size: =11
            Text: =LookUp(DL_SAN_PHAM, MA_SAN_PHAM = ThisItem.MA_SAN_PHAM).TEN_SAN_PHAM & " - " & ThisItem.TEN_CHUONG_TRINH
            Width: =403
            X: =30
            ZIndex: =1

        Gallery6 As gallery.variableTemplateHeightGallery:
            BorderColor: =RGBA(0, 0, 0, 1)
            DelayItemLoading: =true
            Height: =251
            Items: =Filter( tempQLFull, MA_CHUONG_TRINH = ThisItem.MA_CHUONG_TRINH && !(MA_CHUONG_TRINH))
            Layout: =Layout.Vertical
            LoadingSpinner: =LoadingSpinner.Data
            TemplateSize: =43
            Width: =1111
            X: =30
            Y: =31
            ZIndex: =3

            Label13 As label:
                BorderColor: =RGBA(0, 0, 0, 1)
                BorderThickness: =1
                Height: =35
                OnSelect: =Select(Parent)
                Size: =11
                Text: =ThisItem.LOAI
                ZIndex: =1

            Checkbox2_1 As checkbox:
                BorderColor: =RGBA(0, 0, 0, 1)
                CheckboxBorderColor: |-
                    =RGBA(0, 0, 0, 1
                    )
                CheckboxSize: =20
                Default: |
                    =
                    If(ThisItem.cr282_loai = "Chính", true, false)
                DisabledColor: =RGBA(0, 0, 0, 1)
                DisabledFill: =RGBA(255, 255, 255, 1)
                DisplayMode: |
                    =
                    
                    If(ThisItem.cr282_loai = "Chính", DisplayMode.Disabled, DisplayMode.Edit)
                Height: =31
                HoverBorderColor: |
                    =
                HoverColor: =RGBA(255, 255, 255, 1)
                OnSelect: =Select(Parent)
                PaddingLeft: =8
                PressedBorderColor: =
                PressedColor: =RGBA(0, 0, 0, 0)
                PressedFill: |
                    =
                Size: =11
                Text: =""
                Underline: =true
                Width: =30
                X: =1011
                Y: =4
                ZIndex: =3

            Label16 As label:
                BorderColor: =RGBA(0, 0, 0, 1)
                BorderThickness: =1
                Height: =35
                OnSelect: =Select(Parent)
                Text: =ThisItem.TEN_HIEN_THI
                Width: =299
                X: =150
                ZIndex: =5

            Label20 As label:
                Height: =36
                OnSelect: =Select(Parent)
                Text: =//ThisItem.MA_CHUONG_TRINH
                Visible: =false
                X: =484
                ZIndex: =6

            Label22 As label:
                BorderColor: =RGBA(0, 0, 0, 1)
                BorderThickness: =1
                Height: =35
                OnSelect: =Select(Parent)
                Text: |
                    =Text(ThisItem.SO_TIEN, "###,###,###")
                X: =449
                ZIndex: =8

            Label1_1 As label:
                BorderColor: =RGBA(0, 0, 0, 1)
                BorderThickness: =1
                Height: =35
                OnSelect: =Select(Parent)
                Text: |
                    = Text(ThisItem.PHI, "###,###,###")
                X: =599
                ZIndex: =9

        Checkbox2 As checkbox:
            BorderColor: =RGBA(0, 0, 0, 1)
            CheckboxBorderColor: =RGBA(0, 0, 0, 1)
            CheckboxSize: =20
            Height: =31
            OnSelect: =Select(Parent)
            PaddingLeft: =8
            Size: =11
            Text: =""
            Width: =30
            ZIndex: =4

        Button4_4 As button:
            Height: =38
            OnSelect: =Select(Parent)
            Size: =11
            Text: ="Mua ngay"
            Width: =116
            X: =1115
            Y: =120
            ZIndex: =5

    Button3_17 As button:
        Size: =11
        Text: ="Mua ngay"
        Width: =121
        X: =1156
        Y: =40
        ZIndex: =2

    Button3_18 As button:
        OnSelect: |
            =ClearCollect(
                tempCTKH,
                ""
            );
            ClearCollect(
                tempQLFull,
                ""
            );
            Set(
                ConcatenatedResult,
                ""
            );
            // lấy danh sách sản phẩm
            ClearCollect(
                tempSPKH,
                Filter(
                    ' DL_SAN_PHAM_CT',
                    MA_SAN_PHAM = "PVICARE"
                )
            );
            // lấy danh sách nhóm quyền lợi gắn với chương trình của sản phẩm
            ForAll(
                tempSPKH As sp,
                Collect(
                    tempCTKH,
                    AddColumns(
                        Filter(
                            DL_SAN_PHAM_NHOMQLS,
                            MA_SP = sp.MA_SAN_PHAM && !IsBlank(
                                Find(
                                    sp.MA_CHUONG_TRINH,
                                    CHUONGTRINH_APDUNG
                                )
                            )
                        ),
                        "MA_CHUONG_TRINH",
                        sp.MA_CHUONG_TRINH
                    )
                );
                
            );
            // danh sách có tổng số tiền và phí
            ForAll(
                tempCTKH As ctql,
                Collect(
                    tempQLFull,
                    AddColumns(
                        ctql,
                        "SO_TIEN",
                        Max(
                            Filter(
                                DL_CHUONGTRINH_QLCTS,
                                MA_SAN_PHAM = ctql.MA_SP && MA_CHUONG_TRINH = ctql.MA_CHUONG_TRINH && MA_NHOM_QL = ctql.MA_NHOM_QL
                            ),
                            GH_SOTIEN_NAM
                        ),
                        "PHI",
                        Sum ( Filter (DL_CHUONG_TRINH_BANG_PHIS, MA_SAN_PHAM = ctql.MA_SP && MA_CHUONG_TRINH = ctql.MA_CHUONG_TRINH && NHOM_TINH_PHI = ctql.MA_NHOM_TINHPHI ), PHI_BH)
                    )
                )
            );
        Size: =11
        Text: ="Tra cứu dữ liệu"
        X: =930
        Y: =40
        ZIndex: =3

