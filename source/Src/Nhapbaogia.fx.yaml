"Nhapbaogia As screen.'autoLayout_Approval_ver1.0'":
    OnVisible: |-
        =    ClearCollect(
                tmpDSHDSPNHDCollect,
                AddColumns(
                    Filter(
                        DL_HOP_DONG_SPS,
                        MA_HOP_DONG = maHopDongFwd
                    ),
                    "edited",
                    0
                )
            );

    Container3_10 As groupContainer.manualLayoutContainer:
        BorderColor: =RGBA(255, 255, 255, 1)
        DropShadow: =DropShadow.None
        Height: =607
        Width: =1267
        X: =80
        Y: =144
        ZIndex: =1

        Gallery3_4 As gallery.variableTemplateHeightGallery:
            DelayItemLoading: =true
            Fill: =RGBA(255, 255, 255, 1)
            Height: =366
            Items: |-
                =SortByColumns(
                    tmpDSHDSPNHDCollect,
                    "cr282_id",
                    SortOrder.Ascending
                )
            Layout: =Layout.Vertical
            LoadingSpinner: =LoadingSpinner.Data
            TemplateSize: =312
            Width: =1267
            Y: =169
            ZIndex: =21

            Label3_90 As label:
                Height: =44
                Size: =11
                Text: ="Sản phẩm"
                Width: =130
                Y: =6
                ZIndex: =2

            Label3_93 As label:
                Height: =25
                Size: =11
                Text: ="Tên chương trình"
                Visible: =false
                Width: =140
                X: =990
                Y: =6
                ZIndex: =3

            Label3_92 As label:
                Height: =25
                Size: =11
                Text: ="Mã chương trình (*)"
                Visible: =false
                Width: =160
                X: =368
                Y: =14
                ZIndex: =4

            tiSoNTGSPNHD_1 As text:
                Align: =Align.Right
                BorderColor: =RGBA(72, 163, 62, 1)
                Default: |-
                    =If (
                        ThisItem.edited=1,
                        LookUp(tmpMaCTChangeNHD,ID=ThisItem.ID,SONGUOI_THAMGIA),
                        ThisItem.SONGUOI_THAMGIA
                    )
                DisplayMode: =DisplayMode.Disabled
                Format: =TextFormat.Number
                Height: =32
                RadiusBottomLeft: =0
                RadiusBottomRight: =0
                RadiusTopLeft: =0
                RadiusTopRight: =0
                Size: =11
                Width: =250
                Y: =206
                ZIndex: =7

            tiTongPhiNHD_1 As text:
                Align: =Align.Right
                BorderColor: =RGBA(72, 163, 62, 1)
                Default: |-
                    =If (
                        ThisItem.edited=1,
                        LookUp(tmpMaCTChangeNHD,ID=ThisItem.ID,TONG_TIEN_PHI),
                        ThisItem.TONG_TIEN_PHI
                    )
                DisplayMode: =DisplayMode.Disabled
                Format: =TextFormat.Number
                Height: =32
                RadiusBottomLeft: =0
                RadiusBottomRight: =0
                RadiusTopLeft: =0
                RadiusTopRight: =0
                Size: =11
                Width: =250
                X: =382
                Y: =206
                ZIndex: =8

            Label3_96 As label:
                Height: =25
                Size: =11
                Text: ="Số người tham gia"
                Width: =250
                Y: =178
                ZIndex: =9

            Label3_97 As label:
                Height: =25
                Size: =11
                Text: ="Tổng phí/Nhóm"
                Width: =249
                X: =382
                Y: =181
                ZIndex: =10

            tiTenSPNHD_2 As text:
                BorderColor: =RGBA(72, 163, 62, 1)
                Default: =LookUp(DL_SAN_PHAM,MA_SAN_PHAM=cbxMaSPNHD_2.Selected.MA_SAN_PHAM,TEN_SAN_PHAM)
                DisplayMode: =DisplayMode.Disabled
                Height: =32
                RadiusBottomLeft: =0
                RadiusBottomRight: =0
                RadiusTopLeft: =0
                RadiusTopRight: =0
                Size: =11
                Visible: =false
                Width: =250
                X: =355
                Y: =34
                ZIndex: =11

            cbxMaSPNHD_2 As combobox:
                BorderColor: =RGBA(72, 163, 62, 1)
                DefaultSelectedItems: =LookUp(DL_SAN_PHAM,MA_SAN_PHAM=ThisItem.MA_SAN_PHAM)
                DisplayFields: =["cr282_ma_san_pham","cr282_ten_san_pham"]
                DisplayMode: =If(ThisItem.edited=1,DisplayMode.Edit,DisplayMode.Disabled)
                Height: =59
                InputTextPlaceholder: =""
                Items: =DL_SAN_PHAM
                OnChange: |-
                    =If(
                        cbxMaSPNHD_2.Selected.MA_SAN_PHAM<>LookUp(tmpMaCTChangeNHD,ID=ThisItem.ID,MA_SAN_PHAM) && IsBlank(unReloadMaSP),
                        UpdateIf(
                            tmpMaCTChangeNHD,
                            ID=ThisItem.ID,
                            {
                                MA_SAN_PHAM:cbxMaSPNHD_2.Selected.MA_SAN_PHAM,
                                MA_CHUONG_TRINH:Blank(),
                                NHOM_TINH_PHI:Blank()
                            }
                        );   
                    );
                OnSelect: |-
                    =UpdateContext({
                        unReloadMaSP:Blank(),
                        unReloadMaCT:Blank()
                    })
                SearchFields: =["cr282_ma_san_pham"]
                SearchItems: =Search(DL_SAN_PHAM,cbxMaSPNHD_2.SearchText,"cr282_ma_san_pham")
                SelectMultiple: =false
                Size: =11
                Template: =ListItemTemplate.Double
                Width: =1073
                X: =183
                Y: =6
                ZIndex: =15

            LinkHDLK_5 As text:
                BorderThickness: =0
                Color: =RGBA(39, 113, 194, 1)
                Default: ="Danh sách NĐBH"
                DisabledBorderColor: =RGBA(255, 255, 255, 1)
                DisabledFill: =RGBA(255, 255, 255, 1)
                DisplayMode: |-
                    =//If(ThisItem.edited=0,DisplayMode.Edit,DisplayMode.Disabled) 
                    DisplayMode.Edit
                Height: =28
                HoverBorderColor: =RGBA(255, 255, 255, 1)
                HoverColor: =RGBA(39, 113, 194, 1)
                HoverFill: =RGBA(255, 255, 255, 1)
                OnSelect: |-
                    =ClearCollect(
                        dmGioiTinhNDBHCollect,
                        DM_GIOI_TINHS
                    );
                    ClearCollect(
                        dmPhamViNDBHCollect,
                        DM_PHAMVI_DIALYS
                    );
                    If(
                        IsBlank(cbxMaSPNHD_2.Selected.MA_SAN_PHAM),
                        Notify(
                            "Bắt buộc chọn sản phẩm",
                            NotificationType.Error,
                            2000
                        ),
                        (ThisItem.edited=1 && IsBlank(cbxMaCTNHD_2.Selected.MA_CHUONG_TRINH)) || (ThisItem.edited=0 && IsBlank(cbxMaCTNHDHide_1.Selected.MA_CHUONG_TRINH)),
                        Notify(
                            "Bắt buộc chọn chương trình",
                            NotificationType.Error,
                            2000
                        ),
                        IsEmpty(cbxNhomTPNHD_1.SelectedItems),
                        Notify(
                            "Bắt buộc chọn nhóm tính phí",
                            NotificationType.Error,
                            2000
                        ),
                        Set(
                            idHopDongSPNDBH,
                            ThisItem.ID
                        );
                        Set(
                            maSPNDBH,
                            cbxMaSPNHD_2.Selected.MA_SAN_PHAM
                        );
                        Set(
                            maHDNDBH,
                            First(objHD).MA_HOP_DONG
                        );
                        Set(
                            maCTNDBH,
                            If(
                                ThisItem.edited=1,
                                cbxMaCTNHD_2.Selected.MA_CHUONG_TRINH,
                                cbxMaCTNHDHide_1.Selected.MA_CHUONG_TRINH
                            )
                        );
                        Set(
                            nhomTPNDBH,
                            Concat(
                                cbxNhomTPNHD_1.SelectedItems,
                                Value,
                                "|"
                            )
                        );
                        Set(
                            phiDCNDBH,
                            tiPhiDCNHD_1.Text
                        );
                        If(
                            cbxLoaiKHNHD.Selected.value = "0" && IsBlank(
                                LookUp(
                                    tmpMaCTChangeNHD,
                                    ID = ThisItem.ID,
                                    AUTO_GEN_NDBH
                                )
                            ) && ThisItem.edited = 1,
                            /* 
                            UpdateContext({varPhiNDBH: 0});
                            UpdateContext({varTuoi: 0});
                            UpdateContext({varDVTuoi: 0});
                            //Tinh tuoi
                            If(
                                !IsBlank(dpNSinhNHD.SelectedDate),
                                If(
                                    DateDiff(
                                        dpNSinhNHD.SelectedDate,
                                        Today(),
                                        TimeUnit.Years
                                    ) > 0,
                                    UpdateContext(
                                        {
                                            varTuoi: DateDiff(
                                                dpNSinhNHD.SelectedDate,
                                                Today(),
                                                TimeUnit.Years
                                            )
                                        }
                                    );
                                    UpdateContext({varDVTuoi: 100});
                                    ,
                                    If(
                                        DateDiff(
                                            dpNSinhNHD.SelectedDate,
                                            Today(),
                                            TimeUnit.Months
                                        ) > 0,
                                        UpdateContext({varTuoi: 1});
                                        UpdateContext({varDVTuoi: 200});
                                        ,
                                        If(
                                            DateDiff(
                                                dpNSinhNHD.SelectedDate,
                                                Today(),
                                                TimeUnit.Days
                                            ) >= 60,
                                            UpdateContext({varTuoi: 1});
                                            UpdateContext({varDVTuoi: 400}),
                                            UpdateContext({varTuoi: 0})
                                        )
                                    )
                                )
                            );
                            //Kiem tra dap ung chi tieu
                    UpdateContext(
                                {
                                    varPhiNDBH: Sum(
                                        Filter(
                                            DL_CHUONG_TRINH_BANG_PHIS,
                                            MA_SAN_PHAM = maSPNDBH && MA_CHUONG_TRINH = maCTNDBH && !IsBlank(
                                                Find(
                                                    NHOM_TINH_PHI,
                                                    nhomTPNDBH
                                                )
                                            ) && (IsBlank(MA_PHAMVI_DIALY) || (!IsBlank(cbxTinhNHD.Selected.MA_PHAMVI) && MA_PHAMVI_DIALY = cbxTinhNHD.Selected.MA_PHAMVI)) && (IsBlank(MA_GIOI_TINH) || (!IsBlank(cbxGTinhNHD.Selected.MA_GIOI_TINH) && MA_GIOI_TINH = cbxGTinhNHD.Selected.MA_GIOI_TINH)) && (IsBlank(MA_DO_TUOI) || MA_DO_TUOI = LookUp(
                                                DM_DO_TUOIS,
                                                (If(
                                                    MO_TA = MA_DO_TUOI && DONVI_TUOI_TU > 100,
                                                    1,
                                                    TUOI_TU
                                                ) <= varTuoi) && (If(
                                                    DONVI_TUOI_DEN > 100,
                                                    1,
                                                    TUOI_DEN
                                                ) >= varTuoi)
                                            ).MO_TA || IsBlank(MA_DO_TUOI))
                                        ),
                                        PHI_BH
                                    )
                                }
                            );*/
                            //Lay phi chuong trinh
                    UpdateContext(
                                {
                                    idNDBH: If(
                                        CountIf(
                                            tmpDSNDBHNHDCollect,
                                            true
                                        ) > 0,
                                        Max(
                                            tmpDSNDBHNHDCollect,
                                            ID
                                        ) + 1,
                                        Max(
                                            DL_HOP_DONG_SP_NDBH,
                                            ID
                                        ) + 1
                                    )
                                }
                            );
                            Collect(
                                tmpDSNDBHNHDCollect,
                                {
                                    ID: idNDBH,
                                    ID_HOPDONG_SP: ThisItem.ID,
                                    MA_HOP_DONG: First(objHD).MA_HOP_DONG,
                                    MA_SAN_PHAM: ThisItem.MA_SAN_PHAM,
                                    MA_CHUONG_TRINH: ThisItem.MA_CHUONG_TRINH,
                                    MST: cbxMaKHNHD.Selected.MST,
                                    TEN_NDBH: tiTenKHNHD.Text,
                                    DIA_CHI: tiDChiNHD.Text,
                                    MA_GIOI__TINH: cbxGTinhNHD.Selected.MA_GIOI_TINH,
                                    MA_NHAN_VIEN: "",
                                    MA_TINH_TP: cbxTinhNHD.Selected.MA_PHAMVI,
                                    MOI_QUAN_HE: "",
                                    NGAY_SINH: dpNSinhNHD.SelectedDate,
                                    NHOM: "",
                                    SO_GIAY_TO: cbxMaKHNHD.Selected.SO_GIAY_TO,
                                    PHI_NDBH: Blank(),
                                    edited: 0
                                }
                            );
                            UpdateIf(
                                tmpMaCTChangeNHD,
                                ID = ThisItem.ID,
                                {AUTO_GEN_NDBH: "1"}
                            )
                        );
                    	//tinh lai phi neu thay doi san pham, ctrinh hoac nhom tinh phi
                        /*
                        UpdateContext(
                            {
                                objChangeNDBH: First(
                                    Filter(
                                        tmpDSNDBHNHDCollect,
                                        ID_HOPDONG_SP = ThisItem.ID
                                    )
                                )
                            }
                        );*/
                        ClearCollect(
                            tmpTinhLaiPhiNDBHCollect,
                            {
                                varPhiNDBHCol:0,
                                varTuoiCol:0,
                                varDVTuoiCol:0
                            }
                        );
                        ClearCollect(
                            tmpKQPhiNDBHCollect,
                            {
                                ID:0,
                                PHI_NDBH:0
                            }
                        );
                        Clear(tmpKQPhiNDBHCollect);
                        /*
                        ClearCollect(
                            changeNhomTPNDBH,
                            {
                                check:false
                            }
                        );
                        ForAll(
                            Split(objChangeNDBH.NHOM_TINH_PHI,"|") As ds,
                            If(
                                IsBlank(Find(ds.Value,nhomTPNDBH)),
                                UpdateIf(
                                    changeNhomTPNDBH,
                                    true,
                                    {
                                        check:true
                                    }
                                )
                            )
                        );
                        ForAll(
                            Split(nhomTPNDBH,"|") As ds,
                            If(
                                IsBlank(Find(ds.Value,objChangeNDBH.NHOM_TINH_PHI)),
                                UpdateIf(
                                    changeNhomTPNDBH,
                                    true,
                                    {
                                        check:true
                                    }
                                )
                            )
                        );
                        If(
                            objChangeNDBH.MA_SAN_PHAM<>maSPNDBH || objChangeNDBH.MA_CHUONG_TRINH<>maCTNDBH || First(changeNhomTPNDBH).check,*/
                            ForAll(
                                Filter(
                    				tmpDSNDBHNHDCollect,
                    				ID_HOPDONG_SP = ThisItem.ID
                    			) As ds,
                    			//Tinh tuoi
                    			If(
                    				!IsBlank(ds.NGAY_SINH),
                    				If(
                    					DateDiff(
                    						ds.NGAY_SINH,
                    						Today(),
                    						TimeUnit.Years
                    					) > 0,
                                        UpdateIf(
                                            tmpTinhLaiPhiNDBHCollect,
                                            true,
                                            {
                                                varTuoiCol:DateDiff(
                    								ds.NGAY_SINH,
                    								Today(),
                    								TimeUnit.Years
                    							),
                                                varDVTuoiCol: 100
                                            }
                                        ),
                    					If(
                    						DateDiff(
                    							ds.NGAY_SINH,
                    							Today(),
                    							TimeUnit.Months
                    						) > 0,
                                            UpdateIf(
                    							tmpTinhLaiPhiNDBHCollect,
                    							true,
                    							{
                    								varTuoiCol:1,
                    								varDVTuoiCol: 200
                    							}
                    						),
                    						If(
                    							DateDiff(
                    								ds.NGAY_SINH,
                    								Today(),
                    								TimeUnit.Days
                    							) >= 60,
                                                UpdateIf(
                                                    tmpTinhLaiPhiNDBHCollect,
                                                    true,
                                                    {
                                                        varTuoiCol: 1,
                                                        varDVTuoiCol: 400
                                                    }
                                                ),
                                                UpdateIf(
                                                    tmpTinhLaiPhiNDBHCollect,
                                                    true,
                                                    {
                                                        varTuoiCol: 0
                                                    }
                                                )
                    						)
                    					)
                    				)
                    			);
                    			//Kiem tra dap ung chi tieu
                                UpdateIf(
                                    tmpTinhLaiPhiNDBHCollect,
                                    true,
                                    {
                                        varPhiNDBHCol:Sum(
                    					Filter(
                    						DL_CHUONG_TRINH_BANG_PHIS,MA_SAN_PHAM = maSPNDBH && MA_CHUONG_TRINH = maCTNDBH && 
                                            !IsBlank(Find(NHOM_TINH_PHI,nhomTPNDBH)) &&
                    						(IsBlank(MA_PHAMVI_DIALY) || (!IsBlank(ds.MA_TINH_TP) && 
                    						MA_PHAMVI_DIALY = LookUp(dmPhamViNDBHCollect,MA_PHAMVI=ds.MA_TINH_TP,TEN_PHAMVI))) && 
                    						(IsBlank(MA_GIOI_TINH) || (!IsBlank(ds.MA_GIOI__TINH) && 
                    						MA_GIOI_TINH = LookUp(dmGioiTinhNDBHCollect,MA_GIOI_TINH=ds.MA_GIOI__TINH,TEN_GIOI_TINH))) && 
                    						(IsBlank(MA_DO_TUOI) || MA_DO_TUOI = LookUp(
                    							DM_DO_TUOIS,
                    							(If(
                    								MO_TA = MA_DO_TUOI && DONVI_TUOI_TU > 100,
                    								1,
                    								TUOI_TU
                    							) <= varTuoiCol) && (If(
                    								DONVI_TUOI_DEN > 100,
                    								1,
                    								TUOI_DEN
                    							) >= varTuoiCol)
                    						).MO_TA || IsBlank(MA_DO_TUOI))
                    					),
                    					PHI_BH
                    				)
                                    }
                                );
                    			//Lay phi chuong trinh
                                Collect(
                                    tmpKQPhiNDBHCollect,
                                    {
                                        ID:ds.ID,
                                        PHI_NDBH:First(tmpTinhLaiPhiNDBHCollect).varPhiNDBHCol
                                    }
                                );
                                UpdateIf(
                                    tmpTinhLaiPhiNDBHCollect,
                                    true,
                                    {
                                        varPhiNDBHCol:0,
                                        varTuoiCol:0,
                                        varDVTuoiCol:0
                                    }
                                )
                            );
                            ForAll(
                                tmpKQPhiNDBHCollect As ds,
                                UpdateIf(
                                    tmpDSNDBHNHDCollect,
                                    ID_HOPDONG_SP=ThisItem.ID && ID=ds.ID,
                                    {
                                        PHI_NDBH:ds.PHI_NDBH
                                    }
                                )
                            );
                        //);
                        // end tinh lai phi neu thay doi san pham, ctrinh hoac nhom tinh phi
                        If(
                            ThisItem.edited = 1,
                            Set(
                                modeMHNDBH,
                                "1"
                            ),
                            Set(
                                modeMHNDBH,
                                "0"
                            )
                        );
                        Navigate(NhapNDBH);
                    )
                Size: =11
                Underline: =true
                Width: =142
                X: =169
                Y: =259
                ZIndex: =20

            LinkHDLK_4 As text:
                BorderThickness: =0
                Color: =RGBA(39, 113, 194, 1)
                Default: ="Quyền lợi chi tiết"
                DisabledBorderColor: =RGBA(255, 255, 255, 1)
                DisabledFill: =RGBA(255, 255, 255, 1)
                Height: =27
                HoverBorderColor: =RGBA(255, 255, 255, 1)
                HoverColor: =RGBA(39, 113, 194, 1)
                HoverFill: =RGBA(255, 255, 255, 1)
                OnSelect: |
                    =If(
                        IsBlank(cbxMaSPNHD_2.Selected.MA_SAN_PHAM),
                        Notify(
                            "Bắt buộc chọn sản phẩm",
                            NotificationType.Error,
                            2000
                        ),
                        (ThisItem.edited=1 && IsBlank(cbxMaCTNHD_2.Selected.MA_CHUONG_TRINH)) || (ThisItem.edited=0 && IsBlank(cbxMaCTNHDHide_1.Selected.MA_CHUONG_TRINH)),
                        Notify(
                            "Bắt buộc chọn chương trình",
                            NotificationType.Error,
                            2000
                        ),
                        IsEmpty(cbxNhomTPNHD_1.SelectedItems),
                        Notify(
                            "Bắt buộc chọn nhóm tính phí",
                            NotificationType.Error,
                            2000
                        ),
                        Set(idHopDongSPQLCT,ThisItem.ID);
                        Set(maSPQLCTNHD,cbxMaSPNHD_2.Selected.MA_SAN_PHAM);
                        Set(maHDQLCTNHD,First(objHD).MA_HOP_DONG);
                        Set(
                            maCTQLCTNHD,
                            If(
                                ThisItem.edited=1,
                                cbxMaCTNHD_2.Selected.MA_CHUONG_TRINH,
                                cbxMaCTNHDHide_1.Selected.MA_CHUONG_TRINH
                            )
                        );
                        Set(maNhomTPQLCTNHD,Concat(cbxNhomTPNHD_1.SelectedItems,Value,"|"));
                        UpdateContext({
                            objChangeQLCTNHD:First(
                                Filter(
                                    tmpQLCTHDSPNHDCollect,
                                    ID_HOPDONG_SP=ThisItem.ID
                                )
                            )
                        });
                        ClearCollect(
                            tmpChangeQLCTNHD,
                            {
                                check:false
                            }
                        );
                        If(
                            objChangeQLCTNHD.MA_SAN_PHAM<>cbxMaSPNHD_2.Selected.MA_SAN_PHAM || 
                            objChangeQLCTNHD.MA_CHUONG_TRINH<>maCTQLCTNHD,
                            //Notify("alo11",NotificationType.Error,1000);
                            UpdateIf(
                                tmpChangeQLCTNHD,
                                true,
                                {
                                    check:true
                                }
                            )
                        );
                        ForAll(
                            Split(maNhomTPQLCTNHD,"|") As ds,
                            If(
                                IsBlank(Find(ds.Value,objChangeQLCTNHD.NHOM_TINH_PHI)),
                                UpdateIf(
                                    tmpChangeQLCTNHD,
                                    true,
                                    {
                                        check:true
                                    }
                                )
                            )
                        );
                        ForAll(
                            Split(objChangeQLCTNHD.NHOM_TINH_PHI,"|") As ds,
                            If(
                                IsBlank(Find(ds.Value,maNhomTPQLCTNHD)),
                                UpdateIf(
                                    tmpChangeQLCTNHD,
                                    true,
                                    {
                                        check:true
                                    }
                                )
                            )
                        );
                        If(
                            First(tmpChangeQLCTNHD).check,
                            RemoveIf(
                                tmpQLCTHDSPNHDCollect,
                                ID_HOPDONG_SP=ThisItem.ID
                            )
                        );
                        If(
                            CountIf(Filter(tmpQLCTHDSPNHDCollect,ID_HOPDONG_SP=ThisItem.ID),true)=0,
                            //Notify("alo",NotificationType.Error,1000);
                            ForAll(
                                Filter(
                                    DL_CHUONGTRINH_QLCTS,
                                    MA_CHUONG_TRINH = maCTQLCTNHD && MA_SAN_PHAM = maSPQLCTNHD &&
                                    MA_NHOM_QL in Distinct(Filter(DL_SAN_PHAM_NHOMQLS,MA_SP = maSPQLCTNHD && 
                                        !IsBlank(Find(maCTQLCTNHD,CHUONGTRINH_APDUNG)) &&
                                        !IsBlank(Find(MA_NHOM_TINHPHI,maNhomTPQLCTNHD))
                                    ),MA_NHOM_QL)
                                ) As ql,
                                Collect(
                                    tmpQLCTHDSPNHDCollect,
                                    {
                                        MA_CHUONG_TRINH: maCTQLCTNHD,
                                        MA_SAN_PHAM: cbxMaSPNHD_2.Selected.MA_SAN_PHAM,
                                        NHOM_TINH_PHI:Concat(cbxNhomTPNHD_1.SelectedItems,Value,"|"),
                                        MA_QL_CT: ql.MA_QL_CT,
                                        TT_HIENTHI: ql.TT_HIENTHI,
                                        MA_NHOM_QL: ql.MA_NHOM_QL,
                                        GH_SOLAN_NAM: ql.GH_SOLAN_NAM,
                                        GH_SONGAY_NAM: ql.GH_SONGAY_NAM,
                                        GH_SOTIEN_BENH: ql.GH_SOTIEN_BENH,
                                        GH_SOTIEN_NAM: ql.GH_SOTIEN_NAM,
                                        GH_SOTIEN_NGAY: ql.GH_SOTIEN_NGAY,
                                        GH_SOTIEN_VU: ql.GH_SOTIEN_VU,
                                        PT_TU_CHITRA: ql.PT_TU_CHITRA,
                                        SO_TIEN_BH: ql.SO_TIEN_BH,
                                        TEN_QUYEN_LOI_HT: ql.TEN_QUYEN_LOI_HT,
                                        ID_HOPDONG_SP:ThisItem.ID,
                                        edited:0
                                    }
                                )
                            )
                        );
                        If(
                            ThisItem.edited = 1,
                            Set(
                                modeMHQLCT,
                                "1"
                            ),
                            Set(
                                modeMHQLCT,
                                "0"
                            )
                        );
                        Navigate(DSQuyenLoiHD)
                    )
                Size: =11
                Underline: =true
                Visible: |-
                    =//If(!IsBlank(tiMaHDNHD.Text),true,false)
                    true
                Width: =169
                Y: =259
                ZIndex: =23

            tiPhiDCNHD_1 As text:
                Align: =Align.Right
                BorderColor: =RGBA(72, 163, 62, 1)
                Default: |-
                    =If (
                        ThisItem.edited=1,
                        If(LookUp(tmpMaCTChangeNHD,ID=ThisItem.ID,PHI_DIEU_CHINH)=0,Blank(),LookUp(tmpMaCTChangeNHD,ID=ThisItem.ID,PHI_DIEU_CHINH)),
                        If(ThisItem.PHI_DIEU_CHINH=0,Blank(),ThisItem.PHI_DIEU_CHINH)
                    )
                DisplayMode: =If(ThisItem.edited=1,DisplayMode.Edit,DisplayMode.Disabled)
                Format: =TextFormat.Number
                Height: =32
                OnChange: |-
                    =If(
                        Value(tiPhiDCNHD_1.Text)=0,
                        UpdateIf(
                            tmpMaCTChangeNHD,
                            ID=ThisItem.ID,
                            {
                                PHI_DIEU_CHINH:Blank()
                            }
                        );
                        Reset(tiPhiDCNHD_1)
                    );
                    If(
                        IsBlank(tiPhiDCNHD_1.Text) || Value(tiPhiDCNHD_1.Text)=0,
                        UpdateContext({
                            tongPhiNDBH:LookUp(tmpMaCTChangeNHD,ID=ThisItem.ID,TONG_PHI_DANHSACH)
                        });
                        UpdateIf(
                            tmpMaCTChangeNHD,
                            ID=ThisItem.ID,
                            {
                                TONG_TIEN_PHI:tongPhiNDBH
                            }
                        );
                        Reset(tiTongPhiNHD_1),
                        Value(tiPhiDCNHD_1.Text)<>ThisItem.PHI_DIEU_CHINH && !IsBlank(tiPhiDCNHD_1.Text) && Value(tiPhiDCNHD_1.Text)<>0,
                        UpdateIf(
                            tmpMaCTChangeNHD,
                            ID=ThisItem.ID,
                            {
                                TONG_TIEN_PHI:Value(tiPhiDCNHD_1.Text)*Value(tiSoNTGSPNHD_1.Text)
                            }
                        );
                        Reset(tiTongPhiNHD_1)
                    )
                RadiusBottomLeft: =0
                RadiusBottomRight: =0
                RadiusTopLeft: =0
                RadiusTopRight: =0
                Size: =11
                Visible: =false
                Width: =250
                X: =46
                Y: =186
                ZIndex: =24

            tiNhomTPNHD_1 As text:
                BorderColor: =RGBA(72, 163, 62, 1)
                Default: =Concat(Split(ThisItem.NHOM_TINH_PHI,"|"), Value,", ") 
                DisplayMode: =DisplayMode.Disabled
                Height: =32
                RadiusBottomLeft: =0
                RadiusBottomRight: =0
                RadiusTopLeft: =0
                RadiusTopRight: =0
                Size: =11
                Visible: |
                    =ThisItem.edited=0
                Width: =250
                Y: =203
                ZIndex: =26

            cbxMaCTNHDHide_1 As combobox:
                BorderColor: =RGBA(72, 163, 62, 1)
                DefaultSelectedItems: |-
                    =/*If (
                        ThisItem.edited=1,
                        LookUp(
                            ' DL_SAN_PHAM_CT',
                            MA_SAN_PHAM=cbxMaSPNHD.Selected.MA_SAN_PHAM && MA_CHUONG_TRINH=tiMaCTNHD.Text
                        ),
                        LookUp(
                            ' DL_SAN_PHAM_CT',
                            MA_SAN_PHAM=cbxMaSPNHD.Selected.MA_SAN_PHAM && MA_CHUONG_TRINH=ThisItem.MA_CHUONG_TRINH
                        )
                    )*/
                    LookUp(
                        ' DL_SAN_PHAM_CT',
                        MA_CHUONG_TRINH=ThisItem.MA_CHUONG_TRINH
                    )
                DisplayFields: =["cr282_ma_chuongtrinh"]
                DisplayMode: =DisplayMode.Disabled
                Height: =32
                InputTextPlaceholder: =""
                Items: =' DL_SAN_PHAM_CT'
                SearchFields: =["cr282_ma_chuongtrinh"]
                SearchItems: =Search(' DL_SAN_PHAM_CT',cbxMaCTNHDHide_1.SearchText,"cr282_ma_chuongtrinh")
                SelectMultiple: =false
                Size: =11
                Visible: =ThisItem.edited=0
                Width: =250
                X: =672
                Y: =34
                ZIndex: =29

            RadioGroupCanvas1 As Radio.pcfdataset:
                BasePaletteColor: =RGBA(5, 102, 178, 1)
                DisplayMode: =DisplayMode.Edit
                Font: =Font.'Open Sans'
                FontColor: =RGBA(0, 0, 0, 1)
                FontSize: =15
                Height: =46
                Items: =Filter(' DL_SAN_PHAM_CT',MA_SAN_PHAM=cbxMaSPNHD_2.Selected.MA_SAN_PHAM)
                Layout: ='RadioGroupCanvas.Layout'.Horizontal
                OnSelect: =Select(Parent)
                Width: =1087
                X: =169
                Y: =65
                ZIndex: =30

                MA_ID_SO2 As pcfDataField.textualColumn:
                    FieldDisplayName: ="MA_ID_SO"
                    FieldName: ="cr282_ma_idso"
                    FieldType: ="n"
                    FieldVariantName: ="textualColumn"
                    Order: =8
                    ZIndex: =32

                MA_ID_SO1 As pcfDataField.textualColumn:
                    FieldDisplayName: ="MA_ID_SO"
                    FieldName: ="cr282_ma_id_so"
                    FieldType: ="n"
                    FieldVariantName: ="textualColumn"
                    Order: =7
                    ZIndex: =33

                MA_CHUONG_TRINH1 As pcfDataField.textualColumn:
                    FieldDisplayName: ="MA_CHUONG_TRINH"
                    FieldName: ="cr282_ma_chuongtrinh"
                    FieldType: ="s"
                    FieldVariantName: ="textualColumn"
                    Order: =6
                    ZIndex: =34

                TRANG_THAI2 As pcfDataField.textualColumn:
                    FieldDisplayName: ="TRANG_THAI"
                    FieldName: ="cr282_trang_thai"
                    FieldType: ="n"
                    FieldVariantName: ="textualColumn"
                    Order: =5
                    ZIndex: =35

                MO_TA2 As pcfDataField.textualColumn:
                    FieldDisplayName: ="MO_TA"
                    FieldName: ="cr282_mo_ta"
                    FieldType: ="s"
                    FieldVariantName: ="textualColumn"
                    Order: =4
                    ZIndex: =36

                MA_SAN_PHAM2 As pcfDataField.textualColumn:
                    FieldDisplayName: ="MA_SAN_PHAM"
                    FieldName: ="cr282_ma_san_pham"
                    FieldType: ="s"
                    FieldVariantName: ="textualColumn"
                    Order: =3
                    ZIndex: =37

                TEN_CHUONG_TRINH1 As pcfDataField.textualColumn:
                    FieldDisplayName: ="TEN_CHUONG_TRINH"
                    FieldName: ="cr282_ten_chuong_trinh"
                    FieldType: ="s"
                    FieldVariantName: ="textualColumn"
                    Order: =1
                    ZIndex: =38

                ID1 As pcfDataField.textualColumn:
                    FieldDisplayName: ="ID"
                    FieldName: ="cr282_ma_chuong_trinh"
                    FieldType: ="s"
                    FieldVariantName: ="textualColumn"
                    Order: =2
                    ZIndex: =39

            Label3_91 As label:
                Height: =25
                Size: =11
                Text: ="Chọn chương trình"
                Width: =144
                Y: =73
                ZIndex: =31

            Gallery1 As gallery.galleryVertical:
                DelayItemLoading: =true
                Height: =71
                Items: |-
                    =Filter(
                        ["Nhóm chính","Nhóm bổ sung","Nhóm thai sản","Nha khoa/Chăm sóc răng","Ngoại trú","Nhóm thương tật, tử vong"],
                        Value in
                        Distinct(
                            Filter(
                                DL_SAN_PHAM_NHOMQLS,
                                MA_SP=cbxMaSPNHD_2.Selected.MA_SAN_PHAM && 
                                !IsBlank(RadioGroupCanvas1.Selected.MA_CHUONG_TRINH) && 
                                !IsBlank(Find(LookUp(tmpMaCTChangeNHD,ID=ThisItem.ID,MA_CHUONG_TRINH),CHUONGTRINH_APDUNG))
                            ),
                            MA_NHOM_TINHPHI
                        )
                    )
                Layout: =Layout.Vertical
                LoadingSpinner: =LoadingSpinner.Data
                TemplateSize: =55
                Width: =1087
                WrapCount: =5
                X: =169
                Y: =107
                ZIndex: =32

                CheckboxCanvas1 As Checkbox:
                    DisplayMode: =DisplayMode.Edit
                    Height: =30
                    Label: =""
                    OnCheck: =false
                    OnSelect: =Select(Parent)
                    OnUncheck: =false
                    Width: =40
                    X: =0
                    Y: =11
                    ZIndex: =1

                Label9 As label:
                    OnSelect: =Select(Parent)
                    Size: =11
                    Text: =ThisItem.Value
                    X: =27
                    Y: =6
                    ZIndex: =2

            Label3_94 As label:
                Height: =25
                Size: =11
                Text: ="Nhóm tính phí"
                Width: =144
                Y: =125
                ZIndex: =33

        Button2_8 As button:
            Height: =32
            OnSelect: |+
                =
                    Collect(
                        tmpDSHDSPNHDCollect,
                        Defaults(tmpDSHDSPNHDCollect)
                    );
                    UpdateContext({
                        maHDSP:Max(DL_HOP_DONG_SPS,ID)+1
                    });
                    UpdateIf(
                        tmpDSHDSPNHDCollect,
                        IsBlank(ID),
                        {
                            ID:Text(maHDSP),
                            MA_HOP_DONG:First(objHD).MA_HOP_DONG,
                            edited:1
                        }
                    );
                    ClearCollect(
                        tmpMaCTChangeNHD,
                        tmpDSHDSPNHDCollect
                    );
                    UpdateContext({
                        maAddedHDSPNHD:Text(maHDSP),
                        unReloadMaSP:Blank()
                    });
                    Reset(LinkHDLK);
                
            Size: =11
            Text: ="Thêm mới"
            Width: =100
            Y: =137
            ZIndex: =22

        Loailoc As combobox:
            BorderColor: =RGBA(180, 214, 250, 1)
            ChevronBackground: =RGBA(180, 214, 250, 1)
            DisplayFields: =["TEN"]
            Height: =45
            Items: |-
                =[{MA:"CN",TEN:"Cá nhân"},{MA:"NH",TEN:"Nhóm"}]
            PressedFill: =RGBA(180, 214, 250, 1)
            SearchFields: =["TEN"]
            SearchItems: |-
                =Search([{MA:"CN",TEN:"Cá nhân"},{MA:"NH",TEN:"Nhóm"}],Loailoc.SearchText,"TEN")
            SelectMultiple: =false
            Size: =11
            Width: =217
            Y: =87
            ZIndex: =23

        Label8 As label:
            Height: =35
            Size: =11
            Text: ="Cá nhân/Nhóm"
            Width: =217
            Y: =52
            ZIndex: =24

        cbxGTinhNHD_1 As combobox:
            BorderColor: =RGBA(180, 214, 250, 1)
            ChevronBackground: =RGBA(180, 214, 250, 1)
            DefaultSelectedItems: =LookUp(DM_GIOI_TINHS,MA_GIOI_TINH=First(objHD).GIOI_TINH)
            DisplayFields: =["cr282_ten_gioi_tinh"]
            Height: =45
            InputTextPlaceholder: ="Chọn giới tính"
            Items: =DM_GIOI_TINHS
            SearchFields: =["cr282_ten_gioi_tinh"]
            SearchItems: =Search(DM_GIOI_TINHS,cbxGTinhNHD_1.SearchText,"cr282_ten_gioi_tinh")
            SelectionFill: =RGBA(180, 214, 250, 1)
            SelectMultiple: =false
            Size: =11
            Visible: =If(Loailoc.Selected.MA = "CN", true, false)
            Width: =182
            X: =258
            Y: =86
            ZIndex: =25

        Label8_1 As label:
            Height: =35
            Size: =11
            Text: ="Giới tính"
            Visible: =If(Loailoc.Selected.MA = "CN", true, false)
            Width: =182
            X: =259
            Y: =52
            ZIndex: =26

        dpNSinhNHD_1 As datepicker:
            BorderColor: =RGBA(180, 214, 250, 1)
            DefaultDate: =First(objHD).NGAY_SINH
            EndYear: =2200
            Format: ="dd/mm/yyyy"
            Height: =46
            InputTextPlaceholder: =
            IsEditable: =true
            Size: =11
            StartYear: =1900
            Visible: =If(Loailoc.Selected.MA = "CN", true, false)
            Width: =250
            X: =484
            Y: =86
            ZIndex: =27

        Label8_2 As label:
            Height: =35
            Size: =11
            Text: ="Ngày sinh"
            Visible: =If(Loailoc.Selected.MA = "CN", true, false)
            Width: =250
            X: =484
            Y: =51
            ZIndex: =28

    LeftNavigation_36 As LeftNavigation_9:
        Width: =LeftNavigation_36.MenuWidth - 10
        ZIndex: =2

