Nhapdieukien As screen:
    OnVisible: |
        =Set(varXoaSP, false);
        Set(varXoaKB, false);
        Set(varXoaKH, false);
        Set(varXoaPV, false);
        
        Select(Icon2_1);
        ClearCollect(
            tmpApdungKH,
            GroupBy(
                Filter(
                    DL_DIEUKIEN_APDUNG_LOAI_CT,
                    MA_DIEU_KIEN = varMaDKien && THANH_PHAN = "KH" && AP_DUNG = "1"
                ),
                "cr282_id",
                "cr282_ma_dieu_kien",
                "cr282_thanh_phan",
                "cr282_ap_dung",
                "cr282_ma_tieu_chi",
                "cr282_ten_tieu_chi",
                "group_apdung_kh"
            )
        );
        ClearCollect(
            tmpLoaitruKH,
            GroupBy(
                Filter(
                    DL_DIEUKIEN_APDUNG_LOAI_CT,
                    MA_DIEU_KIEN = varMaDKien && THANH_PHAN = "KH" && AP_DUNG = "2"
                ),
                "cr282_id",
                "cr282_ma_dieu_kien",
                "cr282_thanh_phan",
                "cr282_ap_dung",
                "cr282_ma_tieu_chi",
                "cr282_ten_tieu_chi",
                "group_loaitru_kh"
            )
        );
        ClearCollect(
            tmpApdungPV,
            GroupBy(
                Filter(
                    DL_DIEUKIEN_APDUNG_LOAI_CT,
                    MA_DIEU_KIEN = varMaDKien && THANH_PHAN = "PV" && AP_DUNG = "1"
                ),
                "cr282_id",
                "cr282_ma_dieu_kien",
                "cr282_thanh_phan",
                "cr282_ap_dung",
                "cr282_ma_tieu_chi",
                "cr282_ten_tieu_chi",
                "group_apdung_pv"
            )
        );
        ClearCollect(
            tmpLoaitruPV,
            GroupBy(
                Filter(
                    DL_DIEUKIEN_APDUNG_LOAI_CT,
                    MA_DIEU_KIEN = varMaDKien && THANH_PHAN = "PV" && AP_DUNG = "2"
                ),
                "cr282_id",
                "cr282_ma_dieu_kien",
                "cr282_thanh_phan",
                "cr282_ap_dung",
                "cr282_ma_tieu_chi",
                "cr282_ten_tieu_chi",
                "group_loaitru_pv"
            )
        );
        ClearCollect(
            tmpDsGiatri,
            [
                {
                    Ma: "",
                    Ten: "",
                    Loai: "",
                    cr282_ten_gia_tri: ""
                }
            ]
        );
        // them chi tieu Nhom khach hang
        ForAll(
            DM_NHOM_KH As kh,
            Patch(
                tmpDsGiatri,
                Defaults(tmpDsGiatri),
                {
                    Ma: kh.MA_NHOM_KH,
                    Ten: kh.TEN_NHOM_KH,
                    Loai: "MA_KH_NHOM",
                    cr282_ten_gia_tri: kh.TEN_NHOM_KH
                }
            )
        );
        // them chi tieu LOAI khach hang
        Collect(
            tmpDsGiatri,
            {
                Ma: "0",
                Ten: "Cá nhân",
                Loai: "MA_KH_LOAI",
                cr282_ten_gia_tri: "Cá nhân"
            },
            {
                Ma: "1",
                Ten: "Tổ chức",
                Loai: "MA_KH_LOAI",
                cr282_ten_gia_tri: "Tổ chức"
            }
        );
        // them chi tieu Pham vi
        ForAll(
            DM_PHAMVI_DIALYS As pv,
            Patch(
                tmpDsGiatri,
                Defaults(tmpDsGiatri),
                {
                    Ma: pv.MA_PHAMVI,
                    Ten: pv.TEN_PHAMVI,
                    Loai: If(
                        pv.LOAI = "KHU_VUC",
                        "MA_KHU_VUC",
                        If(
                            pv.LOAI = "QUOC_GIA",
                            "MA_QG",
                            If(
                                pv.LOAI = "VUNG_MIEN",
                                "MA_VUNG_MIEN",
                                If(
                                    pv.LOAI = "TINH_TP",
                                    "MA_TINH_TP",
                                    If(
                                        pv.LOAI = "QUAN_HUYEN",
                                        "MA_QUAN_HUYEN",
                                        If(
                                            pv.LOAI = "DON_VI",
                                            "MA_DON_VI",
                                            "KHAC"
                                        )
                                    )
                                )
                            )
                        )
                    ),
                    cr282_ten_gia_tri: pv.TEN_PHAMVI
                }
            )
        );
        // T.ANH xử lý sản phẩm
        If(
            CountRows(
                Filter(
                    DL_DIEUKIEN_APDUNG_LOAI_CT,
                    MA_DIEU_KIEN = varMaDKien && THANH_PHAN = "SP" && AP_DUNG = "1" && KIEU = "2"
                )
            ) > 0,
            ClearCollect(
                tmpApdungSp,
                GroupBy(
                    Filter(
                        DL_DIEUKIEN_APDUNG_LOAI_CT,
                        MA_DIEU_KIEN = varMaDKien && THANH_PHAN = "SP" && AP_DUNG = "1" && KIEU = "2"
                    ),
                    "cr282_id",
                    "cr282_ma_dieu_kien",
                    "cr282_ap_dung",
                    "cr282_ma_tieu_chi",
                    "cr282_kieu",
                    "cr282_thanh_phan",
                    "cr282_ma_pv_ad",
                    "group"
                )
            );
            
        );
        If(
            CountRows(
                Filter(
                    DL_DIEUKIEN_APDUNG_LOAI_CT,
                    MA_DIEU_KIEN = varMaDKien && THANH_PHAN = "SP" && AP_DUNG = "2" && KIEU = "2"
                )
            ) > 0,
            ClearCollect(
                tmpLoaitruSp,
                GroupBy(
                    Filter(
                        DL_DIEUKIEN_APDUNG_LOAI_CT,
                        MA_DIEU_KIEN = varMaDKien && THANH_PHAN = "SP" && AP_DUNG = "2" && KIEU = "2"
                    ),
                    "cr282_id",
                    "cr282_ma_dieu_kien",
                    "cr282_ap_dung",
                    "cr282_ma_tieu_chi",
                    "cr282_kieu",
                    "cr282_thanh_phan",
                    "cr282_ma_pv_ad",
                    "group"
                )
            )
        );
        // them san pham
        ForAll(
            DL_SAN_PHAM As sp,
            Patch(
                tmpDsGiatri,
                Defaults(tmpDsGiatri),
                {
                    Ma: sp.MA_SAN_PHAM,
                    Loai: "MA_SP",
                    cr282_ten_gia_tri: sp.TEN_SAN_PHAM
                }
            )
        );
        // them combo san pham
        ForAll(
            DL_SAN_PHAM As sp,
            Patch(
                tmpDsGiatri,
                Defaults(tmpDsGiatri),
                {
                    Ma: sp.MA_SAN_PHAM,
                    Loai: "MA_COMBO_SP",
                    cr282_ten_gia_tri: sp.TEN_SAN_PHAM
                }
            )
        );
        Patch(
            tmpDsGiatri,
            Defaults(tmpDsGiatri),
            {
                Ma: "Sức khoẻ",
                Loai: "LHNV",
                cr282_ten_gia_tri: "Sức khoẻ"
            }
        );
        Patch(
            tmpDsGiatri,
            Defaults(tmpDsGiatri),
            {
                Ma: "Tai nạn",
                Loai: "LHNV",
                cr282_ten_gia_tri: "Tai nạn"
            }
        );
        Patch(
            tmpDsGiatri,
            Defaults(tmpDsGiatri),
            {
                Ma: "Trách nhiệm dân sự",
                Loai: "LHNV",
                cr282_ten_gia_tri: "Trách nhiệm dân sự"
            }
        );
        // them chuong trinh
        ForAll(
            ' DL_SAN_PHAM_CT' As sp,
            Patch(
                tmpDsGiatri,
                Defaults(tmpDsGiatri),
                {
                    Ma: sp.MA_CHUONG_TRINH,
                    Loai: "MA_CT",
                    cr282_ten_gia_tri: sp.TEN_CHUONG_TRINH
                }
            )
        );
        //Kenh ban
        ClearCollect(
            tmpApdungKB,
            GroupBy(
                Filter(
                    DL_DIEUKIEN_APDUNG_LOAI_CT,
                    MA_DIEU_KIEN = varMaDKien && THANH_PHAN = "KB" && AP_DUNG = "1"
                ),
                "cr282_id",
                "cr282_ma_dieu_kien",
                "cr282_thanh_phan",
                "cr282_ap_dung",
                "cr282_ma_tieu_chi",
                "cr282_ten_tieu_chi",
                "group_apdung_kb"
            )
        );
        ClearCollect(
            tmpLoaitruKB,
            GroupBy(
                Filter(
                    DL_DIEUKIEN_APDUNG_LOAI_CT,
                    MA_DIEU_KIEN = varMaDKien && THANH_PHAN = "KB" && AP_DUNG = "2"
                ),
                "cr282_id",
                "cr282_ma_dieu_kien",
                "cr282_thanh_phan",
                "cr282_ap_dung",
                "cr282_ma_tieu_chi",
                "cr282_ten_tieu_chi",
                "group_loaitru_kb"
            )
        );
        // them kenh ban
        ForAll(
            DM_KENH_BANS As kb,
            Patch(
                tmpDsGiatri,
                Defaults(tmpDsGiatri),
                {
                    Ma: kb.MA_KENH_BAN,
                    Ten: kb.TEN_KENH_BAN,
                    Loai: "MA_KB_DM",
                    cr282_ten_gia_tri: kb.TEN_KENH_BAN
                }
            )
        );
        ForAll(
            DM_LOAI_KENH_BANS As kb,
            Patch(
                tmpDsGiatri,
                Defaults(tmpDsGiatri),
                {
                    Ma: kb.MA_LOAI_KB,
                    Ten: kb.TEN_LOAI_KB,
                    Loai: "MA_KB_LOAI",
                    cr282_ten_gia_tri: kb.TEN_LOAI_KB
                }
            )
        );
        Collect(
            tmpDsGiatri,
            {
                Ma: "0",
                Ten: "Cá nhân",
                Loai: "MA_KB_NHOM",
                cr282_ten_gia_tri: "Cá nhân"
            },
            {
                Ma: "1",
                Ten: "Tổ chức",
                Loai: "MA_KB_NHOM",
                cr282_ten_gia_tri: "Tổ chức"
            }
        );
        //End Kenh ban

    CanvasDK As fluidGrid.fluidGridWithBlankCard:
        BorderThickness: =0
        Height: =Parent.Height - Self.Y
        Width: =Parent.Width
        Y: =
        ZIndex: =1

        DataCardChung As dataCard:
            BorderColor: =RGBA(0, 0, 0, 1)
            BorderStyle: =BorderStyle.Solid
            BorderThickness: =0
            DisplayMode: =DisplayMode.Edit
            Fill: =RGBA(0, 0, 0, 0)
            Height: =2291
            Width: =Parent.Width
            X: =0
            Y: =0
            ZIndex: =1

            ContainerChung As groupContainer.manualLayoutContainer:
                BorderStyle: =BorderStyle.None
                Fill: =RGBA(255, 255, 255, 1)
                Height: =342
                RadiusBottomLeft: =0
                RadiusBottomRight: =0
                RadiusTopLeft: =0
                RadiusTopRight: =0
                Width: =Parent.Width-130
                X: =130
                ZIndex: =1

                Label1_22 As label:
                    Align: =Align.Justify
                    BorderColor: =RGBA(0, 0, 0, 0)
                    BorderStyle: =BorderStyle.None
                    BorderThickness: =2
                    Color: =RGBA(50, 49, 48, 1)
                    DisabledBorderColor: =RGBA(0, 0, 0, 0)
                    DisabledColor: =RGBA(161, 159, 157, 1)
                    FocusedBorderThickness: =4
                    Font: =Font.'Segoe UI'
                    FontWeight: =FontWeight.Bold
                    Height: =30
                    Size: =11
                    Text: ="1. Thông tin chung"
                    Width: =Parent.Width
                    ZIndex: =1

                FormDKChung As form:
                    BorderColor: =RGBA(255, 255, 255, 1)
                    BorderStyle: =BorderStyle.None
                    DataSource: =DL_DIEUKIEN_APDUNG
                    DefaultMode: =FormMode.New
                    Height: =315
                    Item: |-
                        =If(
                            !VarEditCS,
                            LookUp(
                                DL_DIEUKIEN_APDUNG,
                                MA_DIEU_KIEN = newMaDK
                            ),
                            LookUp(
                                DL_DIEUKIEN_APDUNG,
                                MA_DIEU_KIEN = varMaDKien
                            )
                        )
                    NumberOfColumns: =2
                    Width: =Parent.Width
                    Y: =27
                    ZIndex: =2

                    MA_DIEU_KIEN_DataCard1 As typedDataCard.textualEditCard:
                        BorderColor: =RGBA(245, 245, 245, 1)
                        BorderStyle: =BorderStyle.Solid
                        DataField: ="cr282_ma_dieu_kien"
                        Default: =ThisItem.MA_DIEU_KIEN
                        DisplayMode: =Parent.DisplayMode
                        DisplayName: =DataSourceInfo([@DL_DIEUKIEN_APDUNG],DataSourceInfo.DisplayName,"cr282_ma_dieu_kien")
                        Fill: =RGBA(0, 0, 0, 0)
                        Height: =60
                        MaxLength: =DataSourceInfo([@DL_DIEUKIEN_APDUNG], DataSourceInfo.MaxLength, "cr282_ma_dieu_kien")
                        Required: =true
                        Update: =newMaDK
                        Width: =618
                        X: =0
                        Y: =0
                        ZIndex: =3

                        DataCardKey2_1 As label:
                            AutoHeight: =true
                            BorderColor: =RGBA(0, 0, 0, 0)
                            BorderStyle: =BorderStyle.None
                            BorderThickness: =2
                            Color: =RGBA(50, 49, 48, 1)
                            DisabledBorderColor: =RGBA(0, 0, 0, 0)
                            DisabledColor: =RGBA(161, 159, 157, 1)
                            FocusedBorderThickness: =4
                            FontWeight: =FontWeight.Semibold
                            Height: =34
                            PaddingLeft: =0
                            Size: =11
                            Text: ="Mã điều kiện"
                            Width: =(Parent.Width - 60) * 0.4
                            Wrap: =false
                            X: =30
                            Y: =10 + (DataCardValueMaDK.Height / 2) - (Self.Height / 2)
                            ZIndex: =1

                        DataCardValueMaDK As text:
                            BorderColor: =RGBA(45, 128, 40, 1)
                            Color: =RGBA(50, 49, 48, 1)
                            Default: =Parent.Default
                            DelayOutput: =true
                            DisabledBorderColor: =RGBA(180, 214, 250, 1)
                            DisabledColor: =RGBA(161, 159, 157, 1)
                            DisabledFill: =RGBA(214, 221, 224, 1)
                            DisplayMode: =DisplayMode.Disabled
                            HintText: ="Hệ thống tự sinh"
                            HoverBorderColor: =RGBA(9, 33, 98, 1)
                            HoverColor: =RGBA(50, 49, 48, 1)
                            HoverFill: =RGBA(255, 255, 255, 1)
                            MaxLength: =Parent.MaxLength
                            PaddingLeft: =5
                            PressedBorderColor: =RGBA(127, 178, 57, 1)
                            PressedColor: =RGBA(50, 49, 48, 1)
                            PressedFill: =RGBA(255, 255, 255, 1)
                            RadiusBottomLeft: =0
                            RadiusBottomRight: =0
                            RadiusTopLeft: =0
                            RadiusTopRight: =0
                            Size: =11
                            Tooltip: =Parent.DisplayName
                            Width: =(Parent.Width - 60) * 0.6
                            X: =250
                            Y: =5
                            ZIndex: =2

                    TRANG_THAI_DataCard1_1 As typedDataCard.textualEditCard:
                        BorderColor: =RGBA(245, 245, 245, 1)
                        BorderStyle: =BorderStyle.Solid
                        DataField: ="cr282_trang_thai"
                        Default: =ThisItem.TRANG_THAI
                        DisplayMode: =Parent.DisplayMode
                        DisplayName: =DataSourceInfo([@DL_DIEUKIEN_APDUNG],DataSourceInfo.DisplayName,"cr282_trang_thai")
                        Fill: =RGBA(0, 0, 0, 0)
                        Height: =50
                        MaxLength: =DataSourceInfo([@DL_DIEUKIEN_APDUNG], DataSourceInfo.MaxLength, "cr282_trang_thai")
                        Required: =false
                        Update: =DataCardValueHoatDong.Value
                        Width: =618
                        X: =1
                        Y: =0
                        ZIndex: =3

                        DataCardKey11 As label:
                            AutoHeight: =true
                            BorderColor: =RGBA(0, 0, 0, 0)
                            BorderStyle: =BorderStyle.None
                            BorderThickness: =2
                            Color: =RGBA(50, 49, 48, 1)
                            DisabledBorderColor: =RGBA(0, 0, 0, 0)
                            DisabledColor: =RGBA(161, 159, 157, 1)
                            FocusedBorderThickness: =4
                            FontWeight: =FontWeight.Semibold
                            Height: =34
                            PaddingLeft: =0
                            Size: =11
                            Text: ="Hoạt động"
                            Width: =(Parent.Width - 60) * 0.4
                            Wrap: =false
                            X: =30
                            Y: =10 + (DataCardValueHoatDong.Height / 2) - (Self.Height / 2)
                            ZIndex: =1

                        StarVisible11 As label:
                            Align: =Align.Center
                            BorderColor: =RGBA(0, 0, 0, 0)
                            BorderStyle: =BorderStyle.None
                            BorderThickness: =2
                            Color: =RGBA(50, 49, 48, 1)
                            DisabledBorderColor: =RGBA(0, 0, 0, 0)
                            DisabledColor: =RGBA(161, 159, 157, 1)
                            FocusedBorderThickness: =4
                            Font: =Font.'Segoe UI'
                            FontWeight: =FontWeight.Semibold
                            Height: =DataCardKey11.Height
                            PaddingLeft: =0
                            Text: ="*"
                            Visible: =And(Parent.Required, Parent.DisplayMode=DisplayMode.Edit)
                            Width: =30
                            Wrap: =false
                            Y: =DataCardKey11.Y
                            ZIndex: =4

                        DataCardValueHoatDong As checkbox:
                            BorderColor: =RGBA(9, 33, 98, 1)
                            BorderStyle: =BorderStyle.None
                            BorderThickness: =2
                            CheckboxBorderColor: =RGBA(9, 33, 98, 1)
                            Color: =RGBA(50, 49, 48, 1)
                            Default: =Parent.Default
                            DisabledBorderColor: =RGBA(0, 0, 0, 0)
                            DisabledColor: =RGBA(161, 159, 157, 1)
                            Fill: =RGBA(255, 255, 255, 1)
                            FocusedBorderThickness: =4
                            Height: =40
                            HoverBorderColor: =RGBA(0, 0, 0, 0)
                            HoverColor: =RGBA(50, 49, 48, 1)
                            HoverFill: =RGBA(0, 0, 0, 0)
                            PressedBorderColor: =RGBA(0, 0, 0, 0)
                            PressedColor: =RGBA(50, 49, 48, 1)
                            PressedFill: =RGBA(0, 0, 0, 0)
                            Size: =11
                            Text: =""
                            Width: =40
                            X: =253
                            Y: =10
                            ZIndex: =5

                    SO_VB_DataCard1 As typedDataCard.textualEditCard:
                        BorderColor: =RGBA(245, 245, 245, 1)
                        BorderStyle: =BorderStyle.Solid
                        DataField: ="cr282_so_vb"
                        Default: =ThisItem.SO_VB
                        DisplayMode: =Parent.DisplayMode
                        DisplayName: =DataSourceInfo([@DL_DIEUKIEN_APDUNG],DataSourceInfo.DisplayName,"cr282_so_vb")
                        Fill: =RGBA(0, 0, 0, 0)
                        Height: =50
                        MaxLength: =DataSourceInfo([@DL_DIEUKIEN_APDUNG], DataSourceInfo.MaxLength, "cr282_so_vb")
                        Required: =false
                        Update: =DataCardValueSoVB.Text
                        Width: =618
                        X: =0
                        Y: =1
                        ZIndex: =3

                        DataCardKey9_2 As label:
                            AutoHeight: =true
                            BorderColor: =RGBA(0, 0, 0, 0)
                            BorderStyle: =BorderStyle.None
                            BorderThickness: =2
                            Color: =RGBA(50, 49, 48, 1)
                            DisabledBorderColor: =RGBA(0, 0, 0, 0)
                            DisabledColor: =RGBA(161, 159, 157, 1)
                            FocusedBorderThickness: =4
                            FontWeight: =FontWeight.Semibold
                            Height: =34
                            PaddingLeft: =0
                            Size: =11
                            Text: ="Số văn bản"
                            Width: =(Parent.Width - 60) * 0.4
                            Wrap: =false
                            X: =30
                            Y: =10 + (DataCardValueSoVB.Height / 2) - (Self.Height / 2)
                            ZIndex: =1

                        DataCardValueSoVB As text:
                            BorderColor: =RGBA(180, 214, 250, 1)
                            Color: =RGBA(50, 49, 48, 1)
                            Default: =Parent.Default
                            DelayOutput: =true
                            DisabledBorderColor: =RGBA(180, 214, 250, 1)
                            DisabledColor: =RGBA(161, 159, 157, 1)
                            DisabledFill: =RGBA(214, 221, 224, 1)
                            DisplayMode: =If(varDaGhi,DisplayMode.Disabled,DisplayMode.Edit)
                            HoverBorderColor: =RGBA(9, 33, 98, 1)
                            HoverColor: =RGBA(50, 49, 48, 1)
                            HoverFill: =RGBA(255, 255, 255, 1)
                            MaxLength: =Parent.MaxLength
                            PaddingLeft: =5
                            PressedBorderColor: =RGBA(9, 33, 98, 1)
                            PressedColor: =RGBA(50, 49, 48, 1)
                            PressedFill: =RGBA(255, 255, 255, 1)
                            RadiusBottomLeft: =0
                            RadiusBottomRight: =0
                            RadiusTopLeft: =0
                            RadiusTopRight: =0
                            Size: =11
                            Tooltip: =Parent.DisplayName
                            Width: =(Parent.Width - 60) * 0.6
                            X: =DataCardKey9_2.X + DataCardKey9_2.Width
                            Y: =10
                            ZIndex: =2

                        StarVisible9_2 As label:
                            Align: =Align.Center
                            BorderColor: =RGBA(0, 0, 0, 0)
                            BorderStyle: =BorderStyle.None
                            BorderThickness: =2
                            Color: =RGBA(50, 49, 48, 1)
                            DisabledBorderColor: =RGBA(0, 0, 0, 0)
                            DisabledColor: =RGBA(161, 159, 157, 1)
                            FocusedBorderThickness: =4
                            Font: =Font.'Segoe UI'
                            FontWeight: =FontWeight.Semibold
                            Height: =DataCardKey9_2.Height
                            PaddingLeft: =0
                            Text: ="*"
                            Visible: =And(Parent.Required, Parent.DisplayMode=DisplayMode.Edit)
                            Width: =30
                            Wrap: =false
                            Y: =DataCardKey9_2.Y
                            ZIndex: =4

                    NGAY_VB_DataCard1 As typedDataCard.dateTimeEditCard:
                        BorderColor: =RGBA(0, 0, 0, 1)
                        BorderStyle: =BorderStyle.Solid
                        DataField: ="cr282_ngay_vb"
                        Default: =ThisItem.NGAY_VB
                        DisplayMode: =Parent.DisplayMode
                        DisplayName: =DataSourceInfo([@DL_DIEUKIEN_APDUNG],DataSourceInfo.DisplayName,"cr282_ngay_vb")
                        Fill: =RGBA(0, 0, 0, 0)
                        Height: =50
                        Required: =false
                        Update: =If(Not IsBlank(DateValueVB.SelectedDate), DateValueVB.SelectedDate, Blank())
                        Width: =618
                        X: =1
                        Y: =1
                        ZIndex: =3

                        DataCardKey10_1 As label:
                            AutoHeight: =true
                            BorderColor: =RGBA(0, 0, 0, 0)
                            BorderStyle: =BorderStyle.None
                            BorderThickness: =2
                            Color: =RGBA(50, 49, 48, 1)
                            DisabledBorderColor: =RGBA(0, 0, 0, 0)
                            DisabledColor: =RGBA(161, 159, 157, 1)
                            FocusedBorderThickness: =4
                            FontWeight: =FontWeight.Semibold
                            Height: =34
                            PaddingLeft: =0
                            Size: =11
                            Text: ="Ngày văn bản"
                            Width: =(Parent.Width - 60) * 0.4
                            Wrap: =false
                            X: =30
                            Y: =10
                            ZIndex: =1

                        DateValueVB As datepicker:
                            BorderColor: =RGBA(180, 214, 250, 1)
                            CalendarHeaderFill: =RGBA(16, 110, 190, 1)
                            Color: =RGBA(50, 49, 48, 1)
                            DefaultDate: =Parent.Default
                            DisabledBorderColor: =RGBA(180, 214, 250, 1)
                            DisabledColor: =RGBA(161, 159, 157, 1)
                            DisabledFill: =RGBA(214, 221, 224, 1)
                            DisplayMode: =If(varDaGhi,DisplayMode.Disabled,DisplayMode.Edit)
                            EndYear: =Year(Today())+100
                            Format: ="dd/mm/yyyy"
                            HoverDateFill: =RGBA(184, 187, 184, 1)
                            InputTextPlaceholder: =
                            IsEditable: =true
                            PaddingBottom: =0
                            PaddingLeft: =If(Self.DisplayMode = DisplayMode.Edit, 5, 0)
                            SelectedDateFill: =RGBA(0, 120, 212, 1)
                            Size: =11
                            StartYear: =1899
                            Tooltip: =Parent.DisplayName
                            Width: =(Parent.Width - 60) * 0.6
                            X: =253
                            Y: =10
                            ZIndex: =2

                        StarVisible10_1 As label:
                            Align: =Align.Center
                            BorderColor: =RGBA(0, 0, 0, 0)
                            BorderStyle: =BorderStyle.None
                            BorderThickness: =2
                            Color: =RGBA(50, 49, 48, 1)
                            DisabledBorderColor: =RGBA(0, 0, 0, 0)
                            DisabledColor: =RGBA(161, 159, 157, 1)
                            FocusedBorderThickness: =4
                            Font: =Font.'Segoe UI'
                            FontWeight: =FontWeight.Semibold
                            Height: =DataCardKey10_1.Height
                            PaddingLeft: =0
                            Text: ="*"
                            Visible: =And(Parent.Required, Parent.DisplayMode=DisplayMode.Edit)
                            Width: =30
                            Wrap: =false
                            Y: =DataCardKey10_1.Y
                            ZIndex: =7

                    HIEU_LUC_TU_DataCard1 As typedDataCard.dateTimeEditCard:
                        BorderColor: =RGBA(245, 245, 245, 1)
                        BorderStyle: =BorderStyle.Solid
                        DataField: ="cr282_hieu_luc_tu"
                        Default: =ThisItem.HIEU_LUC_TU
                        DisplayMode: =Parent.DisplayMode
                        DisplayName: =DataSourceInfo([@DL_DIEUKIEN_APDUNG],DataSourceInfo.DisplayName,"cr282_hieu_luc_tu")
                        Fill: =RGBA(0, 0, 0, 0)
                        Height: =50
                        Required: =false
                        Update: =If(Not IsBlank(DateValueTU.SelectedDate), DateValueTU.SelectedDate)
                        Width: =618
                        X: =0
                        Y: =2
                        ZIndex: =3

                        DataCardKey14 As label:
                            AutoHeight: =true
                            BorderColor: =RGBA(0, 0, 0, 0)
                            BorderStyle: =BorderStyle.None
                            BorderThickness: =2
                            Color: =RGBA(50, 49, 48, 1)
                            DisabledBorderColor: =RGBA(0, 0, 0, 0)
                            DisabledColor: =RGBA(161, 159, 157, 1)
                            FocusedBorderThickness: =4
                            FontWeight: =FontWeight.Semibold
                            Height: =34
                            PaddingLeft: =0
                            Size: =11
                            Text: ="Hiệu lực từ (*)"
                            Width: =(Parent.Width - 60) * 0.4
                            Wrap: =false
                            X: =30
                            Y: =10
                            ZIndex: =1

                        DateValueTU As datepicker:
                            BorderColor: =RGBA(180, 214, 250, 1)
                            CalendarHeaderFill: =RGBA(16, 110, 190, 1)
                            Color: =RGBA(50, 49, 48, 1)
                            DefaultDate: =Parent.Default
                            DisabledBorderColor: =RGBA(180, 214, 250, 1)
                            DisabledColor: =RGBA(161, 159, 157, 1)
                            DisabledFill: =RGBA(214, 221, 224, 1)
                            DisplayMode: =If(varDaGhi,DisplayMode.Disabled,DisplayMode.Edit)
                            EndYear: =Year(Today())+100
                            Format: ="dd/mm/yyyy"
                            HoverDateFill: =RGBA(184, 187, 184, 1)
                            InputTextPlaceholder: =
                            IsEditable: =true
                            PaddingBottom: =0
                            PaddingLeft: =If(Self.DisplayMode = DisplayMode.Edit, 5, 0)
                            SelectedDateFill: =RGBA(0, 120, 212, 1)
                            Size: =11
                            StartYear: =1899
                            Tooltip: =Parent.DisplayName
                            Width: =(Parent.Width - 60) * 0.6
                            X: =DataCardKey14.X + DataCardKey14.Width
                            Y: =10
                            ZIndex: =2

                        StarVisible14 As label:
                            Align: =Align.Center
                            BorderColor: =RGBA(0, 0, 0, 0)
                            BorderStyle: =BorderStyle.None
                            BorderThickness: =2
                            Color: =RGBA(50, 49, 48, 1)
                            DisabledBorderColor: =RGBA(0, 0, 0, 0)
                            DisabledColor: =RGBA(161, 159, 157, 1)
                            FocusedBorderThickness: =4
                            Font: =Font.'Segoe UI'
                            FontWeight: =FontWeight.Semibold
                            Height: =DataCardKey14.Height
                            PaddingLeft: =0
                            Text: ="*"
                            Visible: =And(Parent.Required, Parent.DisplayMode=DisplayMode.Edit)
                            Width: =30
                            Wrap: =false
                            Y: =DataCardKey14.Y
                            ZIndex: =7

                    HIEU_LUC_DEN_DataCard1 As typedDataCard.dateTimeEditCard:
                        BorderColor: =RGBA(245, 245, 245, 1)
                        BorderStyle: =BorderStyle.Solid
                        DataField: ="cr282_hieu_luc_den"
                        Default: =ThisItem.HIEU_LUC_DEN
                        DisplayMode: =Parent.DisplayMode
                        DisplayName: =DataSourceInfo([@DL_DIEUKIEN_APDUNG],DataSourceInfo.DisplayName,"cr282_hieu_luc_den")
                        Fill: =RGBA(0, 0, 0, 0)
                        Height: =60
                        Required: =false
                        Update: =If(Not IsBlank(DateValueDen.SelectedDate), DateValueDen.SelectedDate,Blank())
                        Width: =618
                        X: =1
                        Y: =2
                        ZIndex: =3

                        DataCardKey17 As label:
                            AutoHeight: =true
                            BorderColor: =RGBA(0, 0, 0, 0)
                            BorderStyle: =BorderStyle.None
                            BorderThickness: =2
                            Color: =RGBA(50, 49, 48, 1)
                            DisabledBorderColor: =RGBA(0, 0, 0, 0)
                            DisabledColor: =RGBA(161, 159, 157, 1)
                            FocusedBorderThickness: =4
                            FontWeight: =FontWeight.Semibold
                            Height: =34
                            PaddingLeft: =0
                            Size: =11
                            Text: ="Hiệu lực đến"
                            Width: =(Parent.Width - 60) * 0.4
                            Wrap: =false
                            X: =30
                            Y: =10
                            ZIndex: =1

                        DateValueDen As datepicker:
                            BorderColor: =RGBA(180, 214, 250, 1)
                            CalendarHeaderFill: =RGBA(16, 110, 190, 1)
                            Color: =RGBA(50, 49, 48, 1)
                            DefaultDate: =Parent.Default
                            DisabledBorderColor: =RGBA(180, 214, 250, 1)
                            DisabledColor: =RGBA(161, 159, 157, 1)
                            DisabledFill: =RGBA(214, 221, 224, 1)
                            DisplayMode: =If(varDaGhi,DisplayMode.Disabled,DisplayMode.Edit)
                            EndYear: =Year(Today())+100
                            Format: ="dd/mm/yyyy"
                            HoverDateFill: =RGBA(184, 187, 184, 1)
                            InputTextPlaceholder: =
                            IsEditable: =true
                            PaddingBottom: =0
                            PaddingLeft: =If(Self.DisplayMode = DisplayMode.Edit, 5, 0)
                            SelectedDateFill: =RGBA(0, 120, 212, 1)
                            Size: =11
                            StartYear: =1899
                            Tooltip: =Parent.DisplayName
                            Width: =(Parent.Width - 60) * 0.6
                            X: =DataCardKey17.X + DataCardKey17.Width
                            Y: =10
                            ZIndex: =2

                        StarVisible17 As label:
                            Align: =Align.Center
                            BorderColor: =RGBA(0, 0, 0, 0)
                            BorderStyle: =BorderStyle.None
                            BorderThickness: =2
                            Color: =RGBA(50, 49, 48, 1)
                            DisabledBorderColor: =RGBA(0, 0, 0, 0)
                            DisabledColor: =RGBA(161, 159, 157, 1)
                            FocusedBorderThickness: =4
                            Font: =Font.'Segoe UI'
                            FontWeight: =FontWeight.Semibold
                            Height: =DataCardKey17.Height
                            PaddingLeft: =0
                            Text: ="*"
                            Visible: =And(Parent.Required, Parent.DisplayMode=DisplayMode.Edit)
                            Width: =30
                            Wrap: =false
                            Y: =DataCardKey17.Y
                            ZIndex: =7

                    FILE_DataCard1 As typedDataCard.fileEditCard:
                        BorderColor: =RGBA(245, 245, 245, 1)
                        BorderStyle: =BorderStyle.Solid
                        DataField: ="cr282_file"
                        Default: |-
                            =If(!IsBlank(ThisItem.FILE.FileName), Table({DisplayName: ThisItem.FILE.FileName, Value: ThisItem.FILE.Value}), Blank())
                        DisplayMode: =Parent.DisplayMode
                        DisplayName: =DataSourceInfo([@DL_DIEUKIEN_APDUNG],DataSourceInfo.DisplayName,"cr282_file")
                        Fill: =RGBA(0, 0, 0, 0)
                        Height: =120
                        Required: =false
                        Update: =DataCardValueFile.Attachments
                        Width: =618
                        X: =0
                        Y: =3
                        ZIndex: =3

                        DataCardKey6_2 As label:
                            AutoHeight: =true
                            BorderColor: =RGBA(0, 0, 0, 0)
                            BorderStyle: =BorderStyle.None
                            BorderThickness: =2
                            Color: =RGBA(50, 49, 48, 1)
                            DisabledBorderColor: =RGBA(0, 0, 0, 0)
                            DisabledColor: =RGBA(161, 159, 157, 1)
                            FocusedBorderThickness: =4
                            FontWeight: =FontWeight.Semibold
                            Height: =34
                            PaddingLeft: =0
                            Size: =11
                            Text: ="Tên file"
                            Width: =(Parent.Width - 60) * 0.4
                            Wrap: =false
                            X: =30
                            Y: =10
                            ZIndex: =1

                        DataCardValueFile As attachments:
                            AddAttachmentText: ="Chọn file"
                            BorderColor: =RGBA(230, 230, 230, 1)
                            Color: =RGBA(50, 49, 48, 1)
                            DisabledBorderColor: =RGBA(180, 214, 250, 1)
                            DisabledColor: =RGBA(161, 159, 157, 1)
                            DisabledFill: =RGBA(214, 221, 224, 1)
                            DisplayMode: =If(varDaGhi,DisplayMode.Disabled,DisplayMode.Edit)
                            Height: =101
                            HoverColor: =RGBA(50, 49, 48, 1)
                            HoverFill: =RGBA(245, 245, 245, 1)
                            IsInDataCard: =true
                            ItemColor: =RGBA(0, 0, 0, 1)
                            ItemFill: =RGBA(0, 120, 212, 1)
                            ItemHoverColor: =RGBA(50, 49, 48, 1)
                            ItemHoverFill: =RGBA(245, 245, 245, 1)
                            Items: =Parent.Default
                            ItemSpacing: =12
                            MaxAttachments: =1
                            MaxAttachmentsText: =""
                            NoAttachmentsColor: =RGBA(161, 159, 157, 1)
                            NoAttachmentsText: =""
                            PaddingBottom: =5
                            PaddingLeft: =If(Self.DisplayMode = DisplayMode.Edit, 5, 0)
                            PaddingRight: =5
                            PaddingTop: =5
                            PressedFill: =RGBA(0, 120, 212, 1)
                            Size: =11
                            Tooltip: =Parent.DisplayName
                            Width: =(Parent.Width - 60) * 0.6
                            X: =DataCardKey6_2.X + DataCardKey6_2.Width
                            Y: =10
                            ZIndex: =2

                        StarVisible6_2 As label:
                            Align: =Align.Center
                            BorderColor: =RGBA(0, 0, 0, 0)
                            BorderStyle: =BorderStyle.None
                            BorderThickness: =2
                            Color: =RGBA(50, 49, 48, 1)
                            DisabledBorderColor: =RGBA(0, 0, 0, 0)
                            DisabledColor: =RGBA(161, 159, 157, 1)
                            FocusedBorderThickness: =4
                            Font: =Font.'Segoe UI'
                            FontWeight: =FontWeight.Semibold
                            Height: =DataCardKey6_2.Height
                            PaddingLeft: =0
                            Text: ="*"
                            Visible: =And(Parent.Required, Parent.DisplayMode=DisplayMode.Edit)
                            Width: =30
                            Wrap: =false
                            Y: =DataCardKey6_2.Y
                            ZIndex: =4

                    ID_DataCard1 As typedDataCard.numberEditCard:
                        BorderColor: =RGBA(245, 245, 245, 1)
                        BorderStyle: =BorderStyle.Solid
                        DataField: ="cr282_id"
                        Default: =ThisItem.ID
                        DisplayMode: =Parent.DisplayMode
                        DisplayName: =DataSourceInfo([@DL_DIEUKIEN_APDUNG],DataSourceInfo.DisplayName,"cr282_id")
                        Fill: =RGBA(0, 0, 0, 1)
                        Height: =50
                        Required: =true
                        Update: =newIDMaDD
                        Visible: =false
                        Width: =618
                        X: =605
                        Y: =3
                        ZIndex: =3

                        DataCardKey8_2 As label:
                            AutoHeight: =true
                            BorderColor: =RGBA(0, 0, 0, 0)
                            BorderStyle: =BorderStyle.None
                            BorderThickness: =2
                            Color: =RGBA(50, 49, 48, 1)
                            DisabledBorderColor: =RGBA(0, 0, 0, 0)
                            DisabledColor: =RGBA(161, 159, 157, 1)
                            FocusedBorderThickness: =4
                            Font: =Font.'Segoe UI'
                            FontWeight: =FontWeight.Semibold
                            Height: =34
                            PaddingLeft: =0
                            Text: =Parent.DisplayName
                            Width: =(Parent.Width - 60) * 0.4
                            Wrap: =false
                            X: =30
                            Y: =10 + (DataCardID.Height / 2) - (Self.Height / 2)
                            ZIndex: =1

                        DataCardID As text:
                            BorderColor: =If(IsBlank(Parent.Error), Parent.BorderColor, Color.Red)
                            Color: =RGBA(50, 49, 48, 1)
                            Default: =Parent.Default
                            DelayOutput: =true
                            DisabledBorderColor: =RGBA(0, 0, 0, 0)
                            DisabledColor: =RGBA(161, 159, 157, 1)
                            DisabledFill: =RGBA(242, 242, 241, 0)
                            DisplayMode: =Parent.DisplayMode
                            Font: =Font.'Segoe UI'
                            Format: =TextFormat.Number
                            HoverBorderColor: =RGBA(16, 110, 190, 1)
                            HoverColor: =RGBA(50, 49, 48, 1)
                            HoverFill: =RGBA(255, 255, 255, 1)
                            PaddingLeft: =5
                            PressedBorderColor: =RGBA(0, 120, 212, 1)
                            PressedColor: =RGBA(50, 49, 48, 1)
                            PressedFill: =RGBA(255, 255, 255, 1)
                            RadiusBottomLeft: =0
                            RadiusBottomRight: =0
                            RadiusTopLeft: =0
                            RadiusTopRight: =0
                            Tooltip: =Parent.DisplayName
                            Width: =(Parent.Width - 60) * 0.6
                            X: =DataCardKey8_2.X + DataCardKey8_2.Width
                            Y: =10
                            ZIndex: =2

                        ErrorMessage8_2 As label:
                            AutoHeight: =true
                            BorderColor: =RGBA(0, 0, 0, 0)
                            BorderStyle: =BorderStyle.None
                            BorderThickness: =2
                            DisabledBorderColor: =RGBA(0, 0, 0, 0)
                            DisabledColor: =RGBA(168, 0, 0, 1)
                            FocusedBorderThickness: =4
                            Font: =Font.'Segoe UI'
                            Height: =10
                            Live: =Live.Assertive
                            PaddingBottom: =0
                            PaddingLeft: =0
                            PaddingRight: =0
                            PaddingTop: =0
                            Size: =13
                            Text: =Parent.Error
                            Visible: =Parent.DisplayMode=DisplayMode.Edit
                            Width: =Parent.Width - 60
                            X: =30
                            Y: =DataCardID.Y + DataCardID.Height
                            ZIndex: =3

            Container2_3 As groupContainer.manualLayoutContainer:
                Height: =521
                Width: =Parent.Width-Self.X-14
                X: =130
                Y: =1294
                ZIndex: =2

                Label6_1 As label:
                    FontWeight: =FontWeight.Bold
                    Height: =46
                    Size: =11
                    Text: ="2.3 Khách hàng"
                    Width: =Parent.Width
                    ZIndex: =2

                RadioKH As radio:
                    BorderColor: =RGBA(255, 255, 255, 1)
                    Default: |-
                        =//If(CountRows(Filter(DL_DIEUKIEN_APDUNG_LOAI, MA_DIEU_KIEN =varMaDKien  && THANH_PHAN = "KH" && AP_DUNG = "1")) > 0, LookUp(DL_DIEUKIEN_APDUNG_LOAI, MA_DIEU_KIEN =varMaDKien  && THANH_PHAN = "SP" && AP_DUNG = "1" ).TEN_KIEU, "Tất cả" )
                        If(IsBlank(varMaDKien), "Tất cả",LookUp(DL_DIEUKIEN_APDUNG_LOAI, MA_DIEU_KIEN =varMaDKien  && THANH_PHAN = "KH" && AP_DUNG = "1" ).TEN_KIEU)
                    DisabledBorderColor: =RGBA(255, 255, 255, 1)
                    DisabledFill: =RGBA(255, 255, 255, 1)
                    DisplayMode: =If(varDaGhi,DisplayMode.Disabled,DisplayMode.Edit)
                    HoverColor: =RGBA(0, 0, 0, 1)
                    Items: |-
                        =[{Text:"Tất cả", ID: 1 },{Text:"Một phần", ID: 2}]
                    OnSelect: =true
                    RadioBorderColor: =RGBA(0, 84, 148, 1)
                    Size: =11
                    X: =40
                    Y: =76
                    ZIndex: =3

                GalleryKH_1 As gallery.galleryVertical:
                    BorderColor: =RGBA(180, 214, 250, 1)
                    BorderThickness: =1
                    DelayItemLoading: =true
                    Height: =156
                    Items: =tmpApdungKH
                    Layout: =Layout.Vertical
                    LoadingSpinner: =LoadingSpinner.Data
                    TemplateSize: =46
                    Visible: =If(RadioKH.Selected.ID = 2 , true)
                    Width: =962
                    X: =252
                    Y: =77
                    ZIndex: =4

                    DropKH As dropdown:
                        BorderColor: =RGBA(180, 214, 250, 1)
                        ChevronBackground: =RGBA(255, 255, 255, 1)
                        ChevronFill: =RGBA(180, 214, 250, 1)
                        Default: =ThisItem.cr282_ten_tieu_chi
                        DisabledBorderColor: =RGBA(204, 228, 246, 1)
                        DisabledFill: =RGBA(230, 230, 230, 1)
                        DisplayMode: =If(varDaGhi,DisplayMode.Disabled,DisplayMode.Edit)
                        Items: =Filter(DM_TIEU_CHI_APDUNGS, LOAI = "KH")
                        OnChange: =Reset(ComboBoxGTKH)
                        OnSelect: =
                        Size: =11
                        Width: =200
                        ZIndex: =4

                    ComboBoxGTKH As combobox:
                        BorderColor: =RGBA(180, 214, 250, 1)
                        ChevronBackground: =RGBA(255, 255, 255, 1)
                        ChevronFill: =RGBA(180, 214, 250, 1)
                        DefaultSelectedItems: =ThisItem.group_apdung_kh
                        DisabledBorderColor: =RGBA(204, 228, 246, 1)
                        DisabledFill: =RGBA(230, 230, 230, 1)
                        DisplayFields: =["cr282_ten_gia_tri"]
                        DisplayMode: =If(varDaGhi,DisplayMode.Disabled,DisplayMode.Edit)
                        IsSearchable: =false
                        Items: =Filter( tmpDsGiatri, Loai = DropKH.Selected.MA_CHI_TIEU)
                        OnSelect: =Select(Parent)
                        SearchFields: =["cr282_ten_gia_tri"]
                        SearchItems: =[]
                        Size: =11
                        Width: =643
                        X: =212
                        ZIndex: =5

                    Button5_9 As button:
                        DisplayMode: =If(varDaGhi,DisplayMode.Disabled,DisplayMode.Edit)
                        Height: =28
                        OnSelect: =RemoveIf(tmpApdungKH, cr282_id= ThisItem.cr282_id)
                        Size: =11
                        Text: ="Xoá"
                        Width: =73
                        X: =877
                        Y: =3
                        ZIndex: =6

                    TextInput5 As text:
                        Default: =ThisItem.cr282_id
                        OnSelect: =Select(Parent)
                        Visible: =false
                        X: =246
                        Y: =6
                        ZIndex: =7

                Label7 As label:
                    FontWeight: =FontWeight.Bold
                    Size: =11
                    Text: ="Áp dụng"
                    X: =25
                    Y: =36
                    ZIndex: =5

                RadioKH_LoaiTru As radio:
                    BorderColor: =RGBA(0, 0, 0, 0)
                    Default: |-
                        =
                        
                        If(IsBlank(varMaDKien) Or varXoaKH, "",LookUp(DL_DIEUKIEN_APDUNG_LOAI, MA_DIEU_KIEN =varMaDKien  && THANH_PHAN = "KH" && AP_DUNG = "2" ).TEN_KIEU
                        )
                    DisplayMode: =If(varDaGhi,DisplayMode.Disabled,DisplayMode.Edit)
                    Height: =101
                    HoverColor: =RGBA(0, 0, 0, 1)
                    Items: |-
                        =[{Text:"Một phần", ID: 2}]
                    OnSelect: =true
                    RadioBorderColor: =RGBA(0, 84, 148, 1)
                    Size: =11
                    X: =41
                    Y: =333
                    ZIndex: =6

                GalleryKH_LoaiTru As gallery.galleryVertical:
                    BorderColor: =RGBA(180, 214, 250, 1)
                    BorderThickness: =1
                    DelayItemLoading: =true
                    Height: =156
                    Items: =tmpLoaitruKH
                    Layout: =Layout.Vertical
                    LoadingSpinner: =LoadingSpinner.Data
                    TemplateSize: =46
                    Visible: =If(RadioKH_LoaiTru.Selected.ID = 2 , true)
                    Width: =962
                    X: =252
                    Y: =333
                    ZIndex: =7

                    DropKH_LoaiTru As dropdown:
                        BorderColor: =RGBA(180, 214, 250, 1)
                        ChevronBackground: =RGBA(255, 255, 255, 1)
                        ChevronFill: =RGBA(180, 214, 250, 1)
                        Default: =ThisItem.cr282_ten_tieu_chi
                        DisabledBorderColor: =RGBA(204, 228, 246, 1)
                        DisabledFill: =RGBA(230, 230, 230, 1)
                        DisplayMode: =If(varDaGhi,DisplayMode.Disabled,DisplayMode.Edit)
                        Items: =Filter(DM_TIEU_CHI_APDUNGS, LOAI = "KH")
                        OnChange: =Reset(ComboBoxGTKH_LT)
                        OnSelect: =
                        Size: =11
                        Width: =200
                        ZIndex: =4

                    ComboBoxGTKH_LT As combobox:
                        BorderColor: =RGBA(180, 214, 250, 1)
                        ChevronBackground: =RGBA(255, 255, 255, 1)
                        ChevronFill: =RGBA(180, 214, 250, 1)
                        DefaultSelectedItems: =ThisItem.group_loaitru_kh
                        DisabledBorderColor: =RGBA(204, 228, 246, 1)
                        DisabledFill: =RGBA(230, 230, 230, 1)
                        DisplayFields: =["cr282_ten_gia_tri"]
                        DisplayMode: =If(varDaGhi,DisplayMode.Disabled,DisplayMode.Edit)
                        IsSearchable: =false
                        Items: =Filter( tmpDsGiatri, Loai = DropKH_LoaiTru.Selected.MA_CHI_TIEU)
                        OnSelect: =Select(Parent)
                        SearchFields: =["cr282_ten_gia_tri"]
                        SearchItems: =[]
                        Size: =11
                        Width: =643
                        X: =212
                        ZIndex: =5

                    Button5_10 As button:
                        DisplayMode: =If(varDaGhi,DisplayMode.Disabled,DisplayMode.Edit)
                        Height: =28
                        OnSelect: =RemoveIf(tmpLoaitruKH, cr282_id = ThisItem.cr282_id)
                        Size: =11
                        Text: ="Xoá"
                        Width: =73
                        X: =877
                        Y: =3
                        ZIndex: =6

                    TextInput6 As text:
                        Default: =ThisItem.cr282_id
                        OnSelect: =Select(Parent)
                        Visible: =false
                        X: =190
                        Y: =5
                        ZIndex: =7

                Label7_1 As label:
                    FontWeight: =FontWeight.Bold
                    Size: =11
                    Text: ="Loại trừ"
                    Width: =69
                    X: =25
                    Y: =293
                    ZIndex: =8

                Button3_1 As button:
                    DisplayMode: =If(varDaGhi,DisplayMode.Disabled,DisplayMode.Edit)
                    Height: =25
                    OnSelect: |-
                        =
                        
                        
                        
                        Collect(
                            tmpApdungKH,
                            [{cr282_id:Value( Max (tmpApdungKH, cr282_id) + 1)}]
                        );
                    Size: =11
                    Text: ="Thêm mới"
                    Visible: =If(RadioKH.Selected.ID = 2 , true)
                    Width: =91
                    X: =254
                    Y: =11
                    ZIndex: =9

                Button3_2 As button:
                    DisplayMode: =If(varDaGhi,DisplayMode.Disabled,DisplayMode.Edit)
                    Height: =25
                    OnSelect: |-
                        =
                        
                        Collect(
                            tmpLoaitruKH,
                            [{cr282_id:Value( Max (tmpLoaitruKH, cr282_id) + 1)}]
                        );
                    Size: =11
                    Text: ="Thêm mới"
                    Visible: =If(RadioKH_LoaiTru.Selected.ID = 2 , true)
                    Width: =91
                    X: =252
                    Y: =263
                    ZIndex: =10

                BadgeCanvas1_41 As Badge:
                    BasePaletteColor: =
                    Content: =""
                    DisplayMode: =DisplayMode.Edit
                    FontColor: =
                    Height: =27
                    Visible: =If(RadioKH.Selected.ID = 2 , true)
                    Width: =962
                    X: =252
                    Y: =50
                    ZIndex: =11

                Label11_7 As label:
                    Align: =Align.Center
                    FontWeight: =FontWeight.Bold
                    Height: =27
                    Size: =11
                    Text: ="Giá trị"
                    Visible: =If(RadioKH.Selected.ID = 2 , true)
                    Width: =642
                    X: =472
                    Y: =50
                    ZIndex: =12

                Label11_8 As label:
                    Align: =Align.Center
                    FontWeight: =FontWeight.Bold
                    Height: =27
                    Size: =11
                    Text: ="Tiêu chí"
                    Visible: =If(RadioKH.Selected.ID = 2 , true)
                    Width: =203
                    X: =254
                    Y: =50
                    ZIndex: =13

                BadgeCanvas1_42 As Badge:
                    BasePaletteColor: =
                    Content: =""
                    DisplayMode: =DisplayMode.Edit
                    FontColor: =
                    Height: =27
                    Visible: =If(RadioKH_LoaiTru.Selected.ID = 2 , true)
                    Width: =962
                    X: =252
                    Y: =306
                    ZIndex: =14

                Label11_9 As label:
                    Align: =Align.Center
                    FontWeight: =FontWeight.Bold
                    Height: =27
                    Size: =11
                    Text: ="Giá trị"
                    Visible: =If(RadioKH_LoaiTru.Selected.ID = 2 , true)
                    Width: =642
                    X: =472
                    Y: =306
                    ZIndex: =15

                Label11_10 As label:
                    Align: =Align.Center
                    FontWeight: =FontWeight.Bold
                    Height: =27
                    Size: =11
                    Text: ="Tiêu chí"
                    Visible: =If(RadioKH_LoaiTru.Selected.ID = 2 , true)
                    Width: =203
                    X: =254
                    Y: =306
                    ZIndex: =16

                Icon2_3 As icon.Reload:
                    BorderColor: =RGBA(0, 0, 0, 1)
                    Color: =RGBA(0, 0, 0, 1)
                    Height: =20
                    Icon: =Icon.Cancel
                    OnSelect: |-
                        =Reset(RadioKH_LoaiTru);
                        Set(varXoaKH, true);
                    Width: =20
                    X: =99
                    Y: =303
                    ZIndex: =17

            Container2_4 As groupContainer.manualLayoutContainer:
                Height: =493
                Width: =Parent.Width-Self.X-14
                X: =137
                Y: =1787
                ZIndex: =3

                Label6_2 As label:
                    FontWeight: =FontWeight.Bold
                    Height: =46
                    Size: =11
                    Text: ="2.4 Phạm vi"
                    Width: =Parent.Width
                    ZIndex: =2

                RadioPV As radio:
                    BorderColor: =RGBA(0, 0, 0, 0)
                    Default: |-
                        =//If(CountRows(Filter(DL_DIEUKIEN_APDUNG_LOAI, MA_DIEU_KIEN =varMaDKien  && THANH_PHAN = "PV" && AP_DUNG = "1")) > 0, LookUp(DL_DIEUKIEN_APDUNG_LOAI, MA_DIEU_KIEN =varMaDKien  && THANH_PHAN = "SP" && AP_DUNG = "1" ).TEN_KIEU, "Tất cả" )
                        If(IsBlank(varMaDKien), "Tất cả",LookUp(DL_DIEUKIEN_APDUNG_LOAI, MA_DIEU_KIEN =varMaDKien  && THANH_PHAN = "PV" && AP_DUNG = "1" ).TEN_KIEU)
                    DisplayMode: =If(varDaGhi,DisplayMode.Disabled,DisplayMode.Edit)
                    HoverColor: =RGBA(0, 0, 0, 1)
                    Items: |-
                        =[{Text:"Tất cả", ID: 1 },{Text:"Một phần", ID: 2}]
                    OnSelect: =true
                    RadioBorderColor: =RGBA(0, 84, 148, 1)
                    Size: =11
                    X: =40
                    Y: =76
                    ZIndex: =3

                GalleryPV_1 As gallery.galleryVertical:
                    BorderColor: =RGBA(180, 214, 250, 1)
                    BorderThickness: =1
                    DelayItemLoading: =true
                    Height: =156
                    Items: =tmpApdungPV
                    Layout: =Layout.Vertical
                    LoadingSpinner: =LoadingSpinner.Data
                    TemplateSize: =46
                    Visible: =If(RadioPV.Selected.ID = 2 , true)
                    Width: =962
                    X: =252
                    Y: =76
                    ZIndex: =4

                    DropPV As dropdown:
                        BorderColor: =RGBA(180, 214, 250, 1)
                        ChevronBackground: =RGBA(255, 255, 255, 1)
                        ChevronFill: =RGBA(180, 214, 250, 1)
                        Default: =ThisItem.cr282_ten_tieu_chi
                        DisabledBorderColor: =RGBA(204, 228, 246, 1)
                        DisabledFill: =RGBA(230, 230, 230, 1)
                        DisplayMode: =If(varDaGhi,DisplayMode.Disabled,DisplayMode.Edit)
                        Items: =Filter(DM_TIEU_CHI_APDUNGS, LOAI = "PV")
                        OnChange: =Reset(ComboBoxGTPV)
                        OnSelect: =
                        Size: =11
                        Width: =200
                        ZIndex: =4

                    ComboBoxGTPV As combobox:
                        BorderColor: =RGBA(180, 214, 250, 1)
                        ChevronBackground: =RGBA(255, 255, 255, 1)
                        ChevronFill: =RGBA(180, 214, 250, 1)
                        DefaultSelectedItems: =ThisItem.group_apdung_pv
                        DisabledBorderColor: =RGBA(204, 228, 246, 1)
                        DisabledFill: =RGBA(230, 230, 230, 1)
                        DisplayFields: =["cr282_ten_gia_tri"]
                        DisplayMode: =If(varDaGhi,DisplayMode.Disabled,DisplayMode.Edit)
                        IsSearchable: =false
                        Items: =Filter( tmpDsGiatri, Loai = DropPV.Selected.MA_CHI_TIEU)
                        OnSelect: =Select(Parent)
                        SearchFields: =["cr282_ten_gia_tri"]
                        SearchItems: =[]
                        Size: =11
                        Width: =643
                        X: =212
                        ZIndex: =5

                    Button5_11 As button:
                        DisplayMode: =If(varDaGhi,DisplayMode.Disabled,DisplayMode.Edit)
                        Height: =28
                        OnSelect: =RemoveIf(tmpApdungPV, ThisItem.cr282_id=cr282_id)
                        Size: =11
                        Text: ="Xoá"
                        Width: =73
                        X: =877
                        Y: =3
                        ZIndex: =6

                    TextInput7 As text:
                        Default: =ThisItem.cr282_id
                        OnSelect: =Select(Parent)
                        Visible: =false
                        X: =211
                        Y: =6
                        ZIndex: =7

                Label7_2 As label:
                    FontWeight: =FontWeight.Bold
                    Size: =11
                    Text: ="Áp dụng"
                    X: =25
                    Y: =36
                    ZIndex: =5

                RadioPV_LoaiTru As radio:
                    BorderColor: =RGBA(0, 0, 0, 0)
                    Default: |-
                        =
                        If(IsBlank(varMaDKien) Or varXoaPV, "",LookUp(DL_DIEUKIEN_APDUNG_LOAI, MA_DIEU_KIEN =varMaDKien  && THANH_PHAN = "PV" && AP_DUNG = "2" ).TEN_KIEU)
                    DisplayMode: =If(varDaGhi,DisplayMode.Disabled,DisplayMode.Edit)
                    HoverColor: =RGBA(0, 0, 0, 1)
                    Items: |-
                        =[{Text:"Một phần", ID: 2}]
                    OnSelect: =true
                    RadioBorderColor: =RGBA(0, 84, 148, 1)
                    Size: =11
                    X: =41
                    Y: =304
                    ZIndex: =6

                GalleryPV_LoaiTru As gallery.galleryVertical:
                    BorderColor: =RGBA(180, 214, 250, 1)
                    BorderThickness: =1
                    DelayItemLoading: =true
                    Height: =156
                    Items: =tmpLoaitruPV
                    Layout: =Layout.Vertical
                    LoadingSpinner: =LoadingSpinner.Data
                    TemplateSize: =46
                    Visible: =If(RadioPV_LoaiTru.Selected.ID = 2 ,true)
                    Width: =962
                    X: =252
                    Y: =304
                    ZIndex: =7

                    DropPV_LoaiTru As dropdown:
                        BorderColor: =RGBA(180, 214, 250, 1)
                        ChevronBackground: =RGBA(255, 255, 255, 1)
                        ChevronFill: =RGBA(180, 214, 250, 1)
                        Default: =ThisItem.cr282_ten_tieu_chi
                        DisabledBorderColor: =RGBA(204, 228, 246, 1)
                        DisabledFill: =RGBA(230, 230, 230, 1)
                        DisplayMode: =If(varDaGhi,DisplayMode.Disabled,DisplayMode.Edit)
                        Items: =Filter(DM_TIEU_CHI_APDUNGS, LOAI = "PV")
                        OnChange: =Reset(ComboBoxGTPV_LT)
                        OnSelect: =
                        Size: =11
                        Width: =200
                        ZIndex: =4

                    ComboBoxGTPV_LT As combobox:
                        BorderColor: =RGBA(180, 214, 250, 1)
                        ChevronBackground: =RGBA(255, 255, 255, 1)
                        ChevronFill: =RGBA(9, 33, 98, 1)
                        DefaultSelectedItems: =ThisItem.group_loaitru_pv
                        DisabledBorderColor: =RGBA(204, 228, 246, 1)
                        DisabledFill: =RGBA(230, 230, 230, 1)
                        DisplayFields: =["cr282_ten_gia_tri"]
                        DisplayMode: =If(varDaGhi,DisplayMode.Disabled,DisplayMode.Edit)
                        IsSearchable: =false
                        Items: =Filter( tmpDsGiatri, Loai = DropPV_LoaiTru.Selected.MA_CHI_TIEU)
                        OnSelect: =Select(Parent)
                        SearchFields: =["cr282_ten_gia_tri"]
                        SearchItems: =[]
                        Size: =11
                        Width: =643
                        X: =212
                        ZIndex: =5

                    Button5_12 As button:
                        DisplayMode: =If(varDaGhi,DisplayMode.Disabled,DisplayMode.Edit)
                        Height: =28
                        OnSelect: =RemoveIf(tmpLoaitruPV, ThisItem.cr282_id=cr282_id)
                        Size: =11
                        Text: ="Xoá"
                        Width: =73
                        X: =880
                        Y: =9
                        ZIndex: =6

                    TextInput8 As text:
                        Default: =ThisItem.cr282_id
                        Height: =41
                        OnSelect: =Select(Parent)
                        Visible: =false
                        X: =270
                        Y: =5
                        ZIndex: =7

                Label7_3 As label:
                    FontWeight: =FontWeight.Bold
                    Size: =11
                    Text: ="Loại trừ"
                    Width: =71
                    X: =25
                    Y: =264
                    ZIndex: =8

                Button3_3 As button:
                    DisplayMode: =If(varDaGhi,DisplayMode.Disabled,DisplayMode.Edit)
                    Height: =25
                    OnSelect: |-
                        =
                        
                        
                        Collect(
                            tmpApdungPV,
                            [{cr282_id:Value( Max (tmpApdungPV, cr282_id) + 1)}]
                        );
                    Size: =11
                    Text: ="Thêm mới"
                    Visible: =If(RadioPV.Selected.ID = 2 , true)
                    Width: =91
                    X: =252
                    Y: =15
                    ZIndex: =9

                Button3_4 As button:
                    DisplayMode: =If(varDaGhi,DisplayMode.Disabled,DisplayMode.Edit)
                    Height: =25
                    OnSelect: |-
                        =
                        
                        
                        
                        
                        Collect(
                            tmpLoaitruPV,
                            [{cr282_id:Value( Max (tmpLoaitruPV, cr282_id) + 1)}]
                        );
                    Size: =11
                    Text: ="Thêm mới"
                    Visible: =If(RadioPV_LoaiTru.Selected.ID = 2 ,true)
                    Width: =91
                    X: =253.2
                    Y: =245
                    ZIndex: =10

                BadgeCanvas1_43 As Badge:
                    BasePaletteColor: =
                    Content: =""
                    DisplayMode: =DisplayMode.Edit
                    FontColor: =
                    Height: =27
                    Visible: =If(RadioPV.Selected.ID = 2 , true)
                    Width: =962
                    X: =252
                    Y: =47
                    ZIndex: =11

                Label11_11 As label:
                    Align: =Align.Center
                    FontWeight: =FontWeight.Bold
                    Height: =27
                    Size: =11
                    Text: ="Giá trị"
                    Visible: =If(RadioPV.Selected.ID = 2 , true)
                    Width: =642
                    X: =471
                    Y: =47
                    ZIndex: =12

                Label11_12 As label:
                    Align: =Align.Center
                    FontWeight: =FontWeight.Bold
                    Height: =27
                    Size: =11
                    Text: ="Tiêu chí"
                    Visible: =If(RadioPV.Selected.ID = 2 , true)
                    Width: =203
                    X: =253
                    Y: =47
                    ZIndex: =13

                BadgeCanvas1_44 As Badge:
                    BasePaletteColor: =
                    Content: =""
                    DisplayMode: =DisplayMode.Edit
                    FontColor: =
                    Height: =27
                    Visible: =If(RadioPV_LoaiTru.Selected.ID = 2 ,true)
                    Width: =962
                    X: =252
                    Y: =277
                    ZIndex: =14

                Label11_13 As label:
                    Align: =Align.Center
                    FontWeight: =FontWeight.Bold
                    Height: =27
                    Size: =11
                    Text: ="Giá trị"
                    Visible: =If(RadioPV_LoaiTru.Selected.ID = 2 ,true)
                    Width: =642
                    X: =472
                    Y: =277
                    ZIndex: =15

                Label11_14 As label:
                    Align: =Align.Center
                    FontWeight: =FontWeight.Bold
                    Height: =27
                    Size: =11
                    Text: ="Tiêu chí"
                    Visible: =If(RadioPV_LoaiTru.Selected.ID = 2 ,true)
                    Width: =203
                    X: =254
                    Y: =277
                    ZIndex: =16

                Icon2_4 As icon.Reload:
                    BorderColor: =RGBA(0, 0, 0, 1)
                    Color: =RGBA(0, 0, 0, 1)
                    Height: =20
                    Icon: =Icon.Cancel
                    OnSelect: |-
                        =Reset(RadioPV_LoaiTru);
                        Set(varXoaPV, true)
                    Width: =20
                    X: =99
                    Y: =274
                    ZIndex: =17

            SPApdung As groupContainer.manualLayoutContainer:
                BorderStyle: =BorderStyle.None
                Height: =273
                Width: =1222
                X: =130
                Y: =342
                ZIndex: =5

                Label6_4 As label:
                    FontWeight: =FontWeight.Bold
                    Height: =46
                    Size: =11
                    Text: ="2. Điều kiện áp dụng"
                    Width: =Parent.Width
                    ZIndex: =1

                Label6_5 As label:
                    FontWeight: =FontWeight.Bold
                    Height: =46
                    Size: =11
                    Text: ="2.1 Sản phẩm"
                    Width: =222
                    Y: =40
                    ZIndex: =2

                Radio2 As radio:
                    BorderColor: =RGBA(0, 0, 0, 0)
                    Default: |-
                        =//LookUp(DL_DIEUKIEN_APDUNG_LOAI, MA_DIEU_KIEN =varMaDKien  && THANH_PHAN = "SP" && AP_DUNG = "1" ).TEN_KIEU
                        //If(CountRows(Filter(DL_DIEUKIEN_APDUNG_LOAI, MA_DIEU_KIEN =varMaDKien  && THANH_PHAN = "SP" && AP_DUNG = "1")) > 0, LookUp(DL_DIEUKIEN_APDUNG_LOAI, MA_DIEU_KIEN =varMaDKien  && THANH_PHAN = "SP" && AP_DUNG = "1" ).TEN_KIEU, "Tất cả" )
                        If(IsBlank(varMaDKien), "Tất cả",LookUp(DL_DIEUKIEN_APDUNG_LOAI, MA_DIEU_KIEN =varMaDKien  && THANH_PHAN = "SP" && AP_DUNG = "1" ).TEN_KIEU)
                    DisplayMode: =If(varDaGhi,DisplayMode.Disabled,DisplayMode.Edit)
                    HoverColor: =RGBA(0, 0, 0, 1)
                    Items: |-
                        =[{Text:"Tất cả", ID: 1 },{Text:"Một phần", ID: 2}]
                    OnSelect: =true
                    RadioBorderColor: =RGBA(15, 84, 140, 1)
                    Size: =11
                    X: =48
                    Y: =116
                    ZIndex: =3

                Gallery5 As gallery.galleryVertical:
                    BorderColor: =RGBA(180, 214, 250, 1)
                    BorderThickness: =1
                    DelayItemLoading: =true
                    Height: =156
                    Items: |-
                        =
                        tmpApdungSp
                    Layout: =Layout.Vertical
                    LoadingSpinner: =LoadingSpinner.Data
                    TemplateSize: =46
                    Visible: =If(Radio2.Selected.ID = 2 , true)
                    Width: =962
                    X: =252
                    Y: =116
                    ZIndex: =4

                    DropQTich As dropdown:
                        BorderColor: =RGBA(180, 214, 250, 1)
                        ChevronBackground: =RGBA(255, 255, 255, 1)
                        ChevronFill: =RGBA(180, 214, 250, 1)
                        Default: |
                            =LookUp(DL_DIEUKIEN_APDUNG_LOAI_CT, MA_DIEU_KIEN =varMaDKien && THANH_PHAN ="SP" && AP_DUNG = "1" && KIEU = "2" && MA_TIEU_CHI = ThisItem.cr282_ma_tieu_chi).TEN_TIEU_CHI
                        DisabledBorderColor: =RGBA(180, 214, 250, 1)
                        DisabledFill: =RGBA(214, 221, 224, 1)
                        DisplayMode: =If(varDaGhi,DisplayMode.Disabled,DisplayMode.Edit)
                        Items: =Filter(DM_TIEU_CHI_APDUNGS, LOAI = "SP")
                        OnChange: =Reset(ComboBox3)
                        OnSelect: =Reset(ComboBox3);
                        Size: =11
                        Width: =200
                        ZIndex: =4

                    ComboBox3 As combobox:
                        BorderColor: =RGBA(180, 214, 250, 1)
                        ChevronBackground: =RGBA(255, 255, 255, 1)
                        ChevronFill: =RGBA(180, 214, 250, 1)
                        DefaultSelectedItems: =ThisItem.group
                        DisabledBorderColor: =RGBA(180, 214, 250, 1)
                        DisabledFill: =RGBA(214, 221, 224, 1)
                        DisplayFields: =["cr282_ten_gia_tri","Ma"]
                        DisplayMode: =If(varDaGhi,DisplayMode.Disabled,DisplayMode.Edit)
                        IsSearchable: =false
                        Items: =Filter( tmpDsGiatri, Loai = DropQTich.Selected.MA_CHI_TIEU)
                        OnSelect: =Select(Parent)
                        SearchFields: =["cr282_ten_gia_tri"]
                        SearchItems: =[]
                        Width: =423
                        X: =214
                        ZIndex: =5

                    Button5_13 As button:
                        DisplayMode: =If(varDaGhi,DisplayMode.Disabled,DisplayMode.Edit)
                        Height: =28
                        OnSelect: =RemoveIf(tmpApdungSp, cr282_id = ThisItem.cr282_id)
                        Size: =11
                        Text: ="Xoá"
                        Width: =73
                        X: =876
                        Y: =6
                        ZIndex: =6

                    TextInput1 As text:
                        Default: =ThisItem.cr282_id
                        OnSelect: =Select(Parent)
                        Visible: =false
                        Width: =172
                        X: =214
                        Y: =5
                        ZIndex: =7

                    PV_AD As dropdown:
                        BorderColor: =RGBA(180, 214, 250, 1)
                        ChevronBackground: =RGBA(255, 255, 255, 1)
                        ChevronFill: =RGBA(180, 214, 250, 1)
                        Default: |
                            =LookUp(DL_DIEUKIEN_APDUNG_LOAI_CT, MA_DIEU_KIEN =varMaDKien && THANH_PHAN ="SP" && AP_DUNG = "1" && KIEU = "2" && MA_TIEU_CHI = ThisItem.cr282_ma_tieu_chi && MA_PV_AD = ThisItem.cr282_ma_pv_ad).TEN_PV_AD
                        DisabledBorderColor: =RGBA(180, 214, 250, 1)
                        DisabledFill: =RGBA(214, 221, 224, 1)
                        DisplayMode: =If(varDaGhi,DisplayMode.Disabled,DisplayMode.Edit)
                        Items: |
                            =If(DropQTich.Selected.MA_CHI_TIEU ="MA_COMBO_SP", [{Text:"Hợp đồng hiện tại", ID: "1" },{Text:"Liên kết hợp đồng", ID: "2"}], [{Text:"", ID: "" }])
                        OnChange: =
                        OnSelect: =
                        Size: =11
                        Visible: |
                            =If(DropQTich.Selected.MA_CHI_TIEU ="MA_COMBO_SP", true, false)
                        Width: =188
                        X: =648
                        ZIndex: =9

                Label7_4 As label:
                    FontWeight: =FontWeight.Bold
                    Size: =11
                    Text: ="Áp dụng"
                    X: =25
                    Y: =76
                    ZIndex: =5

                Button3_5 As button:
                    DisplayMode: =If(varDaGhi,DisplayMode.Disabled,DisplayMode.Edit)
                    Height: =25
                    OnSelect: |+
                        =Collect(
                            tmpApdungSp,
                            [{cr282_id:Value( Max (tmpApdungSp, cr282_id) + 1)}]
                        );
                        
                    Size: =11
                    Text: ="Thêm mới"
                    Visible: =If(Radio2.Selected.ID = 2 , true)
                    Width: =91
                    X: =254
                    Y: =51
                    ZIndex: =6

                BadgeCanvas1_38 As Badge:
                    BasePaletteColor: =
                    Content: =""
                    DisplayMode: =DisplayMode.Edit
                    FontColor: =
                    Height: =27
                    Visible: =If(Radio2.Selected.ID = 2 , true)
                    Width: =962
                    X: =252
                    Y: =90
                    ZIndex: =7

                Label11 As label:
                    Align: =Align.Center
                    FontWeight: =FontWeight.Bold
                    Height: =27
                    Size: =11
                    Text: ="Tiêu chí"
                    Visible: =If(Radio2.Selected.ID = 2 , true)
                    Width: =203
                    X: =254
                    Y: =90
                    ZIndex: =8

                Label11_1 As label:
                    Align: =Align.Center
                    FontWeight: =FontWeight.Bold
                    Height: =27
                    Size: =11
                    Text: ="Giá trị"
                    Visible: =If(Radio2.Selected.ID = 2 , true)
                    Width: =419
                    X: =473
                    Y: =90
                    ZIndex: =9

                Label11_2 As label:
                    Align: =Align.Center
                    FontWeight: =FontWeight.Bold
                    Height: =26
                    Size: =11
                    Text: ="Phạm vi áp dụng"
                    Visible: =If(Radio2.Selected.ID = 2 , true)
                    Width: =189
                    X: =908
                    Y: =90
                    ZIndex: =10

            SPLoaiTru As groupContainer.manualLayoutContainer:
                Height: =221
                Width: =1222
                X: =131
                Y: =615
                ZIndex: =6

                Radio2_1 As radio:
                    BorderColor: =RGBA(0, 0, 0, 0)
                    Default: |-
                        =
                        If(IsBlank(varMaDKien) Or varXoaSP, "",LookUp(DL_DIEUKIEN_APDUNG_LOAI, MA_DIEU_KIEN =varMaDKien  && THANH_PHAN = "SP" && AP_DUNG = "2" ).TEN_KIEU)
                    DisplayMode: =If(varDaGhi,DisplayMode.Disabled,DisplayMode.Edit)
                    HoverColor: =RGBA(0, 0, 0, 1)
                    Items: |-
                        =[{Text:"Một phần", ID: 2}]
                    OnSelect: =true
                    RadioBorderColor: =RGBA(15, 84, 140, 1)
                    Size: =11
                    X: =43
                    Y: =65
                    ZIndex: =3

                Gallery5_1 As gallery.galleryVertical:
                    BorderColor: =RGBA(180, 214, 250, 1)
                    BorderThickness: =1
                    DelayItemLoading: =true
                    Height: =150
                    Items: =tmpLoaitruSp
                    Layout: =Layout.Vertical
                    LoadingSpinner: =LoadingSpinner.Data
                    TemplateSize: =46
                    Visible: =If(Radio2_1.Selected.ID = 2 , true)
                    Width: =962
                    X: =253.2
                    Y: =65
                    ZIndex: =4

                    DropQTich_1 As dropdown:
                        BorderColor: =RGBA(180, 214, 250, 1)
                        ChevronBackground: =RGBA(255, 255, 255, 1)
                        ChevronFill: =RGBA(180, 214, 250, 1)
                        Default: |
                            =LookUp(DL_DIEUKIEN_APDUNG_LOAI_CT, MA_DIEU_KIEN =varMaDKien && THANH_PHAN ="SP" && AP_DUNG = "2" && KIEU = "2" && MA_TIEU_CHI = ThisItem.cr282_ma_tieu_chi).TEN_TIEU_CHI
                        DisabledBorderColor: =RGBA(180, 214, 250, 1)
                        DisabledFill: =RGBA(214, 221, 224, 1)
                        DisplayMode: =If(varDaGhi,DisplayMode.Disabled,DisplayMode.Edit)
                        Items: =Filter(DM_TIEU_CHI_APDUNGS, LOAI = "SP")
                        OnChange: =
                        OnSelect: =Reset(ComboBox3_1)
                        Size: =11
                        Width: =200
                        ZIndex: =4

                    ComboBox3_1 As combobox:
                        BorderColor: =RGBA(180, 214, 250, 1)
                        ChevronBackground: =RGBA(255, 255, 255, 1)
                        ChevronFill: =RGBA(180, 214, 250, 1)
                        DefaultSelectedItems: =ThisItem.group
                        DisabledBorderColor: =RGBA(180, 214, 250, 1)
                        DisabledFill: =RGBA(214, 221, 224, 1)
                        DisplayFields: =["cr282_ten_gia_tri"]
                        DisplayMode: =If(varDaGhi,DisplayMode.Disabled,DisplayMode.Edit)
                        IsSearchable: =false
                        Items: =Filter( tmpDsGiatri, Loai = DropQTich_1.Selected.MA_CHI_TIEU)
                        OnSelect: =Select(Parent)
                        SearchFields: =["cr282_ten_gia_tri"]
                        SearchItems: =[]
                        Width: =423
                        X: =212
                        ZIndex: =5

                    Button5_14 As button:
                        DisplayMode: =If(varDaGhi,DisplayMode.Disabled,DisplayMode.Edit)
                        Height: =28
                        OnSelect: =RemoveIf(tmpLoaitruSp, cr282_id = ThisItem.cr282_id)
                        Size: =11
                        Text: ="Xoá"
                        Width: =73
                        X: =877
                        Y: =3
                        ZIndex: =6

                    TextInput2 As text:
                        Default: =ThisItem.cr282_id
                        OnSelect: =Select(Parent)
                        Visible: =false
                        Width: =268
                        X: =247
                        Y: =6
                        ZIndex: =7

                    PV_AD_1 As dropdown:
                        BorderColor: =RGBA(180, 214, 250, 1)
                        ChevronBackground: =RGBA(255, 255, 255, 1)
                        ChevronFill: =RGBA(180, 214, 250, 1)
                        Default: |
                            =LookUp(DL_DIEUKIEN_APDUNG_LOAI_CT, MA_DIEU_KIEN =varMaDKien && THANH_PHAN ="SP" && AP_DUNG = "2" && KIEU = "2" && MA_TIEU_CHI = ThisItem.cr282_ma_tieu_chi && MA_PV_AD = ThisItem.cr282_ma_pv_ad).TEN_PV_AD
                        DisabledBorderColor: =RGBA(180, 214, 250, 1)
                        DisabledFill: =RGBA(214, 221, 224, 1)
                        DisplayMode: =If(varDaGhi,DisplayMode.Disabled,DisplayMode.Edit)
                        Items: |
                            =If(DropQTich.Selected.MA_CHI_TIEU ="MA_COMBO_SP", [{Text:"Hợp đồng hiện tại", ID: "1" },{Text:"Liên kết hợp đồng", ID: "2"}], [{Text:"", ID: "" }])
                        OnChange: =
                        OnSelect: =
                        Size: =11
                        Visible: |
                            =If(DropQTich_1.Selected.MA_CHI_TIEU ="MA_COMBO_SP", true, false)
                        Width: =188
                        X: =648
                        ZIndex: =8

                Label7_5 As label:
                    FontWeight: =FontWeight.Bold
                    Size: =11
                    Text: ="Loại trừ"
                    Width: =75
                    X: =24
                    Y: =7
                    ZIndex: =5

                Button3_6 As button:
                    DisplayMode: =If(varDaGhi,DisplayMode.Disabled,DisplayMode.Edit)
                    Height: =25
                    OnSelect: |-
                        =Collect(
                            tmpLoaitruSp,
                            [{cr282_id:Value( Max (tmpLoaitruSp, cr282_id) + 1)}]
                        );
                    Size: =11
                    Text: ="Thêm mới"
                    Visible: =If(Radio2_1.Selected.ID = 2 , true)
                    Width: =91
                    X: =254
                    Y: =7
                    ZIndex: =6

                BadgeCanvas1_45 As Badge:
                    BasePaletteColor: =
                    Content: =""
                    DisplayMode: =DisplayMode.Edit
                    FontColor: =
                    Height: =27
                    Visible: =If(Radio2_1.Selected.ID = 2 , true)
                    Width: =962
                    X: =252
                    Y: =38
                    ZIndex: =7

                Label11_15 As label:
                    Align: =Align.Center
                    FontWeight: =FontWeight.Bold
                    Height: =27
                    Size: =11
                    Text: ="Tiêu chí"
                    Visible: =If(Radio2_1.Selected.ID = 2 , true)
                    Width: =203
                    X: =254
                    Y: =38
                    ZIndex: =8

                Label11_16 As label:
                    Align: =Align.Center
                    FontWeight: =FontWeight.Bold
                    Height: =27
                    Size: =11
                    Text: ="Giá trị"
                    Visible: =If(Radio2_1.Selected.ID = 2 , true)
                    Width: =419
                    X: =473
                    Y: =38
                    ZIndex: =9

                Label11_17 As label:
                    Align: =Align.Center
                    FontWeight: =FontWeight.Bold
                    Height: =26
                    Size: =11
                    Text: ="Phạm vi áp dụng"
                    Visible: =If(Radio2_1.Selected.ID = 2 , true)
                    Width: =189
                    X: =908
                    Y: =38
                    ZIndex: =10

                Icon2_1 As icon.Reload:
                    BorderColor: =RGBA(0, 0, 0, 1)
                    Color: =RGBA(0, 0, 0, 1)
                    Height: =20
                    Icon: =Icon.Cancel
                    OnSelect: |-
                        =Reset(Radio2_1);
                        Set(varXoaSP, true);
                    Width: =20
                    X: =99
                    Y: =15
                    ZIndex: =11

            "'Container2.2' As groupContainer.manualLayoutContainer":
                Height: =458
                Width: =Parent.Width-Self.X-14
                X: =130
                Y: =836
                ZIndex: =7

                Label6_6 As label:
                    FontWeight: =FontWeight.Bold
                    Height: =46
                    Size: =11
                    Text: ="2.2 Kênh bán"
                    Width: =Parent.Width
                    ZIndex: =2

                RadioKB As radio:
                    BorderColor: =RGBA(0, 0, 0, 0)
                    Default: |-
                        =//If(CountRows(Filter(DL_DIEUKIEN_APDUNG_LOAI, MA_DIEU_KIEN =varMaDKien  && THANH_PHAN = "KB" && AP_DUNG = "1")) > 0, LookUp(DL_DIEUKIEN_APDUNG_LOAI, MA_DIEU_KIEN =varMaDKien  && THANH_PHAN = "KB" && AP_DUNG = "1" ).TEN_KIEU, "Tất cả" )
                        If(IsBlank(varMaDKien), "Tất cả",LookUp(DL_DIEUKIEN_APDUNG_LOAI, MA_DIEU_KIEN =varMaDKien  && THANH_PHAN = "KB" && AP_DUNG = "1" ).TEN_KIEU)
                    DisplayMode: =If(varDaGhi,DisplayMode.Disabled,DisplayMode.Edit)
                    HoverColor: =RGBA(0, 0, 0, 1)
                    Items: |-
                        =[{Text:"Tất cả", ID: 1 },{Text:"Một phần", ID: 2}]
                    OnSelect: =true
                    RadioBorderColor: =RGBA(0, 84, 148, 1)
                    Size: =11
                    X: =40
                    Y: =76
                    ZIndex: =3

                GalleryKB As gallery.galleryVertical:
                    BorderColor: =RGBA(180, 214, 250, 1)
                    BorderThickness: =1
                    DelayItemLoading: =true
                    Height: =156
                    Items: =tmpApdungKB
                    Layout: =Layout.Vertical
                    LoadingSpinner: =LoadingSpinner.Data
                    TemplateSize: =46
                    Visible: =If(RadioKB.Selected.ID = 2 , true)
                    Width: =962
                    X: =253
                    Y: =76
                    ZIndex: =4

                    DropKB As dropdown:
                        BorderColor: =RGBA(180, 214, 250, 1)
                        ChevronBackground: =RGBA(255, 255, 255, 1)
                        ChevronFill: =RGBA(180, 214, 250, 1)
                        Default: =ThisItem.cr282_ten_tieu_chi
                        DisabledBorderColor: =RGBA(204, 228, 246, 1)
                        DisabledFill: =RGBA(230, 230, 230, 1)
                        DisplayMode: =If(varDaGhi,DisplayMode.Disabled,DisplayMode.Edit)
                        Items: =Filter(DM_TIEU_CHI_APDUNGS, LOAI = "KB")
                        OnChange: =Reset(ComboBoxGTKB)
                        OnSelect: =
                        Size: =11
                        Width: =200
                        ZIndex: =4

                    ComboBoxGTKB As combobox:
                        BorderColor: =RGBA(180, 214, 250, 1)
                        ChevronBackground: =RGBA(255, 255, 255, 1)
                        ChevronFill: =RGBA(180, 214, 250, 1)
                        DefaultSelectedItems: =ThisItem.group_apdung_kb
                        DisabledBorderColor: =RGBA(204, 228, 246, 1)
                        DisabledFill: =RGBA(230, 230, 230, 1)
                        DisplayFields: =["cr282_ten_gia_tri"]
                        DisplayMode: =If(varDaGhi,DisplayMode.Disabled,DisplayMode.Edit)
                        IsSearchable: =false
                        Items: =Filter( tmpDsGiatri, Loai = DropKB.Selected.MA_CHI_TIEU)
                        OnSelect: =Select(Parent)
                        SearchFields: =["cr282_ten_gia_tri"]
                        SearchItems: =[]
                        Size: =11
                        Width: =643
                        X: =212
                        ZIndex: =5

                    Button5_15 As button:
                        DisplayMode: =If(varDaGhi,DisplayMode.Disabled,DisplayMode.Edit)
                        Height: =28
                        OnSelect: =RemoveIf(tmpApdungKB, cr282_id=ThisItem.cr282_id)
                        Size: =11
                        Text: ="Xoá"
                        Width: =73
                        X: =877
                        Y: =3
                        ZIndex: =6

                    TextInput3 As text:
                        Default: =ThisItem.cr282_id
                        OnSelect: =Select(Parent)
                        Visible: =false
                        Width: =269
                        X: =575
                        Y: =3
                        ZIndex: =7

                Label7_6 As label:
                    FontWeight: =FontWeight.Bold
                    Size: =11
                    Text: ="Áp dụng"
                    X: =25
                    Y: =36
                    ZIndex: =5

                RadioKB_LoaiTru As radio:
                    BorderColor: =RGBA(0, 0, 0, 0)
                    Default: |-
                        =
                        If(IsBlank(varMaDKien) Or varXoaKB, "",LookUp(DL_DIEUKIEN_APDUNG_LOAI, MA_DIEU_KIEN =varMaDKien  && THANH_PHAN = "KB" && AP_DUNG = "2" ).TEN_KIEU )
                    DisplayMode: =If(varDaGhi,DisplayMode.Disabled,DisplayMode.Edit)
                    HoverColor: =RGBA(0, 0, 0, 1)
                    Items: |-
                        =[{Text:"Một phần", ID: 2}]
                    OnSelect: =true
                    RadioBorderColor: =RGBA(0, 84, 148, 1)
                    Size: =11
                    X: =41
                    Y: =295
                    ZIndex: =6

                GalleryKB_LoaiTru As gallery.galleryVertical:
                    BorderColor: =RGBA(180, 214, 250, 1)
                    BorderThickness: =1
                    DelayItemLoading: =true
                    Height: =156
                    Items: =tmpLoaitruKB
                    Layout: =Layout.Vertical
                    LoadingSpinner: =LoadingSpinner.Data
                    TemplateSize: =46
                    Visible: =If(RadioKB_LoaiTru.Selected.ID = 2 , true)
                    Width: =962
                    X: =251
                    Y: =295
                    ZIndex: =7

                    DropKB_LoaiTru As dropdown:
                        BorderColor: =RGBA(180, 214, 250, 1)
                        ChevronBackground: =RGBA(255, 255, 255, 1)
                        ChevronFill: =RGBA(180, 214, 250, 1)
                        Default: =ThisItem.cr282_ten_tieu_chi
                        DisabledBorderColor: =RGBA(204, 228, 246, 1)
                        DisabledFill: =RGBA(230, 230, 230, 1)
                        DisplayMode: =If(varDaGhi,DisplayMode.Disabled,DisplayMode.Edit)
                        Items: =Filter(DM_TIEU_CHI_APDUNGS, LOAI = "KB")
                        OnChange: =Reset(ComboBoxGTKB_LT)
                        OnSelect: =
                        Size: =11
                        Width: =200
                        X: =1
                        ZIndex: =4

                    ComboBoxGTKB_LT As combobox:
                        BorderColor: =RGBA(180, 214, 250, 1)
                        ChevronBackground: =RGBA(255, 255, 255, 1)
                        ChevronFill: =RGBA(180, 214, 250, 1)
                        DefaultSelectedItems: =ThisItem.group_loaitru_kb
                        DisabledBorderColor: =RGBA(204, 228, 246, 1)
                        DisabledFill: =RGBA(230, 230, 230, 1)
                        DisplayFields: =["cr282_ten_gia_tri"]
                        DisplayMode: =If(varDaGhi,DisplayMode.Disabled,DisplayMode.Edit)
                        IsSearchable: =false
                        Items: =Filter( tmpDsGiatri, Loai = DropKB_LoaiTru.Selected.MA_CHI_TIEU)
                        OnSelect: =Select(Parent)
                        SearchFields: =["cr282_ten_gia_tri"]
                        SearchItems: =[]
                        Size: =11
                        Width: =643
                        X: =215
                        ZIndex: =5

                    Button5_16 As button:
                        DisplayMode: =If(varDaGhi,DisplayMode.Disabled,DisplayMode.Edit)
                        Height: =28
                        OnSelect: =RemoveIf(tmpLoaitruKB, cr282_id=ThisItem.cr282_id)
                        Size: =11
                        Text: ="Xoá"
                        Width: =73
                        X: =877
                        Y: =3
                        ZIndex: =6

                    TextInput4 As text:
                        Default: =ThisItem.cr282_id
                        OnSelect: =Select(Parent)
                        Visible: =false
                        X: =231
                        Y: =5
                        ZIndex: =7

                Label7_7 As label:
                    FontWeight: =FontWeight.Bold
                    Size: =11
                    Text: ="Loại trừ"
                    Width: =81
                    X: =25
                    Y: =255
                    ZIndex: =8

                Button3_7 As button:
                    DisplayMode: =If(varDaGhi,DisplayMode.Disabled,DisplayMode.Edit)
                    Height: =25
                    OnSelect: |-
                        =
                        Collect(
                            tmpApdungKB,
                            [{cr282_id:Value( Max (tmpApdungKB, cr282_id) + 1)}]
                        );
                    Size: =11
                    Text: ="Thêm mới"
                    Visible: =If(RadioKB.Selected.ID = 2, true)
                    Width: =91
                    X: =253.2
                    Y: =11
                    ZIndex: =9

                Button3_8 As button:
                    DisplayMode: =If(varDaGhi,DisplayMode.Disabled,DisplayMode.Edit)
                    Height: =25
                    OnSelect: |-
                        =
                        
                        
                        Collect(
                            tmpLoaitruKB,
                            [{cr282_id:Value( Max (tmpLoaitruKB, cr282_id) + 1)}]
                        );
                    Size: =11
                    Text: ="Thêm mới"
                    Visible: =If(RadioKB_LoaiTru.Selected.ID = 2 , true)
                    Width: =91
                    X: =254
                    Y: =241
                    ZIndex: =10

                BadgeCanvas1_39 As Badge:
                    BasePaletteColor: =
                    Content: =""
                    DisplayMode: =DisplayMode.Edit
                    FontColor: =
                    Height: =27
                    Visible: =If(RadioKB.Selected.ID = 2 , true)
                    Width: =962
                    X: =252
                    Y: =49
                    ZIndex: =11

                Label11_3 As label:
                    Align: =Align.Center
                    FontWeight: =FontWeight.Bold
                    Height: =27
                    Size: =11
                    Text: ="Tiêu chí"
                    Visible: =If(RadioKB.Selected.ID = 2 , true)
                    Width: =203
                    X: =253
                    Y: =49
                    ZIndex: =12

                Label11_4 As label:
                    Align: =Align.Center
                    FontWeight: =FontWeight.Bold
                    Height: =27
                    Size: =11
                    Text: ="Giá trị"
                    Visible: =If(RadioKB.Selected.ID = 2 , true)
                    Width: =642
                    X: =472
                    Y: =49
                    ZIndex: =13

                BadgeCanvas1_40 As Badge:
                    BasePaletteColor: =
                    Content: =""
                    DisplayMode: =DisplayMode.Edit
                    FontColor: =
                    Height: =27
                    Visible: =If(RadioKB_LoaiTru.Selected.ID = 2 , true)
                    Width: =962
                    X: =252
                    Y: =268
                    ZIndex: =14

                Label11_5 As label:
                    Align: =Align.Center
                    FontWeight: =FontWeight.Bold
                    Height: =27
                    Size: =11
                    Text: ="Giá trị"
                    Visible: =If(RadioKB_LoaiTru.Selected.ID = 2 , true)
                    Width: =642
                    X: =472
                    Y: =268
                    ZIndex: =15

                Label11_6 As label:
                    Align: =Align.Center
                    FontWeight: =FontWeight.Bold
                    Height: =27
                    Size: =11
                    Text: ="Tiêu chí"
                    Visible: =If(RadioKB_LoaiTru.Selected.ID = 2 , true)
                    Width: =203
                    X: =254
                    Y: =268
                    ZIndex: =16

                Icon2 As icon.Reload:
                    BorderColor: =RGBA(0, 0, 0, 1)
                    Color: =RGBA(0, 0, 0, 1)
                    Height: =20
                    Icon: =Icon.Cancel
                    OnSelect: |-
                        =Reset(RadioKB_LoaiTru);
                        Set(varXoaKB, true);
                    Width: =20
                    X: =99
                    Y: =265
                    ZIndex: =17

    LeftNavigation_27 As LeftNavigation_9:
        Width: =LeftNavigation_27.MenuWidth - 10
        ZIndex: =2

    Button6_11 As button:
        DisplayMode: =If(varDaGhi,DisplayMode.Disabled,DisplayMode.Edit)
        OnSelect: |
            =//Xu ly thong tin chung
            UpdateContext({errorMsgDK: ""});
            //Clear(tmpCheckDup);
            If(
                IsBlank(DataCardID.Text),
                UpdateContext(
                    {
                        newIDMaDD: If(
                            CountIf(
                                DL_DIEUKIEN_APDUNG,
                                true
                            ) = 0,
                            1,
                            Max(
                                DL_DIEUKIEN_APDUNG,
                                ID
                            ) + 1
                        )
                    }
                ),
                UpdateContext({newIDMaDD: Value(DataCardID.Text)})
            );
            If(
                IsBlank(DataCardValueMaDK.Text),
                UpdateContext(
                    {
                        newMaDK: Concatenate(
                            "AD",
                            If(
                                newIDMaDD < 10,
                                "000",
                                If(
                                    newIDMaDD < 100 && newIDMaDD >= 10,
                                    "00",
                                    If(
                                        newIDMaDD < 1000 && newIDMaDD >= 100,
                                        "0",
                                        ""
                                    )
                                )
                            ),
                            Text(newIDMaDD)
                        )
                    }
                ),
                UpdateContext({newMaDK: DataCardValueMaDK.Text})
            );
            If(
                IsBlank(DateValueTU.SelectedDate),
                UpdateContext({errorMsgDK: "Hiệu lực từ là bắt buộc"})
            );
            If(
                IsBlank(errorMsgDK) && !IsBlank(DateValueDen.SelectedDate) && DateValueTU.SelectedDate > DateValueDen.SelectedDate,
                UpdateContext({errorMsgDK: "Hiệu lực đến phải sau hiệu lực từ"})
            );
            //Kiem tra tieu chi la duy nhat
            //San pham - ap dung
            If(
                IsBlank(errorMsgDK) && CountRows(tmpApdungSp) > 0,
                Clear(errorCol);
                Clear(tmpCheckDup);
                ForAll(
                    Gallery5.AllItems As kh,
                    Collect(
                        tmpCheckDup,
                        {
                            Type: "SP",
                            Value: kh.DropQTich.Selected.MA_CHI_TIEU
                        }
                    );
                );
                ForAll(
                    Gallery5.AllItems As kh,
                    If(
                        CountIf(
                            tmpCheckDup,
                            Type = "SP" && Value = kh.DropQTich.Selected.MA_CHI_TIEU
                        ) > 1,
                        Collect(
                            errorCol,
                            {Message: "Trùng tiêu chí áp dụng sản phẩm"}
                        )
                    )
                );
                If(
                    !IsEmpty(errorCol),
                    UpdateContext({errorMsgDK: First(errorCol).Message})
                )
            );
            //san pham - loai tru
            If(
                IsBlank(errorMsgDK) && CountRows(tmpLoaitruSp) > 0,
                Clear(errorCol);
                Clear(tmpCheckDup);
                ForAll(
                    Gallery5_1.AllItems As kh,
                    Collect(
                        tmpCheckDup,
                        {
                            Type: "KH",
                            Value: kh.DropQTich_1.Selected.MA_CHI_TIEU
                        }
                    );
                );
                ForAll(
                    Gallery5_1.AllItems As kh,
                    If(
                        CountIf(
                            tmpCheckDup,
                            Type = "KH" && Value = kh.DropQTich_1.Selected.MA_CHI_TIEU
                        ) > 1,
                        Collect(
                            errorCol,
                            {Message: "Trùng tiêu chí loại trừ sản phẩm"}
                        )
                    )
                );
                If(
                    !IsEmpty(errorCol),
                    UpdateContext({errorMsgDK: First(errorCol).Message})
                )
            );
            //Kenh ban
            //Kenh ban - ap dung
            If(
                IsBlank(errorMsgDK) && CountRows(tmpApdungKB) > 0,
                Clear(errorCol);
                Clear(tmpCheckDup);
                ForAll(
                    GalleryKB.AllItems As kh,
                    Collect(
                        tmpCheckDup,
                        {
                            Type: "KB",
                            Value: kh.DropKB.Selected.MA_CHI_TIEU
                        }
                    );
                );
                ForAll(
                    GalleryKB.AllItems As kh,
                    If(
                        CountIf(
                            tmpCheckDup,
                            Type = "KB" && Value = kh.DropKB.Selected.MA_CHI_TIEU
                        ) > 1,
                        Collect(
                            errorCol,
                            {Message: "Trùng tiêu chí áp dụng kênh bán"}
                        )
                    )
                );
                If(
                    !IsEmpty(errorCol),
                    UpdateContext({errorMsgDK: First(errorCol).Message})
                )
            );
            //Kenh ban - loai tru
            If(
                IsBlank(errorMsgDK) && CountRows(tmpLoaitruKB) > 0,
                Clear(errorCol);
                Clear(tmpCheckDup);
                ForAll(
                    GalleryKB_LoaiTru.AllItems As kh,
                    Collect(
                        tmpCheckDup,
                        {
                            Type: "KB",
                            Value: kh.DropKB_LoaiTru.Selected.MA_CHI_TIEU
                        }
                    );
                );
                ForAll(
                    GalleryKB_LoaiTru.AllItems As kh,
                    If(
                        CountIf(
                            tmpCheckDup,
                            Type = "KB" && Value = kh.DropKB_LoaiTru.Selected.MA_CHI_TIEU
                        ) > 1,
                        Collect(
                            errorCol,
                            {Message: "Trùng tiêu chí loại trừ kênh bán"}
                        )
                    )
                );
                If(
                    !IsEmpty(errorCol),
                    UpdateContext({errorMsgDK: First(errorCol).Message})
                )
            );
            //End kenh ban
            //Khach hang - ap dung
            If(
                IsBlank(errorMsgDK) && CountRows(tmpApdungKH) > 0,
                Clear(errorCol);
                Clear(tmpCheckDup);
                ForAll(
                    GalleryKH_1.AllItems As kh,
                    Collect(
                        tmpCheckDup,
                        {
                            Type: "KH",
                            Value: kh.DropKH.Selected.MA_CHI_TIEU
                        }
                    );
                );
                ForAll(
                    GalleryKH_1.AllItems As kh,
                    If(
                        CountIf(
                            tmpCheckDup,
                            Type = "KH" && Value = kh.DropKH.Selected.MA_CHI_TIEU
                        ) > 1,
                        Collect(
                            errorCol,
                            {Message: "Trùng tiêu chí áp dụng khách hàng"}
                        )
                    )
                );
                If(
                    !IsEmpty(errorCol),
                    UpdateContext({errorMsgDK: First(errorCol).Message})
                )
            );
            //Khach hang - loai tru
            If(
                IsBlank(errorMsgDK) && CountRows(tmpLoaitruKH) > 0,
                Clear(errorCol);
                Clear(tmpCheckDup);
                ForAll(
                    GalleryKH_LoaiTru.AllItems As kh,
                    Collect(
                        tmpCheckDup,
                        {
                            Type: "KH",
                            Value: kh.DropKH_LoaiTru.Selected.MA_CHI_TIEU
                        }
                    );
                );
                ForAll(
                    GalleryKH_LoaiTru.AllItems As kh,
                    If(
                        CountIf(
                            tmpCheckDup,
                            Type = "KH" && Value = kh.DropKH_LoaiTru.Selected.MA_CHI_TIEU
                        ) > 1,
                        Collect(
                            errorCol,
                            {Message: "Trùng tiêu chí loại trừ khách hàng"}
                        )
                    )
                );
                If(
                    !IsEmpty(errorCol),
                    UpdateContext({errorMsgDK: First(errorCol).Message})
                )
            );
            //pham vi - ap dung
            If(
                IsBlank(errorMsgDK) && CountRows(tmpApdungPV) > 0,
                Clear(errorCol);
                Clear(tmpCheckDup);
                ForAll(
                    GalleryPV_1.AllItems As kh,
                    Collect(
                        tmpCheckDup,
                        {
                            Type: "PV",
                            Value: kh.DropPV.Selected.MA_CHI_TIEU
                        }
                    );
                );
                ForAll(
                    GalleryPV_1.AllItems As kh,
                    If(
                        CountIf(
                            tmpCheckDup,
                            Type = "PV" && Value = kh.DropPV.Selected.MA_CHI_TIEU
                        ) > 1,
                        Collect(
                            errorCol,
                            {Message: "Trùng tiêu chí áp dụng phạm vi"}
                        )
                    )
                );
                If(
                    !IsEmpty(errorCol),
                    UpdateContext({errorMsgDK: First(errorCol).Message})
                )
            );
            //Pham vi - loai tru
            If(
                IsBlank(errorMsgDK) && CountRows(tmpLoaitruPV) > 0,
                Clear(errorCol);
                Clear(tmpCheckDup);
                ForAll(
                    GalleryPV_LoaiTru.AllItems As kh,
                    Collect(
                        tmpCheckDup,
                        {
                            Type: "PV",
                            Value: kh.DropPV_LoaiTru.Selected.MA_CHI_TIEU
                        }
                    );
                );
                ForAll(
                    GalleryPV_LoaiTru.AllItems As kh,
                    If(
                        CountIf(
                            tmpCheckDup,
                            Type = "PV" && Value = kh.DropPV_LoaiTru.Selected.MA_CHI_TIEU
                        ) > 1,
                        Collect(
                            errorCol,
                            {Message: "Trùng tiêu chí loại trừ phạm vi"}
                        )
                    )
                );
                If(
                    !IsEmpty(errorCol),
                    UpdateContext({errorMsgDK: First(errorCol).Message})
                )
            );
            If(
                !IsBlank(errorMsgDK),
                Notify(
                    errorMsgDK,
                    NotificationType.Error,
                    800
                ),
                
                SubmitForm(FormDKChung);
                UpdateContext({rcd: newMaDK});
                EditForm(FormDKChung);
                RemoveIf(
                    DL_DIEUKIEN_APDUNG_LOAI,
                    MA_DIEU_KIEN = newMaDK
                );
                RemoveIf(
                    DL_DIEUKIEN_APDUNG_LOAI_CT,
                    MA_DIEU_KIEN = newMaDK
                );
                Set(
                    varIdAdSP,
                    0
                );
                Set(
                    varIdLtSp,
                    0
                );
                // T.ANH LƯU SAN PHAM
            // lưu dữ liệu ở bảng  DL_DIEUKIEN_APDUNG_LOAI
            // THÊM DỮ LIỆU ÁP DỤNG
            Set(
                    varIdAdSP,
                    Max(
                        DL_DIEUKIEN_APDUNG_LOAI,
                        ID
                    ) + 1
                );
                Patch(
                    DL_DIEUKIEN_APDUNG_LOAI,
                    Defaults(DL_DIEUKIEN_APDUNG_LOAI),
                    {
                        ID: varIdAdSP,
                        MA_DIEU_KIEN: newMaDK,
                        THANH_PHAN: "SP",
                        AP_DUNG: "1",
                        KIEU: Radio2.Selected.ID,
                        TEN_KIEU: Radio2.Selected.Text
                    }
                );
                
            // THÊM DỮ LIỆU LOẠI TRỪ
            Set(
                    varIdLtSp,
                    Max(
                        DL_DIEUKIEN_APDUNG_LOAI,
                        ID
                    ) + 1
                );
                If(
                    !IsBlank(Radio2_1.Selected.Text),
                    Patch(
                        DL_DIEUKIEN_APDUNG_LOAI,
                        Defaults(DL_DIEUKIEN_APDUNG_LOAI),
                        {
                            ID: varIdLtSp,
                            MA_DIEU_KIEN: newMaDK,
                            THANH_PHAN: "SP",
                            AP_DUNG: "2",
                            KIEU: Radio2_1.Selected.ID,
                            TEN_KIEU: Radio2_1.Selected.Text
                        }
                    )
                );
                
            // lưu dữ liệu ở bảng chi tiết
            // lưu áp dụng
            If(
                    Radio2.Selected.ID = 2,
                    ForAll(
                        Gallery5.AllItems As ad,
                        ForAll(
                            ad.ComboBox3.SelectedItems As gt,
                            Patch(
                                DL_DIEUKIEN_APDUNG_LOAI_CT,
                                Defaults(DL_DIEUKIEN_APDUNG_LOAI_CT),
                                {
                                    ID: Value(ad.TextInput1.Text),
                                    ID_LOAI: varIdAdSP,
                                    MA_DIEU_KIEN: newMaDK,
                                    THANH_PHAN: "SP",
                                    AP_DUNG: "1",
                                    KIEU: Radio2.Selected.ID,
                                    MA_TIEU_CHI: ad.DropQTich.Selected.MA_CHI_TIEU,
                                    TEN_TIEU_CHI: ad.DropQTich.Selected.TEN_CHI_TIEU,
                                    MA_GIA_TRI: LookUp(
                                        tmpDsGiatri,
                                        cr282_ten_gia_tri = gt.cr282_ten_gia_tri && Loai = ad.DropQTich.Selected.MA_CHI_TIEU
                                    ).Ma,
                                    TEN_GIA_TRI: gt.cr282_ten_gia_tri,
                                    MA_PV_AD:PV_AD.Selected.ID,
                                    TEN_PV_AD:PV_AD.Selected.Text
                                }
                            )
                        )
                    )
                );
                
            // lưu loại trừ
            If(
                    Radio2_1.Selected.ID = 2,
                    ForAll(
                        Gallery5_1.AllItems As ad,
                        ForAll(
                            ad.ComboBox3_1.SelectedItems As gt,
                            Patch(
                                DL_DIEUKIEN_APDUNG_LOAI_CT,
                                Defaults(DL_DIEUKIEN_APDUNG_LOAI_CT),
                                {
                                    ID: Value(TextInput2.Text),
                                    ID_LOAI: varIdAdSP,
                                    MA_DIEU_KIEN: newMaDK,
                                    THANH_PHAN: "SP",
                                    AP_DUNG: "2",
                                    KIEU: Radio2_1.Selected.ID,
                                    MA_TIEU_CHI: ad.DropQTich_1.Selected.MA_CHI_TIEU,
                                    TEN_TIEU_CHI: ad.DropQTich_1.Selected.TEN_CHI_TIEU,
                                    MA_GIA_TRI: LookUp(
                                        tmpDsGiatri,
                                        cr282_ten_gia_tri = gt.cr282_ten_gia_tri && Loai = ad.DropQTich_1.Selected.MA_CHI_TIEU
                                    ).Ma,
                                    TEN_GIA_TRI: gt.cr282_ten_gia_tri,
                                    MA_PV_AD:PV_AD_1.Selected.ID,
                                    TEN_PV_AD:PV_AD_1.Selected.Text
                                }
                            )
                        )
                    )
                );
                
            // lưu dữ liệu ở bảng  DL_DIEUKIEN_APDUNG_LOAI KENH BAN
            Set(
                    varIdAdKB,
                    0
                );
                Set(
                    varIdLtKB,
                    0
                );
                Set(
                    varIdAdKB,
                    Max(
                        DL_DIEUKIEN_APDUNG_LOAI,
                        ID
                    ) + 1
                );
                // ÁP DỤNG
            Patch(
                    DL_DIEUKIEN_APDUNG_LOAI,
                    Defaults(DL_DIEUKIEN_APDUNG_LOAI),
                    {
                        ID: varIdAdKB,
                        MA_DIEU_KIEN: newMaDK,
                        THANH_PHAN: "KB",
                        AP_DUNG: "1",
                        KIEU: RadioKB.Selected.ID,
                        TEN_KIEU: RadioKB.Selected.Text
                    }
                );
                // LOẠI TRỪ
            If(
                    !IsBlank(RadioKB_LoaiTru.Selected.Text),
                    Patch(
                        DL_DIEUKIEN_APDUNG_LOAI,
                        Set(
                            varIdLtKB,
                            Max(
                                DL_DIEUKIEN_APDUNG_LOAI,
                                ID
                            ) + 1
                        );
                        Defaults(DL_DIEUKIEN_APDUNG_LOAI),
                        {
                            ID: Max(
                                DL_DIEUKIEN_APDUNG_LOAI,
                                ID
                            ) + 1,
                            MA_DIEU_KIEN: newMaDK,
                            THANH_PHAN: "KB",
                            AP_DUNG: "2",
                            KIEU: RadioKB_LoaiTru.Selected.ID,
                            TEN_KIEU: RadioKB_LoaiTru.Selected.Text
                        }
                    )
                );
                
            // lưu dữ liệu ở bảng chi tiết
            If(
                    RadioKB.Selected.ID = 2 && CountRows(tmpApdungKB) > 0,
                    ForAll(
                        GalleryKB.AllItems As kh,
                        ForAll(
                            kh.ComboBoxGTKB.SelectedItems As gt,
                            Patch(
                                DL_DIEUKIEN_APDUNG_LOAI_CT,
                                Defaults(DL_DIEUKIEN_APDUNG_LOAI_CT),
                                {
                                    ID: Value( kh.TextInput3.Text),
                                    ID_LOAI: varIdAdKB,
                                    MA_DIEU_KIEN: newMaDK,
                                    THANH_PHAN: "KB",
                                    AP_DUNG: "1",
                                    KIEU: RadioKB.Selected.ID,
                                    MA_TIEU_CHI: kh.DropKB.Selected.MA_CHI_TIEU,
                                    TEN_TIEU_CHI: kh.DropKB.Selected.TEN_CHI_TIEU,
                                    MA_GIA_TRI: LookUp(
                                        tmpDsGiatri,
                                        cr282_ten_gia_tri = gt.cr282_ten_gia_tri && Loai = kh.DropKB.Selected.MA_CHI_TIEU
                                    ).Ma,
                                    TEN_GIA_TRI: gt.cr282_ten_gia_tri
                                }
                            )
                        )
                    )
                );
                
            // lưu dữ liệu ở bảng chi tiết loai trừ
            If(
                    RadioKB_LoaiTru.Selected.ID = 2 && CountRows(tmpLoaitruKB) > 0,
                    ForAll(
                        GalleryKB_LoaiTru.AllItems As kh,
                        ForAll(
                            kh.ComboBoxGTKB_LT.SelectedItems As gt,
                            Patch(
                                DL_DIEUKIEN_APDUNG_LOAI_CT,
                                Defaults(DL_DIEUKIEN_APDUNG_LOAI_CT),
                                {
                                    ID: Value(kh.TextInput4.Text),
                                    ID_LOAI: varIdLtKB,
                                    MA_DIEU_KIEN: newMaDK,
                                    THANH_PHAN: "KB",
                                    AP_DUNG: "2",
                                    KIEU: RadioKB_LoaiTru.Selected.ID,
                                    MA_TIEU_CHI: kh.DropKB_LoaiTru.Selected.MA_CHI_TIEU,
                                    TEN_TIEU_CHI: kh.DropKB_LoaiTru.Selected.TEN_CHI_TIEU,
                                    MA_GIA_TRI: LookUp(
                                        tmpDsGiatri,
                                        cr282_ten_gia_tri = gt.cr282_ten_gia_tri && Loai = kh.DropKB_LoaiTru.Selected.MA_CHI_TIEU
                                    ).Ma,
                                    TEN_GIA_TRI: gt.cr282_ten_gia_tri
                                }
                            )
                        )
                    )
                );
                
            //End kenh ban
            // lưu dữ liệu ở bảng  DL_DIEUKIEN_APDUNG_LOAI KHANH HANG
            Set(
                    varIdAdKH,
                    0
                );
                Set(
                    varIdLtKH,
                    0
                );
                Set(
                    varIdAdKH,
                    Max(
                        DL_DIEUKIEN_APDUNG_LOAI,
                        ID
                    ) + 1
                );
                Patch(
                    DL_DIEUKIEN_APDUNG_LOAI,
                    Defaults(DL_DIEUKIEN_APDUNG_LOAI),
                    {
                        ID: varIdAdKH,
                        MA_DIEU_KIEN: newMaDK,
                        THANH_PHAN: "KH",
                        AP_DUNG: "1",
                        KIEU: RadioKH.Selected.ID,
                        TEN_KIEU: RadioKH.Selected.Text
                    }
                );
                If(
                    !IsBlank(RadioKH_LoaiTru.Selected.Text),
                    Patch(
                        DL_DIEUKIEN_APDUNG_LOAI,
                        Set(
                            varIdLtKH,
                            Max(
                                DL_DIEUKIEN_APDUNG_LOAI,
                                ID
                            ) + 1
                        );
                        Defaults(DL_DIEUKIEN_APDUNG_LOAI),
                        {
                            ID: Max(
                                DL_DIEUKIEN_APDUNG_LOAI,
                                ID
                            ) + 1,
                            MA_DIEU_KIEN: newMaDK,
                            THANH_PHAN: "KH",
                            AP_DUNG: "2",
                            KIEU: RadioKH_LoaiTru.Selected.ID,
                            TEN_KIEU: RadioKB_LoaiTru.Selected.Text
                        }
                    )
                );
                
            // lưu dữ liệu ở bảng chi tiết
            If(
                    RadioKH.Selected.ID = 2 && CountRows(tmpApdungKH) > 0,
                    ForAll(
                        GalleryKH_1.AllItems As kh,
                        ForAll(
                            kh.ComboBoxGTKH.SelectedItems As gt,
                            Patch(
                                DL_DIEUKIEN_APDUNG_LOAI_CT,
                                Defaults(DL_DIEUKIEN_APDUNG_LOAI_CT),
                                {
                                    ID: Value(kh.TextInput5.Text),
                                    ID_LOAI: varIdAdKH,
                                    MA_DIEU_KIEN: newMaDK,
                                    THANH_PHAN: "KH",
                                    AP_DUNG: "1",
                                    KIEU: RadioKH.Selected.ID,
                                    MA_TIEU_CHI: kh.DropKH.Selected.MA_CHI_TIEU,
                                    TEN_TIEU_CHI: kh.DropKH.Selected.TEN_CHI_TIEU,
                                    MA_GIA_TRI: LookUp(
                                        tmpDsGiatri,
                                        cr282_ten_gia_tri = gt.cr282_ten_gia_tri && Loai = kh.DropKH.Selected.MA_CHI_TIEU
                                    ).Ma,
                                    TEN_GIA_TRI: gt.cr282_ten_gia_tri
                                }
                            )
                        )
                    )
                );
                
            // lưu dữ liệu ở bảng chi tiết loai tru
            If(
                    RadioKH_LoaiTru.Selected.ID = 2 && CountRows(tmpLoaitruKH) > 0,
                    ForAll(
                        GalleryKH_LoaiTru.AllItems As kh,
                        ForAll(
                            kh.ComboBoxGTKH_LT.SelectedItems As gt,
                            Patch(
                                DL_DIEUKIEN_APDUNG_LOAI_CT,
                                Defaults(DL_DIEUKIEN_APDUNG_LOAI_CT),
                                {
                                    ID: Value(kh.TextInput6.Text) ,
                                    ID_LOAI: varIdLtKH,
                                    MA_DIEU_KIEN: newMaDK,
                                    THANH_PHAN: "KH",
                                    AP_DUNG: "2",
                                    KIEU: RadioKH_LoaiTru.Selected.ID,
                                    MA_TIEU_CHI: kh.DropKH_LoaiTru.Selected.MA_CHI_TIEU,
                                    TEN_TIEU_CHI: kh.DropKH_LoaiTru.Selected.TEN_CHI_TIEU,
                                    MA_GIA_TRI: LookUp(
                                        tmpDsGiatri,
                                        cr282_ten_gia_tri = gt.cr282_ten_gia_tri && Loai = kh.DropKH_LoaiTru.Selected.MA_CHI_TIEU
                                    ).Ma,
                                    TEN_GIA_TRI: gt.cr282_ten_gia_tri
                                }
                            )
                        )
                    )
                );
                
            // lưu dữ liệu ở bảng  DL_DIEUKIEN_APDUNG_LOAI PHAM_VI
            Set(
                    varIdAdPV,
                    0
                );
                Set(
                    varIdLtPV,
                    0
                );
                Set(
                    varIdAdPV,
                    Max(
                        DL_DIEUKIEN_APDUNG_LOAI,
                        ID
                    ) + 1
                );
                Patch(
                    DL_DIEUKIEN_APDUNG_LOAI,
                    Defaults(DL_DIEUKIEN_APDUNG_LOAI),
                    {
                        ID: varIdAdPV,
                        MA_DIEU_KIEN: newMaDK,
                        THANH_PHAN: "PV",
                        AP_DUNG: "1",
                        KIEU: RadioPV.Selected.ID,
                        TEN_KIEU: RadioPV.Selected.Text
                    }
                );
                If(
                    !IsBlank(RadioPV_LoaiTru.Selected.Text),
                    Patch(
                        DL_DIEUKIEN_APDUNG_LOAI,
                        Set(
                            varIdLtPV,
                            Max(
                                DL_DIEUKIEN_APDUNG_LOAI,
                                ID
                            ) + 1
                        );
                        Defaults(DL_DIEUKIEN_APDUNG_LOAI),
                        {
                            ID: Max(
                                DL_DIEUKIEN_APDUNG_LOAI,
                                ID
                            ) + 1,
                            MA_DIEU_KIEN: newMaDK,
                            THANH_PHAN: "PV",
                            AP_DUNG: "2",
                            KIEU: RadioPV_LoaiTru.Selected.ID,
                            TEN_KIEU: RadioPV_LoaiTru.Selected.Text
                        }
                    )
                );
                
            // lưu dữ liệu ở bảng chi tiết
            If(
                    RadioPV.Selected.ID = 2 && CountRows(tmpApdungPV) > 0,
                    ForAll(
                        GalleryPV_1.AllItems As pv,
                        ForAll(
                            pv.ComboBoxGTPV.SelectedItems As gt,
                            Patch(
                                DL_DIEUKIEN_APDUNG_LOAI_CT,
                                Defaults(DL_DIEUKIEN_APDUNG_LOAI_CT),
                                {
                                    ID: Value(pv.TextInput7.Text),
                                    ID_LOAI: varIdAdPV,
                                    MA_DIEU_KIEN: newMaDK,
                                    THANH_PHAN: "PV",
                                    AP_DUNG: "1",
                                    KIEU: RadioPV.Selected.ID,
                                    MA_TIEU_CHI: pv.DropPV.Selected.MA_CHI_TIEU,
                                    TEN_TIEU_CHI: pv.DropPV.Selected.TEN_CHI_TIEU,
                                    MA_GIA_TRI: LookUp(
                                        tmpDsGiatri,
                                        cr282_ten_gia_tri = gt.cr282_ten_gia_tri && Loai = pv.DropPV.Selected.MA_CHI_TIEU
                                    ).Ma,
                                    TEN_GIA_TRI: gt.cr282_ten_gia_tri
                                }
                            )
                        )
                    )
                );
                
            // lưu dữ liệu ở bảng chi tiết loai trừ
            If(
                    RadioPV_LoaiTru.Selected.ID = 2 && CountRows(tmpLoaitruPV) > 0,
                    ForAll(
                        GalleryPV_LoaiTru.AllItems As kh,
                        ForAll(
                            kh.ComboBoxGTPV_LT.SelectedItems As gt,
                            Patch(
                                DL_DIEUKIEN_APDUNG_LOAI_CT,
                                Defaults(DL_DIEUKIEN_APDUNG_LOAI_CT),
                                {
                                    ID: Value(kh.TextInput8.Text),
                                    ID_LOAI: varIdLtPV,
                                    MA_DIEU_KIEN: newMaDK,
                                    THANH_PHAN: "PV",
                                    AP_DUNG: "2",
                                    KIEU: RadioPV_LoaiTru.Selected.ID,
                                    MA_TIEU_CHI: kh.DropPV_LoaiTru.Selected.MA_CHI_TIEU,
                                    TEN_TIEU_CHI: kh.DropPV_LoaiTru.Selected.TEN_CHI_TIEU,
                                    MA_GIA_TRI: LookUp(
                                        tmpDsGiatri,
                                        cr282_ten_gia_tri = gt.cr282_ten_gia_tri && Loai = kh.DropPV_LoaiTru.Selected.MA_CHI_TIEU
                                    ).Ma,
                                    TEN_GIA_TRI: gt.cr282_ten_gia_tri
                                }
                            )
                        )
                    )
                );
                Notify(
                    "Lưu dữ liệu thành công",
                    NotificationType.Success,
                    800
                ); 
            );
        Size: =11
        Text: ="Lưu dữ liệu"
        Width: =122
        X: =1093
        Y: =728
        ZIndex: =3

    Button6_12 As button:
        OnSelect: =Back();
        Size: =11
        Text: ="Quay lại"
        Width: =81
        X: =1005
        Y: =728
        ZIndex: =4

    ButtonGhi As button:
        DisplayMode: =If(varDaGhi,DisplayMode.Disabled,DisplayMode.Edit)
        OnSelect: |
            =//Xu ly thong tin chung
            //Xu ly thong tin chung
            UpdateContext({errorMsgDK: ""});
            //Clear(tmpCheckDup);
            If(
                IsBlank(DataCardID.Text),
                UpdateContext(
                    {
                        newIDMaDD: If(
                            CountIf(
                                DL_DIEUKIEN_APDUNG,
                                true
                            ) = 0,
                            1,
                            Max(
                                DL_DIEUKIEN_APDUNG,
                                ID
                            ) + 1
                        )
                    }
                ),
                UpdateContext({newIDMaDD: Value(DataCardID.Text)})
            );
            If(
                IsBlank(DataCardValueMaDK.Text),
                UpdateContext(
                    {
                        newMaDK: Concatenate(
                            "AD",
                            If(
                                newIDMaDD < 10,
                                "000",
                                If(
                                    newIDMaDD < 100 && newIDMaDD >= 10,
                                    "00",
                                    If(
                                        newIDMaDD < 1000 && newIDMaDD >= 100,
                                        "0",
                                        ""
                                    )
                                )
                            ),
                            Text(newIDMaDD)
                        )
                    }
                ),
                UpdateContext({newMaDK: DataCardValueMaDK.Text})
            );
            If(
                IsBlank(DateValueTU.SelectedDate),
                UpdateContext({errorMsgDK: "Hiệu lực từ là bắt buộc"})
            );
            If(
                IsBlank(errorMsgDK) && !IsBlank(DateValueDen.SelectedDate) && DateValueTU.SelectedDate > DateValueDen.SelectedDate,
                UpdateContext({errorMsgDK: "Hiệu lực đến phải sau hiệu lực từ"})
            );
            //Kiem tra tieu chi la duy nhat
            //San pham - ap dung
            If(
                IsBlank(errorMsgDK) && CountRows(tmpApdungSp) > 0,
                Clear(errorCol);
                Clear(tmpCheckDup);
                ForAll(
                    Gallery5.AllItems As kh,
                    Collect(
                        tmpCheckDup,
                        {
                            Type: "SP",
                            Value: kh.DropQTich.Selected.MA_CHI_TIEU
                        }
                    );
                );
                ForAll(
                    Gallery5.AllItems As kh,
                    If(
                        CountIf(
                            tmpCheckDup,
                            Type = "SP" && Value = kh.DropQTich.Selected.MA_CHI_TIEU
                        ) > 1,
                        Collect(
                            errorCol,
                            {Message: "Trùng tiêu chí áp dụng sản phẩm"}
                        )
                    )
                );
                If(
                    !IsEmpty(errorCol),
                    UpdateContext({errorMsgDK: First(errorCol).Message})
                )
            );
            //san pham - loai tru
            If(
                IsBlank(errorMsgDK) && CountRows(tmpLoaitruSp) > 0,
                Clear(errorCol);
                Clear(tmpCheckDup);
                ForAll(
                    Gallery5_1.AllItems As kh,
                    Collect(
                        tmpCheckDup,
                        {
                            Type: "KH",
                            Value: kh.DropQTich_1.Selected.MA_CHI_TIEU
                        }
                    );
                );
                ForAll(
                    Gallery5_1.AllItems As kh,
                    If(
                        CountIf(
                            tmpCheckDup,
                            Type = "KH" && Value = kh.DropQTich_1.Selected.MA_CHI_TIEU
                        ) > 1,
                        Collect(
                            errorCol,
                            {Message: "Trùng tiêu chí loại trừ sản phẩm"}
                        )
                    )
                );
                If(
                    !IsEmpty(errorCol),
                    UpdateContext({errorMsgDK: First(errorCol).Message})
                )
            );
            //Kenh ban
            //Kenh ban - ap dung
            If(
                IsBlank(errorMsgDK) && CountRows(tmpApdungKB) > 0,
                Clear(errorCol);
                Clear(tmpCheckDup);
                ForAll(
                    GalleryKB.AllItems As kh,
                    Collect(
                        tmpCheckDup,
                        {
                            Type: "KB",
                            Value: kh.DropKB.Selected.MA_CHI_TIEU
                        }
                    );
                );
                ForAll(
                    GalleryKB.AllItems As kh,
                    If(
                        CountIf(
                            tmpCheckDup,
                            Type = "KB" && Value = kh.DropKB.Selected.MA_CHI_TIEU
                        ) > 1,
                        Collect(
                            errorCol,
                            {Message: "Trùng tiêu chí áp dụng kênh bán"}
                        )
                    )
                );
                If(
                    !IsEmpty(errorCol),
                    UpdateContext({errorMsgDK: First(errorCol).Message})
                )
            );
            //Kenh ban - loai tru
            If(
                IsBlank(errorMsgDK) && CountRows(tmpLoaitruKB) > 0,
                Clear(errorCol);
                Clear(tmpCheckDup);
                ForAll(
                    GalleryKB_LoaiTru.AllItems As kh,
                    Collect(
                        tmpCheckDup,
                        {
                            Type: "KB",
                            Value: kh.DropKB_LoaiTru.Selected.MA_CHI_TIEU
                        }
                    );
                );
                ForAll(
                    GalleryKB_LoaiTru.AllItems As kh,
                    If(
                        CountIf(
                            tmpCheckDup,
                            Type = "KB" && Value = kh.DropKB_LoaiTru.Selected.MA_CHI_TIEU
                        ) > 1,
                        Collect(
                            errorCol,
                            {Message: "Trùng tiêu chí loại trừ kênh bán"}
                        )
                    )
                );
                If(
                    !IsEmpty(errorCol),
                    UpdateContext({errorMsgDK: First(errorCol).Message})
                )
            );
            //End kenh ban
            //Khach hang - ap dung
            If(
                IsBlank(errorMsgDK) && CountRows(tmpApdungKH) > 0,
                Clear(errorCol);
                Clear(tmpCheckDup);
                ForAll(
                    GalleryKH_1.AllItems As kh,
                    Collect(
                        tmpCheckDup,
                        {
                            Type: "KH",
                            Value: kh.DropKH.Selected.MA_CHI_TIEU
                        }
                    );
                );
                ForAll(
                    GalleryKH_1.AllItems As kh,
                    If(
                        CountIf(
                            tmpCheckDup,
                            Type = "KH" && Value = kh.DropKH.Selected.MA_CHI_TIEU
                        ) > 1,
                        Collect(
                            errorCol,
                            {Message: "Trùng tiêu chí áp dụng khách hàng"}
                        )
                    )
                );
                If(
                    !IsEmpty(errorCol),
                    UpdateContext({errorMsgDK: First(errorCol).Message})
                )
            );
            //Khach hang - loai tru
            If(
                IsBlank(errorMsgDK) && CountRows(tmpLoaitruKH) > 0,
                Clear(errorCol);
                Clear(tmpCheckDup);
                ForAll(
                    GalleryKH_LoaiTru.AllItems As kh,
                    Collect(
                        tmpCheckDup,
                        {
                            Type: "KH",
                            Value: kh.DropKH_LoaiTru.Selected.MA_CHI_TIEU
                        }
                    );
                );
                ForAll(
                    GalleryKH_LoaiTru.AllItems As kh,
                    If(
                        CountIf(
                            tmpCheckDup,
                            Type = "KH" && Value = kh.DropKH_LoaiTru.Selected.MA_CHI_TIEU
                        ) > 1,
                        Collect(
                            errorCol,
                            {Message: "Trùng tiêu chí loại trừ khách hàng"}
                        )
                    )
                );
                If(
                    !IsEmpty(errorCol),
                    UpdateContext({errorMsgDK: First(errorCol).Message})
                )
            );
            //pham vi - ap dung
            If(
                IsBlank(errorMsgDK) && CountRows(tmpApdungPV) > 0,
                Clear(errorCol);
                Clear(tmpCheckDup);
                ForAll(
                    GalleryPV_1.AllItems As kh,
                    Collect(
                        tmpCheckDup,
                        {
                            Type: "PV",
                            Value: kh.DropPV.Selected.MA_CHI_TIEU
                        }
                    );
                );
                ForAll(
                    GalleryPV_1.AllItems As kh,
                    If(
                        CountIf(
                            tmpCheckDup,
                            Type = "PV" && Value = kh.DropPV.Selected.MA_CHI_TIEU
                        ) > 1,
                        Collect(
                            errorCol,
                            {Message: "Trùng tiêu chí áp dụng phạm vi"}
                        )
                    )
                );
                If(
                    !IsEmpty(errorCol),
                    UpdateContext({errorMsgDK: First(errorCol).Message})
                )
            );
            //Pham vi - loai tru
            If(
                IsBlank(errorMsgDK) && CountRows(tmpLoaitruPV) > 0,
                Clear(errorCol);
                Clear(tmpCheckDup);
                ForAll(
                    GalleryPV_LoaiTru.AllItems As kh,
                    Collect(
                        tmpCheckDup,
                        {
                            Type: "PV",
                            Value: kh.DropPV_LoaiTru.Selected.MA_CHI_TIEU
                        }
                    );
                );
                ForAll(
                    GalleryPV_LoaiTru.AllItems As kh,
                    If(
                        CountIf(
                            tmpCheckDup,
                            Type = "PV" && Value = kh.DropPV_LoaiTru.Selected.MA_CHI_TIEU
                        ) > 1,
                        Collect(
                            errorCol,
                            {Message: "Trùng tiêu chí loại trừ phạm vi"}
                        )
                    )
                );
                If(
                    !IsEmpty(errorCol),
                    UpdateContext({errorMsgDK: First(errorCol).Message})
                )
            );
            If(
                !IsBlank(errorMsgDK),
                Notify(
                    errorMsgDK,
                    NotificationType.Error,
                    800
                ),
                SubmitForm(FormDKChung);
                UpdateContext({rcd: newMaDK});
                EditForm(FormDKChung);
                RemoveIf(
                    DL_DIEUKIEN_APDUNG_LOAI,
                    MA_DIEU_KIEN = newMaDK
                );
                RemoveIf(
                    DL_DIEUKIEN_APDUNG_LOAI_CT,
                    MA_DIEU_KIEN = newMaDK
                );
                Set(
                    varIdAdSP,
                    0
                );
                Set(
                    varIdLtSp,
                    0
                );
                // T.ANH LƯU SAN PHAM
            // lưu dữ liệu ở bảng  DL_DIEUKIEN_APDUNG_LOAI
            // THÊM DỮ LIỆU ÁP DỤNG
            Set(
                    varIdAdSP,
                    Max(
                        DL_DIEUKIEN_APDUNG_LOAI,
                        ID
                    ) + 1
                );
                Patch(
                    DL_DIEUKIEN_APDUNG_LOAI,
                    Defaults(DL_DIEUKIEN_APDUNG_LOAI),
                    {
                        ID: varIdAdSP,
                        MA_DIEU_KIEN: newMaDK,
                        THANH_PHAN: "SP",
                        AP_DUNG: "1",
                        KIEU: Radio2.Selected.ID,
                        TEN_KIEU: Radio2.Selected.Text
                    }
                );
                
            // THÊM DỮ LIỆU LOẠI TRỪ
            Set(
                    varIdLtSp,
                    Max(
                        DL_DIEUKIEN_APDUNG_LOAI,
                        ID
                    ) + 1
                );
                If(
                    !IsBlank(Radio2_1.Selected.Text),
                    Patch(
                        DL_DIEUKIEN_APDUNG_LOAI,
                        Defaults(DL_DIEUKIEN_APDUNG_LOAI),
                        {
                            ID: varIdLtSp,
                            MA_DIEU_KIEN: newMaDK,
                            THANH_PHAN: "SP",
                            AP_DUNG: "2",
                            KIEU: Radio2_1.Selected.ID,
                            TEN_KIEU: Radio2_1.Selected.Text
                        }
                    )
                );
                
            // lưu dữ liệu ở bảng chi tiết
            // lưu áp dụng
            If(
                    Radio2.Selected.ID = 2,
                    ForAll(
                        Gallery5.AllItems As ad,
                        ForAll(
                            ad.ComboBox3.SelectedItems As gt,
                            Patch(
                                DL_DIEUKIEN_APDUNG_LOAI_CT,
                                Defaults(DL_DIEUKIEN_APDUNG_LOAI_CT),
                                {
                                    ID: Value(ad.TextInput1.Text),
                                    ID_LOAI: varIdAdSP,
                                    MA_DIEU_KIEN: varMaDKien,
                                    THANH_PHAN: "SP",
                                    AP_DUNG: "1",
                                    KIEU: Radio2.Selected.ID,
                                    MA_TIEU_CHI: ad.DropQTich.Selected.MA_CHI_TIEU,
                                    TEN_TIEU_CHI: ad.DropQTich.Selected.TEN_CHI_TIEU,
                                    MA_GIA_TRI: LookUp(
                                        tmpDsGiatri,
                                        cr282_ten_gia_tri = gt.cr282_ten_gia_tri && Loai = ad.DropQTich.Selected.MA_CHI_TIEU
                                    ).Ma,
                                    TEN_GIA_TRI: gt.cr282_ten_gia_tri
                                }
                            )
                        )
                    )
                );
                
            // lưu loại trừ
            If(
                    Radio2_1.Selected.ID = 2,
                    ForAll(
                        Gallery5_1.AllItems As ad,
                        ForAll(
                            ad.ComboBox3_1.SelectedItems As gt,
                            Patch(
                                DL_DIEUKIEN_APDUNG_LOAI_CT,
                                Defaults(DL_DIEUKIEN_APDUNG_LOAI_CT),
                                {
                                    ID: Value(TextInput2.Text),
                                    ID_LOAI: varIdAdSP,
                                    MA_DIEU_KIEN: varMaDKien,
                                    THANH_PHAN: "SP",
                                    AP_DUNG: "2",
                                    KIEU: Radio2_1.Selected.ID,
                                    MA_TIEU_CHI: ad.DropQTich_1.Selected.MA_CHI_TIEU,
                                    TEN_TIEU_CHI: ad.DropQTich_1.Selected.TEN_CHI_TIEU,
                                    MA_GIA_TRI: LookUp(
                                        tmpDsGiatri,
                                        cr282_ten_gia_tri = gt.cr282_ten_gia_tri && Loai = ad.DropQTich_1.Selected.MA_CHI_TIEU
                                    ).Ma,
                                    TEN_GIA_TRI: gt.cr282_ten_gia_tri
                                }
                            )
                        )
                    )
                );
                
            // lưu dữ liệu ở bảng  DL_DIEUKIEN_APDUNG_LOAI KENH BAN
            Set(
                    varIdAdKB,
                    0
                );
                Set(
                    varIdLtKB,
                    0
                );
                Set(
                    varIdAdKB,
                    Max(
                        DL_DIEUKIEN_APDUNG_LOAI,
                        ID
                    ) + 1
                );
                // ÁP DỤNG
            Patch(
                    DL_DIEUKIEN_APDUNG_LOAI,
                    Defaults(DL_DIEUKIEN_APDUNG_LOAI),
                    {
                        ID: varIdAdKB,
                        MA_DIEU_KIEN: newMaDK,
                        THANH_PHAN: "KB",
                        AP_DUNG: "1",
                        KIEU: RadioKB.Selected.ID,
                        TEN_KIEU: RadioKB.Selected.Text
                    }
                );
                // LOẠI TRỪ
            If(
                    !IsBlank(RadioKB_LoaiTru.Selected.Text),
                    Patch(
                        DL_DIEUKIEN_APDUNG_LOAI,
                        Set(
                            varIdLtKB,
                            Max(
                                DL_DIEUKIEN_APDUNG_LOAI,
                                ID
                            ) + 1
                        );
                        Defaults(DL_DIEUKIEN_APDUNG_LOAI),
                        {
                            ID: Max(
                                DL_DIEUKIEN_APDUNG_LOAI,
                                ID
                            ) + 1,
                            MA_DIEU_KIEN: newMaDK,
                            THANH_PHAN: "KB",
                            AP_DUNG: "2",
                            KIEU: RadioKB_LoaiTru.Selected.ID,
                            TEN_KIEU: RadioKB_LoaiTru.Selected.Text
                        }
                    )
                );
                
            // lưu dữ liệu ở bảng chi tiết
            If(
                    RadioKB.Selected.ID = 2 && CountRows(tmpApdungKB) > 0,
                    ForAll(
                        GalleryKB.AllItems As kh,
                        ForAll(
                            kh.ComboBoxGTKB.SelectedItems As gt,
                            Patch(
                                DL_DIEUKIEN_APDUNG_LOAI_CT,
                                Defaults(DL_DIEUKIEN_APDUNG_LOAI_CT),
                                {
                                    ID: Value(kh.TextInput3.Text),
                                    ID_LOAI: varIdAdKB,
                                    MA_DIEU_KIEN: newMaDK,
                                    THANH_PHAN: "KB",
                                    AP_DUNG: "1",
                                    KIEU: RadioKB.Selected.ID,
                                    MA_TIEU_CHI: kh.DropKB.Selected.MA_CHI_TIEU,
                                    TEN_TIEU_CHI: kh.DropKB.Selected.TEN_CHI_TIEU,
                                    MA_GIA_TRI: LookUp(
                                        tmpDsGiatri,
                                        cr282_ten_gia_tri = gt.cr282_ten_gia_tri && Loai = kh.DropKB.Selected.MA_CHI_TIEU
                                    ).Ma,
                                    TEN_GIA_TRI: gt.cr282_ten_gia_tri
                                }
                            )
                        )
                    )
                );
                
            // lưu dữ liệu ở bảng chi tiết loai trừ
            If(
                    RadioKB_LoaiTru.Selected.ID = 2 && CountRows(tmpLoaitruKB) > 0,
                    ForAll(
                        GalleryKB_LoaiTru.AllItems As kh,
                        ForAll(
                            kh.ComboBoxGTKB_LT.SelectedItems As gt,
                            Patch(
                                DL_DIEUKIEN_APDUNG_LOAI_CT,
                                Defaults(DL_DIEUKIEN_APDUNG_LOAI_CT),
                                {
                                    ID: Value(kh.TextInput4.Text),
                                    ID_LOAI: varIdLtKB,
                                    MA_DIEU_KIEN: newMaDK,
                                    THANH_PHAN: "KB",
                                    AP_DUNG: "2",
                                    KIEU: RadioKB_LoaiTru.Selected.ID,
                                    MA_TIEU_CHI: kh.DropKB_LoaiTru.Selected.MA_CHI_TIEU,
                                    TEN_TIEU_CHI: kh.DropKB_LoaiTru.Selected.TEN_CHI_TIEU,
                                    MA_GIA_TRI: LookUp(
                                        tmpDsGiatri,
                                        cr282_ten_gia_tri = gt.cr282_ten_gia_tri && Loai = kh.DropKB_LoaiTru.Selected.MA_CHI_TIEU
                                    ).Ma,
                                    TEN_GIA_TRI: gt.cr282_ten_gia_tri
                                }
                            )
                        )
                    )
                );
                
            //End kenh ban
            // lưu dữ liệu ở bảng  DL_DIEUKIEN_APDUNG_LOAI KHANH HANG
            Set(
                    varIdAdKH,
                    0
                );
                Set(
                    varIdLtKH,
                    0
                );
                Set(
                    varIdAdKH,
                    Max(
                        DL_DIEUKIEN_APDUNG_LOAI,
                        ID
                    ) + 1
                );
                Patch(
                    DL_DIEUKIEN_APDUNG_LOAI,
                    Defaults(DL_DIEUKIEN_APDUNG_LOAI),
                    {
                        ID: varIdAdKH,
                        MA_DIEU_KIEN: newMaDK,
                        THANH_PHAN: "KH",
                        AP_DUNG: "1",
                        KIEU: RadioKH.Selected.ID,
                        TEN_KIEU: RadioKH.Selected.Text
                    }
                );
                If(
                    !IsBlank(RadioKH_LoaiTru.Selected.Text),
                    Patch(
                        DL_DIEUKIEN_APDUNG_LOAI,
                        Set(
                            varIdLtKH,
                            Max(
                                DL_DIEUKIEN_APDUNG_LOAI,
                                ID
                            ) + 1
                        );
                        Defaults(DL_DIEUKIEN_APDUNG_LOAI),
                        {
                            ID: Max(
                                DL_DIEUKIEN_APDUNG_LOAI,
                                ID
                            ) + 1,
                            MA_DIEU_KIEN: newMaDK,
                            THANH_PHAN: "KH",
                            AP_DUNG: "2",
                            KIEU: RadioKH_LoaiTru.Selected.ID,
                            TEN_KIEU: RadioKB_LoaiTru.Selected.Text
                        }
                    )
                );
                
            // lưu dữ liệu ở bảng chi tiết
            If(
                    RadioKH.Selected.ID = 2 && CountRows(tmpApdungKH) > 0,
                    ForAll(
                        GalleryKH_1.AllItems As kh,
                        ForAll(
                            kh.ComboBoxGTKH.SelectedItems As gt,
                            Patch(
                                DL_DIEUKIEN_APDUNG_LOAI_CT,
                                Defaults(DL_DIEUKIEN_APDUNG_LOAI_CT),
                                {
                                    ID: Value(kh.TextInput5.Text),
                                    ID_LOAI: varIdAdKH,
                                    MA_DIEU_KIEN: newMaDK,
                                    THANH_PHAN: "KH",
                                    AP_DUNG: "1",
                                    KIEU: RadioKH.Selected.ID,
                                    MA_TIEU_CHI: kh.DropKH.Selected.MA_CHI_TIEU,
                                    TEN_TIEU_CHI: kh.DropKH.Selected.TEN_CHI_TIEU,
                                    MA_GIA_TRI: LookUp(
                                        tmpDsGiatri,
                                        cr282_ten_gia_tri = gt.cr282_ten_gia_tri && Loai = kh.DropKH.Selected.MA_CHI_TIEU
                                    ).Ma,
                                    TEN_GIA_TRI: gt.cr282_ten_gia_tri
                                }
                            )
                        )
                    )
                );
                
            // lưu dữ liệu ở bảng chi tiết loai tru
            If(
                    RadioKH_LoaiTru.Selected.ID = 2 && CountRows(tmpLoaitruKH) > 0,
                    ForAll(
                        GalleryKH_LoaiTru.AllItems As kh,
                        ForAll(
                            kh.ComboBoxGTKH_LT.SelectedItems As gt,
                            Patch(
                                DL_DIEUKIEN_APDUNG_LOAI_CT,
                                Defaults(DL_DIEUKIEN_APDUNG_LOAI_CT),
                                {
                                    ID: Value(kh.TextInput6.Text),
                                    ID_LOAI: varIdLtKH,
                                    MA_DIEU_KIEN: newMaDK,
                                    THANH_PHAN: "KH",
                                    AP_DUNG: "2",
                                    KIEU: RadioKH_LoaiTru.Selected.ID,
                                    MA_TIEU_CHI: kh.DropKH_LoaiTru.Selected.MA_CHI_TIEU,
                                    TEN_TIEU_CHI: kh.DropKH_LoaiTru.Selected.TEN_CHI_TIEU,
                                    MA_GIA_TRI: LookUp(
                                        tmpDsGiatri,
                                        cr282_ten_gia_tri = gt.cr282_ten_gia_tri && Loai = kh.DropKH_LoaiTru.Selected.MA_CHI_TIEU
                                    ).Ma,
                                    TEN_GIA_TRI: gt.cr282_ten_gia_tri
                                }
                            )
                        )
                    )
                );
                
            // lưu dữ liệu ở bảng  DL_DIEUKIEN_APDUNG_LOAI PHAM_VI
            Set(
                    varIdAdPV,
                    0
                );
                Set(
                    varIdLtPV,
                    0
                );
                Set(
                    varIdAdPV,
                    Max(
                        DL_DIEUKIEN_APDUNG_LOAI,
                        ID
                    ) + 1
                );
                Patch(
                    DL_DIEUKIEN_APDUNG_LOAI,
                    Defaults(DL_DIEUKIEN_APDUNG_LOAI),
                    {
                        ID: varIdAdPV,
                        MA_DIEU_KIEN: newMaDK,
                        THANH_PHAN: "PV",
                        AP_DUNG: "1",
                        KIEU: RadioPV.Selected.ID,
                        TEN_KIEU: RadioPV.Selected.Text
                    }
                );
                If(
                    !IsBlank(RadioPV_LoaiTru.Selected.Text),
                    Patch(
                        DL_DIEUKIEN_APDUNG_LOAI,
                        Set(
                            varIdLtPV,
                            Max(
                                DL_DIEUKIEN_APDUNG_LOAI,
                                ID
                            ) + 1
                        );
                        Defaults(DL_DIEUKIEN_APDUNG_LOAI),
                        {
                            ID: Max(
                                DL_DIEUKIEN_APDUNG_LOAI,
                                ID
                            ) + 1,
                            MA_DIEU_KIEN: newMaDK,
                            THANH_PHAN: "PV",
                            AP_DUNG: "2",
                            KIEU: RadioPV_LoaiTru.Selected.ID,
                            TEN_KIEU: RadioPV_LoaiTru.Selected.Text
                        }
                    )
                );
                
            // lưu dữ liệu ở bảng chi tiết
            If(
                    RadioPV.Selected.ID = 2 && CountRows(tmpApdungPV) > 0,
                    ForAll(
                        GalleryPV_1.AllItems As pv,
                        ForAll(
                            pv.ComboBoxGTPV.SelectedItems As gt,
                            Patch(
                                DL_DIEUKIEN_APDUNG_LOAI_CT,
                                Defaults(DL_DIEUKIEN_APDUNG_LOAI_CT),
                                {
                                    ID: Value(pv.TextInput7.Text),
                                    ID_LOAI: varIdAdPV,
                                    MA_DIEU_KIEN: newMaDK,
                                    THANH_PHAN: "PV",
                                    AP_DUNG: "1",
                                    KIEU: RadioPV.Selected.ID,
                                    MA_TIEU_CHI: pv.DropPV.Selected.MA_CHI_TIEU,
                                    TEN_TIEU_CHI: pv.DropPV.Selected.TEN_CHI_TIEU,
                                    MA_GIA_TRI: LookUp(
                                        tmpDsGiatri,
                                        cr282_ten_gia_tri = gt.cr282_ten_gia_tri && Loai = pv.DropPV.Selected.MA_CHI_TIEU
                                    ).Ma,
                                    TEN_GIA_TRI: gt.cr282_ten_gia_tri
                                }
                            )
                        )
                    )
                );
                
            // lưu dữ liệu ở bảng chi tiết loai trừ
            If(
                    RadioPV_LoaiTru.Selected.ID = 2 && CountRows(tmpLoaitruPV) > 0,
                    ForAll(
                        GalleryPV_LoaiTru.AllItems As kh,
                        ForAll(
                            kh.ComboBoxGTPV_LT.SelectedItems As gt,
                            Patch(
                                DL_DIEUKIEN_APDUNG_LOAI_CT,
                                Defaults(DL_DIEUKIEN_APDUNG_LOAI_CT),
                                {
                                    ID: Value(kh.TextInput8.Text),
                                    ID_LOAI: varIdLtPV,
                                    MA_DIEU_KIEN: newMaDK,
                                    THANH_PHAN: "PV",
                                    AP_DUNG: "2",
                                    KIEU: RadioPV_LoaiTru.Selected.ID,
                                    MA_TIEU_CHI: kh.DropPV_LoaiTru.Selected.MA_CHI_TIEU,
                                    TEN_TIEU_CHI: kh.DropPV_LoaiTru.Selected.TEN_CHI_TIEU,
                                    MA_GIA_TRI: LookUp(
                                        tmpDsGiatri,
                                        cr282_ten_gia_tri = gt.cr282_ten_gia_tri && Loai = kh.DropPV_LoaiTru.Selected.MA_CHI_TIEU
                                    ).Ma,
                                    TEN_GIA_TRI: gt.cr282_ten_gia_tri
                                }
                            )
                        )
                    )
                );
                /*UpdateIf(
                    DL_DIEUKIEN_APDUNG,
                    MA_DIEU_KIEN = DataCardValueMaDK.Text,
                    {TRANG_THAI: "true"}
                );*/
                UpdateContext({rcd: newMaDK});
                EditForm(FormDKChung);
                Notify(
                    "Ghi dữ liệu thành công",
                    NotificationType.Success,
                    800
                );
                /*Set(
                    varDaGhi,
                    true
                );*/
            );
        Size: =11
        Text: ="Ghi dữ liệu"
        Visible: =If(!IsBlank(DataCardValueMaDK.Text),true,false)
        Width: =122
        X: =1222
        Y: =728
        ZIndex: =5

