# ************************************************************************************************
# Warning: YAML source code for Canvas Apps is in preview. The schema is being actively developed.
# Content may be incomplete and subject to change.
# This file is read-only and should only be used to review changes made within Power Apps Studio.
# This file isn't used when loading the app. External editing, merging and conflict resolution are
# not supported.
# 
# For more information, visit https://go.microsoft.com/fwlink/?linkid=2292623
# ************************************************************************************************
Screens:
  NhapHopDong:
    Properties:
      LoadingSpinnerColor: =RGBA(56, 96, 178, 1)
      OnHidden: |-
        =If(
            IsBlank(isNhapBGHD) && IsBlank(First(objHD).MA_HOP_DONG),
            Refresh(DL_HOP_DONG_SPS);
            ClearCollect(
                tmpDSHDSPRemoveNHDCollect,
                Filter(
                    DL_HOP_DONG_SPS,
                    IsBlank(MA_HOP_DONG)
                )
            );
            ForAll(
                tmpDSHDSPRemoveNHDCollect As ds,
                Remove(
                    DL_HOP_DONG_SPS,
                    ds
                );
                RemoveIf(
                    DL_HOP_DONG_SP_NDBH,
                    ID_HOPDONG_SP=ds.ID
                );
                RemoveIf(
                    DL_HOP_DONG_SP_QLCT,
                    ID_HOPDONG_SP=ds.ID
                );
            );
            Set(
                nhapBGCCPFwd,
                Blank()
            );
        )
      OnVisible: "=If(\n    IsBlank(varUnReloadNHD),\n    UpdateContext({\n        unReloadCbxNHD:\"1\",\n        unReloadMaSP:\"1\",\n        unReloadMaCT:\"1\"\n    });\n    Reset(dpNgayHDNHD);\n    Reset(dpHLTuNHD);\n    Reset(dpHLDenNHD);\n    Reset(cbxDVQLNHD);\n    Reset(cbxDVTienNHD);\n    Reset(cbxLoaiKBNHD);\n    Reset(cbxMaKBNHD);\n    Reset(tiTenKBNHD);\n    Reset(cbxDVKBNHD);\n    Reset(cbxMaKHNHD);\n    Reset(tiTenKHNHD);\n    Reset(tiDChiNHD);\n    Reset(dpNSinhNHD);\n    Reset(cbxGTinhNHD);\n    Reset(tiSDTNHD);\n    Reset(tiEmailNHD);\n    Reset(cbxLoaiKHNHD);\n    Reset(cbxNgheNHD);\n    Reset(cbxTinhNHD);\n    Reset(LinkHDLK);\n    Reset(tiSoNTGNHD);\n    Reset(ddLoaiHDNHD);\n    If(\n        IsBlank(\n            LookUp(\n                DL_HOP_DONGS,\n                MA_HOP_DONG = maHopDongFwd\n            )\n        ),\n        ClearCollect(\n            objHD,\n            Defaults(DL_HOP_DONGS)\n        ),\n        ClearCollect(\n            objHD,\n            LookUp(\n                DL_HOP_DONGS,\n                MA_HOP_DONG = maHopDongFwd\n            )\n        )\n    );\n    If(\n        IsBlank(nhapBGCCPFwd),\n        ClearCollect(\n            tmpDSHDSPNHDCollect,\n            AddColumns(\n                Filter(\n                    DL_HOP_DONG_SPS,\n                    MA_HOP_DONG = maHopDongFwd\n                ),\n                edited,\n                0\n            )\n        ),\n        ClearCollect(\n            tmpDSHDSPNHDCollect,\n            AddColumns(\n                Filter(\n                    DL_HOP_DONG_SPS,\n                    IsBlank(MA_HOP_DONG)\n                ),\n                edited,\n                0\n            )\n        )\n    );\n    ClearCollect(\n        tmpDSNDBHNHDCollect,\n        AddColumns(\n            Filter(\n                DL_HOP_DONG_SP_NDBH,\n                MA_HOP_DONG=First(objHD).MA_HOP_DONG\n            ),\n            edited,\n            0\n        )\n    );\n    ClearCollect(\n        tmpQLCTHDSPNHDCollect,\n        AddColumns(\n            Filter(\n                DL_HOP_DONG_SP_QLCT,\n                MA_HOP_DONG=First(objHD).MA_HOP_DONG\n            ),\n            edited,\n            0\n        )\n    );\n    ClearCollect(\n        tmpDSHDSPLKNHDCollect,\n        Filter(\n            DL_HOP_DONG_LIENKETS,\n            SO_HOP_DONG = maHopDongFwd\n        )\n    );\n    ClearCollect(\n        dmMaGiamGiaNHDCollect,\n        AddColumns(\n            DM_MA_GIAMGIAS,\n            title,\n            Concatenate(\n                \"Mã: \",MA_GIAM_GIA,\", Giảm theo: \",If(LOAI=\"SO_TIEN\",\"Số tiền\",\"Tỷ lệ\"),\", Giá trị giảm: \",\n                If(LOAI=\"SO_TIEN\",Text(SO_TIEN),Concatenate(Text(TY_LE_GIAM*100),\"%\",\", Phí giảm tối đa: \",Text(SO_TIEN_TOIDA)))\n            ),\n            gia_tri_tong,\n            If(LOAI=\"SO_TIEN\",SO_TIEN,SO_TIEN_TOIDA)\n        )\n    );\n    ClearCollect(\n        tmpKTTNHDCollect,\n        Filter(\n            DL_HOP_DONG_TTOANS,\n            MA_HOP_DONG = maHopDongFwd\n        )\n    );\n    ClearCollect(\n        tmpMaCTChangeNHD,\n        tmpDSHDSPNHDCollect\n    );\n    UpdateContext(\n        {\n            maAddedHDSPNHD: \"\",\n            maUpdatedHDSPNHD: \"\",\n            nhomKB:First(objHD).NHOM_KENH_BAN\n        }\n    );\n    If(\n        CountIf(\n            tmpKTTNHDCollect,\n            true\n        ) = 0,\n        Collect(\n            tmpKTTNHDCollect,\n            Defaults(tmpKTTNHDCollect)\n        );\n        UpdateContext({\n            maKTT:Max(DL_HOP_DONG_TTOANS,ID)+1\n        });\n        UpdateIf(\n            tmpKTTNHDCollect,\n            IsBlank(ID),\n            {\n                ID: Text(maKTT)\n            }\n        )\n    ),\n    varUnReloadNHD = \"2\",\n    UpdateIf(\n        objHD,\n        true,\n        {\n            SO_NGUOI_TGIA:Sum(Filter(tmpDSHDSPNHDCollect,ID<>idHopDongSPNDBH),SONGUOI_THAMGIA)+LookUp(tmpMaCTChangeNHD,ID=idHopDongSPNDBH,SONGUOI_THAMGIA)\n        }\n    ),\n    varUnReloadNHD = \"3\",\n    ClearCollect(\n        tmpDSHDSPLKNHDCollect,\n        Filter(\n            DL_HOP_DONG_LIENKETS,\n            SO_HOP_DONG = First(objHD).MA_HOP_DONG\n        )\n    );\n    \n);\n//Lay muc 6\nClear(tmpCsDaChon);\nForAll(\n    Filter(\n        DL_HOP_DONG_CHON_CS,\n        MA_HOP_DONG = tiMaHDNHD.Text\n    ) As cs,\n    Collect(\n        tmpCsDaChon,\n        {\n            ID:cs.ID,\n            MA_CHINH_SACH: cs.MA_CHINH_SACH,\n            MO_TA: cs.MO_TA,\n            SO_TIEN: cs.SO_TIEN,\n            TY_LE: cs.TY_LE,\n            SO_TIEN_TOIDA: cs.SO_TIEN_TOIDA\n        }\n    );\n    \n);\nSet(\n    maHopDongFwd,\n    \"\"\n);\nSet(\n    varUnReloadNHD,\n    Blank()\n);\nUpdateContext({\n    unReloadCbxNHD:Blank()\n});"
    Children:
      - Canvas2:
          Control: FluidGrid@2.3.0
          Properties:
            BorderThickness: =0
            Height: =768
            Width: =1306
            X: =60
            Y: =
          Children:
            - DataCard2:
                Control: DataCard@1.0.2
                Properties:
                  Height: =1661
                  Width: =1306
                Children:
                  - Container3_2:
                      Control: GroupContainer@1.3.0
                      Variant: ManualLayout
                      Properties:
                        DropShadow: =DropShadow.None
                        Height: =179
                        Width: =1267
                        X: =16
                        Y: =4
                      Children:
                        - Label3_32:
                            Control: Label@2.5.1
                            Properties:
                              BorderColor: =RGBA(0, 18, 107, 1)
                              Font: =Font.'Open Sans'
                              Height: =25
                              Size: =11
                              Text: ="Số hợp đồng"
                              X: =30
                              Y: =24
                        - tiMaHDNHD:
                            Control: Classic/TextInput@2.3.2
                            Properties:
                              BorderColor: =RGBA(72, 163, 62, 1)
                              Default: '=If(IsBlank(First(objHD).MA_HOP_DONG),"",First(objHD).MA_HOP_DONG) '
                              DisplayMode: =DisplayMode.Disabled
                              Font: =Font.'Open Sans'
                              Height: =32
                              HintText: ="Hệ thống tự sinh"
                              HoverBorderColor: =RGBA(0, 18, 107, 1)
                              HoverFill: =RGBA(186, 202, 226, 1)
                              RadiusBottomLeft: =0
                              RadiusBottomRight: =0
                              RadiusTopLeft: =0
                              RadiusTopRight: =0
                              Size: =11
                              Width: =250
                              X: =30
                              Y: =52
                        - Label3_35:
                            Control: Label@2.5.1
                            Properties:
                              BorderColor: =RGBA(0, 18, 107, 1)
                              Font: =Font.'Open Sans'
                              Height: =25
                              Size: =11
                              Text: ="Hiệu lực đến (*)"
                              Width: =140
                              X: =990
                              Y: =24
                        - Label3_37:
                            Control: Label@2.5.1
                            Properties:
                              BorderColor: =RGBA(0, 18, 107, 1)
                              Font: =Font.'Open Sans'
                              Height: =25
                              Size: =11
                              Text: ="Đơn vị quản lý HĐ (*)"
                              Width: =168
                              X: =355
                              Y: =95
                        - cbxDVQLNHD:
                            Control: Classic/ComboBox@2.4.0
                            Properties:
                              BorderColor: =RGBA(72, 163, 62, 1)
                              ChevronBackground: =RGBA(56, 96, 178, 1)
                              ChevronFill: =RGBA(255, 255, 255, 1)
                              ChevronHoverBackground: =ColorFade(RGBA(56, 96, 178, 1), -20%)
                              ChevronHoverFill: =RGBA(255, 255, 255, 1)
                              DefaultSelectedItems: =LookUp(Filter(DM_PHAMVI_DIALYS,LOAI="DON_VI"),MA_PHAMVI=First(objHD).DONVI_QUANLY_HD)
                              DisplayFields: =["cr282_ten_phamvi","cr282_ma_phamvi"]
                              Font: =Font.'Open Sans'
                              Height: =32
                              HoverFill: =RGBA(186, 202, 226, 1)
                              InputTextPlaceholder: ="Chọn đơn vị quản lý"
                              Items: =Filter(DM_PHAMVI_DIALYS,LOAI="DON_VI")
                              PressedColor: =RGBA(255, 255, 255, 1)
                              PressedFill: =RGBA(0, 18, 107, 1)
                              SearchFields: =["cr282_ten_phamvi"]
                              SelectMultiple: =false
                              SelectionColor: =RGBA(255, 255, 255, 1)
                              SelectionFill: =RGBA(56, 96, 178, 1)
                              Size: =11
                              Width: =250
                              X: =355
                              Y: =122
                        - Label3_34:
                            Control: Label@2.5.1
                            Properties:
                              BorderColor: =RGBA(0, 18, 107, 1)
                              Font: =Font.'Open Sans'
                              Height: =25
                              Size: =11
                              Text: ="Hiệu lực từ (*)"
                              Width: =140
                              X: =672
                              Y: =24
                        - dpNgayHDNHD:
                            Control: Classic/DatePicker@2.6.0
                            Properties:
                              BorderColor: =RGBA(72, 163, 62, 1)
                              DefaultDate: =If(IsBlank(First(objHD).MA_HOP_DONG),Today(),First(objHD).NGAY_HOP_DONG)
                              EndYear: =2200
                              Font: =Font.'Open Sans'
                              Format: ="dd/mm/yyyy"
                              Height: =32
                              IconBackground: =RGBA(56, 96, 178, 1)
                              IconFill: =RGBA(255, 255, 255, 1)
                              InputTextPlaceholder: =
                              IsEditable: =true
                              Size: =11
                              StartYear: =1900
                              Width: =250
                              X: =355
                              Y: =52
                        - Label3_33:
                            Control: Label@2.5.1
                            Properties:
                              BorderColor: =RGBA(0, 18, 107, 1)
                              Font: =Font.'Open Sans'
                              Height: =25
                              Size: =11
                              Text: ="Ngày hợp đồng (*)"
                              Width: =140
                              X: =355
                              Y: =24
                        - dpHLTuNHD:
                            Control: Classic/DatePicker@2.6.0
                            Properties:
                              BorderColor: =RGBA(72, 163, 62, 1)
                              DefaultDate: =First(objHD).HIEU_LUC_TU
                              EndYear: =2200
                              Font: =Font.'Open Sans'
                              Format: ="dd/mm/yyyy"
                              Height: =32
                              IconBackground: =RGBA(56, 96, 178, 1)
                              IconFill: =RGBA(255, 255, 255, 1)
                              InputTextPlaceholder: =
                              IsEditable: =true
                              OnChange: |-
                                =If(
                                    IsBlank(dpHLDenNHD.SelectedDate),
                                    UpdateIf(
                                        objHD,
                                        true,
                                        {
                                            HIEU_LUC_DEN:DateAdd(dpHLTuNHD.SelectedDate,364,TimeUnit.Days)
                                        }
                                    )
                                )
                              Size: =11
                              StartYear: =1900
                              Width: =250
                              X: =672
                              Y: =52
                        - dpHLDenNHD:
                            Control: Classic/DatePicker@2.6.0
                            Properties:
                              BorderColor: =RGBA(72, 163, 62, 1)
                              DefaultDate: =First(objHD).HIEU_LUC_DEN
                              EndYear: =2200
                              Font: =Font.'Open Sans'
                              Format: ="dd/mm/yyyy"
                              Height: =32
                              IconBackground: =RGBA(56, 96, 178, 1)
                              IconFill: =RGBA(255, 255, 255, 1)
                              InputTextPlaceholder: =
                              IsEditable: =true
                              Size: =11
                              StartYear: =1900
                              Width: =250
                              X: =990
                              Y: =52
                        - cbxDVTienNHD:
                            Control: Classic/ComboBox@2.4.0
                            Properties:
                              BorderColor: =RGBA(72, 163, 62, 1)
                              ChevronBackground: =RGBA(56, 96, 178, 1)
                              ChevronFill: =RGBA(255, 255, 255, 1)
                              ChevronHoverBackground: =ColorFade(RGBA(56, 96, 178, 1), -20%)
                              ChevronHoverFill: =RGBA(255, 255, 255, 1)
                              DefaultSelectedItems: =If(IsBlank(First(objHD).MA_HOP_DONG),LookUp(BH_DM_TIENTES,TIEN_TE="VND"),LookUp(BH_DM_TIENTES,TIEN_TE=First(objHD).DONVI_TIEN))
                              DisplayFields: =["cr282_tien_te"]
                              Font: =Font.'Open Sans'
                              Height: =32
                              HoverFill: =RGBA(186, 202, 226, 1)
                              InputTextPlaceholder: ="Chọn đơn vị tiền"
                              Items: =BH_DM_TIENTES
                              PressedColor: =RGBA(255, 255, 255, 1)
                              PressedFill: =RGBA(0, 18, 107, 1)
                              SearchFields: =["cr282_id"]
                              SelectMultiple: =false
                              SelectionColor: =RGBA(255, 255, 255, 1)
                              SelectionFill: =RGBA(56, 96, 178, 1)
                              Size: =11
                              Width: =250
                              X: =672
                              Y: =122
                        - Label3_38:
                            Control: Label@2.5.1
                            Properties:
                              BorderColor: =RGBA(0, 18, 107, 1)
                              Font: =Font.'Open Sans'
                              Height: =25
                              Size: =11
                              Text: ="Đơn vị tiền (*)"
                              Width: =140
                              X: =672
                              Y: =95
                        - Label3_36:
                            Control: Label@2.5.1
                            Properties:
                              BorderColor: =RGBA(0, 18, 107, 1)
                              Font: =Font.'Open Sans'
                              FontWeight: =FontWeight.Bold
                              Height: =20
                              Size: =11
                              Text: ="1. Thông tin chung"
                              Width: =254
                              X: =3
                              Y: =4
                        - Label3_39:
                            Control: Label@2.5.1
                            Properties:
                              BorderColor: =RGBA(0, 18, 107, 1)
                              Font: =Font.'Open Sans'
                              Height: =25
                              Size: =11
                              Text: ="Phương thức thanh toán"
                              Width: =190
                              X: =990
                              Y: =95
                        - cbxPTTTNHD:
                            Control: Classic/ComboBox@2.4.0
                            Properties:
                              BorderColor: =RGBA(72, 163, 62, 1)
                              ChevronBackground: =RGBA(56, 96, 178, 1)
                              ChevronFill: =RGBA(255, 255, 255, 1)
                              ChevronHoverBackground: =ColorFade(RGBA(56, 96, 178, 1), -20%)
                              ChevronHoverFill: =RGBA(255, 255, 255, 1)
                              DefaultSelectedItems: =LookUp([{title:"Tiền mặt",value:"0"},{title:"Chuyển khoản",value:"1"}],value=First(objHD).PTHUC_THANH_TOAN)
                              DisplayFields: =["title"]
                              Font: =Font.'Open Sans'
                              Height: =32
                              HoverFill: =RGBA(186, 202, 226, 1)
                              InputTextPlaceholder: ="Chọn phương thức TT"
                              Items: =[{title:"Tiền mặt",value:"0"},{title:"Chuyển khoản",value:"1"}]
                              PressedColor: =RGBA(255, 255, 255, 1)
                              PressedFill: =RGBA(0, 18, 107, 1)
                              SearchFields: =["title"]
                              SelectMultiple: =false
                              SelectionColor: =RGBA(255, 255, 255, 1)
                              SelectionFill: =RGBA(56, 96, 178, 1)
                              Size: =11
                              Width: =250
                              X: =990
                              Y: =122
                        - Label3_88:
                            Control: Label@2.5.1
                            Properties:
                              BorderColor: =RGBA(0, 18, 107, 1)
                              Font: =Font.'Open Sans'
                              Height: =25
                              Size: =11
                              Text: ="Loại hợp đồng"
                              Width: =168
                              X: =30
                              Y: =95
                        - ddLoaiHDNHD:
                            Control: Classic/DropDown@2.3.1
                            Properties:
                              BorderColor: =RGBA(54, 176, 75, 1)
                              ChevronBackground: =RGBA(56, 96, 178, 1)
                              ChevronFill: =RGBA(255, 255, 255, 1)
                              ChevronHoverBackground: =ColorFade(RGBA(56, 96, 178, 1), -20%)
                              ChevronHoverFill: =RGBA(255, 255, 255, 1)
                              Default: ="Lần đầu"
                              Font: =Font.'Open Sans'
                              Height: =32
                              HoverFill: =RGBA(186, 202, 226, 1)
                              Items: =[{title:"Lần đầu",value:"0"},{title:"Tái tục",value:"1"}]
                              Items.Value: =title
                              PressedColor: =RGBA(255, 255, 255, 1)
                              PressedFill: =RGBA(0, 18, 107, 1)
                              SelectionColor: =RGBA(255, 255, 255, 1)
                              SelectionFill: =RGBA(56, 96, 178, 1)
                              Size: =11
                              Width: =250
                              X: =30
                              Y: =122
                  - Container3_3:
                      Control: GroupContainer@1.3.0
                      Variant: ManualLayout
                      Properties:
                        DropShadow: =DropShadow.None
                        Height: =99
                        Width: =1267
                        X: =16
                        Y: =183
                      Children:
                        - Label3_41:
                            Control: Label@2.5.1
                            Properties:
                              BorderColor: =RGBA(0, 18, 107, 1)
                              Font: =Font.'Open Sans'
                              Height: =25
                              Size: =11
                              Text: ="Loại kênh bán (*)"
                              Width: =137
                              X: =30
                              Y: =25
                        - Label3_44:
                            Control: Label@2.5.1
                            Properties:
                              BorderColor: =RGBA(0, 18, 107, 1)
                              Font: =Font.'Open Sans'
                              Height: =25
                              Size: =11
                              Text: ="Đơn vị kênh bán"
                              Width: =133
                              X: =990
                              Y: =25
                        - Label3_43:
                            Control: Label@2.5.1
                            Properties:
                              BorderColor: =RGBA(0, 18, 107, 1)
                              Font: =Font.'Open Sans'
                              Height: =25
                              Size: =11
                              Text: ="Tên kênh bán (*)"
                              Width: =140
                              X: =672
                              Y: =25
                        - Label3_42:
                            Control: Label@2.5.1
                            Properties:
                              BorderColor: =RGBA(0, 18, 107, 1)
                              Font: =Font.'Open Sans'
                              Height: =25
                              Size: =11
                              Text: ="Mã kênh bán (*)"
                              Width: =140
                              X: =355
                              Y: =25
                        - Label3_40:
                            Control: Label@2.5.1
                            Properties:
                              BorderColor: =RGBA(0, 18, 107, 1)
                              Font: =Font.'Open Sans'
                              FontWeight: =FontWeight.Bold
                              Height: =20
                              Size: =11
                              Text: ="2. Kênh bán"
                              Width: =254
                              Y: =4
                        - tiTenKBNHD:
                            Control: Classic/TextInput@2.3.2
                            Properties:
                              BorderColor: =RGBA(72, 163, 62, 1)
                              Default: =First(objHD).TEN_KENH_BAN
                              Font: =Font.'Open Sans'
                              Height: =32
                              HoverBorderColor: =RGBA(0, 18, 107, 1)
                              HoverFill: =RGBA(186, 202, 226, 1)
                              RadiusBottomLeft: =0
                              RadiusBottomRight: =0
                              RadiusTopLeft: =0
                              RadiusTopRight: =0
                              Size: =11
                              Width: =250
                              X: =672
                              Y: =52
                        - cbxLoaiKBNHD:
                            Control: Classic/ComboBox@2.4.0
                            Properties:
                              BorderColor: =RGBA(72, 163, 62, 1)
                              ChevronBackground: =RGBA(56, 96, 178, 1)
                              ChevronFill: =RGBA(255, 255, 255, 1)
                              ChevronHoverBackground: =ColorFade(RGBA(56, 96, 178, 1), -20%)
                              ChevronHoverFill: =RGBA(255, 255, 255, 1)
                              DefaultSelectedItems: =LookUp(DM_LOAI_KENH_BANS,MA_LOAI_KB=First(objHD).LOAI_KENH_BAN)
                              DisplayFields: =["cr282_ten_loai_kb"]
                              Font: =Font.'Open Sans'
                              Height: =32
                              HoverFill: =RGBA(186, 202, 226, 1)
                              InputTextPlaceholder: ="Chọn loại kênh bán"
                              Items: =DM_LOAI_KENH_BANS
                              OnChange: =Reset(cbxMaKBNHD)
                              PressedColor: =RGBA(255, 255, 255, 1)
                              PressedFill: =RGBA(0, 18, 107, 1)
                              SearchFields: =["cr282_ten_loai_kb"]
                              SelectMultiple: =false
                              SelectionColor: =RGBA(255, 255, 255, 1)
                              SelectionFill: =RGBA(56, 96, 178, 1)
                              Size: =11
                              Width: =250
                              X: =30
                              Y: =52
                        - cbxMaKBNHD:
                            Control: Classic/ComboBox@2.4.0
                            Properties:
                              BorderColor: =RGBA(72, 163, 62, 1)
                              ChevronBackground: =RGBA(56, 96, 178, 1)
                              ChevronFill: =RGBA(255, 255, 255, 1)
                              ChevronHoverBackground: =ColorFade(RGBA(56, 96, 178, 1), -20%)
                              ChevronHoverFill: =RGBA(255, 255, 255, 1)
                              DefaultSelectedItems: =LookUp(DM_KENH_BANS,MA_KENH_BAN=First(objHD).MA_KENH_BAN && LOAI=cbxLoaiKBNHD.Selected.MA_LOAI_KB)
                              DisplayFields: =["cr282_ma_kenh_ban","cr282_ten_kenh_ban"]
                              Font: =Font.'Open Sans'
                              Height: =32
                              HoverFill: =RGBA(186, 202, 226, 1)
                              InputTextPlaceholder: ="Chọn mã kênh bán"
                              Items: =Filter(DM_KENH_BANS,LOAI=cbxLoaiKBNHD.Selected.MA_LOAI_KB)
                              OnChange: |-
                                =If(
                                    IsBlank(unReloadCbxNHD),
                                    UpdateIf(
                                        objHD,
                                        true,
                                        {
                                            MA_KENH_BAN:cbxMaKBNHD.Selected.MA_KENH_BAN,
                                            TEN_KENH_BAN:LookUp(DM_KENH_BANS,MA_KENH_BAN=cbxMaKBNHD.Selected.MA_KENH_BAN,TEN_KENH_BAN)
                                        }
                                    );
                                    UpdateContext({
                                        nhomKB:If(
                                            LookUp(DM_LOAI_KENH_BANS,MA_LOAI_KB=cbxMaKBNHD.Selected.LOAI,CODE_KENH_BAN) in ["TT","CTV"],
                                            "0",
                                            LookUp(DM_LOAI_KENH_BANS,MA_LOAI_KB=cbxMaKBNHD.Selected.LOAI,CODE_KENH_BAN) in ["MG","BA"],
                                            "1",
                                            LookUp(DM_LOAI_KENH_BANS,MA_LOAI_KB=cbxMaKBNHD.Selected.LOAI,CODE_KENH_BAN) = "DL" &&
                                            LookUp(DM_LOAI_KENH_BANS,MA_LOAI_KB=cbxMaKBNHD.Selected.LOAI,CODE_KENH_BAN),
                                            cbxMaKBNHD.Selected.LOAI_CANHAN_TOCHUC
                                        )
                                    })
                                )
                              PressedColor: =RGBA(255, 255, 255, 1)
                              PressedFill: =RGBA(0, 18, 107, 1)
                              SearchFields: =["cr282_ma_kenh_ban"]
                              SelectMultiple: =false
                              SelectionColor: =RGBA(255, 255, 255, 1)
                              SelectionFill: =RGBA(56, 96, 178, 1)
                              Size: =11
                              Width: =250
                              X: =355
                              Y: =52
                        - cbxDVKBNHD:
                            Control: Classic/ComboBox@2.4.0
                            Properties:
                              BorderColor: =RGBA(72, 163, 62, 1)
                              ChevronBackground: =RGBA(56, 96, 178, 1)
                              ChevronFill: =RGBA(255, 255, 255, 1)
                              ChevronHoverBackground: =ColorFade(RGBA(56, 96, 178, 1), -20%)
                              ChevronHoverFill: =RGBA(255, 255, 255, 1)
                              DefaultSelectedItems: =LookUp(DM_DON_VI,MA_DON_VI=First(objHD).DONVI_KENHBAN)
                              DisplayFields: =["cr282_ten_don_vi","cr282_ma_don_vi"]
                              Font: =Font.'Open Sans'
                              Height: =32
                              HoverFill: =RGBA(186, 202, 226, 1)
                              InputTextPlaceholder: ="Chọn đơn vị kênh bán"
                              Items: =DM_DON_VI
                              PressedColor: =RGBA(255, 255, 255, 1)
                              PressedFill: =RGBA(0, 18, 107, 1)
                              SearchFields: =["cr282_ten_don_vi"]
                              SelectMultiple: =false
                              SelectionColor: =RGBA(255, 255, 255, 1)
                              SelectionFill: =RGBA(56, 96, 178, 1)
                              Size: =11
                              Width: =250
                              X: =990
                              Y: =52
                  - Container3_4:
                      Control: GroupContainer@1.3.0
                      Variant: ManualLayout
                      Properties:
                        DropShadow: =DropShadow.None
                        Height: =239
                        Width: =1267
                        X: =16
                        Y: =282
                      Children:
                        - Label3_46:
                            Control: Label@2.5.1
                            Properties:
                              BorderColor: =RGBA(0, 18, 107, 1)
                              Font: =Font.'Open Sans'
                              Height: =25
                              Size: =11
                              Text: ="Mã khách hàng (*)"
                              Width: =137
                              X: =30
                              Y: =25
                        - Label3_49:
                            Control: Label@2.5.1
                            Properties:
                              BorderColor: =RGBA(0, 18, 107, 1)
                              Font: =Font.'Open Sans'
                              Height: =25
                              Size: =11
                              Text: ="Ngày sinh/Thành lập"
                              Width: =160
                              X: =30
                              Y: =92
                        - Label3_48:
                            Control: Label@2.5.1
                            Properties:
                              BorderColor: =RGBA(0, 18, 107, 1)
                              Font: =Font.'Open Sans'
                              Height: =25
                              Size: =11
                              Text: ="Địa chỉ"
                              Width: =83
                              X: =672
                              Y: =25
                        - Label3_47:
                            Control: Label@2.5.1
                            Properties:
                              BorderColor: =RGBA(0, 18, 107, 1)
                              Font: =Font.'Open Sans'
                              Height: =25
                              Size: =11
                              Text: ="Tên khách hàng (*)"
                              Width: =140
                              X: =355
                              Y: =25
                        - dpNSinhNHD:
                            Control: Classic/DatePicker@2.6.0
                            Properties:
                              BorderColor: =RGBA(72, 163, 62, 1)
                              DefaultDate: =First(objHD).NGAY_SINH
                              EndYear: =2200
                              Font: =Font.'Open Sans'
                              Format: ="dd/mm/yyyy"
                              Height: =32
                              IconBackground: =RGBA(56, 96, 178, 1)
                              IconFill: =RGBA(255, 255, 255, 1)
                              InputTextPlaceholder: =
                              IsEditable: =true
                              Size: =11
                              StartYear: =1900
                              Width: =250
                              X: =30
                              Y: =120
                        - Label3_45:
                            Control: Label@2.5.1
                            Properties:
                              BorderColor: =RGBA(0, 18, 107, 1)
                              Font: =Font.'Open Sans'
                              FontWeight: =FontWeight.Bold
                              Height: =20
                              Size: =11
                              Text: ="3. Khách hàng"
                              Width: =254
                              Y: =4
                        - tiDChiNHD:
                            Control: Classic/TextInput@2.3.2
                            Properties:
                              BorderColor: =RGBA(72, 163, 62, 1)
                              Default: =First(objHD).DIA_CHI
                              Font: =Font.'Open Sans'
                              Height: =32
                              HoverBorderColor: =RGBA(0, 18, 107, 1)
                              HoverFill: =RGBA(186, 202, 226, 1)
                              RadiusBottomLeft: =0
                              RadiusBottomRight: =0
                              RadiusTopLeft: =0
                              RadiusTopRight: =0
                              Size: =11
                              Width: =250
                              X: =672
                              Y: =52
                        - cbxMaKHNHD:
                            Control: Classic/ComboBox@2.4.0
                            Properties:
                              BorderColor: =RGBA(72, 163, 62, 1)
                              ChevronBackground: =RGBA(56, 96, 178, 1)
                              ChevronFill: =RGBA(255, 255, 255, 1)
                              ChevronHoverBackground: =ColorFade(RGBA(56, 96, 178, 1), -20%)
                              ChevronHoverFill: =RGBA(255, 255, 255, 1)
                              DefaultSelectedItems: =LookUp(DM_KHACH_HANG,MA_KHACH_HANG=First(objHD).MA_KHACH_HANG)
                              DisplayFields: =["cr282_ma_khach_hang","cr282_ten_khach_hang"]
                              Font: =Font.'Open Sans'
                              Height: =32
                              HoverFill: =RGBA(186, 202, 226, 1)
                              InputTextPlaceholder: ="Chọn mã khách hàng"
                              Items: =DM_KHACH_HANG
                              OnChange: |-
                                =If(
                                    IsBlank(unReloadCbxNHD),
                                    UpdateIf(
                                        objHD,
                                        true,
                                        {
                                            MA_KHACH_HANG:cbxMaKHNHD.Selected.MA_KHACH_HANG,
                                            TEN_KHACH_HANG:LookUp(DM_KHACH_HANG,MA_KHACH_HANG=cbxMaKHNHD.Selected.MA_KHACH_HANG,TEN_KHACH_HANG),
                                            DIA_CHI:LookUp(DM_KHACH_HANG,MA_KHACH_HANG=cbxMaKHNHD.Selected.MA_KHACH_HANG,DIA_CHI_KH),
                                            NGAY_SINH:LookUp(DM_KHACH_HANG,MA_KHACH_HANG=cbxMaKHNHD.Selected.MA_KHACH_HANG,NGAY_SINH),
                                            GIOI_TINH:LookUp(DM_KHACH_HANG,MA_KHACH_HANG=cbxMaKHNHD.Selected.MA_KHACH_HANG,MA_GIOI_TINH),
                                            SO_DIEN_THOAI:LookUp(DM_KHACH_HANG,MA_KHACH_HANG=cbxMaKHNHD.Selected.MA_KHACH_HANG,SDT_KHACH_HANG),
                                            EMAIL:LookUp(DM_KHACH_HANG,MA_KHACH_HANG=cbxMaKHNHD.Selected.MA_KHACH_HANG,EMAIL),
                                            LOAI_KHACH_HANG:LookUp(DM_KHACH_HANG,MA_KHACH_HANG=cbxMaKHNHD.Selected.MA_KHACH_HANG,LOAI_KHACH_HANG),
                                            NGHE_NGHIEP:LookUp(DM_KHACH_HANG,MA_KHACH_HANG=cbxMaKHNHD.Selected.MA_KHACH_HANG,NGANH_NGHE),
                                            TINH_TP_KH:LookUp(DM_KHACH_HANG,MA_KHACH_HANG=cbxMaKHNHD.Selected.MA_KHACH_HANG,MA_TINH),
                                            NHOM_KHACH_HANG:LookUp(DM_KHACH_HANG,MA_KHACH_HANG=cbxMaKHNHD.Selected.MA_KHACH_HANG,MA_NHOM_KH)
                                        }
                                    );
                                    If(
                                        LookUp(DM_KHACH_HANG,MA_KHACH_HANG=cbxMaKHNHD.Selected.MA_KHACH_HANG,LOAI_KHACH_HANG)="0",
                                        ClearCollect(
                                            dmKhachHangNHDCollect,
                                            RenameColumns(
                                                ShowColumns(
                                                    DM_NGHE_NGHIEP,
                                                    MA_NGHE_NGHIEP,
                                                    TEN_NGHE_NGHIEP
                                                ),
                                                cr282_ma_nghe_nghiep,
                                                value,
                                                cr282_ten_nghe_nghiep,
                                                title
                                            )
                                        ),
                                        ClearCollect(
                                            dmKhachHangNHDCollect,
                                            RenameColumns(
                                                ShowColumns(
                                                    BH_DM_NGANHNGHES,
                                                    MA_NHOM_NGANH,
                                                    TEN_NGANH
                                                ),
                                                cr282_ma_nhom_nganh,
                                                value,
                                                cr282_ten_nganh,
                                                title
                                            )
                                        )
                                    );
                                    Reset(cbxNgheNHD);
                                    If(
                                        !IsBlank(First(objHD).TEN_KHACH_HANG_SAVED) && !IsBlank(First(objHD).MA_KHACH_HANG) && First(objHD).MA_KHACH_HANG<>First(objHD).TEN_KHACH_HANG_SAVED,
                                        Refresh(DL_HOP_DONG_SP_NDBH);
                                        RemoveIf(DL_HOP_DONG_SP_NDBH,MA_HOP_DONG=First(objHD).MA_HOP_DONG);
                                        Clear(tmpDSNDBHNHDCollect);
                                        UpdateIf(
                                            DL_HOP_DONG_SPS,
                                            MA_HOP_DONG=First(objHD).MA_HOP_DONG,
                                            {
                                                AUTO_GEN_NDBH:Blank(),
                                                SONGUOI_THAMGIA:0,
                                                TONG_TIEN_PHI:0,
                                                TONG_PHI_DANHSACH:0
                                            }
                                        );
                                        ClearCollect(
                                            tmpDSHDSPNHDCollect1,
                                            tmpDSHDSPNHDCollect
                                        );
                                        UpdateIf(
                                            tmpDSHDSPNHDCollect,
                                            MA_HOP_DONG=First(objHD).MA_HOP_DONG,
                                            {
                                                AUTO_GEN_NDBH:Blank(),
                                                SONGUOI_THAMGIA:0,
                                                TONG_TIEN_PHI:0,
                                                TONG_PHI_DANHSACH:0
                                            }
                                        );
                                        ClearCollect(
                                            tmpMaCTChangeNHD,
                                            tmpDSHDSPNHDCollect
                                        );
                                        UpdateIf(
                                            objHD,
                                            true,
                                            {
                                                SO_NGUOI_TGIA:"0"
                                            }
                                        );
                                        UpdateIf(
                                            DL_HOP_DONGS,
                                            MA_HOP_DONG=First(objHD).MA_HOP_DONG,
                                            {
                                                DIA_CHI: tiDChiNHD.Text,
                                                EMAIL: tiEmailNHD.Text,
                                                GIOI_TINH: cbxGTinhNHD.Selected.MA_GIOI_TINH,
                                                LOAI_KHACH_HANG: cbxLoaiKHNHD.Selected.value,
                                                MA_KHACH_HANG: cbxMaKHNHD.Selected.MA_KHACH_HANG,
                                                NGAY_SINH: dpNSinhNHD.SelectedDate,
                                                NGHE_NGHIEP: cbxNgheNHD.Selected.value,
                                                SO_DIEN_THOAI: tiSDTNHD.Text,
                                                TEN_KHACH_HANG: tiTenKHNHD.Text,
                                                TINH_TP_KH: cbxTinhNHD.Selected.MA_PHAMVI,
                                                NHOM_KHACH_HANG: cbxNhomKHNHD.Selected.MA_NHOM_KH,
                                                TEN_KHACH_HANG_SAVED:cbxMaKHNHD.Selected.MA_KHACH_HANG,
                                                SO_NGUOI_TGIA:"0"
                                            }
                                        )
                                    )
                                )
                              OnSelect: |-
                                =UpdateContext({
                                    checkChangeKH1:"1"
                                })
                              PressedColor: =RGBA(255, 255, 255, 1)
                              PressedFill: =RGBA(0, 18, 107, 1)
                              SearchFields: =["cr282_ma_khach_hang"]
                              SelectMultiple: =false
                              SelectionColor: =RGBA(255, 255, 255, 1)
                              SelectionFill: =RGBA(56, 96, 178, 1)
                              Size: =11
                              Width: =250
                              X: =30
                              Y: =52
                        - tiTenKHNHD:
                            Control: Classic/TextInput@2.3.2
                            Properties:
                              BorderColor: =RGBA(72, 163, 62, 1)
                              Default: =First(objHD).TEN_KHACH_HANG
                              Font: =Font.'Open Sans'
                              Height: =32
                              HoverBorderColor: =RGBA(0, 18, 107, 1)
                              HoverFill: =RGBA(186, 202, 226, 1)
                              RadiusBottomLeft: =0
                              RadiusBottomRight: =0
                              RadiusTopLeft: =0
                              RadiusTopRight: =0
                              Size: =11
                              Width: =250
                              X: =355
                              Y: =52
                        - cbxGTinhNHD:
                            Control: Classic/ComboBox@2.4.0
                            Properties:
                              BorderColor: =RGBA(72, 163, 62, 1)
                              ChevronBackground: =RGBA(56, 96, 178, 1)
                              ChevronFill: =RGBA(255, 255, 255, 1)
                              ChevronHoverBackground: =ColorFade(RGBA(56, 96, 178, 1), -20%)
                              ChevronHoverFill: =RGBA(255, 255, 255, 1)
                              DefaultSelectedItems: =LookUp(DM_GIOI_TINHS,MA_GIOI_TINH=First(objHD).GIOI_TINH)
                              DisplayFields: =["cr282_ten_gioi_tinh"]
                              Font: =Font.'Open Sans'
                              Height: =32
                              HoverFill: =RGBA(186, 202, 226, 1)
                              InputTextPlaceholder: ="Chọn giới tính"
                              Items: =DM_GIOI_TINHS
                              PressedColor: =RGBA(255, 255, 255, 1)
                              PressedFill: =RGBA(0, 18, 107, 1)
                              SearchFields: =["cr282_ten_gioi_tinh"]
                              SelectMultiple: =false
                              SelectionColor: =RGBA(255, 255, 255, 1)
                              SelectionFill: =RGBA(56, 96, 178, 1)
                              Size: =11
                              Width: =250
                              X: =355
                              Y: =120
                        - Label3_50:
                            Control: Label@2.5.1
                            Properties:
                              BorderColor: =RGBA(0, 18, 107, 1)
                              Font: =Font.'Open Sans'
                              Height: =25
                              Size: =11
                              Text: ="Giới tính"
                              Width: =83
                              X: =355
                              Y: =92
                        - tiSDTNHD:
                            Control: Classic/TextInput@2.3.2
                            Properties:
                              BorderColor: =RGBA(72, 163, 62, 1)
                              Default: =First(objHD).SO_DIEN_THOAI
                              Font: =Font.'Open Sans'
                              Height: =32
                              HoverBorderColor: =RGBA(0, 18, 107, 1)
                              HoverFill: =RGBA(186, 202, 226, 1)
                              RadiusBottomLeft: =0
                              RadiusBottomRight: =0
                              RadiusTopLeft: =0
                              RadiusTopRight: =0
                              Size: =11
                              Width: =250
                              X: =672
                              Y: =120
                        - tiEmailNHD:
                            Control: Classic/TextInput@2.3.2
                            Properties:
                              BorderColor: =RGBA(72, 163, 62, 1)
                              Default: =First(objHD).EMAIL
                              Font: =Font.'Open Sans'
                              Height: =32
                              HoverBorderColor: =RGBA(0, 18, 107, 1)
                              HoverFill: =RGBA(186, 202, 226, 1)
                              RadiusBottomLeft: =0
                              RadiusBottomRight: =0
                              RadiusTopLeft: =0
                              RadiusTopRight: =0
                              Size: =11
                              Width: =250
                              X: =990
                              Y: =120
                        - tiSoNTGNHD:
                            Control: Classic/TextInput@2.3.2
                            Properties:
                              Align: =Align.Right
                              BorderColor: =RGBA(72, 163, 62, 1)
                              Default: =If(IsBlank(First(objHD).SO_NGUOI_TGIA),0,First(objHD).SO_NGUOI_TGIA)
                              DisplayMode: =DisplayMode.Disabled
                              Font: =Font.'Open Sans'
                              Height: =32
                              HoverBorderColor: =RGBA(0, 18, 107, 1)
                              HoverFill: =RGBA(186, 202, 226, 1)
                              RadiusBottomLeft: =0
                              RadiusBottomRight: =0
                              RadiusTopLeft: =0
                              RadiusTopRight: =0
                              Size: =11
                              Width: =250
                              X: =990
                              Y: =190
                        - cbxNgheNHD:
                            Control: Classic/ComboBox@2.4.0
                            Properties:
                              BorderColor: =RGBA(72, 163, 62, 1)
                              ChevronBackground: =RGBA(56, 96, 178, 1)
                              ChevronFill: =RGBA(255, 255, 255, 1)
                              ChevronHoverBackground: =ColorFade(RGBA(56, 96, 178, 1), -20%)
                              ChevronHoverFill: =RGBA(255, 255, 255, 1)
                              DefaultSelectedItems: =LookUp(dmKhachHangNHDCollect,value=First(objHD).NGHE_NGHIEP)
                              DisplayFields: =["title"]
                              Font: =Font.'Open Sans'
                              Height: =32
                              HoverFill: =RGBA(186, 202, 226, 1)
                              InputTextPlaceholder: =
                              Items: =SortByColumns(dmKhachHangNHDCollect,"value",SortOrder.Ascending)
                              PressedColor: =RGBA(255, 255, 255, 1)
                              PressedFill: =RGBA(0, 18, 107, 1)
                              SearchFields: =["title"]
                              SelectMultiple: =false
                              SelectionColor: =RGBA(255, 255, 255, 1)
                              SelectionFill: =RGBA(56, 96, 178, 1)
                              Size: =11
                              Width: =250
                              X: =672
                              Y: =190
                        - Label3_51:
                            Control: Label@2.5.1
                            Properties:
                              BorderColor: =RGBA(0, 18, 107, 1)
                              Font: =Font.'Open Sans'
                              Height: =25
                              Size: =11
                              Text: ="Số điện thoại"
                              Width: =140
                              X: =672
                              Y: =92
                        - Label3_52:
                            Control: Label@2.5.1
                            Properties:
                              BorderColor: =RGBA(0, 18, 107, 1)
                              Font: =Font.'Open Sans'
                              Height: =25
                              Size: =11
                              Text: ="Email"
                              Width: =83
                              X: =990
                              Y: =92
                        - cbxLoaiKHNHD:
                            Control: Classic/ComboBox@2.4.0
                            Properties:
                              BorderColor: =RGBA(72, 163, 62, 1)
                              ChevronBackground: =RGBA(56, 96, 178, 1)
                              ChevronFill: =RGBA(255, 255, 255, 1)
                              ChevronHoverBackground: =ColorFade(RGBA(56, 96, 178, 1), -20%)
                              ChevronHoverFill: =RGBA(255, 255, 255, 1)
                              DefaultSelectedItems: =LookUp([{title:"Cá nhân",value:"0"},{title:"Tổ chức",value:"1"}],value=First(objHD).LOAI_KHACH_HANG)
                              DisplayFields: =["title"]
                              Font: =Font.'Open Sans'
                              Height: =32
                              HoverFill: =RGBA(186, 202, 226, 1)
                              InputTextPlaceholder: ="Chọn loại khách hàng"
                              IsSearchable: =false
                              Items: =[{title:"Cá nhân",value:"0"},{title:"Tổ chức",value:"1"}]
                              PressedColor: =RGBA(255, 255, 255, 1)
                              PressedFill: =RGBA(0, 18, 107, 1)
                              SearchFields: =["title"]
                              SelectMultiple: =false
                              SelectionColor: =RGBA(255, 255, 255, 1)
                              SelectionFill: =RGBA(56, 96, 178, 1)
                              Size: =11
                              Width: =250
                              X: =30
                              Y: =190
                        - Label3_53:
                            Control: Label@2.5.1
                            Properties:
                              BorderColor: =RGBA(0, 18, 107, 1)
                              Font: =Font.'Open Sans'
                              Height: =25
                              Size: =11
                              Text: ="Loại khách hàng"
                              Width: =140
                              X: =30
                              Y: =162
                        - Label3_54:
                            Control: Label@2.5.1
                            Properties:
                              BorderColor: =RGBA(0, 18, 107, 1)
                              Font: =Font.'Open Sans'
                              Height: =25
                              Size: =11
                              Text: ="Nghề nghiệp/Nhóm nghề"
                              Width: =200
                              X: =672
                              Y: =162
                        - Label3_55:
                            Control: Label@2.5.1
                            Properties:
                              BorderColor: =RGBA(0, 18, 107, 1)
                              Font: =Font.'Open Sans'
                              Height: =25
                              Size: =11
                              Text: ="Tổng số người tham gia"
                              Width: =200
                              X: =990
                              Y: =162
                        - cbxTinhNHD:
                            Control: Classic/ComboBox@2.4.0
                            Properties:
                              BorderColor: =RGBA(72, 163, 62, 1)
                              ChevronBackground: =RGBA(56, 96, 178, 1)
                              ChevronFill: =RGBA(255, 255, 255, 1)
                              ChevronHoverBackground: =ColorFade(RGBA(56, 96, 178, 1), -20%)
                              ChevronHoverFill: =RGBA(255, 255, 255, 1)
                              DefaultSelectedItems: =LookUp(Filter(DM_PHAMVI_DIALYS,LOAI="TINH_TP"),MA_PHAMVI=First(objHD).TINH_TP_KH)
                              DisplayFields: =["cr282_ten_phamvi"]
                              Font: =Font.'Open Sans'
                              Height: =32
                              HoverFill: =RGBA(186, 202, 226, 1)
                              InputTextPlaceholder: ="Chọn tỉnh/thành phố"
                              Items: =Filter(DM_PHAMVI_DIALYS,LOAI="TINH_TP")
                              PressedColor: =RGBA(255, 255, 255, 1)
                              PressedFill: =RGBA(0, 18, 107, 1)
                              SearchFields: =["cr282_ma_phamvi"]
                              SelectMultiple: =false
                              SelectionColor: =RGBA(255, 255, 255, 1)
                              SelectionFill: =RGBA(56, 96, 178, 1)
                              Size: =11
                              Width: =250
                              X: =990
                              Y: =52
                        - Label3_57:
                            Control: Label@2.5.1
                            Properties:
                              BorderColor: =RGBA(0, 18, 107, 1)
                              Font: =Font.'Open Sans'
                              Height: =25
                              Size: =11
                              Text: ="Tỉnh/TP"
                              Width: =83
                              X: =990
                              Y: =25
                        - cbxNhomKHNHD:
                            Control: Classic/ComboBox@2.4.0
                            Properties:
                              BorderColor: =RGBA(72, 163, 62, 1)
                              ChevronBackground: =RGBA(56, 96, 178, 1)
                              ChevronFill: =RGBA(255, 255, 255, 1)
                              ChevronHoverBackground: =ColorFade(RGBA(56, 96, 178, 1), -20%)
                              ChevronHoverFill: =RGBA(255, 255, 255, 1)
                              DefaultSelectedItems: =LookUp(DM_NHOM_KH,MA_NHOM_KH=First(objHD).NHOM_KHACH_HANG)
                              DisplayFields: =["cr282_ten_nhom_kh"]
                              Font: =Font.'Open Sans'
                              Height: =32
                              HoverFill: =RGBA(186, 202, 226, 1)
                              InputTextPlaceholder: ="Chọn loại khách hàng"
                              IsSearchable: =false
                              Items: =DM_NHOM_KH
                              PressedColor: =RGBA(255, 255, 255, 1)
                              PressedFill: =RGBA(0, 18, 107, 1)
                              SearchFields: =["cr282_ten_nhom_kh"]
                              SelectMultiple: =false
                              SelectionColor: =RGBA(255, 255, 255, 1)
                              SelectionFill: =RGBA(56, 96, 178, 1)
                              Size: =11
                              Width: =250
                              X: =355
                              Y: =190
                        - Label3_56:
                            Control: Label@2.5.1
                            Properties:
                              BorderColor: =RGBA(0, 18, 107, 1)
                              Font: =Font.'Open Sans'
                              Height: =25
                              Size: =11
                              Text: ="Nhóm khách hàng"
                              Width: =140
                              X: =355
                              Y: =162
                  - Container3_5:
                      Control: GroupContainer@1.3.0
                      Variant: ManualLayout
                      Properties:
                        DropShadow: =DropShadow.None
                        Height: =257
                        Width: =1267
                        X: =16
                        Y: =521
                      Children:
                        - Label3_58:
                            Control: Label@2.5.1
                            Properties:
                              BorderColor: =RGBA(0, 18, 107, 1)
                              Font: =Font.'Open Sans'
                              FontWeight: =FontWeight.Bold
                              Height: =20
                              Size: =11
                              Text: ="4. Sản phẩm"
                              Width: =254
                              Y: =4
                        - Gallery3_2:
                            Control: Gallery@2.15.0
                            Variant: VariableHeight
                            Properties:
                              BorderColor: =RGBA(0, 18, 107, 1)
                              Height: =184
                              Items: |-
                                =SortByColumns(
                                    tmpDSHDSPNHDCollect,
                                    "cr282_id",
                                    SortOrder.Ascending
                                )
                              TemplateSize: =170
                              Width: =1267
                              Y: =70
                            Children:
                              - Label3_59:
                                  Control: Label@2.5.1
                                  Properties:
                                    BorderColor: =RGBA(0, 18, 107, 1)
                                    Font: =Font.'Open Sans'
                                    Height: =25
                                    Size: =11
                                    Text: ="Mã sản phẩm (*)"
                                    Width: =130
                                    X: =30
                                    Y: =6
                              - Label3_61:
                                  Control: Label@2.5.1
                                  Properties:
                                    BorderColor: =RGBA(0, 18, 107, 1)
                                    Font: =Font.'Open Sans'
                                    Height: =25
                                    Size: =11
                                    Text: ="Tên chương trình"
                                    Width: =140
                                    X: =990
                                    Y: =6
                              - Label3_62:
                                  Control: Label@2.5.1
                                  Properties:
                                    BorderColor: =RGBA(0, 18, 107, 1)
                                    Font: =Font.'Open Sans'
                                    Height: =25
                                    Size: =11
                                    Text: ="Mã chương trình (*)"
                                    Width: =160
                                    X: =672
                                    Y: =6
                              - Label3_60:
                                  Control: Label@2.5.1
                                  Properties:
                                    BorderColor: =RGBA(0, 18, 107, 1)
                                    Font: =Font.'Open Sans'
                                    Height: =25
                                    Size: =11
                                    Text: ="Tên sản phẩm"
                                    Width: =140
                                    X: =355
                                    Y: =6
                              - tiSoNTGSPNHD:
                                  Control: Classic/TextInput@2.3.2
                                  Properties:
                                    Align: =Align.Right
                                    BorderColor: =RGBA(72, 163, 62, 1)
                                    Default: |-
                                      =If (
                                          ThisItem.edited=1,
                                          LookUp(tmpMaCTChangeNHD,ID=ThisItem.ID,SONGUOI_THAMGIA),
                                          ThisItem.SONGUOI_THAMGIA
                                      )
                                    DisplayMode: =DisplayMode.Disabled
                                    Font: =Font.'Open Sans'
                                    Format: =TextFormat.Number
                                    Height: =32
                                    HoverBorderColor: =RGBA(0, 18, 107, 1)
                                    HoverFill: =RGBA(186, 202, 226, 1)
                                    RadiusBottomLeft: =0
                                    RadiusBottomRight: =0
                                    RadiusTopLeft: =0
                                    RadiusTopRight: =0
                                    Size: =11
                                    Width: =250
                                    X: =672
                                    Y: =102
                              - tiTongPhiNHD:
                                  Control: Classic/TextInput@2.3.2
                                  Properties:
                                    Align: =Align.Right
                                    BorderColor: =RGBA(72, 163, 62, 1)
                                    Default: |-
                                      =If (
                                          ThisItem.edited=1,
                                          LookUp(tmpMaCTChangeNHD,ID=ThisItem.ID,TONG_TIEN_PHI),
                                          ThisItem.TONG_TIEN_PHI
                                      )
                                    DisplayMode: =DisplayMode.Disabled
                                    Font: =Font.'Open Sans'
                                    Format: =TextFormat.Number
                                    Height: =32
                                    HoverBorderColor: =RGBA(0, 18, 107, 1)
                                    HoverFill: =RGBA(186, 202, 226, 1)
                                    RadiusBottomLeft: =0
                                    RadiusBottomRight: =0
                                    RadiusTopLeft: =0
                                    RadiusTopRight: =0
                                    Size: =11
                                    Width: =250
                                    X: =990
                                    Y: =102
                              - Label3_64:
                                  Control: Label@2.5.1
                                  Properties:
                                    BorderColor: =RGBA(0, 18, 107, 1)
                                    Font: =Font.'Open Sans'
                                    Height: =25
                                    Size: =11
                                    Text: ="Số người tham gia"
                                    Width: =140
                                    X: =672
                                    Y: =74
                              - Label3_65:
                                  Control: Label@2.5.1
                                  Properties:
                                    BorderColor: =RGBA(0, 18, 107, 1)
                                    Font: =Font.'Open Sans'
                                    Height: =25
                                    Size: =11
                                    Text: ="Tổng phí/Nhóm"
                                    Width: =140
                                    X: =990
                                    Y: =74
                              - tiTenSPNHD:
                                  Control: Classic/TextInput@2.3.2
                                  Properties:
                                    BorderColor: =RGBA(72, 163, 62, 1)
                                    Default: =LookUp(DL_SAN_PHAM,MA_SAN_PHAM=cbxMaSPNHD.Selected.MA_SAN_PHAM,TEN_SAN_PHAM)
                                    DisplayMode: =DisplayMode.Disabled
                                    Font: =Font.'Open Sans'
                                    Height: =32
                                    HoverBorderColor: =RGBA(0, 18, 107, 1)
                                    HoverFill: =RGBA(186, 202, 226, 1)
                                    RadiusBottomLeft: =0
                                    RadiusBottomRight: =0
                                    RadiusTopLeft: =0
                                    RadiusTopRight: =0
                                    Size: =11
                                    Width: =250
                                    X: =355
                                    Y: =34
                              - tiTenCTNHD:
                                  Control: Classic/TextInput@2.3.2
                                  Properties:
                                    BorderColor: =RGBA(72, 163, 62, 1)
                                    Default: =LookUp(' DL_SAN_PHAM_CT',MA_SAN_PHAM=cbxMaSPNHD.Selected.MA_SAN_PHAM && MA_CHUONG_TRINH=cbxMaCTNHD.Selected.MA_CHUONG_TRINH,TEN_CHUONG_TRINH)
                                    DisplayMode: =DisplayMode.Disabled
                                    Font: =Font.'Open Sans'
                                    Height: =32
                                    HoverBorderColor: =RGBA(0, 18, 107, 1)
                                    HoverFill: =RGBA(186, 202, 226, 1)
                                    RadiusBottomLeft: =0
                                    RadiusBottomRight: =0
                                    RadiusTopLeft: =0
                                    RadiusTopRight: =0
                                    Size: =11
                                    Width: =250
                                    X: =990
                                    Y: =34
                              - cbxMaCTNHD:
                                  Control: Classic/ComboBox@2.4.0
                                  Properties:
                                    BorderColor: =RGBA(72, 163, 62, 1)
                                    ChevronBackground: =RGBA(56, 96, 178, 1)
                                    ChevronFill: =RGBA(255, 255, 255, 1)
                                    ChevronHoverBackground: =ColorFade(RGBA(56, 96, 178, 1), -20%)
                                    ChevronHoverFill: =RGBA(255, 255, 255, 1)
                                    DefaultSelectedItems: |-
                                      =/*If (
                                          ThisItem.edited=1,
                                          LookUp(
                                              ' DL_SAN_PHAM_CT',
                                              MA_SAN_PHAM=cbxMaSPNHD.Selected.MA_SAN_PHAM && MA_CHUONG_TRINH=tiMaCTNHD.Text
                                          ),
                                          LookUp(
                                              ' DL_SAN_PHAM_CT',
                                              MA_SAN_PHAM=cbxMaSPNHD.Selected.MA_SAN_PHAM && MA_CHUONG_TRINH=ThisItem.MA_CHUONG_TRINH
                                          )
                                      )*/

                                      LookUp(
                                          ' DL_SAN_PHAM_CT',
                                          MA_SAN_PHAM=cbxMaSPNHD.Selected.MA_SAN_PHAM && MA_CHUONG_TRINH=LookUp(tmpMaCTChangeNHD,ID=ThisItem.ID,MA_CHUONG_TRINH)
                                      )
                                    DisplayFields: =["cr282_ma_chuongtrinh","cr282_ten_chuong_trinh"]
                                    Font: =Font.'Open Sans'
                                    Height: =32
                                    HoverFill: =RGBA(186, 202, 226, 1)
                                    InputTextPlaceholder: =""
                                    Items: =Filter(' DL_SAN_PHAM_CT',MA_SAN_PHAM=cbxMaSPNHD.Selected.MA_SAN_PHAM)
                                    OnChange: |-
                                      =If(
                                          cbxMaCTNHD.Selected.MA_CHUONG_TRINH<>LookUp(tmpMaCTChangeNHD,ID=ThisItem.ID,MA_CHUONG_TRINH) && IsBlank(unReloadMaCT),
                                          UpdateIf(
                                              tmpMaCTChangeNHD,
                                              ID=ThisItem.ID,
                                              {
                                                  MA_CHUONG_TRINH:cbxMaCTNHD.Selected.MA_CHUONG_TRINH,
                                                  NHOM_TINH_PHI:Blank()
                                              }
                                          );
                                          Reset(cbxNhomTPNHD);
                                      );
                                    OnSelect: |-
                                      =UpdateContext({
                                          unReloadMaSP:Blank(),
                                          unReloadMaCT:Blank()
                                      })
                                    PressedColor: =RGBA(255, 255, 255, 1)
                                    PressedFill: =RGBA(0, 18, 107, 1)
                                    SearchFields: =["cr282_ma_chuong_trinh"]
                                    SelectMultiple: =false
                                    SelectionColor: =RGBA(255, 255, 255, 1)
                                    SelectionFill: =RGBA(56, 96, 178, 1)
                                    Size: =11
                                    Visible: =ThisItem.edited=1
                                    Width: =250
                                    X: =672
                                    Y: =34
                              - cbxMaSPNHD:
                                  Control: Classic/ComboBox@2.4.0
                                  Properties:
                                    BorderColor: =RGBA(72, 163, 62, 1)
                                    ChevronBackground: =RGBA(56, 96, 178, 1)
                                    ChevronFill: =RGBA(255, 255, 255, 1)
                                    ChevronHoverBackground: =ColorFade(RGBA(56, 96, 178, 1), -20%)
                                    ChevronHoverFill: =RGBA(255, 255, 255, 1)
                                    DefaultSelectedItems: =LookUp(DL_SAN_PHAM,MA_SAN_PHAM=ThisItem.MA_SAN_PHAM)
                                    DisplayFields: =["cr282_ma_san_pham","cr282_ten_san_pham"]
                                    DisplayMode: =If(ThisItem.edited=1,DisplayMode.Edit,DisplayMode.Disabled)
                                    Font: =Font.'Open Sans'
                                    Height: =32
                                    HoverFill: =RGBA(186, 202, 226, 1)
                                    InputTextPlaceholder: =""
                                    Items: =DL_SAN_PHAM
                                    OnChange: |-
                                      =If(
                                          cbxMaSPNHD.Selected.MA_SAN_PHAM<>LookUp(tmpMaCTChangeNHD,ID=ThisItem.ID,MA_SAN_PHAM) && IsBlank(unReloadMaSP),
                                          UpdateIf(
                                              tmpMaCTChangeNHD,
                                              ID=ThisItem.ID,
                                              {
                                                  MA_SAN_PHAM:cbxMaSPNHD.Selected.MA_SAN_PHAM,
                                                  MA_CHUONG_TRINH:Blank(),
                                                  NHOM_TINH_PHI:Blank()
                                              }
                                          );
                                          Reset(cbxMaCTNHD);Reset(cbxNhomTPNHD);
                                      );
                                    OnSelect: |-
                                      =UpdateContext({
                                          unReloadMaSP:Blank(),
                                          unReloadMaCT:Blank()
                                      })
                                    PressedColor: =RGBA(255, 255, 255, 1)
                                    PressedFill: =RGBA(0, 18, 107, 1)
                                    SearchFields: =["cr282_ma_san_pham"]
                                    SelectMultiple: =false
                                    SelectionColor: =RGBA(255, 255, 255, 1)
                                    SelectionFill: =RGBA(56, 96, 178, 1)
                                    Size: =11
                                    Width: =250
                                    X: =30
                                    Y: =34
                              - btnXoaHDSPNHD:
                                  Control: Classic/Button@2.2.0
                                  Properties:
                                    BorderColor: =ColorFade(Self.Fill, -15%)
                                    Color: =RGBA(255, 255, 255, 1)
                                    DisabledBorderColor: =RGBA(166, 166, 166, 1)
                                    Fill: =RGBA(56, 96, 178, 1)
                                    Font: =Font.'Open Sans'
                                    Height: =32
                                    HoverBorderColor: =ColorFade(Self.BorderColor, 20%)
                                    HoverColor: =RGBA(255, 255, 255, 1)
                                    HoverFill: =ColorFade(RGBA(56, 96, 178, 1), -20%)
                                    OnSelect: "=If(\n    Or(maAddedHDSPNHD<>\"\",maUpdatedHDSPNHD<>\"\"),\n    Notify(\"Có dữ liệu chưa được lưu\",NotificationType.Warning,2000),\n    //xoa ds ndbh\n    Refresh(DL_HOP_DONG_SP_NDBH);\n    ClearCollect(\n        tmpDSNDBHRemoveNHDCollect,\n        Filter(\n            DL_HOP_DONG_SP_NDBH,\n            MA_HOP_DONG=First(objHD).MA_HOP_DONG && ID_HOPDONG_SP=ThisItem.ID\n        )\n    );\n    ForAll(\n        tmpDSNDBHRemoveNHDCollect As ds,\n        Remove(\n            DL_HOP_DONG_SP_NDBH,\n            ds\n        )\n    );\n    ClearCollect(\n        tmpDSNDBHRemoveNHDCollect,\n        Filter(\n            tmpDSNDBHNHDCollect,\n            ID_HOPDONG_SP=ThisItem.ID\n        )\n    );\n    ForAll(\n        tmpDSNDBHRemoveNHDCollect As ds,\n        Remove(\n            tmpDSNDBHNHDCollect,\n            ds\n        )\n    );\n    //end xoa ds ndbh\n    \n    //xoa ds qlct\n    Refresh(DL_HOP_DONG_SP_QLCT);\n    ClearCollect(\n        tmpDSQLCTRemoveNHDCollect,\n        Filter(\n            DL_HOP_DONG_SP_QLCT,\n            MA_HOP_DONG=First(objHD).MA_HOP_DONG && ID_HOPDONG_SP=ThisItem.ID\n        )\n    );\n    ForAll(\n        tmpDSQLCTRemoveNHDCollect As ds,\n        Remove(\n            DL_HOP_DONG_SP_QLCT,\n            ds\n        )\n    );\n    ClearCollect(\n        tmpDSQLCTRemoveNHDCollect,\n        Filter(\n            tmpQLCTHDSPNHDCollect,\n            ID_HOPDONG_SP=ThisItem.ID\n        )\n    );\n    ForAll(\n        tmpDSQLCTRemoveNHDCollect As ds,\n        Remove(\n            tmpQLCTHDSPNHDCollect,\n            ds\n        )\n    );\n    //end xoa ds qlct\n\n    //xoa ds hdsp\n    Refresh(DL_HOP_DONG_SPS);\n    ClearCollect(\n        tmpDSHDSPRemoveNHDCollect,\n        Filter(\n            DL_HOP_DONG_SPS,\n            ID=ThisItem.ID\n        )\n    );\n    ForAll(\n        tmpDSHDSPRemoveNHDCollect As ds,\n        Remove(\n            DL_HOP_DONG_SPS,\n            ds\n        )\n    );\n    ClearCollect(\n        tmpDSHDSPRemoveNHDCollect,\n        Filter(\n            tmpDSHDSPNHDCollect,\n            ID=ThisItem.ID\n        )\n    );\n    ForAll(\n        tmpDSHDSPRemoveNHDCollect As ds,\n        Remove(\n            tmpDSHDSPNHDCollect,\n            ds\n        )\n    );\n    //end xoa ds hdsp\n\n    UpdateIf(\n        objHD,\n        true,\n        {\n            SO_NGUOI_TGIA:Sum(tmpDSHDSPNHDCollect,SONGUOI_THAMGIA)\n        }\n    );\n    UpdateIf(\n        DL_HOP_DONG_SPS,\n        MA_HOP_DONG=First(objHD).MA_HOP_DONG,\n        {\n            SO_NGUOI_TGIA:Sum(tmpDSHDSPNHDCollect,SONGUOI_THAMGIA)\n        }\n    );\n    Notify(\"Xóa dữ liệu thành công\", NotificationType.Success,2000);\n)"
                                    PressedBorderColor: =Self.Fill
                                    PressedColor: =Self.Fill
                                    PressedFill: =Self.Color
                                    Size: =11
                                    Text: ="Xóa"
                                    Visible: =ThisItem.edited=0
                                    Width: =90
                                    X: =1100
                                    Y: =143
                              - btnLuuHDSPNHD:
                                  Control: Classic/Button@2.2.0
                                  Properties:
                                    BorderColor: =ColorFade(Self.Fill, -15%)
                                    Color: =RGBA(255, 255, 255, 1)
                                    DisabledBorderColor: =RGBA(166, 166, 166, 1)
                                    Fill: =RGBA(56, 96, 178, 1)
                                    Font: =Font.'Open Sans'
                                    Height: =32
                                    HoverBorderColor: =ColorFade(Self.BorderColor, 20%)
                                    HoverColor: =RGBA(255, 255, 255, 1)
                                    HoverFill: =ColorFade(RGBA(56, 96, 178, 1), -20%)
                                    OnSelect: |
                                      =If(
                                          IsBlank(cbxMaSPNHD.Selected.MA_SAN_PHAM),
                                          Notify("Bắt buộc chọn sản phẩm",NotificationType.Error,2000),
                                          IsBlank(cbxMaCTNHD.Selected.MA_CHUONG_TRINH),
                                          Notify("Bắt buộc chọn chương trình",NotificationType.Error,2000),
                                          IsEmpty(cbxNhomTPNHD.SelectedItems),
                                          Notify("Bắt buộc chọn nhóm tính phí",NotificationType.Error,2000),
                                          UpdateContext({
                                              unReloadMaSP:"1",
                                              unReloadMaCT:"1"
                                          });
                                          If(
                                              ThisItem.ID=maAddedHDSPNHD,
                                              Patch(
                                                  DL_HOP_DONG_SPS,
                                                  {
                                                      ID: ThisItem.ID,
                                                      MA_HOP_DONG: First(objHD).MA_HOP_DONG,
                                                      MA_SAN_PHAM: cbxMaSPNHD.Selected.MA_SAN_PHAM,
                                                      MA_CHUONG_TRINH: cbxMaCTNHD.Selected.MA_CHUONG_TRINH,
                                                      TEN_CHUONG_TRINH: tiTenCTNHD.Text,
                                                      TEN_SAN_PHAM: tiTenSPNHD.Text,
                                                      DON_VI_TINH: cbxDVTienNHD.Selected.TIEN_TE,
                                                      SONGUOI_THAMGIA: Value(tiSoNTGSPNHD.Text),
                                                      TONG_TIEN_PHI: Value(tiTongPhiNHD.Text),
                                                      MA_KENH_BAN: cbxMaKBNHD.Selected.MA_KENH_BAN,
                                                      MA_KHACH_HANG: cbxMaKHNHD.Selected.MA_KHACH_HANG,
                                                      NGAY_HOP_DONG: dpNgayHDNHD.SelectedDate,
                                                      NHOM_TINH_PHI: Concat(
                                                          cbxNhomTPNHD.SelectedItems,
                                                          Value,
                                                          "|"
                                                      ),
                                                      PHI_DIEU_CHINH:Value(tiPhiDCNHD.Text),
                                                      TONG_PHI_DANHSACH:LookUp(tmpMaCTChangeNHD,ID=ThisItem.ID,TONG_PHI_DANHSACH),
                                                      AUTO_GEN_NDBH:LookUp(tmpMaCTChangeNHD,ID=ThisItem.ID,AUTO_GEN_NDBH)
                                                  }
                                              ),
                                              ThisItem.ID=maUpdatedHDSPNHD,
                                              UpdateIf(
                                                  DL_HOP_DONG_SPS,
                                                  ID = ThisItem.ID,
                                                  {
                                                      MA_SAN_PHAM:cbxMaSPNHD.Selected.MA_SAN_PHAM,
                                                      TEN_SAN_PHAM:tiTenSPNHD.Text,
                                                      MA_CHUONG_TRINH:cbxMaCTNHD.Selected.MA_CHUONG_TRINH,
                                                      TEN_CHUONG_TRINH:tiTenCTNHD.Text,
                                                      SONGUOI_THAMGIA: Value(tiSoNTGSPNHD.Text),
                                                      TONG_TIEN_PHI: Value(tiTongPhiNHD.Text),
                                                      MA_KENH_BAN: cbxMaKBNHD.Selected.MA_KENH_BAN,
                                                      MA_KHACH_HANG: cbxMaKHNHD.Selected.MA_KHACH_HANG,
                                                      NGAY_HOP_DONG: dpNgayHDNHD.SelectedDate,
                                                      NHOM_TINH_PHI: Concat(
                                                          cbxNhomTPNHD.SelectedItems,
                                                          Value,
                                                          "|"
                                                      ),
                                                      PHI_DIEU_CHINH:Value(tiPhiDCNHD.Text),
                                                      TONG_PHI_DANHSACH:LookUp(tmpMaCTChangeNHD,ID=ThisItem.ID,TONG_PHI_DANHSACH),
                                                      AUTO_GEN_NDBH:LookUp(tmpMaCTChangeNHD,ID=ThisItem.ID,AUTO_GEN_NDBH)
                                                  }
                                              )
                                          );
                                          UpdateIf(
                                              tmpDSHDSPNHDCollect,
                                              ID=ThisItem.ID,
                                              {
                                                  MA_SAN_PHAM:cbxMaSPNHD.Selected.MA_SAN_PHAM,
                                                  TEN_SAN_PHAM:tiTenSPNHD.Text,
                                                  MA_CHUONG_TRINH:cbxMaCTNHD.Selected.MA_CHUONG_TRINH,
                                                  TEN_CHUONG_TRINH:tiTenCTNHD.Text,
                                                  PTHUC_THANH_TOAN:cbxPTTTNHD.Selected.value,
                                                  SONGUOI_THAMGIA:Value(tiSoNTGSPNHD.Text),
                                                  TONG_TIEN_PHI:Value(tiTongPhiNHD.Text),
                                                  NHOM_TINH_PHI:Concat(cbxNhomTPNHD.SelectedItems, Value,"|"),
                                                  PHI_DIEU_CHINH:Value(tiPhiDCNHD.Text),
                                                  TONG_PHI_DANHSACH:LookUp(tmpMaCTChangeNHD,ID=ThisItem.ID,TONG_PHI_DANHSACH),
                                                  AUTO_GEN_NDBH:LookUp(tmpMaCTChangeNHD,ID=ThisItem.ID,AUTO_GEN_NDBH),
                                                  edited:0
                                              }
                                          );
                                          Refresh(DL_HOP_DONG_SP_NDBH);
                                          RemoveIf(
                                              DL_HOP_DONG_SP_NDBH,
                                              MA_HOP_DONG=First(objHD).MA_HOP_DONG && ID_HOPDONG_SP=ThisItem.ID
                                          );
                                          ForAll(
                                              Filter(
                                                  tmpDSNDBHNHDCollect,
                                                  ID_HOPDONG_SP=ThisItem.ID
                                              ) As ds,
                                              Patch(
                                                  DL_HOP_DONG_SP_NDBH,
                                                  {
                                                      ID:ds.ID,
                                                      MA_HOP_DONG:First(objHD).MA_HOP_DONG,
                                                      MA_SAN_PHAM:cbxMaSPNHD.Selected.MA_SAN_PHAM,
                                                      MA_CHUONG_TRINH:cbxMaCTNHD.Selected.MA_CHUONG_TRINH,
                                                      NHOM_TINH_PHI:Concat(cbxNhomTPNHD.SelectedItems, Value,"|"),
                                                      TEN_NDBH:ds.TEN_NDBH,
                                                      MST:ds.MST,
                                                      DIA_CHI:ds.DIA_CHI,
                                                      MA_GIOI__TINH:ds.MA_GIOI__TINH,
                                                      MA_TINH_TP: ds.MA_TINH_TP,
                                                      MA_NHAN_VIEN: ds.MA_NHAN_VIEN,
                                                      MOI_QUAN_HE: ds.MOI_QUAN_HE,
                                                      NGAY_SINH: ds.NGAY_SINH,
                                                      NHOM: ds.NHOM,
                                                      SO_GIAY_TO: ds.SO_GIAY_TO,
                                                      PHI_NDBH: ds.PHI_NDBH,
                                                      ID_HOPDONG_SP:ThisItem.ID
                                                  }
                                              )
                                          );
                                          UpdateIf(
                                              DL_HOP_DONGS,
                                              MA_HOP_DONG=First(objHD).MA_HOP_DONG,
                                              {
                                                  SO_NGUOI_TGIA:Value(tiSoNTGNHD.Text)
                                              }
                                          );
                                          Refresh(DL_HOP_DONG_SP_QLCT);
                                          ClearCollect(
                                              tmpDSQLCTRemoveNHDCollect,
                                              Filter(
                                                  DL_HOP_DONG_SP_QLCT,
                                                  MA_HOP_DONG=First(objHD).MA_HOP_DONG && ID_HOPDONG_SP=ThisItem.ID
                                              )
                                          );
                                          ForAll(
                                              tmpDSQLCTRemoveNHDCollect As ds,
                                              Remove(
                                                  DL_HOP_DONG_SP_QLCT,
                                                  ds
                                              )
                                          );
                                          If(
                                              CountIf(Filter(tmpQLCTHDSPNHDCollect,ID_HOPDONG_SP=ThisItem.ID),true)=0,
                                              ForAll(
                                                  Filter(
                                                      DL_CHUONGTRINH_QLCTS,
                                                      MA_CHUONG_TRINH = cbxMaCTNHD.Selected.MA_CHUONG_TRINH && MA_SAN_PHAM = cbxMaSPNHD.Selected.MA_SAN_PHAM &&
                                                      MA_NHOM_QL in Distinct(Filter(DL_SAN_PHAM_NHOMQLS,MA_SP = cbxMaSPNHD.Selected.MA_SAN_PHAM && 
                                                          !IsBlank(Find(cbxMaCTNHD.Selected.MA_CHUONG_TRINH,CHUONGTRINH_APDUNG)) &&
                                                          !IsBlank(Find(MA_NHOM_TINHPHI,Concat(cbxNhomTPNHD.SelectedItems, Value,"|")))
                                                      ),MA_NHOM_QL)
                                                  ) As ds,
                                                  Patch(
                                                      DL_HOP_DONG_SP_QLCT,
                                                      {
                                                          MA_HOP_DONG:First(objHD).MA_HOP_DONG,
                                                          MA_SAN_PHAM:cbxMaSPNHD.Selected.MA_SAN_PHAM,
                                                          MA_CHUONG_TRINH:cbxMaCTNHD.Selected.MA_CHUONG_TRINH,
                                                          NHOM_TINH_PHI:Concat(cbxNhomTPNHD.SelectedItems, Value,"|"),
                                                          ID_HOPDONG_SP:ThisItem.ID,
                                                          MA_QL_CT:ds.MA_QL_CT,
                                                          MA_NHOM_QL:ds.MA_NHOM_QL,
                                                          TT_HIENTHI:ds.TT_HIENTHI,
                                                          GH_SOLAN_NAM:ds.GH_SOLAN_NAM,
                                                          GH_SONGAY_NAM:ds.GH_SONGAY_NAM,
                                                          GH_SOTIEN_BENH: ds.GH_SOTIEN_BENH,
                                                          GH_SOTIEN_NAM: ds.GH_SOTIEN_NAM,
                                                          GH_SOTIEN_NGAY: ds.GH_SOTIEN_NGAY,
                                                          GH_SOTIEN_VU: ds.GH_SOTIEN_VU,
                                                          PT_TU_CHITRA: ds.PT_TU_CHITRA,
                                                          SO_TIEN_BH: ds.SO_TIEN_BH,
                                                          TEN_QUYEN_LOI_HT: ds.TEN_QUYEN_LOI_HT
                                                      }
                                                  )
                                              )
                                          );
                                          ForAll(
                                              Filter(
                                                  tmpQLCTHDSPNHDCollect,
                                                  ID_HOPDONG_SP=ThisItem.ID
                                              ) As ds,
                                              Patch(
                                                  DL_HOP_DONG_SP_QLCT,
                                                  {
                                                      MA_HOP_DONG:First(objHD).MA_HOP_DONG,
                                                      MA_SAN_PHAM:cbxMaSPNHD.Selected.MA_SAN_PHAM,
                                                      MA_CHUONG_TRINH:cbxMaCTNHD.Selected.MA_CHUONG_TRINH,
                                                      NHOM_TINH_PHI:Concat(cbxNhomTPNHD.SelectedItems, Value,"|"),
                                                      ID_HOPDONG_SP:ThisItem.ID,
                                                      MA_QL_CT:ds.MA_QL_CT,
                                                      MA_NHOM_QL:ds.MA_NHOM_QL,
                                                      TT_HIENTHI:ds.TT_HIENTHI,
                                                      GH_SOLAN_NAM:ds.GH_SOLAN_NAM,
                                                      GH_SONGAY_NAM:ds.GH_SONGAY_NAM,
                                                      GH_SOTIEN_BENH: ds.GH_SOTIEN_BENH,
                                                      GH_SOTIEN_NAM: ds.GH_SOTIEN_NAM,
                                                      GH_SOTIEN_NGAY: ds.GH_SOTIEN_NGAY,
                                                      GH_SOTIEN_VU: ds.GH_SOTIEN_VU,
                                                      PT_TU_CHITRA: ds.PT_TU_CHITRA,
                                                      SO_TIEN_BH: ds.SO_TIEN_BH,
                                                      TEN_QUYEN_LOI_HT: ds.TEN_QUYEN_LOI_HT
                                                  }
                                              )
                                          );
                                          ClearCollect(
                                              tmpMaCTChangeNHD,
                                              tmpDSHDSPNHDCollect
                                          );
                                          UpdateContext({
                                              maAddedHDSPNHD:"",
                                              maUpdatedHDSPNHD:""
                                          });
                                          Notify("Lưu thông tin thành công",NotificationType.Success,2000);
                                      )
                                    PressedBorderColor: =Self.Fill
                                    PressedColor: =Self.Fill
                                    PressedFill: =Self.Color
                                    Size: =11
                                    Text: ="Lưu"
                                    Visible: =ThisItem.edited=1
                                    Width: =90
                                    X: =990
                                    Y: =143
                              - btnSuaHDSPNHD:
                                  Control: Classic/Button@2.2.0
                                  Properties:
                                    BorderColor: =ColorFade(Self.Fill, -15%)
                                    Color: =RGBA(255, 255, 255, 1)
                                    DisabledBorderColor: =RGBA(166, 166, 166, 1)
                                    Fill: =RGBA(56, 96, 178, 1)
                                    Font: =Font.'Open Sans'
                                    Height: =32
                                    HoverBorderColor: =ColorFade(Self.BorderColor, 20%)
                                    HoverColor: =RGBA(255, 255, 255, 1)
                                    HoverFill: =ColorFade(RGBA(56, 96, 178, 1), -20%)
                                    OnSelect: |-
                                      =If(
                                          Or(maAddedHDSPNHD<>"",maUpdatedHDSPNHD<>""),
                                          Notify("Có dữ liệu chưa được lưu",NotificationType.Warning,2000),
                                          UpdateIf(
                                              tmpDSHDSPNHDCollect,
                                              ID=ThisItem.ID,
                                              {
                                                  edited:1
                                              }
                                          );
                                          ClearCollect(
                                              tmpMaCTChangeNHD,
                                              tmpDSHDSPNHDCollect
                                          );
                                          UpdateContext({
                                              maUpdatedHDSPNHD:ThisItem.ID
                                          });
                                          Reset(cbxMaSPNHD);Reset(cbxMaCTNHD);
                                      )
                                    PressedBorderColor: =Self.Fill
                                    PressedColor: =Self.Fill
                                    PressedFill: =Self.Color
                                    Size: =11
                                    Text: ="Sửa"
                                    Visible: =ThisItem.edited=0
                                    Width: =90
                                    X: =990
                                    Y: =143
                              - btnHuyHDSPNHD:
                                  Control: Classic/Button@2.2.0
                                  Properties:
                                    BorderColor: =ColorFade(Self.Fill, -15%)
                                    Color: =RGBA(255, 255, 255, 1)
                                    DisabledBorderColor: =RGBA(166, 166, 166, 1)
                                    Fill: =RGBA(56, 96, 178, 1)
                                    Font: =Font.'Open Sans'
                                    Height: =32
                                    HoverBorderColor: =ColorFade(Self.BorderColor, 20%)
                                    HoverColor: =RGBA(255, 255, 255, 1)
                                    HoverFill: =ColorFade(RGBA(56, 96, 178, 1), -20%)
                                    OnSelect: |-
                                      =If(
                                          ThisItem.ID=maAddedHDSPNHD,
                                          RemoveIf(
                                              tmpDSNDBHNHDCollect,
                                              MA_HOP_DONG=First(objHD).MA_HOP_DONG 
                                              && ID_HOPDONG_SP=ThisItem.ID
                                          );
                                          RemoveIf(
                                              tmpQLCTHDSPNHDCollect,
                                              MA_HOP_DONG=First(objHD).MA_HOP_DONG 
                                              && ID_HOPDONG_SP=ThisItem.ID
                                          );
                                          Remove(tmpDSHDSPNHDCollect,ThisItem),
                                          RemoveIf(
                                              tmpQLCTHDSPNHDCollect,
                                              MA_HOP_DONG=First(objHD).MA_HOP_DONG 
                                              && ID_HOPDONG_SP=ThisItem.ID
                                          );
                                          RemoveIf(
                                              tmpDSNDBHNHDCollect,
                                              MA_HOP_DONG=First(objHD).MA_HOP_DONG 
                                              && ID_HOPDONG_SP=ThisItem.ID
                                          );
                                          Collect(
                                              tmpDSNDBHNHDCollect,
                                              AddColumns(
                                                  Filter(
                                                      DL_HOP_DONG_SP_NDBH,
                                                      MA_HOP_DONG=First(objHD).MA_HOP_DONG && ID_HOPDONG_SP=ThisItem.ID
                                                  ),
                                                  edited,
                                                  0
                                              )
                                          );
                                          UpdateIf(
                                              tmpDSHDSPNHDCollect,
                                              ID=ThisItem.ID,
                                              {
                                                  /*MA_SAN_PHAM:LookUp(DL_HOP_DONG_SPS,MA_HOP_DONG=First(objHD).MA_HOP_DONG && ID=ThisItem.ID,MA_SAN_PHAM),
                                                  MA_CHUONG_TRINH:LookUp(DL_HOP_DONG_SPS,MA_HOP_DONG=First(objHD).MA_HOP_DONG && ID=ThisItem.ID,MA_CHUONG_TRINH),
                                                  NHOM_TINH_PHI:LookUp(DL_HOP_DONG_SPS,MA_HOP_DONG=First(objHD).MA_HOP_DONG && ID=ThisItem.ID,NHOM_TINH_PHI),*/
                                                  SONGUOI_THAMGIA:LookUp(DL_HOP_DONG_SPS,MA_HOP_DONG=First(objHD).MA_HOP_DONG && ID=ThisItem.ID,SONGUOI_THAMGIA),
                                                  TONG_TIEN_PHI:LookUp(DL_HOP_DONG_SPS,MA_HOP_DONG=First(objHD).MA_HOP_DONG && ID=ThisItem.ID,TONG_TIEN_PHI),
                                                  TONG_PHI_DANHSACH:LookUp(DL_HOP_DONG_SPS,MA_HOP_DONG=First(objHD).MA_HOP_DONG && ID=ThisItem.ID,TONG_PHI_DANHSACH),
                                                  edited:0
                                              }
                                          );
                                          UpdateIf(
                                              tmpMaCTChangeNHD,
                                              ID=ThisItem.ID,
                                              {
                                                  MA_CHUONG_TRINH:LookUp(tmpDSHDSPNHDCollect,ID=ThisItem.ID,MA_CHUONG_TRINH),
                                                  NHOM_TINH_PHI:LookUp(tmpDSHDSPNHDCollect,ID=ThisItem.ID,NHOM_TINH_PHI)
                                              }
                                          );
                                          UpdateIf(
                                              objHD,
                                              true,
                                              {
                                                  SO_NGUOI_TGIA:Sum(tmpDSHDSPNHDCollect,SONGUOI_THAMGIA)
                                              }
                                          );
                                          UpdateIf(
                                              DL_HOP_DONGS,
                                              MA_HOP_DONG=First(objHD).MA_HOP_DONG,
                                              {
                                                  SO_NGUOI_TGIA:Sum(tmpDSHDSPNHDCollect,SONGUOI_THAMGIA)
                                              }
                                          );
                                          Collect(
                                              tmpQLCTHDSPNHDCollect,
                                              AddColumns(
                                                  Filter(
                                                      DL_HOP_DONG_SP_QLCT,
                                                      MA_HOP_DONG=First(objHD).MA_HOP_DONG && ID_HOPDONG_SP=ThisItem.ID
                                                  ),
                                                  edited,
                                                  0
                                              )
                                          );
                                      );
                                      UpdateContext({
                                          maAddedHDSPNHD:"",
                                          maUpdatedHDSPNHD:"",
                                          unReloadMaCT:"1",
                                          unReloadMaSP:"1"
                                      });
                                    PressedBorderColor: =Self.Fill
                                    PressedColor: =Self.Fill
                                    PressedFill: =Self.Color
                                    Size: =11
                                    Text: ="Hủy"
                                    Visible: =ThisItem.edited=1
                                    Width: =90
                                    X: =1100
                                    Y: =143
                              - LinkHDLK_1:
                                  Control: Classic/TextInput@2.3.2
                                  Properties:
                                    BorderColor: =RGBA(0, 18, 107, 1)
                                    BorderThickness: =0
                                    Color: =RGBA(39, 113, 194, 1)
                                    Default: ="Danh sách NĐBH"
                                    DisabledBorderColor: =RGBA(255, 255, 255, 1)
                                    DisabledFill: =RGBA(255, 255, 255, 1)
                                    DisplayMode: |-
                                      =//If(ThisItem.edited=0,DisplayMode.Edit,DisplayMode.Disabled) 
                                      DisplayMode.Edit
                                    Font: =Font.'Open Sans'
                                    Height: =28
                                    HoverBorderColor: =RGBA(255, 255, 255, 1)
                                    HoverColor: =RGBA(39, 113, 194, 1)
                                    HoverFill: =RGBA(255, 255, 255, 1)
                                    OnSelect: |-
                                      =ClearCollect(
                                          dmGioiTinhNDBHCollect,
                                          DM_GIOI_TINHS
                                      );
                                      ClearCollect(
                                          dmPhamViNDBHCollect,
                                          DM_PHAMVI_DIALYS
                                      );
                                      If(
                                          IsBlank(cbxMaSPNHD.Selected.MA_SAN_PHAM),
                                          Notify(
                                              "Bắt buộc chọn sản phẩm",
                                              NotificationType.Error,
                                              2000
                                          ),
                                          (ThisItem.edited=1 && IsBlank(cbxMaCTNHD.Selected.MA_CHUONG_TRINH)) || (ThisItem.edited=0 && IsBlank(cbxMaCTNHDHide.Selected.MA_CHUONG_TRINH)),
                                          Notify(
                                              "Bắt buộc chọn chương trình",
                                              NotificationType.Error,
                                              2000
                                          ),
                                          IsEmpty(cbxNhomTPNHD.SelectedItems),
                                          Notify(
                                              "Bắt buộc chọn nhóm tính phí",
                                              NotificationType.Error,
                                              2000
                                          ),
                                          Set(
                                              idHopDongSPNDBH,
                                              ThisItem.ID
                                          );
                                          Set(
                                              maSPNDBH,
                                              cbxMaSPNHD.Selected.MA_SAN_PHAM
                                          );
                                          Set(
                                              maHDNDBH,
                                              First(objHD).MA_HOP_DONG
                                          );
                                          Set(
                                              maCTNDBH,
                                              If(
                                                  ThisItem.edited=1,
                                                  cbxMaCTNHD.Selected.MA_CHUONG_TRINH,
                                                  cbxMaCTNHDHide.Selected.MA_CHUONG_TRINH
                                              )
                                          );
                                          Set(
                                              nhomTPNDBH,
                                              Concat(
                                                  cbxNhomTPNHD.SelectedItems,
                                                  Value,
                                                  "|"
                                              )
                                          );
                                          Set(
                                              phiDCNDBH,
                                              tiPhiDCNHD.Text
                                          );
                                          If(
                                              cbxLoaiKHNHD.Selected.value = "0" && IsBlank(
                                                  LookUp(
                                                      tmpMaCTChangeNHD,
                                                      ID = ThisItem.ID,
                                                      AUTO_GEN_NDBH
                                                  )
                                              ) && ThisItem.edited = 1,
                                              /* 
                                              UpdateContext({varPhiNDBH: 0});
                                              UpdateContext({varTuoi: 0});
                                              UpdateContext({varDVTuoi: 0});
                                              //Tinh tuoi
                                              If(
                                                  !IsBlank(dpNSinhNHD.SelectedDate),
                                                  If(
                                                      DateDiff(
                                                          dpNSinhNHD.SelectedDate,
                                                          Today(),
                                                          TimeUnit.Years
                                                      ) > 0,
                                                      UpdateContext(
                                                          {
                                                              varTuoi: DateDiff(
                                                                  dpNSinhNHD.SelectedDate,
                                                                  Today(),
                                                                  TimeUnit.Years
                                                              )
                                                          }
                                                      );
                                                      UpdateContext({varDVTuoi: 100});
                                                      ,
                                                      If(
                                                          DateDiff(
                                                              dpNSinhNHD.SelectedDate,
                                                              Today(),
                                                              TimeUnit.Months
                                                          ) > 0,
                                                          UpdateContext({varTuoi: 1});
                                                          UpdateContext({varDVTuoi: 200});
                                                          ,
                                                          If(
                                                              DateDiff(
                                                                  dpNSinhNHD.SelectedDate,
                                                                  Today(),
                                                                  TimeUnit.Days
                                                              ) >= 60,
                                                              UpdateContext({varTuoi: 1});
                                                              UpdateContext({varDVTuoi: 400}),
                                                              UpdateContext({varTuoi: 0})
                                                          )
                                                      )
                                                  )
                                              );
                                              //Kiem tra dap ung chi tieu
                                      UpdateContext(
                                                  {
                                                      varPhiNDBH: Sum(
                                                          Filter(
                                                              DL_CHUONG_TRINH_BANG_PHIS,
                                                              MA_SAN_PHAM = maSPNDBH && MA_CHUONG_TRINH = maCTNDBH && !IsBlank(
                                                                  Find(
                                                                      NHOM_TINH_PHI,
                                                                      nhomTPNDBH
                                                                  )
                                                              ) && (IsBlank(MA_PHAMVI_DIALY) || (!IsBlank(cbxTinhNHD.Selected.MA_PHAMVI) && MA_PHAMVI_DIALY = cbxTinhNHD.Selected.MA_PHAMVI)) && (IsBlank(MA_GIOI_TINH) || (!IsBlank(cbxGTinhNHD.Selected.MA_GIOI_TINH) && MA_GIOI_TINH = cbxGTinhNHD.Selected.MA_GIOI_TINH)) && (IsBlank(MA_DO_TUOI) || MA_DO_TUOI = LookUp(
                                                                  DM_DO_TUOIS,
                                                                  (If(
                                                                      MO_TA = MA_DO_TUOI && DONVI_TUOI_TU > 100,
                                                                      1,
                                                                      TUOI_TU
                                                                  ) <= varTuoi) && (If(
                                                                      DONVI_TUOI_DEN > 100,
                                                                      1,
                                                                      TUOI_DEN
                                                                  ) >= varTuoi)
                                                              ).MO_TA || IsBlank(MA_DO_TUOI))
                                                          ),
                                                          PHI_BH
                                                      )
                                                  }
                                              );*/
                                              //Lay phi chuong trinh
                                      UpdateContext(
                                                  {
                                                      idNDBH: If(
                                                          CountIf(
                                                              tmpDSNDBHNHDCollect,
                                                              true
                                                          ) > 0,
                                                          Max(
                                                              tmpDSNDBHNHDCollect,
                                                              ID
                                                          ) + 1,
                                                          Max(
                                                              DL_HOP_DONG_SP_NDBH,
                                                              ID
                                                          ) + 1
                                                      )
                                                  }
                                              );
                                              Collect(
                                                  tmpDSNDBHNHDCollect,
                                                  {
                                                      ID: idNDBH,
                                                      ID_HOPDONG_SP: ThisItem.ID,
                                                      MA_HOP_DONG: First(objHD).MA_HOP_DONG,
                                                      MA_SAN_PHAM: ThisItem.MA_SAN_PHAM,
                                                      MA_CHUONG_TRINH: ThisItem.MA_CHUONG_TRINH,
                                                      MST: cbxMaKHNHD.Selected.MST,
                                                      TEN_NDBH: tiTenKHNHD.Text,
                                                      DIA_CHI: tiDChiNHD.Text,
                                                      MA_GIOI__TINH: cbxGTinhNHD.Selected.MA_GIOI_TINH,
                                                      MA_NHAN_VIEN: "",
                                                      MA_TINH_TP: cbxTinhNHD.Selected.MA_PHAMVI,
                                                      MOI_QUAN_HE: "",
                                                      NGAY_SINH: dpNSinhNHD.SelectedDate,
                                                      NHOM: "",
                                                      SO_GIAY_TO: cbxMaKHNHD.Selected.SO_GIAY_TO,
                                                      PHI_NDBH: Blank(),
                                                      edited: 0
                                                  }
                                              );
                                              UpdateIf(
                                                  tmpMaCTChangeNHD,
                                                  ID = ThisItem.ID,
                                                  {AUTO_GEN_NDBH: "1"}
                                              )
                                          );
                                      	//tinh lai phi neu thay doi san pham, ctrinh hoac nhom tinh phi
                                          /*
                                          UpdateContext(
                                              {
                                                  objChangeNDBH: First(
                                                      Filter(
                                                          tmpDSNDBHNHDCollect,
                                                          ID_HOPDONG_SP = ThisItem.ID
                                                      )
                                                  )
                                              }
                                          );*/
                                          ClearCollect(
                                              tmpTinhLaiPhiNDBHCollect,
                                              {
                                                  varPhiNDBHCol:0,
                                                  varTuoiCol:0,
                                                  varDVTuoiCol:0
                                              }
                                          );
                                          ClearCollect(
                                              tmpKQPhiNDBHCollect,
                                              {
                                                  ID:0,
                                                  PHI_NDBH:0
                                              }
                                          );
                                          Clear(tmpKQPhiNDBHCollect);
                                          /*
                                          ClearCollect(
                                              changeNhomTPNDBH,
                                              {
                                                  check:false
                                              }
                                          );
                                          ForAll(
                                              Split(objChangeNDBH.NHOM_TINH_PHI,"|") As ds,
                                              If(
                                                  IsBlank(Find(ds.Value,nhomTPNDBH)),
                                                  UpdateIf(
                                                      changeNhomTPNDBH,
                                                      true,
                                                      {
                                                          check:true
                                                      }
                                                  )
                                              )
                                          );
                                          ForAll(
                                              Split(nhomTPNDBH,"|") As ds,
                                              If(
                                                  IsBlank(Find(ds.Value,objChangeNDBH.NHOM_TINH_PHI)),
                                                  UpdateIf(
                                                      changeNhomTPNDBH,
                                                      true,
                                                      {
                                                          check:true
                                                      }
                                                  )
                                              )
                                          );
                                          If(
                                              objChangeNDBH.MA_SAN_PHAM<>maSPNDBH || objChangeNDBH.MA_CHUONG_TRINH<>maCTNDBH || First(changeNhomTPNDBH).check,*/
                                              ForAll(
                                                  Filter(
                                      				tmpDSNDBHNHDCollect,
                                      				ID_HOPDONG_SP = ThisItem.ID
                                      			) As ds,
                                      			//Tinh tuoi
                                      			If(
                                      				!IsBlank(ds.NGAY_SINH),
                                      				If(
                                      					DateDiff(
                                      						ds.NGAY_SINH,
                                      						Today(),
                                      						TimeUnit.Years
                                      					) > 0,
                                                          UpdateIf(
                                                              tmpTinhLaiPhiNDBHCollect,
                                                              true,
                                                              {
                                                                  varTuoiCol:DateDiff(
                                      								ds.NGAY_SINH,
                                      								Today(),
                                      								TimeUnit.Years
                                      							),
                                                                  varDVTuoiCol: 100
                                                              }
                                                          ),
                                      					If(
                                      						DateDiff(
                                      							ds.NGAY_SINH,
                                      							Today(),
                                      							TimeUnit.Months
                                      						) > 0,
                                                              UpdateIf(
                                      							tmpTinhLaiPhiNDBHCollect,
                                      							true,
                                      							{
                                      								varTuoiCol:1,
                                      								varDVTuoiCol: 200
                                      							}
                                      						),
                                      						If(
                                      							DateDiff(
                                      								ds.NGAY_SINH,
                                      								Today(),
                                      								TimeUnit.Days
                                      							) >= 60,
                                                                  UpdateIf(
                                                                      tmpTinhLaiPhiNDBHCollect,
                                                                      true,
                                                                      {
                                                                          varTuoiCol: 1,
                                                                          varDVTuoiCol: 400
                                                                      }
                                                                  ),
                                                                  UpdateIf(
                                                                      tmpTinhLaiPhiNDBHCollect,
                                                                      true,
                                                                      {
                                                                          varTuoiCol: 0
                                                                      }
                                                                  )
                                      						)
                                      					)
                                      				)
                                      			);
                                      			//Kiem tra dap ung chi tieu
                                                  UpdateIf(
                                                      tmpTinhLaiPhiNDBHCollect,
                                                      true,
                                                      {
                                                          varPhiNDBHCol:Sum(
                                      					Filter(
                                      						DL_CHUONG_TRINH_BANG_PHIS,MA_SAN_PHAM = maSPNDBH && MA_CHUONG_TRINH = maCTNDBH && 
                                                              !IsBlank(Find(NHOM_TINH_PHI,nhomTPNDBH)) &&
                                      						(IsBlank(MA_PHAMVI_DIALY) || (!IsBlank(ds.MA_TINH_TP) && 
                                      						MA_PHAMVI_DIALY = LookUp(dmPhamViNDBHCollect,MA_PHAMVI=ds.MA_TINH_TP,TEN_PHAMVI))) && 
                                      						(IsBlank(MA_GIOI_TINH) || (!IsBlank(ds.MA_GIOI__TINH) && 
                                      						MA_GIOI_TINH = LookUp(dmGioiTinhNDBHCollect,MA_GIOI_TINH=ds.MA_GIOI__TINH,TEN_GIOI_TINH))) && 
                                      						(IsBlank(MA_DO_TUOI) || MA_DO_TUOI = LookUp(
                                      							DM_DO_TUOIS,
                                      							(If(
                                      								MO_TA = MA_DO_TUOI && DONVI_TUOI_TU > 100,
                                      								1,
                                      								TUOI_TU
                                      							) <= varTuoiCol) && (If(
                                      								DONVI_TUOI_DEN > 100,
                                      								1,
                                      								TUOI_DEN
                                      							) >= varTuoiCol)
                                      						).MO_TA || IsBlank(MA_DO_TUOI))
                                      					),
                                      					PHI_BH
                                      				)
                                                      }
                                                  );
                                      			//Lay phi chuong trinh
                                                  Collect(
                                                      tmpKQPhiNDBHCollect,
                                                      {
                                                          ID:ds.ID,
                                                          PHI_NDBH:First(tmpTinhLaiPhiNDBHCollect).varPhiNDBHCol
                                                      }
                                                  );
                                                  UpdateIf(
                                                      tmpTinhLaiPhiNDBHCollect,
                                                      true,
                                                      {
                                                          varPhiNDBHCol:0,
                                                          varTuoiCol:0,
                                                          varDVTuoiCol:0
                                                      }
                                                  )
                                              );
                                              ForAll(
                                                  tmpKQPhiNDBHCollect As ds,
                                                  UpdateIf(
                                                      tmpDSNDBHNHDCollect,
                                                      ID_HOPDONG_SP=ThisItem.ID && ID=ds.ID,
                                                      {
                                                          PHI_NDBH:ds.PHI_NDBH
                                                      }
                                                  )
                                              );
                                          //);
                                          // end tinh lai phi neu thay doi san pham, ctrinh hoac nhom tinh phi
                                          If(
                                              ThisItem.edited = 1,
                                              Set(
                                                  modeMHNDBH,
                                                  "1"
                                              ),
                                              Set(
                                                  modeMHNDBH,
                                                  "0"
                                              )
                                          );
                                          Set(isNhapBGHD,"1");
                                          Navigate(NhapNDBH);
                                      )
                                    Size: =11
                                    Underline: =true
                                    Width: =142
                                    X: =342
                                    Y: =145
                              - Label3_66:
                                  Control: Label@2.5.1
                                  Properties:
                                    BorderColor: =RGBA(0, 18, 107, 1)
                                    Font: =Font.'Open Sans'
                                    Height: =25
                                    Size: =11
                                    Text: ="Nhóm tính phí"
                                    Width: =140
                                    X: =30
                                    Y: =74
                              - cbxNhomTPNHD:
                                  Control: Classic/ComboBox@2.4.0
                                  Properties:
                                    BorderColor: =RGBA(72, 163, 62, 1)
                                    ChevronBackground: =RGBA(56, 96, 178, 1)
                                    ChevronFill: =RGBA(255, 255, 255, 1)
                                    ChevronHoverBackground: =ColorFade(RGBA(56, 96, 178, 1), -20%)
                                    ChevronHoverFill: =RGBA(255, 255, 255, 1)
                                    DefaultSelectedItems: |-
                                      =/*If (
                                          ThisItem.edited=1,
                                          Filter(
                                              ["Nhóm chính","Nhóm bổ sung","Nhóm thai sản","Nha khoa/Chăm sóc răng","Ngoại trú","Nhóm thương tật, tử vong"],
                                              !IsBlank(Find(Value,tiNhomTPHideNHD.Text)) &&
                                              !IsBlank(cbxMaCTNHD.Selected.MA_CHUONG_TRINH)
                                          ),
                                          Filter(
                                              ["Nhóm chính","Nhóm bổ sung","Nhóm thai sản","Nha khoa/Chăm sóc răng","Ngoại trú","Nhóm thương tật, tử vong"],
                                              !IsBlank(Find(Value,ThisItem.NHOM_TINH_PHI)) &&
                                              !IsBlank(cbxMaCTNHD.Selected.MA_CHUONG_TRINH)
                                          )
                                      )*/
                                      Filter(
                                          ["Nhóm chính","Nhóm bổ sung","Nhóm thai sản","Nha khoa/Chăm sóc răng","Ngoại trú","Nhóm thương tật, tử vong"],
                                          !IsBlank(Find(Value,LookUp(tmpMaCTChangeNHD,ID=ThisItem.ID,NHOM_TINH_PHI))) &&
                                          !IsBlank(cbxMaCTNHD.Selected.MA_CHUONG_TRINH)
                                      )
                                    DisplayFields: =["Value"]
                                    Font: =Font.'Open Sans'
                                    Height: =32
                                    HoverFill: =RGBA(186, 202, 226, 1)
                                    InputTextPlaceholder: =""
                                    IsSearchable: =false
                                    Items: |-
                                      =Filter(
                                          ["Nhóm chính","Nhóm bổ sung","Nhóm thai sản","Nha khoa/Chăm sóc răng","Ngoại trú","Nhóm thương tật, tử vong"],
                                          Value in
                                          Distinct(
                                              Filter(
                                                  DL_SAN_PHAM_NHOMQLS,
                                                  MA_SP=cbxMaSPNHD.Selected.MA_SAN_PHAM && 
                                                  !IsBlank(cbxMaCTNHD.Selected.MA_CHUONG_TRINH) && 
                                                  !IsBlank(Find(LookUp(tmpMaCTChangeNHD,ID=ThisItem.ID,MA_CHUONG_TRINH),CHUONGTRINH_APDUNG))
                                              ),
                                              MA_NHOM_TINHPHI
                                          )
                                      )
                                    PressedColor: =RGBA(255, 255, 255, 1)
                                    PressedFill: =RGBA(0, 18, 107, 1)
                                    SearchFields: =["Value"]
                                    SelectionColor: =RGBA(255, 255, 255, 1)
                                    SelectionFill: =RGBA(56, 96, 178, 1)
                                    Size: =11
                                    Visible: =ThisItem.edited=1
                                    Width: =250
                                    X: =30
                                    Y: =102
                              - LinkHDLK_3:
                                  Control: Classic/TextInput@2.3.2
                                  Properties:
                                    BorderColor: =RGBA(0, 18, 107, 1)
                                    BorderThickness: =0
                                    Color: =RGBA(39, 113, 194, 1)
                                    Default: ="Quyền lợi chi tiết"
                                    DisabledBorderColor: =RGBA(255, 255, 255, 1)
                                    DisabledFill: =RGBA(255, 255, 255, 1)
                                    Font: =Font.'Open Sans'
                                    Height: =27
                                    HoverBorderColor: =RGBA(255, 255, 255, 1)
                                    HoverColor: =RGBA(39, 113, 194, 1)
                                    HoverFill: =RGBA(255, 255, 255, 1)
                                    OnSelect: |
                                      =If(
                                          IsBlank(cbxMaSPNHD.Selected.MA_SAN_PHAM),
                                          Notify(
                                              "Bắt buộc chọn sản phẩm",
                                              NotificationType.Error,
                                              2000
                                          ),
                                          (ThisItem.edited=1 && IsBlank(cbxMaCTNHD.Selected.MA_CHUONG_TRINH)) || (ThisItem.edited=0 && IsBlank(cbxMaCTNHDHide.Selected.MA_CHUONG_TRINH)),
                                          Notify(
                                              "Bắt buộc chọn chương trình",
                                              NotificationType.Error,
                                              2000
                                          ),
                                          IsEmpty(cbxNhomTPNHD.SelectedItems),
                                          Notify(
                                              "Bắt buộc chọn nhóm tính phí",
                                              NotificationType.Error,
                                              2000
                                          ),
                                          Set(idHopDongSPQLCT,ThisItem.ID);
                                          Set(maSPQLCTNHD,cbxMaSPNHD.Selected.MA_SAN_PHAM);
                                          Set(maHDQLCTNHD,First(objHD).MA_HOP_DONG);
                                          Set(
                                              maCTQLCTNHD,
                                              If(
                                                  ThisItem.edited=1,
                                                  cbxMaCTNHD.Selected.MA_CHUONG_TRINH,
                                                  cbxMaCTNHDHide.Selected.MA_CHUONG_TRINH
                                              )
                                          );
                                          Set(maNhomTPQLCTNHD,Concat(cbxNhomTPNHD.SelectedItems,Value,"|"));
                                          UpdateContext({
                                              objChangeQLCTNHD:First(
                                                  Filter(
                                                      tmpQLCTHDSPNHDCollect,
                                                      ID_HOPDONG_SP=ThisItem.ID
                                                  )
                                              )
                                          });
                                          ClearCollect(
                                              tmpChangeQLCTNHD,
                                              {
                                                  check:false
                                              }
                                          );
                                          If(
                                              objChangeQLCTNHD.MA_SAN_PHAM<>cbxMaSPNHD.Selected.MA_SAN_PHAM || 
                                              objChangeQLCTNHD.MA_CHUONG_TRINH<>maCTQLCTNHD,
                                              //Notify("alo11",NotificationType.Error,1000);
                                              UpdateIf(
                                                  tmpChangeQLCTNHD,
                                                  true,
                                                  {
                                                      check:true
                                                  }
                                              )
                                          );
                                          ForAll(
                                              Split(maNhomTPQLCTNHD,"|") As ds,
                                              If(
                                                  IsBlank(Find(ds.Value,objChangeQLCTNHD.NHOM_TINH_PHI)),
                                                  UpdateIf(
                                                      tmpChangeQLCTNHD,
                                                      true,
                                                      {
                                                          check:true
                                                      }
                                                  )
                                              )
                                          );
                                          ForAll(
                                              Split(objChangeQLCTNHD.NHOM_TINH_PHI,"|") As ds,
                                              If(
                                                  IsBlank(Find(ds.Value,maNhomTPQLCTNHD)),
                                                  UpdateIf(
                                                      tmpChangeQLCTNHD,
                                                      true,
                                                      {
                                                          check:true
                                                      }
                                                  )
                                              )
                                          );
                                          If(
                                              First(tmpChangeQLCTNHD).check,
                                              RemoveIf(
                                                  tmpQLCTHDSPNHDCollect,
                                                  ID_HOPDONG_SP=ThisItem.ID
                                              )
                                          );
                                          If(
                                              CountIf(Filter(tmpQLCTHDSPNHDCollect,ID_HOPDONG_SP=ThisItem.ID),true)=0,
                                              //Notify("alo",NotificationType.Error,1000);
                                              ForAll(
                                                  Filter(
                                                      DL_CHUONGTRINH_QLCTS,
                                                      MA_CHUONG_TRINH = maCTQLCTNHD && MA_SAN_PHAM = maSPQLCTNHD &&
                                                      MA_NHOM_QL in Distinct(Filter(DL_SAN_PHAM_NHOMQLS,MA_SP = maSPQLCTNHD && 
                                                          !IsBlank(Find(maCTQLCTNHD,CHUONGTRINH_APDUNG)) &&
                                                          !IsBlank(Find(MA_NHOM_TINHPHI,maNhomTPQLCTNHD))
                                                      ),MA_NHOM_QL)
                                                  ) As ql,
                                                  Collect(
                                                      tmpQLCTHDSPNHDCollect,
                                                      {
                                                          MA_CHUONG_TRINH: maCTQLCTNHD,
                                                          MA_SAN_PHAM: cbxMaSPNHD.Selected.MA_SAN_PHAM,
                                                          NHOM_TINH_PHI:Concat(cbxNhomTPNHD.SelectedItems,Value,"|"),
                                                          MA_QL_CT: ql.MA_QL_CT,
                                                          TT_HIENTHI: ql.TT_HIENTHI,
                                                          MA_NHOM_QL: ql.MA_NHOM_QL,
                                                          GH_SOLAN_NAM: ql.GH_SOLAN_NAM,
                                                          GH_SONGAY_NAM: ql.GH_SONGAY_NAM,
                                                          GH_SOTIEN_BENH: ql.GH_SOTIEN_BENH,
                                                          GH_SOTIEN_NAM: ql.GH_SOTIEN_NAM,
                                                          GH_SOTIEN_NGAY: ql.GH_SOTIEN_NGAY,
                                                          GH_SOTIEN_VU: ql.GH_SOTIEN_VU,
                                                          PT_TU_CHITRA: ql.PT_TU_CHITRA,
                                                          SO_TIEN_BH: ql.SO_TIEN_BH,
                                                          TEN_QUYEN_LOI_HT: ql.TEN_QUYEN_LOI_HT,
                                                          ID_HOPDONG_SP:ThisItem.ID,
                                                          edited:0
                                                      }
                                                  )
                                              )
                                          );
                                          If(
                                              ThisItem.edited = 1,
                                              Set(
                                                  modeMHQLCT,
                                                  "1"
                                              ),
                                              Set(
                                                  modeMHQLCT,
                                                  "0"
                                              )
                                          );
                                          Set(isNhapBGHD,"1");
                                          Navigate(DSQuyenLoiHD);
                                      )
                                    Size: =11
                                    Underline: =true
                                    Visible: |-
                                      =//If(!IsBlank(tiMaHDNHD.Text),true,false)
                                      true
                                    Width: =169
                                    X: =17
                                    Y: =145
                              - tiPhiDCNHD:
                                  Control: Classic/TextInput@2.3.2
                                  Properties:
                                    Align: =Align.Right
                                    BorderColor: =RGBA(72, 163, 62, 1)
                                    Default: |-
                                      =If (
                                          ThisItem.edited=1,
                                          If(LookUp(tmpMaCTChangeNHD,ID=ThisItem.ID,PHI_DIEU_CHINH)=0,Blank(),LookUp(tmpMaCTChangeNHD,ID=ThisItem.ID,PHI_DIEU_CHINH)),
                                          If(ThisItem.PHI_DIEU_CHINH=0,Blank(),ThisItem.PHI_DIEU_CHINH)
                                      )
                                    DisplayMode: =If(ThisItem.edited=1,DisplayMode.Edit,DisplayMode.Disabled)
                                    Font: =Font.'Open Sans'
                                    Format: =TextFormat.Number
                                    Height: =32
                                    HoverBorderColor: =RGBA(0, 18, 107, 1)
                                    HoverFill: =RGBA(186, 202, 226, 1)
                                    OnChange: |-
                                      =If(
                                          Value(tiPhiDCNHD.Text)=0,
                                          UpdateIf(
                                              tmpMaCTChangeNHD,
                                              ID=ThisItem.ID,
                                              {
                                                  PHI_DIEU_CHINH:Blank()
                                              }
                                          );
                                          Reset(tiPhiDCNHD)
                                      );
                                      If(
                                          IsBlank(tiPhiDCNHD.Text) || Value(tiPhiDCNHD.Text)=0,
                                          UpdateContext({
                                              tongPhiNDBH:LookUp(tmpMaCTChangeNHD,ID=ThisItem.ID,TONG_PHI_DANHSACH)
                                          });
                                          UpdateIf(
                                              tmpMaCTChangeNHD,
                                              ID=ThisItem.ID,
                                              {
                                                  TONG_TIEN_PHI:tongPhiNDBH
                                              }
                                          );
                                          Reset(tiTongPhiNHD),
                                          Value(tiPhiDCNHD.Text)<>ThisItem.PHI_DIEU_CHINH && !IsBlank(tiPhiDCNHD.Text) && Value(tiPhiDCNHD.Text)<>0,
                                          UpdateIf(
                                              tmpMaCTChangeNHD,
                                              ID=ThisItem.ID,
                                              {
                                                  TONG_TIEN_PHI:Value(tiPhiDCNHD.Text)*Value(tiSoNTGSPNHD.Text)
                                              }
                                          );
                                          Reset(tiTongPhiNHD)
                                      )
                                    RadiusBottomLeft: =0
                                    RadiusBottomRight: =0
                                    RadiusTopLeft: =0
                                    RadiusTopRight: =0
                                    Size: =11
                                    Width: =250
                                    X: =355
                                    Y: =102
                              - Label3_87:
                                  Control: Label@2.5.1
                                  Properties:
                                    BorderColor: =RGBA(0, 18, 107, 1)
                                    Font: =Font.'Open Sans'
                                    Height: =25
                                    Size: =11
                                    Text: ="Phí/Người điều chỉnh"
                                    Width: =180
                                    X: =355
                                    Y: =74
                              - tiNhomTPNHD:
                                  Control: Classic/TextInput@2.3.2
                                  Properties:
                                    BorderColor: =RGBA(72, 163, 62, 1)
                                    Default: '=Concat(Split(ThisItem.NHOM_TINH_PHI,"|"), Value,", ") '
                                    DisplayMode: =DisplayMode.Disabled
                                    Font: =Font.'Open Sans'
                                    Height: =32
                                    HoverBorderColor: =RGBA(0, 18, 107, 1)
                                    HoverFill: =RGBA(186, 202, 226, 1)
                                    RadiusBottomLeft: =0
                                    RadiusBottomRight: =0
                                    RadiusTopLeft: =0
                                    RadiusTopRight: =0
                                    Size: =11
                                    Visible: |
                                      =ThisItem.edited=0
                                    Width: =250
                                    X: =30
                                    Y: =102
                              - cbxMaCTNHDHide:
                                  Control: Classic/ComboBox@2.4.0
                                  Properties:
                                    BorderColor: =RGBA(72, 163, 62, 1)
                                    ChevronBackground: =RGBA(56, 96, 178, 1)
                                    ChevronFill: =RGBA(255, 255, 255, 1)
                                    ChevronHoverBackground: =ColorFade(RGBA(56, 96, 178, 1), -20%)
                                    ChevronHoverFill: =RGBA(255, 255, 255, 1)
                                    DefaultSelectedItems: |-
                                      =/*If (
                                          ThisItem.edited=1,
                                          LookUp(
                                              ' DL_SAN_PHAM_CT',
                                              MA_SAN_PHAM=cbxMaSPNHD.Selected.MA_SAN_PHAM && MA_CHUONG_TRINH=tiMaCTNHD.Text
                                          ),
                                          LookUp(
                                              ' DL_SAN_PHAM_CT',
                                              MA_SAN_PHAM=cbxMaSPNHD.Selected.MA_SAN_PHAM && MA_CHUONG_TRINH=ThisItem.MA_CHUONG_TRINH
                                          )
                                      )*/
                                      LookUp(
                                          ' DL_SAN_PHAM_CT',
                                          MA_CHUONG_TRINH=ThisItem.MA_CHUONG_TRINH
                                      )
                                    DisplayFields: =["cr282_ma_chuongtrinh"]
                                    DisplayMode: =DisplayMode.Disabled
                                    Font: =Font.'Open Sans'
                                    Height: =32
                                    HoverFill: =RGBA(186, 202, 226, 1)
                                    InputTextPlaceholder: =""
                                    Items: =' DL_SAN_PHAM_CT'
                                    PressedColor: =RGBA(255, 255, 255, 1)
                                    PressedFill: =RGBA(0, 18, 107, 1)
                                    SearchFields: =["cr282_ma_chuongtrinh"]
                                    SelectMultiple: =false
                                    SelectionColor: =RGBA(255, 255, 255, 1)
                                    SelectionFill: =RGBA(56, 96, 178, 1)
                                    Size: =11
                                    Visible: =ThisItem.edited=0
                                    Width: =250
                                    X: =672
                                    Y: =34
                        - Button2_3:
                            Control: Classic/Button@2.2.0
                            Properties:
                              BorderColor: =ColorFade(Self.Fill, -15%)
                              Color: =RGBA(255, 255, 255, 1)
                              DisabledBorderColor: =RGBA(166, 166, 166, 1)
                              DisplayMode: =If(IsBlank(First(objHD).MA_HOP_DONG),DisplayMode.Disabled,DisplayMode.Edit)
                              Fill: =RGBA(56, 96, 178, 1)
                              Font: =Font.'Open Sans'
                              Height: =32
                              HoverBorderColor: =ColorFade(Self.BorderColor, 20%)
                              HoverColor: =RGBA(255, 255, 255, 1)
                              HoverFill: =ColorFade(RGBA(56, 96, 178, 1), -20%)
                              OnSelect: |
                                =If(
                                    Or(maAddedHDSPNHD<>"",maUpdatedHDSPNHD<>""),
                                    Notify("Có dữ liệu chưa được lưu",NotificationType.Warning,2000),
                                    Collect(
                                        tmpDSHDSPNHDCollect,
                                        Defaults(tmpDSHDSPNHDCollect)
                                    );
                                    UpdateContext({
                                        maHDSP:Max(DL_HOP_DONG_SPS,ID)+1
                                    });
                                    UpdateIf(
                                        tmpDSHDSPNHDCollect,
                                        IsBlank(ID),
                                        {
                                            ID:Text(maHDSP),
                                            MA_HOP_DONG:First(objHD).MA_HOP_DONG,
                                            edited:1
                                        }
                                    );
                                    ClearCollect(
                                        tmpMaCTChangeNHD,
                                        tmpDSHDSPNHDCollect
                                    );
                                    UpdateContext({
                                        maAddedHDSPNHD:Text(maHDSP),
                                        unReloadMaSP:Blank()
                                    });
                                    Reset(LinkHDLK);
                                )
                              PressedBorderColor: =Self.Fill
                              PressedColor: =Self.Fill
                              PressedFill: =Self.Color
                              Size: =11
                              Text: ="Thêm mới"
                              Width: =100
                              X: =30
                              Y: =30
                  - Container3_6:
                      Control: GroupContainer@1.3.0
                      Variant: ManualLayout
                      Properties:
                        DropShadow: =DropShadow.None
                        Height: =210
                        Width: =1267
                        X: =16
                        Y: =778
                      Children:
                        - Label3_67:
                            Control: Label@2.5.1
                            Properties:
                              BorderColor: =RGBA(0, 18, 107, 1)
                              Font: =Font.'Open Sans'
                              FontWeight: =FontWeight.Bold
                              Height: =20
                              Size: =11
                              Text: ="5. Hợp đồng liên kết"
                              Width: =254
                              Y: =4
                        - Gallery3_1:
                            Control: Gallery@2.15.0
                            Variant: VariableHeight
                            Properties:
                              BorderColor: =RGBA(0, 18, 107, 1)
                              Height: =146
                              Items: |-
                                =SortByColumns(
                                    tmpDSHDSPLKNHDCollect,
                                    "cr282_so_hop_dong_lk",
                                    SortOrder.Ascending,
                                    "cr282_ma_khach_hang",
                                    SortOrder.Ascending
                                )
                              TemplateSize: =143
                              Width: =1267
                              Y: =60
                            Children:
                              - Label3_68:
                                  Control: Label@2.5.1
                                  Properties:
                                    BorderColor: =RGBA(0, 18, 107, 1)
                                    Font: =Font.'Open Sans'
                                    Height: =25
                                    Size: =11
                                    Text: ="Số HĐ liên kết"
                                    Width: =130
                                    X: =30
                                    Y: =6
                              - Label3_71:
                                  Control: Label@2.5.1
                                  Properties:
                                    BorderColor: =RGBA(0, 18, 107, 1)
                                    Font: =Font.'Open Sans'
                                    Height: =25
                                    Size: =11
                                    Text: ="Mã kênh bán"
                                    Width: =140
                                    X: =990
                                    Y: =6
                              - Label3_72:
                                  Control: Label@2.5.1
                                  Properties:
                                    BorderColor: =RGBA(0, 18, 107, 1)
                                    Font: =Font.'Open Sans'
                                    Height: =25
                                    Size: =11
                                    Text: ="Mã sản phẩm"
                                    Width: =168
                                    X: =30
                                    Y: =74
                              - Label3_70:
                                  Control: Label@2.5.1
                                  Properties:
                                    BorderColor: =RGBA(0, 18, 107, 1)
                                    Font: =Font.'Open Sans'
                                    Height: =25
                                    Size: =11
                                    Text: ="Tên khách hàng"
                                    Width: =140
                                    X: =672
                                    Y: =6
                              - Label3_69:
                                  Control: Label@2.5.1
                                  Properties:
                                    BorderColor: =RGBA(0, 18, 107, 1)
                                    Font: =Font.'Open Sans'
                                    Height: =25
                                    Size: =11
                                    Text: ="Mã khách hàng"
                                    Width: =140
                                    X: =355
                                    Y: =6
                              - Label3_73:
                                  Control: Label@2.5.1
                                  Properties:
                                    BorderColor: =RGBA(0, 18, 107, 1)
                                    Font: =Font.'Open Sans'
                                    Height: =25
                                    Size: =11
                                    Text: ="Tên sản phẩm"
                                    Width: =140
                                    X: =355
                                    Y: =74
                              - tiSoHDLKNHD_1:
                                  Control: Classic/TextInput@2.3.2
                                  Properties:
                                    BorderColor: =RGBA(72, 163, 62, 1)
                                    Default: =ThisItem.SO_HOP_DONG_LK
                                    DisplayMode: =DisplayMode.Disabled
                                    Font: =Font.'Open Sans'
                                    Height: =32
                                    HoverBorderColor: =RGBA(0, 18, 107, 1)
                                    HoverFill: =RGBA(186, 202, 226, 1)
                                    RadiusBottomLeft: =0
                                    RadiusBottomRight: =0
                                    RadiusTopLeft: =0
                                    RadiusTopRight: =0
                                    Size: =11
                                    Width: =250
                                    X: =30
                                    Y: =34
                              - tiMaCTLKNHD_1:
                                  Control: Classic/TextInput@2.3.2
                                  Properties:
                                    BorderColor: =RGBA(72, 163, 62, 1)
                                    Default: =ThisItem.MA_CHUONG_TRINH
                                    DisplayMode: =DisplayMode.Disabled
                                    Font: =Font.'Open Sans'
                                    Height: =32
                                    HoverBorderColor: =RGBA(0, 18, 107, 1)
                                    HoverFill: =RGBA(186, 202, 226, 1)
                                    RadiusBottomLeft: =0
                                    RadiusBottomRight: =0
                                    RadiusTopLeft: =0
                                    RadiusTopRight: =0
                                    Size: =11
                                    Width: =250
                                    X: =672
                                    Y: =102
                              - tiTenCTLKNHD_1:
                                  Control: Classic/TextInput@2.3.2
                                  Properties:
                                    BorderColor: =RGBA(72, 163, 62, 1)
                                    Default: =ThisItem.TEN_CHUONG_TRINH
                                    DisplayMode: =DisplayMode.Disabled
                                    Font: =Font.'Open Sans'
                                    Height: =32
                                    HoverBorderColor: =RGBA(0, 18, 107, 1)
                                    HoverFill: =RGBA(186, 202, 226, 1)
                                    RadiusBottomLeft: =0
                                    RadiusBottomRight: =0
                                    RadiusTopLeft: =0
                                    RadiusTopRight: =0
                                    Size: =11
                                    Width: =250
                                    X: =990
                                    Y: =102
                              - Label3_74:
                                  Control: Label@2.5.1
                                  Properties:
                                    BorderColor: =RGBA(0, 18, 107, 1)
                                    Font: =Font.'Open Sans'
                                    Height: =25
                                    Size: =11
                                    Text: ="Mã chương trình"
                                    Width: =140
                                    X: =672
                                    Y: =74
                              - Label3_75:
                                  Control: Label@2.5.1
                                  Properties:
                                    BorderColor: =RGBA(0, 18, 107, 1)
                                    Font: =Font.'Open Sans'
                                    Height: =25
                                    Size: =11
                                    Text: ="Tên chương trình"
                                    Width: =140
                                    X: =990
                                    Y: =74
                              - tiMaKHLKNHD_1:
                                  Control: Classic/TextInput@2.3.2
                                  Properties:
                                    BorderColor: =RGBA(72, 163, 62, 1)
                                    Default: =ThisItem.MA_KHACH_HANG
                                    DisplayMode: =DisplayMode.Disabled
                                    Font: =Font.'Open Sans'
                                    Height: =32
                                    HoverBorderColor: =RGBA(0, 18, 107, 1)
                                    HoverFill: =RGBA(186, 202, 226, 1)
                                    RadiusBottomLeft: =0
                                    RadiusBottomRight: =0
                                    RadiusTopLeft: =0
                                    RadiusTopRight: =0
                                    Size: =11
                                    Width: =250
                                    X: =355
                                    Y: =34
                              - tiTenKHLKNHD_1:
                                  Control: Classic/TextInput@2.3.2
                                  Properties:
                                    BorderColor: =RGBA(72, 163, 62, 1)
                                    Default: =LookUp(DM_KHACH_HANG,MA_KHACH_HANG=ThisItem.MA_KHACH_HANG,TEN_KHACH_HANG)
                                    DisplayMode: =DisplayMode.Disabled
                                    Font: =Font.'Open Sans'
                                    Height: =32
                                    HoverBorderColor: =RGBA(0, 18, 107, 1)
                                    HoverFill: =RGBA(186, 202, 226, 1)
                                    RadiusBottomLeft: =0
                                    RadiusBottomRight: =0
                                    RadiusTopLeft: =0
                                    RadiusTopRight: =0
                                    Size: =11
                                    Width: =250
                                    X: =672
                                    Y: =34
                              - tiTenKBLKNHD_1:
                                  Control: Classic/TextInput@2.3.2
                                  Properties:
                                    BorderColor: =RGBA(72, 163, 62, 1)
                                    Default: =ThisItem.MA_KENH_BAN
                                    DisplayMode: =DisplayMode.Disabled
                                    Font: =Font.'Open Sans'
                                    Height: =32
                                    HoverBorderColor: =RGBA(0, 18, 107, 1)
                                    HoverFill: =RGBA(186, 202, 226, 1)
                                    RadiusBottomLeft: =0
                                    RadiusBottomRight: =0
                                    RadiusTopLeft: =0
                                    RadiusTopRight: =0
                                    Size: =11
                                    Width: =250
                                    X: =990
                                    Y: =34
                              - tiMaSPLKNHD_1:
                                  Control: Classic/TextInput@2.3.2
                                  Properties:
                                    BorderColor: =RGBA(72, 163, 62, 1)
                                    Default: =ThisItem.MA_SAN_PHAM
                                    DisplayMode: =DisplayMode.Disabled
                                    Font: =Font.'Open Sans'
                                    Height: =32
                                    HoverBorderColor: =RGBA(0, 18, 107, 1)
                                    HoverFill: =RGBA(186, 202, 226, 1)
                                    RadiusBottomLeft: =0
                                    RadiusBottomRight: =0
                                    RadiusTopLeft: =0
                                    RadiusTopRight: =0
                                    Size: =11
                                    Width: =250
                                    X: =30
                                    Y: =102
                              - tiTenSPLKNHD_1:
                                  Control: Classic/TextInput@2.3.2
                                  Properties:
                                    BorderColor: =RGBA(72, 163, 62, 1)
                                    Default: =ThisItem.TEN_SAN_PHAM
                                    DisplayMode: =DisplayMode.Disabled
                                    Font: =Font.'Open Sans'
                                    Height: =32
                                    HoverBorderColor: =RGBA(0, 18, 107, 1)
                                    HoverFill: =RGBA(186, 202, 226, 1)
                                    RadiusBottomLeft: =0
                                    RadiusBottomRight: =0
                                    RadiusTopLeft: =0
                                    RadiusTopRight: =0
                                    Size: =11
                                    Width: =250
                                    X: =355
                                    Y: =102
                        - LinkHDLK:
                            Control: Classic/TextInput@2.3.2
                            Properties:
                              BorderColor: =RGBA(0, 18, 107, 1)
                              BorderThickness: =0
                              Color: =RGBA(39, 113, 194, 1)
                              Default: ="Hợp đồng liên kết"
                              DisabledBorderColor: =RGBA(255, 255, 255, 1)
                              DisabledFill: =RGBA(255, 255, 255, 1)
                              Font: =Font.'Open Sans'
                              Height: =28
                              HoverBorderColor: =RGBA(255, 255, 255, 1)
                              HoverColor: =RGBA(39, 113, 194, 1)
                              HoverFill: =RGBA(255, 255, 255, 1)
                              OnSelect: |-
                                =Set(dsMaSPNLKFwd,Concat(Filter(DL_HOP_DONG_SPS,MA_HOP_DONG=First(objHD).MA_HOP_DONG),MA_SAN_PHAM,"|"));
                                Set(maHDNLKFwd,tiMaHDNHD.Text);
                                Set(maKBNLKFwd,cbxMaKBNHD.Selected.MA_KENH_BAN);
                                Set(maKHNLKFwd,cbxMaKHNHD.Selected.MA_KHACH_HANG);
                                Set(isNhapBGHD,"1");
                                Navigate(NhapHopDongLK)
                              Size: =11
                              Underline: =true
                              Width: =142
                              X: =24
                              Y: =30
                  - Container3_8:
                      Control: GroupContainer@1.3.0
                      Variant: ManualLayout
                      Properties:
                        DropShadow: =DropShadow.None
                        Height: =379
                        Width: =1267
                        X: =16
                        Y: =988
                      Children:
                        - Label3_76:
                            Control: Label@2.5.1
                            Properties:
                              BorderColor: =RGBA(0, 18, 107, 1)
                              Font: =Font.'Open Sans'
                              FontWeight: =FontWeight.Bold
                              Height: =20
                              Size: =11
                              Text: ="6. Chính sách áp dụng"
                              Width: =254
                              Y: =4
                        - LinkHDLK_2:
                            Control: Classic/TextInput@2.3.2
                            Properties:
                              BorderColor: =RGBA(0, 18, 107, 1)
                              BorderThickness: =0
                              Color: =RGBA(39, 113, 194, 1)
                              Default: ="Chọn chính sách"
                              DisabledBorderColor: =RGBA(255, 255, 255, 1)
                              DisabledColor: =RGBA(39, 113, 194, 1)
                              DisabledFill: =RGBA(255, 255, 255, 1)
                              Font: =Font.'Open Sans'
                              Height: =28
                              HoverBorderColor: =RGBA(255, 255, 255, 1)
                              HoverColor: =RGBA(39, 113, 194, 1)
                              HoverFill: =RGBA(255, 255, 255, 1)
                              OnSelect: "=ClearCollect(\n    dlDKADLoaiCTCCSCollect,\n    DL_DIEUKIEN_APDUNG_LOAI_CT\n);\nClearCollect(\n    dlChinhSachDTCTCCSCollect,\n    DL_CHINHSACH_DOITUONG_CT\n);\nSet(\n    dsMaSPNLKFwd,\n    Concat(\n        tmpDSHDSPNHDCollect,\n        MA_SAN_PHAM,\n        \"|\"\n    )\n);\nSet(\n    maHDNLKFwd,\n    tiMaHDNHD.Text\n);\nSet(\n    maKBNLKFwd,\n    cbxMaKBNHD.Selected.MA_KENH_BAN\n);\nSet(\n    maKHNLKFwd,\n    cbxMaKHNHD.Selected.MA_KHACH_HANG\n);\nSet(\n    dsMaSPCCSFwd, \n    Concatenate(\n        Concat(\n            Filter(DL_HOP_DONG_SPS,MA_HOP_DONG=First(objHD).MA_HOP_DONG),\n            MA_SAN_PHAM,\n            \"|\"\n        ),\n        \"|\",\n        Concat(\n            tmpDSHDSPLKNHDCollect,\n            MA_SAN_PHAM,\n            \"|\"\n        )\n    )\n);\nSet(maKBCCSFwd,cbxMaKBNHD.Selected.MA_KENH_BAN);\nSet(maKHCCSFwd,cbxMaKHNHD.Selected.MA_KHACH_HANG);\nSet(maDVCCSFwd,cbxDVQLNHD.Selected.MA_PHAMVI);\nSet(maTinhTPCCSFwd,cbxTinhNHD.Selected.MA_PHAMVI);\nSet(nhomKBCCSFwd,nhomKB);\n// check điều kiện áp dụng\n// lọc điều kiện áp dụng\nUpdateContext({errorMsg: \"\"});\n// lọc điều kiện\n// lấy danh sách các điều kiện áp dụng còn hoạt động và ngày hợp đồng nằm trong khoảng hiệu lực\nClearCollect (\n    tmpDieuKien,\n    Filter(\n        DL_DIEUKIEN_APDUNG,\n        TRANG_THAI = \"true\" && DateValue(HIEU_LUC_TU) <= DateValue(dpNgayHDNHD.SelectedDate)\n    )\n);\nClearCollect(\n    tmpError,\n    {}\n);\nRemoveIf(\n    tmpError,\n    1 = 1\n);\nClearCollect(\n    tmpPass,\n    {}\n);\nClearCollect(\n    dsCombosp,\n    {}\n);\nClearCollect(\n    dsCombospLt,\n    {}\n);\nClearCollect(\n    GroupedSp,\n    {}\n);\nClearCollect(\n    dsSpKetHop,\n    {}\n);\nRemoveIf(\n    tmpPass,\n    1 = 1\n);\n// NẾU K TÌM THẤY ĐIỀU KIỆN THÌ MẶC ĐỊNH LÀ CÓ\nIf(CountRows(tmpDieuKien) <=0 , Collect(\n            tmpPass,\n            {ma_dieu_kien: \"1\"}\n        ));\n// nếu không có điều kiện thỏa mãn thì mặc định \nForAll(\n    tmpDieuKien As dk,\n//1. kiểm tra kênh bán   \n//1.1. kiểm tra mã kênh bán\n// Nếu kênh bán áp dụng cho tất cả và có loại trừ\n// Tìm giá trị loại trừ mã kênh bán, loại kênh bán, cá nhân/tổ chức, nếu có dữ liệu thì false\n    RemoveIf(\n        tmpError,\n        1 = 1\n    );\n    RemoveIf(\n        dsCombosp,\n        1 = 1\n    );\n    RemoveIf(\n        dsSpKetHop,\n        1 = 1\n    );\n    RemoveIf(\n        GroupedSp,\n        1 = 1\n    );\n    If(\n        IsBlank(\n            LookUp(\n                dlDKADLoaiCTCCSCollect,\n                MA_DIEU_KIEN = dk.MA_DIEU_KIEN && THANH_PHAN = \"KB\" && AP_DUNG = \"1\" && MA_TIEU_CHI = \"MA_KB_DM\"\n            )\n        ) And !IsBlank(\n            LookUp(\n                dlDKADLoaiCTCCSCollect,\n                MA_DIEU_KIEN = dk.MA_DIEU_KIEN && THANH_PHAN = \"KB\" && AP_DUNG = \"2\" && MA_TIEU_CHI = \"MA_KB_DM\" && MA_GIA_TRI = cbxMaKBNHD.Selected.MA_KENH_BAN\n            )\n        ) And !IsBlank(cbxMaKBNHD.Selected.MA_KENH_BAN),\n        Collect(\n            tmpError,\n            {ID: 1}\n        );\n    );\n    \n// Nếu kênh bán áp dụng 1 phần\n// Tìm trong danh sách áp dụng theo mã kênh bán, loại kênh bán, cá nhân/tổ chức, nếu không có thì false\nIf(\n        !IsBlank(\n            LookUp(\n                dlDKADLoaiCTCCSCollect,\n                MA_DIEU_KIEN = dk.MA_DIEU_KIEN && THANH_PHAN = \"KB\" && AP_DUNG = \"1\" && KIEU = \"2\" && MA_TIEU_CHI = \"MA_KB_DM\"\n            )\n        ) And IsBlank(\n            LookUp(\n                dlDKADLoaiCTCCSCollect,\n                MA_DIEU_KIEN = dk.MA_DIEU_KIEN && THANH_PHAN = \"KB\" && AP_DUNG = \"1\" && KIEU = \"2\" && MA_TIEU_CHI = \"MA_KB_DM\" && MA_GIA_TRI = cbxMaKBNHD.Selected.MA_KENH_BAN\n            )\n        ) And !IsBlank(cbxMaKBNHD.Selected.MA_KENH_BAN),\n        Collect(\n            tmpError,\n            {ID: 2}\n        );\n    );\n    \n// Nếu kênh bán áp dụng 1 phần\n// Tìm trong danh sách áp dụng theo mã kênh bán nếu có dữ liệu\n// Tìm trong danh sách loại trừ theo mã kênh bán nếu có dữ liệu thì -> false, nếu không có thì  -> pass\nIf(\n        !IsBlank(\n            LookUp(\n                dlDKADLoaiCTCCSCollect,\n                MA_DIEU_KIEN = dk.MA_DIEU_KIEN && THANH_PHAN = \"KB\" && AP_DUNG = \"1\" && KIEU = \"2\" && MA_TIEU_CHI = \"MA_KB_DM\" && MA_GIA_TRI = cbxMaKBNHD.Selected.MA_KENH_BAN\n            )\n        ) And !IsBlank(\n            LookUp(\n                dlDKADLoaiCTCCSCollect,\n                MA_DIEU_KIEN = dk.MA_DIEU_KIEN && THANH_PHAN = \"KB\" && AP_DUNG = \"2\" && MA_TIEU_CHI = \"MA_KB_DM\" && MA_GIA_TRI = cbxMaKBNHD.Selected.MA_KENH_BAN\n            )\n        ) And !IsBlank(cbxMaKBNHD.Selected.MA_KENH_BAN),\n        Collect(\n            tmpError,\n            {ID: 3}\n        );\n    );\n    \n//1.2. kiểm tra loại kênh bán\n// Nếu kênh bán áp dụng cho tất cả và có loại trừ\n// Tìm giá trị loại trừ loại kênh bán nếu có dữ liệu thì false\nIf(\n        IsBlank(\n            LookUp(\n                dlDKADLoaiCTCCSCollect,\n                MA_DIEU_KIEN = dk.MA_DIEU_KIEN && THANH_PHAN = \"KB\" && AP_DUNG = \"1\" && MA_TIEU_CHI = \"MA_KB_LOAI\"\n            )\n        ) And !IsBlank(\n            LookUp(\n                dlDKADLoaiCTCCSCollect,\n                MA_DIEU_KIEN = dk.MA_DIEU_KIEN && THANH_PHAN = \"KB\" && AP_DUNG = \"2\" && MA_TIEU_CHI = \"MA_KB_LOAI\" && MA_GIA_TRI = cbxLoaiKBNHD.Selected.MA_LOAI_KB\n            )\n        ) And !IsBlank(cbxLoaiKBNHD.Selected.MA_LOAI_KB),\n        Collect(\n            tmpError,\n            {ID: 4}\n        );\n    );\n    \n// Nếu kênh bán áp dụng 1 phần\n// Tìm trong danh sách áp dụng theo mã kênh bán, loại kênh bán, cá nhân/tổ chức, nếu không có thì false\nIf(\n        !IsBlank(\n            LookUp(\n                dlDKADLoaiCTCCSCollect,\n                MA_DIEU_KIEN = dk.MA_DIEU_KIEN && THANH_PHAN = \"KB\" && AP_DUNG = \"1\" && KIEU = \"2\" && MA_TIEU_CHI = \"MA_KB_LOAI\"\n            )\n        ) And IsBlank(\n            LookUp(\n                dlDKADLoaiCTCCSCollect,\n                MA_DIEU_KIEN = dk.MA_DIEU_KIEN && THANH_PHAN = \"KB\" && AP_DUNG = \"1\" && KIEU = \"2\" && MA_TIEU_CHI = \"MA_KB_LOAI\" && MA_GIA_TRI = cbxLoaiKBNHD.Selected.MA_LOAI_KB\n            )\n        ) And !IsBlank(cbxLoaiKBNHD.Selected.MA_LOAI_KB),\n        Collect(\n            tmpError,\n            {ID: 5}\n        );\n    );\n    \n// Nếu kênh bán áp dụng 1 phần\n// Tìm trong danh sách áp dụng theo mã kênh bán, loại kênh bán, cá nhân/tổ chức, nếu có dữ liệu\n// Tìm trong danh sách loại trừ (theo mã kênh bán, loại kênh bán, cá nhân/tổ chức) nếu có dữ liệu thì -> false, nếu không có thì  -> pass\nIf(\n        !IsBlank(\n            LookUp(\n                dlDKADLoaiCTCCSCollect,\n                MA_DIEU_KIEN = dk.MA_DIEU_KIEN && THANH_PHAN = \"KB\" && AP_DUNG = \"1\" && KIEU = \"2\" && MA_TIEU_CHI = \"MA_KB_LOAI\" && MA_GIA_TRI = cbxMaKBNHD.Selected.MA_KENH_BAN\n            )\n        ) And !IsBlank(\n            LookUp(\n                dlDKADLoaiCTCCSCollect,\n                MA_DIEU_KIEN = dk.MA_DIEU_KIEN && THANH_PHAN = \"KB\" && AP_DUNG = \"2\" && (MA_GIA_TRI = cbxLoaiKBNHD.Selected.MA_LOAI_KB Or MA_GIA_TRI = cbxMaKBNHD.Selected.MA_KENH_BAN)\n            )\n        ) And !IsBlank(cbxLoaiKBNHD.Selected.MA_LOAI_KB),\n        Collect(\n            tmpError,\n            {ID: 6}\n        );\n    );\n    \n//1.3. kiểm tra nhóm KB\n// Nếu kênh bán áp dụng cho tất cả và có loại trừ\n// Tìm giá trị loại trừ  cá nhân/tổ chức, nếu có dữ liệu thì false\nIf(\n        IsBlank(\n            LookUp(\n                dlDKADLoaiCTCCSCollect,\n                MA_DIEU_KIEN = dk.MA_DIEU_KIEN && THANH_PHAN = \"KB\" && AP_DUNG = \"1\" && MA_TIEU_CHI = \"MA_KB_NHOM\"\n            )\n        ) And !IsBlank(\n            LookUp(\n                dlDKADLoaiCTCCSCollect,\n                MA_DIEU_KIEN = dk.MA_DIEU_KIEN && THANH_PHAN = \"KB\" && AP_DUNG = \"2\" && MA_TIEU_CHI = \"MA_KB_NHOM\" && MA_GIA_TRI = nhomKB\n            )\n        ) And !IsBlank(cbxMaKBNHD.Selected.MA_KENH_BAN),\n        Collect(\n            tmpError,\n            {ID: 7}\n        );\n    );\n    \n// Nếu kênh bán áp dụng 1 phần\n// Tìm trong danh sách áp dụng theo mã kênh bán, loại kênh bán, cá nhân/tổ chức, nếu không có thì false\nIf(\n        !IsBlank(\n            LookUp(\n                dlDKADLoaiCTCCSCollect,\n                MA_DIEU_KIEN = dk.MA_DIEU_KIEN && THANH_PHAN = \"KB\" && AP_DUNG = \"1\" && KIEU = \"2\" && MA_TIEU_CHI = \"MA_KB_NHOM\"\n            )\n        ) And IsBlank(\n            LookUp(\n                dlDKADLoaiCTCCSCollect,\n                MA_DIEU_KIEN = dk.MA_DIEU_KIEN && THANH_PHAN = \"KB\" && AP_DUNG = \"1\" && KIEU = \"2\" && MA_TIEU_CHI = \"MA_KB_NHOM\" && MA_GIA_TRI = nhomKB\n            )\n        ) And !IsBlank(cbxMaKBNHD.Selected.MA_KENH_BAN),\n        Collect(\n            tmpError,\n            {ID: 8}\n        );\n    );\n    \n// Nếu kênh bán áp dụng 1 phần\n// Tìm trong danh sách áp dụng theo mã kênh bán nếu có dữ liệu\n// Tìm trong danh sách loại trừ theo mã kênh bán nếu có dữ liệu thì -> false, nếu không có thì  -> pass\nIf(\n        !IsBlank(\n            LookUp(\n                dlDKADLoaiCTCCSCollect,\n                MA_DIEU_KIEN = dk.MA_DIEU_KIEN && THANH_PHAN = \"KB\" && AP_DUNG = \"1\" && KIEU = \"2\" && MA_TIEU_CHI = \"MA_KB_NHOM\" && MA_GIA_TRI = nhomKB\n            )\n        ) And !IsBlank(\n            LookUp(\n                dlDKADLoaiCTCCSCollect,\n                MA_DIEU_KIEN = dk.MA_DIEU_KIEN && THANH_PHAN = \"KB\" && AP_DUNG = \"2\" && MA_TIEU_CHI = \"MA_KB_NHOM\" && MA_GIA_TRI = nhomKB\n            )\n        ) And !IsBlank(cbxMaKBNHD.Selected.MA_KENH_BAN),\n        Collect(\n            tmpError,\n            {ID: 9}\n        );\n    );\n    \n//2. Kiểm tra khách hàng     \n//2.1. kiểm tra nhóm Kh\n// Nếu kênh bán áp dụng cho tất cả và có loại trừ\n// Tìm giá trị loại trừ  cá nhân/tổ chức, nếu có dữ liệu thì false\nIf(\n        IsBlank(\n            LookUp(\n                dlDKADLoaiCTCCSCollect,\n                MA_DIEU_KIEN = dk.MA_DIEU_KIEN && THANH_PHAN = \"KH\" && AP_DUNG = \"1\" && MA_TIEU_CHI = \"MA_KH_LOAI\"\n            )\n        ) And !IsBlank(\n            LookUp(\n                dlDKADLoaiCTCCSCollect,\n                MA_DIEU_KIEN = dk.MA_DIEU_KIEN && THANH_PHAN = \"KH\" && AP_DUNG = \"2\" && MA_TIEU_CHI = \"MA_KH_LOAI\" && MA_GIA_TRI = cbxLoaiKHNHD.Selected.value\n            )\n        ) And !IsBlank(cbxLoaiKHNHD.Selected.value),\n        Collect(\n            tmpError,\n            {ID: 10}\n        );\n    );\n    \n// Nếu kênh bán áp dụng 1 phần\n// Tìm trong danh sách áp dụng theo mã kênh bán, loại kênh bán, cá nhân/tổ chức, nếu không có thì false\nIf(\n        !IsBlank(\n            LookUp(\n                dlDKADLoaiCTCCSCollect,\n                MA_DIEU_KIEN = dk.MA_DIEU_KIEN && THANH_PHAN = \"KH\" && AP_DUNG = \"1\" && KIEU = \"2\" && MA_TIEU_CHI = \"MA_KH_LOAI\"\n            )\n        ) And IsBlank(\n            LookUp(\n                dlDKADLoaiCTCCSCollect,\n                MA_DIEU_KIEN = dk.MA_DIEU_KIEN && THANH_PHAN = \"KH\" && AP_DUNG = \"1\" && KIEU = \"2\" && MA_TIEU_CHI = \"MA_KH_LOAI\" && MA_GIA_TRI = cbxLoaiKHNHD.Selected.value\n            )\n        ) And !IsBlank(cbxLoaiKHNHD.Selected.value),\n        Collect(\n            tmpError,\n            {ID: 11}\n        );\n    );\n    \n// Nếu kênh bán áp dụng 1 phần\n// Tìm trong danh sách áp dụng theo mã kênh bán nếu có dữ liệu\n// Tìm trong danh sách loại trừ theo mã kênh bán nếu có dữ liệu thì -> false, nếu không có thì  -> pass\nIf(\n        !IsBlank(\n            LookUp(\n                dlDKADLoaiCTCCSCollect,\n                MA_DIEU_KIEN = dk.MA_DIEU_KIEN && THANH_PHAN = \"KH\" && AP_DUNG = \"1\" && KIEU = \"2\" && MA_TIEU_CHI = \"MA_KH_LOAI\" && MA_GIA_TRI = cbxLoaiKHNHD.Selected.value\n            )\n        ) And !IsBlank(\n            LookUp(\n                dlDKADLoaiCTCCSCollect,\n                MA_DIEU_KIEN = dk.MA_DIEU_KIEN && THANH_PHAN = \"KH\" && AP_DUNG = \"2\" && MA_TIEU_CHI = \"MA_KH_LOAI\" && MA_GIA_TRI = cbxLoaiKHNHD.Selected.value\n            )\n        ) And !IsBlank(cbxLoaiKHNHD.Selected.value),\n        Collect(\n            tmpError,\n            {ID: 12}\n        );\n    );\n    \n//3. Kiểm tra phạm vi\n//3.1 Kiểm tra tỉnh/thành phố\n// Nếu áp dụng cho tất cả và có loại trừ\n// Tìm giá trị loại trừ tỉnh hoặc mã cấp cha của tỉnh nếu có dữ liệu thì false\nIf(\n        IsBlank(\n            LookUp(\n                dlDKADLoaiCTCCSCollect,\n                MA_DIEU_KIEN = dk.MA_DIEU_KIEN && THANH_PHAN = \"PV\" && AP_DUNG = \"1\" && (MA_TIEU_CHI = \"MA_TINH_TP\" Or MA_TIEU_CHI = \"MA_VUNG_MIEN\")\n            )\n        ) And !IsBlank(\n            LookUp(\n                dlDKADLoaiCTCCSCollect,\n                MA_DIEU_KIEN = dk.MA_DIEU_KIEN && THANH_PHAN = \"PV\" && AP_DUNG = \"2\" && (MA_TIEU_CHI = \"MA_TINH_TP\" Or MA_TIEU_CHI = \"MA_VUNG_MIEN\")\n            )\n        ) And !IsBlank(\n            LookUp(\n                dlDKADLoaiCTCCSCollect,\n                MA_DIEU_KIEN = dk.MA_DIEU_KIEN && THANH_PHAN = \"PV\" && AP_DUNG = \"2\" && (MA_GIA_TRI = cbxTinhNHD.Selected.MA_PHAMVI Or MA_GIA_TRI = cbxTinhNHD.Selected.MA_CHA)\n            )\n        ) And !IsBlank(cbxTinhNHD.Selected.MA_PHAMVI),\n        Collect(\n            tmpError,\n            {ID: 13}\n        );\n    );\n    \n// Nếu phạm vi áp dụng 1 phần\n// Tìm trong danh sách áp dụng theo tỉnh/thành phố hoặc là mã cha của tỉnh/thành phố nếu không có thì false\nIf(\n        !IsBlank(\n            LookUp(\n                dlDKADLoaiCTCCSCollect,\n                MA_DIEU_KIEN = dk.MA_DIEU_KIEN && THANH_PHAN = \"PV\" && AP_DUNG = \"1\" && KIEU = \"2\" && (MA_TIEU_CHI = \"MA_TINH_TP\" Or MA_TIEU_CHI = \"MA_VUNG_MIEN\")\n            )\n        ) And IsBlank(\n            LookUp(\n                dlDKADLoaiCTCCSCollect,\n                MA_DIEU_KIEN = dk.MA_DIEU_KIEN && THANH_PHAN = \"PV\" && AP_DUNG = \"1\" && KIEU = \"2\" && (MA_GIA_TRI = cbxTinhNHD.Selected.MA_PHAMVI Or MA_GIA_TRI = cbxTinhNHD.Selected.MA_CHA)\n            )\n        ) And !IsBlank(cbxTinhNHD.Selected.MA_PHAMVI),\n        Collect(\n            tmpError,\n            {ID: 14}\n        );\n    );\n    \n// Nếu phạm vi áp dụng 1 phần\n// Tìm trong danh sách áp dụng theo tỉnh/thành phố hoặc mã cha của tỉnh/thành phố nếu có dữ liệu\n// Tìm trong danh sách loại trừ theo tỉnh/thành phố và mã cha của tỉnh/thành phố nếu có dữ liệu thì -> false, nếu không có thì  -> pass\nIf(\n        !IsBlank(\n            LookUp(\n                dlDKADLoaiCTCCSCollect,\n                MA_DIEU_KIEN = dk.MA_DIEU_KIEN && THANH_PHAN = \"PV\" && AP_DUNG = \"1\" && KIEU = \"2\" && (MA_TIEU_CHI = \"MA_TINH_TP\" Or MA_TIEU_CHI = \"MA_VUNG_MIEN\")\n            )\n        ) And !IsBlank(\n            LookUp(\n                dlDKADLoaiCTCCSCollect,\n                MA_DIEU_KIEN = dk.MA_DIEU_KIEN && THANH_PHAN = \"PV\" && AP_DUNG = \"1\" && KIEU = \"2\" && (MA_GIA_TRI = cbxTinhNHD.Selected.MA_PHAMVI Or MA_GIA_TRI = cbxTinhNHD.Selected.MA_CHA)\n            )\n        ) And !IsBlank(\n            LookUp(\n                dlDKADLoaiCTCCSCollect,\n                MA_DIEU_KIEN = dk.MA_DIEU_KIEN && THANH_PHAN = \"PV\" && AP_DUNG = \"2\" && (MA_GIA_TRI = cbxTinhNHD.Selected.MA_PHAMVI Or MA_GIA_TRI = cbxTinhNHD.Selected.MA_CHA)\n            )\n        ) And !IsBlank(cbxTinhNHD.Selected.MA_PHAMVI),\n        Collect(\n            tmpError,\n            {ID: 15}\n        );\n    );\n    \n//3.2 Kiểm tra đơn vị quản lý hợp đồng\n// Nếu áp dụng cho tất cả và có loại trừ\n// Tìm giá trị loại trừ đơn vị quản lý hợp đồng nếu có dữ liệu thì false\nIf(\n        IsBlank(\n            LookUp(\n                dlDKADLoaiCTCCSCollect,\n                MA_DIEU_KIEN = dk.MA_DIEU_KIEN && THANH_PHAN = \"PV\" && AP_DUNG = \"1\" && MA_TIEU_CHI = \"MA_DON_VI\"\n            )\n        ) And !IsBlank(\n            LookUp(\n                dlDKADLoaiCTCCSCollect,\n                MA_DIEU_KIEN = dk.MA_DIEU_KIEN && THANH_PHAN = \"PV\" && AP_DUNG = \"2\" && MA_TIEU_CHI = \"MA_DON_VI\" && MA_GIA_TRI = cbxDVQLNHD.Selected.MA_PHAMVI\n            )\n        ) And !IsBlank(cbxDVQLNHD.Selected.MA_PHAMVI),\n        Collect(\n            tmpError,\n            {ID: 16}\n        );\n    );\n    \n// Nếu phạm vi áp dụng 1 phần\n// Tìm trong danh sách áp dụng đơn vị quản lý hợp đồng không có thì false\nIf(\n        !IsBlank(\n            LookUp(\n                dlDKADLoaiCTCCSCollect,\n                MA_DIEU_KIEN = dk.MA_DIEU_KIEN && THANH_PHAN = \"PV\" && AP_DUNG = \"1\" && KIEU = \"2\" && MA_TIEU_CHI = \"MA_DON_VI\"\n            )\n        ) And IsBlank(\n            LookUp(\n                dlDKADLoaiCTCCSCollect,\n                MA_DIEU_KIEN = dk.MA_DIEU_KIEN && THANH_PHAN = \"PV\" && AP_DUNG = \"1\" && KIEU = \"2\" && MA_GIA_TRI = cbxDVQLNHD.Selected.MA_PHAMVI\n            )\n        ) And !IsBlank(cbxDVQLNHD.Selected.MA_PHAMVI),\n        Collect(\n            tmpError,\n            {ID: 17}\n        );\n    );\n    \n// Nếu phạm vi áp dụng 1 phần\n// Tìm trong danh sách áp dụng theo đơn vị quản lý hợp đồng nếu có dữ liệu\n// Tìm trong danh sách loại trừ theo đơn vị quản lý hợp đồng nếu có dữ liệu thì -> false, nếu không có thì  -> pass\nIf(\n        !IsBlank(\n            LookUp(\n                dlDKADLoaiCTCCSCollect,\n                MA_DIEU_KIEN = dk.MA_DIEU_KIEN && THANH_PHAN = \"PV\" && AP_DUNG = \"1\" && KIEU = \"2\" && MA_TIEU_CHI = \"MA_DON_VI\" && MA_GIA_TRI = cbxDVQLNHD.Selected.MA_PHAMVI\n            )\n        ) And !IsBlank(\n            LookUp(\n                dlDKADLoaiCTCCSCollect,\n                MA_DIEU_KIEN = dk.MA_DIEU_KIEN && THANH_PHAN = \"PV\" && AP_DUNG = \"2\" && MA_TIEU_CHI = \"MA_DON_VI\" && MA_GIA_TRI = cbxDVQLNHD.Selected.MA_PHAMVI\n            )\n        ) And !IsBlank(cbxDVQLNHD.Selected.MA_PHAMVI),\n        Collect(\n            tmpError,\n            {ID: 18}\n        );\n    );\n    \n//4. Kiểm tra sản phẩm\nForAll(\n        Gallery3_2.AllItems As sp,\n            // 4.1.1 Kiểm tra thông tin sản phẩm\n// Nếu sản phẩm áp dụng cho tất cả và có loại trừ\n// Tìm giá trị loại trừ mã sản phẩm nếu có dữ liệu thì false\n        If(\n            IsBlank(\n                LookUp(\n                    dlDKADLoaiCTCCSCollect,\n                    MA_DIEU_KIEN = dk.MA_DIEU_KIEN && THANH_PHAN = \"SP\" && AP_DUNG = \"1\" && MA_TIEU_CHI = \"MA_SP\"\n                )\n            ) And !IsBlank(\n                LookUp(\n                    dlDKADLoaiCTCCSCollect,\n                    MA_DIEU_KIEN = dk.MA_DIEU_KIEN && THANH_PHAN = \"SP\" && AP_DUNG = \"2\" && MA_TIEU_CHI = \"MA_SP\" && MA_GIA_TRI = sp.cbxMaSPNHD.Selected.MA_SAN_PHAM\n                )\n            ) And !IsBlank(sp.cbxMaSPNHD.Selected.MA_SAN_PHAM),\n            Collect(\n                tmpError,\n                {ID: 19}\n            );\n        );\n            // Nếu sản phẩm áp dụng 1 phần\n// Tìm trong danh sách áp dụng theo mã sản phẩm nếu không có thì false\nIf(\n            !IsBlank(\n                LookUp(\n                    dlDKADLoaiCTCCSCollect,\n                    MA_DIEU_KIEN = dk.MA_DIEU_KIEN && THANH_PHAN = \"SP\" && AP_DUNG = \"1\" && MA_TIEU_CHI = \"MA_SP\"\n                )\n            ) And IsBlank(\n                LookUp(\n                    dlDKADLoaiCTCCSCollect,\n                    MA_DIEU_KIEN = dk.MA_DIEU_KIEN && THANH_PHAN = \"SP\" && AP_DUNG = \"1\" && MA_TIEU_CHI = \"MA_SP\" && KIEU = \"2\" && MA_GIA_TRI = sp.cbxMaSPNHD.Selected.MA_SAN_PHAM\n                )\n            ) And !IsBlank(sp.cbxMaSPNHD.Selected.MA_SAN_PHAM),\n            Collect(\n                tmpError,\n                {ID: 20}\n            );\n        );\n        \n// Nếu sản phẩm áp dụng 1 phần\n// Tìm trong danh sách áp dụng theo mã sản phẩm nếu có dữ liệu\n// Tìm trong danh sách loại trừ theo mã sản phẩm nếu có dữ liệu thì -> false, nếu không có thì  -> pass\nIf(\n            !IsBlank(\n                LookUp(\n                    dlDKADLoaiCTCCSCollect,\n                    MA_DIEU_KIEN = dk.MA_DIEU_KIEN && THANH_PHAN = \"SP\" && AP_DUNG = \"1\" && MA_TIEU_CHI = \"MA_SP\" && MA_GIA_TRI = sp.cbxMaSPNHD.Selected.MA_SAN_PHAM\n                )\n            ) And !IsBlank(\n                LookUp(\n                    dlDKADLoaiCTCCSCollect,\n                    MA_DIEU_KIEN = dk.MA_DIEU_KIEN && THANH_PHAN = \"SP\" && AP_DUNG = \"2\" && MA_TIEU_CHI = \"MA_SP\" && MA_GIA_TRI = sp.cbxMaSPNHD.Selected.MA_SAN_PHAM\n                )\n            ) And !IsBlank(sp.cbxMaSPNHD.Selected.MA_SAN_PHAM),\n            Collect(\n                tmpError,\n                {ID: 21}\n            );\n        );\n        // 4.1.2 Kiểm tra thông tin chương trình\n// Nếu chương trình áp dụng cho tất cả và có loại trừ\n// Tìm giá trị loại trừ chương trình nếu có dữ liệu thì false\nIf(\n            IsBlank(\n                LookUp(\n                    dlDKADLoaiCTCCSCollect,\n                    MA_DIEU_KIEN = dk.MA_DIEU_KIEN && THANH_PHAN = \"SP\" && AP_DUNG = \"1\" && MA_TIEU_CHI = \"MA_CT\"\n                )\n            ) And !IsBlank(\n                LookUp(\n                    dlDKADLoaiCTCCSCollect,\n                    MA_DIEU_KIEN = dk.MA_DIEU_KIEN && THANH_PHAN = \"SP\" && AP_DUNG = \"2\" && MA_TIEU_CHI = \"MA_CT\" && \n                    MA_GIA_TRI = sp.cbxMaCTNHDHide.Selected.MA_CHUONG_TRINH\n                )\n            ) And !IsBlank(sp.cbxMaCTNHDHide.Selected.MA_CHUONG_TRINH),\n            Collect(\n                tmpError,\n                {ID: 22}\n            );\n        );\n            // Nếu sản phẩm áp dụng 1 phần\n// Tìm trong danh sách áp dụng theo mã sản phẩm nếu không có thì false\nIf(\n            !IsBlank(\n                LookUp(\n                    dlDKADLoaiCTCCSCollect,\n                    MA_DIEU_KIEN = dk.MA_DIEU_KIEN && THANH_PHAN = \"SP\" && AP_DUNG = \"1\" && MA_TIEU_CHI = \"MA_CT\"\n                )\n            ) And IsBlank(\n                LookUp(\n                    dlDKADLoaiCTCCSCollect,\n                    MA_DIEU_KIEN = dk.MA_DIEU_KIEN && THANH_PHAN = \"SP\" && AP_DUNG = \"1\" && MA_TIEU_CHI = \"MA_CT\" && KIEU = \"2\" && MA_GIA_TRI = sp.cbxMaCTNHDHide.Selected.MA_CHUONG_TRINH\n                )\n            ) And !IsBlank(sp.cbxMaCTNHDHide.Selected.MA_CHUONG_TRINH),\n            Collect(\n                tmpError,\n                {ID: 23}\n            );\n        );\n            // Nếu chương trình áp dụng 1 phần\n// Tìm trong danh sách áp dụng theo mã chương trình nếu có dữ liệu\n// Tìm trong danh sách loại trừ theo mã chương trình nếu có dữ liệu thì -> false, nếu không có thì  -> pass\nIf(\n            !IsBlank(\n                LookUp(\n                    dlDKADLoaiCTCCSCollect,\n                    MA_DIEU_KIEN = dk.MA_DIEU_KIEN && THANH_PHAN = \"SP\" && AP_DUNG = \"1\" && MA_TIEU_CHI = \"MA_CT\" && MA_GIA_TRI = sp.cbxMaCTNHDHide.Selected.MA_CHUONG_TRINH\n                )\n            ) And !IsBlank(\n                LookUp(\n                    dlDKADLoaiCTCCSCollect,\n                    MA_DIEU_KIEN = dk.MA_DIEU_KIEN && THANH_PHAN = \"SP\" && AP_DUNG = \"2\" && MA_TIEU_CHI = \"MA_CT\" && MA_GIA_TRI = sp.cbxMaCTNHDHide.Selected.MA_CHUONG_TRINH\n                )\n            ) And !IsBlank(sp.cbxMaCTNHDHide.Selected.MA_CHUONG_TRINH),\n            Collect(\n                tmpError,\n                {ID: 24}\n            );\n        );\n // 4.1.3 Kiểm tra thông tin LHNV\n// Nếu LHNV áp dụng cho tất cả và có loại trừ\n// Tìm giá trị loại trừ LHNV nếu có dữ liệu thì false\nIf(\n            IsBlank(\n                LookUp(\n                    dlDKADLoaiCTCCSCollect,\n                    MA_DIEU_KIEN = dk.MA_DIEU_KIEN && THANH_PHAN = \"SP\" && AP_DUNG = \"1\" && MA_TIEU_CHI = \"LHNV\"\n                )\n            ) And !IsBlank(\n                LookUp(\n                    dlDKADLoaiCTCCSCollect,\n                    MA_DIEU_KIEN = dk.MA_DIEU_KIEN && THANH_PHAN = \"SP\" && AP_DUNG = \"2\" && MA_TIEU_CHI = \"LHNV\" \n                    && TEN_GIA_TRI = LookUp(DL_SAN_PHAM,MA_SAN_PHAM=cbxMaSPNHD.Selected.MA_SAN_PHAM,LHNV)\n                )\n            ) And !IsBlank(LookUp(DL_SAN_PHAM,MA_SAN_PHAM=cbxMaSPNHD.Selected.MA_SAN_PHAM,LHNV)),\n            Collect(\n                tmpError,\n                {ID: 25}\n            );\n        );\n            // Nếu sản phẩm áp dụng 1 phần\n// Tìm trong danh sách áp dụng theo mã sản phẩm nếu không có thì false\nIf(\n            !IsBlank(\n                LookUp(\n                    dlDKADLoaiCTCCSCollect,\n                    MA_DIEU_KIEN = dk.MA_DIEU_KIEN && THANH_PHAN = \"SP\" && AP_DUNG = \"1\" && MA_TIEU_CHI = \"LHNV\"\n                )\n            ) And IsBlank(\n                LookUp(\n                    dlDKADLoaiCTCCSCollect,\n                    MA_DIEU_KIEN = dk.MA_DIEU_KIEN && THANH_PHAN = \"SP\" && AP_DUNG = \"1\" && MA_TIEU_CHI = \"LHNV\" && KIEU = \"2\" && \n                    TEN_GIA_TRI = LookUp(DL_SAN_PHAM,MA_SAN_PHAM=cbxMaSPNHD.Selected.MA_SAN_PHAM,LHNV)\n                )\n            ) And !IsBlank(LookUp(DL_SAN_PHAM,MA_SAN_PHAM=cbxMaSPNHD.Selected.MA_SAN_PHAM,LHNV)),\n            Collect(\n                tmpError,\n                {ID: 26}\n            );\n        );\n            // Nếu chương trình áp dụng 1 phần\n// Tìm trong danh sách áp dụng theo mã chương trình nếu có dữ liệu\n// Tìm trong danh sách loại trừ theo mã chương trình nếu có dữ liệu thì -> false, nếu không có thì  -> pass\nIf(\n            !IsBlank(\n                LookUp(\n                    dlDKADLoaiCTCCSCollect,\n                    MA_DIEU_KIEN = dk.MA_DIEU_KIEN && THANH_PHAN = \"SP\" && AP_DUNG = \"1\" && MA_TIEU_CHI = \"LHNV\" && \n                    TEN_GIA_TRI = LookUp(DL_SAN_PHAM,MA_SAN_PHAM=cbxMaSPNHD.Selected.MA_SAN_PHAM,LHNV)\n                )\n            ) And !IsBlank(\n                LookUp(\n                    dlDKADLoaiCTCCSCollect,\n                    MA_DIEU_KIEN = dk.MA_DIEU_KIEN && THANH_PHAN = \"SP\" && AP_DUNG = \"2\" && MA_TIEU_CHI = \"LHNV\" && \n                    TEN_GIA_TRI = LookUp(DL_SAN_PHAM,MA_SAN_PHAM=cbxMaSPNHD.Selected.MA_SAN_PHAM,LHNV)\n                )\n            ) And !IsBlank(LookUp(DL_SAN_PHAM,MA_SAN_PHAM=cbxMaSPNHD.Selected.MA_SAN_PHAM,LHNV)),\n            Collect(\n                tmpError,\n                {ID: 27}\n            );\n        );\n    );\n    \n//4.1.4 Kiểm tra combo sản phẩm\nForAll(\n        Gallery3_2.AllItems As sp,\n        Collect(\n            dsSpKetHop,\n            {MA_SAN_PHAM: sp.cbxMaSPNHD.Selected.MA_SAN_PHAM}\n        )\n    );\n    ForAll(\n        Gallery3_1.AllItems As sp,\n        Collect(\n            dsSpKetHop,\n            {MA_SAN_PHAM: sp.tiMaSPLKNHD_1.Text}\n        )\n    );\n    Collect(\n        GroupedSp,\n        GroupBy(\n            dsSpKetHop,\n            MA_SAN_PHAM,\n            Grouped\n        )\n    );\n    If(\n        CountRows(GroupedSp) > 1,\n        Collect(\n            dsCombosp,\n            Filter(\n                dlDKADLoaiCTCCSCollect,\n                MA_GIA_TRI,\n                MA_DIEU_KIEN = dk.MA_DIEU_KIEN && THANH_PHAN = \"SP\" && MA_TIEU_CHI = \"MA_COMBO_SP\" && AP_DUNG = \"1\"\n            )\n        );\n        Collect(\n            dsCombospLt,\n            Filter(\n                dlDKADLoaiCTCCSCollect,\n                MA_GIA_TRI,\n                MA_DIEU_KIEN = dk.MA_DIEU_KIEN && THANH_PHAN = \"SP\" && MA_TIEU_CHI = \"MA_COMBO_SP\" && AP_DUNG = \"2\"\n            )\n        );\n        ForAll(\n            GroupedSp As sp,\n            RemoveIf(\n                dsCombosp,\n                cr282_ma_gia_tri = sp.MA_SAN_PHAM\n            );\n        );\n        ForAll(\n            GroupedSp As sp,\n            RemoveIf(\n                dsCombospLt,\n                cr282_ma_gia_tri = sp.MA_SAN_PHAM\n            );\n        );\n        \n// Nếu COMBO áp dụng cho tất cả và có loại trừ\n// Tìm giá trị loại trừ theo combo sản phẩm nếu có dữ liệu thì false\nIf(\n            IsBlank(\n                LookUp(\n                    dlDKADLoaiCTCCSCollect,\n                    MA_DIEU_KIEN = dk.MA_DIEU_KIEN && THANH_PHAN = \"SP\" && AP_DUNG = \"1\" && MA_TIEU_CHI = \"MA_COMBO_SP\"\n                )\n            ) And !IsBlank(\n                LookUp(\n                    dlDKADLoaiCTCCSCollect,\n                    MA_DIEU_KIEN = dk.MA_DIEU_KIEN && THANH_PHAN = \"SP\" && AP_DUNG = \"2\" && MA_TIEU_CHI = \"MA_COMBO_SP\"\n                )\n            ) And CountRows(dsCombospLt) = 0 And CountRows(GroupedSp) = CountRows(\n                Filter(\n                    dlDKADLoaiCTCCSCollect,\n                    MA_DIEU_KIEN = dk.MA_DIEU_KIEN && THANH_PHAN = \"SP\" && AP_DUNG = \"2\" && MA_TIEU_CHI = \"MA_COMBO_SP\"\n                )\n            ),\n            Collect(\n                tmpError,\n                {ID: 28}\n            );\n        );\n        \n// Nếu combo sản phẩm áp dụng 1 phần\n// Tìm trong danh sách áp dụng theo COMBO SẢN PHẨM nếu không khớp có thì false\nIf(\n            !IsBlank(\n                LookUp(\n                    dlDKADLoaiCTCCSCollect,\n                    MA_DIEU_KIEN = dk.MA_DIEU_KIEN && THANH_PHAN = \"SP\" && AP_DUNG = \"1\" && MA_TIEU_CHI = \"MA_COMBO_SP\"\n                )\n            ) And (CountRows(dsCombosp) <> 0),\n            Collect(\n                tmpError,\n                {ID: 29}\n            );\n        );\n    );\n    \n// nếu điều kiện nào không lỗi thì đưa vào danh sách\nIf(\n        CountRows(tmpError) <= 0,\n        Collect(\n            tmpPass,\n            {ma_dieu_kien: dk.MA_DIEU_KIEN}\n        );\n    )\n);\n// end điều kiện áp dụng\n// lấy chính sách áp dụng\nUpdateContext({errorMsg: \"\"});\n// lọc điều kiện\n// lấy danh sách các điều kiện áp dụng còn hoạt động và ngày hợp đồng nằm trong khoảng hiệu lực\nClearCollect (\n    tmpChinhsach,\n    Filter(\n        DL_CHINHSACH_CHUNG,\n        HOAT_DONG = \"true\" && DateValue(HIEU_LUC_TU) <= DateValue(dpNgayHDNHD.SelectedDate)\n    )\n);\nClearCollect(\n    tmpErrorCs,\n    {}\n);\nRemoveIf(\n    tmpErrorCs,\n    1 = 1\n);\nClearCollect(\n    tmpPassCs,\n    {}\n);\nClearCollect(\n    dsCombosp,\n    {}\n);\nClearCollect(\n    dsCombospLt,\n    {}\n);\nClearCollect(\n    GroupedSp,\n    {}\n);\nClearCollect(\n    dsSpKetHop,\n    {}\n);\nRemoveIf(\n    tmpPassCs,\n    1 = 1\n);\nForAll(\n    tmpChinhsach As dk,\n//1. kiểm tra kênh bán   \n//1.1. kiểm tra mã kênh bán\n// Nếu kênh bán áp dụng cho tất cả và có loại trừ\n// Tìm giá trị loại trừ mã kênh bán, loại kênh bán, cá nhân/tổ chức, nếu có dữ liệu thì false\n    RemoveIf(\n        tmpErrorCs,\n        1 = 1\n    );\n    RemoveIf(\n        dsCombosp,\n        1 = 1\n    );\n    RemoveIf(\n        dsCombospLt,\n        1 = 1\n    );\n    RemoveIf(\n        dsSpKetHop,\n        1 = 1\n    );\n    RemoveIf(\n        GroupedSp,\n        1 = 1\n    );\n    If(\n        IsBlank(\n            LookUp(\n                dlChinhSachDTCTCCSCollect,\n                MA_CHINH_SACH = dk.MA_CHINH_SACH && THANH_PHAN = \"KB\" && AP_DUNG = \"1\" && MA_TIEU_CHI = \"MA_KB_DM\"\n            )\n        ) And !IsBlank(\n            LookUp(\n                dlChinhSachDTCTCCSCollect,\n                MA_CHINH_SACH = dk.MA_CHINH_SACH && THANH_PHAN = \"KB\" && AP_DUNG = \"2\" && MA_TIEU_CHI = \"MA_KB_DM\" && MA_GIA_TRI = cbxMaKBNHD.Selected.MA_KENH_BAN\n            )\n        ) And !IsBlank(cbxMaKBNHD.Selected.MA_KENH_BAN),\n        Collect(\n            tmpErrorCs,\n            {ID: 1}\n        );\n    );\n    \n// Nếu kênh bán áp dụng 1 phần\n// Tìm trong danh sách áp dụng theo mã kênh bán, loại kênh bán, cá nhân/tổ chức, nếu không có thì false\nIf(\n        !IsBlank(\n            LookUp(\n                dlChinhSachDTCTCCSCollect,\n                MA_CHINH_SACH = dk.MA_CHINH_SACH && THANH_PHAN = \"KB\" && AP_DUNG = \"1\" && KIEU = \"2\" && MA_TIEU_CHI = \"MA_KB_DM\"\n            )\n        ) And IsBlank(\n            LookUp(\n                dlChinhSachDTCTCCSCollect,\n                MA_CHINH_SACH = dk.MA_CHINH_SACH && THANH_PHAN = \"KB\" && AP_DUNG = \"1\" && KIEU = \"2\" && MA_TIEU_CHI = \"MA_KB_DM\" && MA_GIA_TRI = cbxMaKBNHD.Selected.MA_KENH_BAN\n            )\n        ) And !IsBlank(cbxMaKBNHD.Selected.MA_KENH_BAN),\n        Collect(\n            tmpErrorCs,\n            {ID: 2}\n        );\n    );\n    \n// Nếu kênh bán áp dụng 1 phần\n// Tìm trong danh sách áp dụng theo mã kênh bán nếu có dữ liệu\n// Tìm trong danh sách loại trừ theo mã kênh bán nếu có dữ liệu thì -> false, nếu không có thì  -> pass\nIf(\n        !IsBlank(\n            LookUp(\n                dlChinhSachDTCTCCSCollect,\n                MA_CHINH_SACH = dk.MA_CHINH_SACH && THANH_PHAN = \"KB\" && AP_DUNG = \"1\" && KIEU = \"2\" && MA_TIEU_CHI = \"MA_KB_DM\" && MA_GIA_TRI = cbxMaKBNHD.Selected.MA_KENH_BAN\n            )\n        ) And !IsBlank(\n            LookUp(\n                dlChinhSachDTCTCCSCollect,\n                MA_CHINH_SACH = dk.MA_CHINH_SACH && THANH_PHAN = \"KB\" && AP_DUNG = \"2\" && MA_TIEU_CHI = \"MA_KB_DM\" && MA_GIA_TRI = cbxMaKBNHD.Selected.MA_KENH_BAN\n            )\n        ) And !IsBlank(cbxMaKBNHD.Selected.MA_KENH_BAN),\n        Collect(\n            tmpErrorCs,\n            {ID: 3}\n        );\n    );\n    \n//1.2. kiểm tra loại kênh bán\n// Nếu kênh bán áp dụng cho tất cả và có loại trừ\n// Tìm giá trị loại trừ loại kênh bán nếu có dữ liệu thì false\nIf(\n        IsBlank(\n            LookUp(\n                dlChinhSachDTCTCCSCollect,\n                MA_CHINH_SACH = dk.MA_CHINH_SACH && THANH_PHAN = \"KB\" && AP_DUNG = \"1\" && MA_TIEU_CHI = \"MA_KB_LOAI\"\n            )\n        ) And !IsBlank(\n            LookUp(\n                dlChinhSachDTCTCCSCollect,\n                MA_CHINH_SACH = dk.MA_CHINH_SACH && THANH_PHAN = \"KB\" && AP_DUNG = \"2\" && MA_TIEU_CHI = \"MA_KB_LOAI\" && MA_GIA_TRI = cbxLoaiKBNHD.Selected.MA_LOAI_KB\n            )\n        ) And !IsBlank(cbxLoaiKBNHD.Selected.MA_LOAI_KB),\n        Collect(\n            tmpErrorCs,\n            {ID: 4}\n        );\n    );\n    \n// Nếu kênh bán áp dụng 1 phần\n// Tìm trong danh sách áp dụng theo mã kênh bán, loại kênh bán, cá nhân/tổ chức, nếu không có thì false\nIf(\n        !IsBlank(\n            LookUp(\n                dlChinhSachDTCTCCSCollect,\n                MA_CHINH_SACH = dk.MA_CHINH_SACH && THANH_PHAN = \"KB\" && AP_DUNG = \"1\" && KIEU = \"2\" && MA_TIEU_CHI = \"MA_KB_LOAI\"\n            )\n        ) And IsBlank(\n            LookUp(\n                dlChinhSachDTCTCCSCollect,\n                MA_CHINH_SACH = dk.MA_CHINH_SACH && THANH_PHAN = \"KB\" && AP_DUNG = \"1\" && KIEU = \"2\" && MA_TIEU_CHI = \"MA_KB_LOAI\" && MA_GIA_TRI = cbxLoaiKBNHD.Selected.MA_LOAI_KB\n            )\n        ) And !IsBlank(cbxLoaiKBNHD.Selected.MA_LOAI_KB),\n        Collect(\n            tmpErrorCs,\n            {ID: 5}\n        );\n    );\n    \n// Nếu kênh bán áp dụng 1 phần\n// Tìm trong danh sách áp dụng theo mã kênh bán, loại kênh bán, cá nhân/tổ chức, nếu có dữ liệu\n// Tìm trong danh sách loại trừ (theo mã kênh bán, loại kênh bán, cá nhân/tổ chức) nếu có dữ liệu thì -> false, nếu không có thì  -> pass\nIf(\n        !IsBlank(\n            LookUp(\n                dlChinhSachDTCTCCSCollect,\n                MA_CHINH_SACH = dk.MA_CHINH_SACH && THANH_PHAN = \"KB\" && AP_DUNG = \"1\" && KIEU = \"2\" && MA_TIEU_CHI = \"MA_KB_LOAI\" && MA_GIA_TRI = cbxMaKBNHD.Selected.MA_KENH_BAN\n            )\n        ) And !IsBlank(\n            LookUp(\n                dlChinhSachDTCTCCSCollect,\n                MA_CHINH_SACH = dk.MA_CHINH_SACH && THANH_PHAN = \"KB\" && AP_DUNG = \"2\" && (MA_GIA_TRI = cbxLoaiKBNHD.Selected.MA_LOAI_KB Or MA_GIA_TRI = cbxMaKBNHD.Selected.MA_KENH_BAN)\n            )\n        ) And !IsBlank(cbxLoaiKBNHD.Selected.MA_LOAI_KB),\n        Collect(\n            tmpErrorCs,\n            {ID: 6}\n        );\n    );\n    \n//1.3. kiểm tra nhóm KB\n// Nếu kênh bán áp dụng cho tất cả và có loại trừ\n// Tìm giá trị loại trừ  cá nhân/tổ chức, nếu có dữ liệu thì false\nIf(\n        IsBlank(\n            LookUp(\n                dlChinhSachDTCTCCSCollect,\n                MA_CHINH_SACH = dk.MA_CHINH_SACH && THANH_PHAN = \"KB\" && AP_DUNG = \"1\" && MA_TIEU_CHI = \"MA_KB_NHOM\"\n            )\n        ) And !IsBlank(\n            LookUp(\n                dlChinhSachDTCTCCSCollect,\n                MA_CHINH_SACH = dk.MA_CHINH_SACH && THANH_PHAN = \"KB\" && AP_DUNG = \"2\" && MA_TIEU_CHI = \"MA_KB_NHOM\" && MA_GIA_TRI = nhomKB\n            )\n        ) And !IsBlank(cbxMaKBNHD.Selected.MA_KENH_BAN),\n        Collect(\n            tmpErrorCs,\n            {ID: 7}\n        );\n    );\n    \n// Nếu kênh bán áp dụng 1 phần\n// Tìm trong danh sách áp dụng theo mã kênh bán, loại kênh bán, cá nhân/tổ chức, nếu không có thì false\nIf(\n        !IsBlank(\n            LookUp(\n                dlChinhSachDTCTCCSCollect,\n                MA_CHINH_SACH = dk.MA_CHINH_SACH && THANH_PHAN = \"KB\" && AP_DUNG = \"1\" && KIEU = \"2\" && MA_TIEU_CHI = \"MA_KB_NHOM\"\n            )\n        ) And IsBlank(\n            LookUp(\n                dlChinhSachDTCTCCSCollect,\n                MA_CHINH_SACH = dk.MA_CHINH_SACH && THANH_PHAN = \"KB\" && AP_DUNG = \"1\" && KIEU = \"2\" && MA_TIEU_CHI = \"MA_KB_NHOM\" && MA_GIA_TRI = nhomKB\n            )\n        ) And !IsBlank(cbxMaKBNHD.Selected.MA_KENH_BAN),\n        Collect(\n            tmpErrorCs,\n            {ID: 8}\n        );\n    );\n    \n// Nếu kênh bán áp dụng 1 phần\n// Tìm trong danh sách áp dụng theo mã kênh bán nếu có dữ liệu\n// Tìm trong danh sách loại trừ theo mã kênh bán nếu có dữ liệu thì -> false, nếu không có thì  -> pass\nIf(\n        !IsBlank(\n            LookUp(\n                dlChinhSachDTCTCCSCollect,\n                MA_CHINH_SACH = dk.MA_CHINH_SACH && THANH_PHAN = \"KB\" && AP_DUNG = \"1\" && KIEU = \"2\" && MA_TIEU_CHI = \"MA_KB_NHOM\" && MA_GIA_TRI = nhomKB\n            )\n        ) And !IsBlank(\n            LookUp(\n                dlChinhSachDTCTCCSCollect,\n                MA_CHINH_SACH = dk.MA_CHINH_SACH && THANH_PHAN = \"KB\" && AP_DUNG = \"2\" && MA_TIEU_CHI = \"MA_KB_NHOM\" && MA_GIA_TRI = nhomKB\n            )\n        ) And !IsBlank(cbxMaKBNHD.Selected.MA_KENH_BAN),\n        Collect(\n            tmpErrorCs,\n            {ID: 9}\n        );\n    );\n    \n//2. Kiểm tra khách hàng     \n//2.1. kiểm tra nhóm Kh\n// Nếu kênh bán áp dụng cho tất cả và có loại trừ\n// Tìm giá trị loại trừ  cá nhân/tổ chức, nếu có dữ liệu thì false\nIf(\n        IsBlank(\n            LookUp(\n                dlChinhSachDTCTCCSCollect,\n                MA_CHINH_SACH = dk.MA_CHINH_SACH && THANH_PHAN = \"KH\" && AP_DUNG = \"1\" && MA_TIEU_CHI = \"MA_KH_LOAI\"\n            )\n        ) And !IsBlank(\n            LookUp(\n                dlChinhSachDTCTCCSCollect,\n                MA_CHINH_SACH = dk.MA_CHINH_SACH && THANH_PHAN = \"KH\" && AP_DUNG = \"2\" && MA_TIEU_CHI = \"MA_KH_LOAI\" && MA_GIA_TRI = cbxLoaiKHNHD.Selected.value\n            )\n        ) And !IsBlank(cbxLoaiKHNHD.Selected.value),\n        Collect(\n            tmpErrorCs,\n            {ID: 10}\n        );\n    );\n    \n// Nếu kênh bán áp dụng 1 phần\n// Tìm trong danh sách áp dụng theo mã kênh bán, loại kênh bán, cá nhân/tổ chức, nếu không có thì false\nIf(\n        !IsBlank(\n            LookUp(\n                dlChinhSachDTCTCCSCollect,\n                MA_CHINH_SACH = dk.MA_CHINH_SACH && THANH_PHAN = \"KH\" && AP_DUNG = \"1\" && KIEU = \"2\" && MA_TIEU_CHI = \"MA_KH_LOAI\"\n            )\n        ) And IsBlank(\n            LookUp(\n                dlChinhSachDTCTCCSCollect,\n                MA_CHINH_SACH = dk.MA_CHINH_SACH && THANH_PHAN = \"KH\" && AP_DUNG = \"1\" && KIEU = \"2\" && MA_TIEU_CHI = \"MA_KH_LOAI\" && MA_GIA_TRI = cbxLoaiKHNHD.Selected.value\n            )\n        ) And !IsBlank(cbxLoaiKHNHD.Selected.value),\n        Collect(\n            tmpErrorCs,\n            {ID: 11}\n        );\n    );\n    \n// Nếu kênh bán áp dụng 1 phần\n// Tìm trong danh sách áp dụng theo mã kênh bán nếu có dữ liệu\n// Tìm trong danh sách loại trừ theo mã kênh bán nếu có dữ liệu thì -> false, nếu không có thì  -> pass\nIf(\n        !IsBlank(\n            LookUp(\n                dlChinhSachDTCTCCSCollect,\n                MA_CHINH_SACH = dk.MA_CHINH_SACH && THANH_PHAN = \"KH\" && AP_DUNG = \"1\" && KIEU = \"2\" && MA_TIEU_CHI = \"MA_KH_LOAI\" && MA_GIA_TRI = cbxLoaiKHNHD.Selected.value\n            )\n        ) And !IsBlank(\n            LookUp(\n                dlChinhSachDTCTCCSCollect,\n                MA_CHINH_SACH = dk.MA_CHINH_SACH && THANH_PHAN = \"KH\" && AP_DUNG = \"2\" && MA_TIEU_CHI = \"MA_KH_LOAI\" && MA_GIA_TRI = cbxLoaiKHNHD.Selected.value\n            )\n        ) And !IsBlank(cbxLoaiKHNHD.Selected.value),\n        Collect(\n            tmpErrorCs,\n            {ID: 12}\n        );\n    );\n    \n//3. Kiểm tra phạm vi\n//3.1 Kiểm tra tỉnh/thành phố\n// Nếu áp dụng cho tất cả và có loại trừ\n// Tìm giá trị loại trừ tỉnh hoặc mã cấp cha của tỉnh nếu có dữ liệu thì false\nIf(\n        IsBlank(\n            LookUp(\n                dlChinhSachDTCTCCSCollect,\n                MA_CHINH_SACH = dk.MA_CHINH_SACH && THANH_PHAN = \"PV\" && AP_DUNG = \"1\" && (MA_TIEU_CHI = \"MA_TINH_TP\" Or MA_TIEU_CHI = \"MA_VUNG_MIEN\")\n            )\n        ) And !IsBlank(\n            LookUp(\n                dlChinhSachDTCTCCSCollect,\n                MA_CHINH_SACH = dk.MA_CHINH_SACH && THANH_PHAN = \"PV\" && AP_DUNG = \"2\" && (MA_TIEU_CHI = \"MA_TINH_TP\" Or MA_TIEU_CHI = \"MA_VUNG_MIEN\")\n            )\n        ) And !IsBlank(\n            LookUp(\n                dlChinhSachDTCTCCSCollect,\n                MA_CHINH_SACH = dk.MA_CHINH_SACH && THANH_PHAN = \"PV\" && AP_DUNG = \"2\" && (MA_GIA_TRI = cbxTinhNHD.Selected.MA_PHAMVI Or MA_GIA_TRI = cbxTinhNHD.Selected.MA_CHA)\n            )\n        ) And !IsBlank(cbxTinhNHD.Selected.MA_PHAMVI),\n        Collect(\n            tmpErrorCs,\n            {ID: 13}\n        );\n    );\n    \n// Nếu phạm vi áp dụng 1 phần\n// Tìm trong danh sách áp dụng theo tỉnh/thành phố hoặc là mã cha của tỉnh/thành phố nếu không có thì false\nIf(\n        !IsBlank(\n            LookUp(\n                dlChinhSachDTCTCCSCollect,\n                MA_CHINH_SACH = dk.MA_CHINH_SACH && THANH_PHAN = \"PV\" && AP_DUNG = \"1\" && KIEU = \"2\" && (MA_TIEU_CHI = \"MA_TINH_TP\" Or MA_TIEU_CHI = \"MA_VUNG_MIEN\")\n            )\n        ) And IsBlank(\n            LookUp(\n                dlChinhSachDTCTCCSCollect,\n                MA_CHINH_SACH = dk.MA_CHINH_SACH && THANH_PHAN = \"PV\" && AP_DUNG = \"1\" && KIEU = \"2\" && (MA_GIA_TRI = cbxTinhNHD.Selected.MA_PHAMVI Or MA_GIA_TRI = cbxTinhNHD.Selected.MA_CHA)\n            )\n        ) And !IsBlank(cbxTinhNHD.Selected.MA_PHAMVI),\n        Collect(\n            tmpErrorCs,\n            {ID: 14}\n        );\n    );\n    \n// Nếu phạm vi áp dụng 1 phần\n// Tìm trong danh sách áp dụng theo tỉnh/thành phố hoặc mã cha của tỉnh/thành phố nếu có dữ liệu\n// Tìm trong danh sách loại trừ theo tỉnh/thành phố và mã cha của tỉnh/thành phố nếu có dữ liệu thì -> false, nếu không có thì  -> pass\nIf(\n        !IsBlank(\n            LookUp(\n                dlChinhSachDTCTCCSCollect,\n                MA_CHINH_SACH = dk.MA_CHINH_SACH && THANH_PHAN = \"PV\" && AP_DUNG = \"1\" && KIEU = \"2\" && (MA_TIEU_CHI = \"MA_TINH_TP\" Or MA_TIEU_CHI = \"MA_VUNG_MIEN\")\n            )\n        ) And !IsBlank(\n            LookUp(\n                dlChinhSachDTCTCCSCollect,\n                MA_CHINH_SACH = dk.MA_CHINH_SACH && THANH_PHAN = \"PV\" && AP_DUNG = \"1\" && KIEU = \"2\" && (MA_GIA_TRI = cbxTinhNHD.Selected.MA_PHAMVI Or MA_GIA_TRI = cbxTinhNHD.Selected.MA_CHA)\n            )\n        ) And !IsBlank(\n            LookUp(\n                dlChinhSachDTCTCCSCollect,\n                MA_CHINH_SACH = dk.MA_CHINH_SACH && THANH_PHAN = \"PV\" && AP_DUNG = \"2\" && (MA_GIA_TRI = cbxTinhNHD.Selected.MA_PHAMVI Or MA_GIA_TRI = cbxTinhNHD.Selected.MA_CHA)\n            )\n        ) And !IsBlank(cbxTinhNHD.Selected.MA_PHAMVI),\n        Collect(\n            tmpErrorCs,\n            {ID: 15}\n        );\n    );\n    \n//3.2 Kiểm tra đơn vị quản lý hợp đồng\n// Nếu áp dụng cho tất cả và có loại trừ\n// Tìm giá trị loại trừ đơn vị quản lý hợp đồng nếu có dữ liệu thì false\nIf(\n        IsBlank(\n            LookUp(\n                dlChinhSachDTCTCCSCollect,\n                MA_CHINH_SACH = dk.MA_CHINH_SACH && THANH_PHAN = \"PV\" && AP_DUNG = \"1\" && MA_TIEU_CHI = \"MA_DON_VI\"\n            )\n        ) And !IsBlank(\n            LookUp(\n                dlChinhSachDTCTCCSCollect,\n                MA_CHINH_SACH = dk.MA_CHINH_SACH && THANH_PHAN = \"PV\" && AP_DUNG = \"2\" && MA_TIEU_CHI = \"MA_DON_VI\" && MA_GIA_TRI = cbxDVQLNHD.Selected.MA_PHAMVI\n            )\n        ) And !IsBlank(cbxDVQLNHD.Selected.MA_PHAMVI),\n        Collect(\n            tmpErrorCs,\n            {ID: 16}\n        );\n    );\n    \n// Nếu phạm vi áp dụng 1 phần\n// Tìm trong danh sách áp dụng đơn vị quản lý hợp đồng không có thì false\nIf(\n        !IsBlank(\n            LookUp(\n                dlChinhSachDTCTCCSCollect,\n                MA_CHINH_SACH = dk.MA_CHINH_SACH && THANH_PHAN = \"PV\" && AP_DUNG = \"1\" && KIEU = \"2\" && MA_TIEU_CHI = \"MA_DON_VI\"\n            )\n        ) And IsBlank(\n            LookUp(\n                dlChinhSachDTCTCCSCollect,\n                MA_CHINH_SACH = dk.MA_CHINH_SACH && THANH_PHAN = \"PV\" && AP_DUNG = \"1\" && KIEU = \"2\" && MA_GIA_TRI = cbxDVQLNHD.Selected.MA_PHAMVI\n            )\n        ) And !IsBlank(cbxDVQLNHD.Selected.MA_PHAMVI),\n        Collect(\n            tmpErrorCs,\n            {ID: 17}\n        );\n    );\n    \n// Nếu phạm vi áp dụng 1 phần\n// Tìm trong danh sách áp dụng theo đơn vị quản lý hợp đồng nếu có dữ liệu\n// Tìm trong danh sách loại trừ theo đơn vị quản lý hợp đồng nếu có dữ liệu thì -> false, nếu không có thì  -> pass\nIf(\n        !IsBlank(\n            LookUp(\n                dlChinhSachDTCTCCSCollect,\n                MA_CHINH_SACH = dk.MA_CHINH_SACH && THANH_PHAN = \"PV\" && AP_DUNG = \"1\" && KIEU = \"2\" && MA_TIEU_CHI = \"MA_DON_VI\" && MA_GIA_TRI = cbxDVQLNHD.Selected.MA_PHAMVI\n            )\n        ) And !IsBlank(\n            LookUp(\n                dlChinhSachDTCTCCSCollect,\n                MA_CHINH_SACH = dk.MA_CHINH_SACH && THANH_PHAN = \"PV\" && AP_DUNG = \"2\" && MA_TIEU_CHI = \"MA_DON_VI\" && MA_GIA_TRI = cbxDVQLNHD.Selected.MA_PHAMVI\n            )\n        ) And !IsBlank(cbxDVQLNHD.Selected.MA_PHAMVI),\n        Collect(\n            tmpErrorCs,\n            {ID: 18}\n        );\n    );\n    \n//4. Kiểm tra sản phẩm\nForAll(\n        Gallery3_2.AllItems As sp,\n            // 4.1.1 Kiểm tra thông tin sản phẩm\n// Nếu sản phẩm áp dụng cho tất cả và có loại trừ\n// Tìm giá trị loại trừ mã sản phẩm nếu có dữ liệu thì false\n        If(\n            IsBlank(\n                LookUp(\n                    dlChinhSachDTCTCCSCollect,\n                    MA_CHINH_SACH = dk.MA_CHINH_SACH && THANH_PHAN = \"SP\" && AP_DUNG = \"1\" && MA_TIEU_CHI = \"MA_SP\"\n                )\n            ) And !IsBlank(\n                LookUp(\n                    dlChinhSachDTCTCCSCollect,\n                    MA_CHINH_SACH = dk.MA_CHINH_SACH && THANH_PHAN = \"SP\" && AP_DUNG = \"2\" && MA_TIEU_CHI = \"MA_SP\" && MA_GIA_TRI = sp.cbxMaSPNHD.Selected.MA_SAN_PHAM\n                )\n            ) And !IsBlank(sp.cbxMaSPNHD.Selected.MA_SAN_PHAM),\n            Collect(\n                tmpErrorCs,\n                {ID: 19}\n            );\n        );\n            // Nếu sản phẩm áp dụng 1 phần\n// Tìm trong danh sách áp dụng theo mã sản phẩm nếu không có thì false\nIf(\n            !IsBlank(\n                LookUp(\n                    dlChinhSachDTCTCCSCollect,\n                    MA_CHINH_SACH = dk.MA_CHINH_SACH && THANH_PHAN = \"SP\" && AP_DUNG = \"1\" && MA_TIEU_CHI = \"MA_SP\"\n                )\n            ) And IsBlank(\n                LookUp(\n                    dlChinhSachDTCTCCSCollect,\n                    MA_CHINH_SACH = dk.MA_CHINH_SACH && THANH_PHAN = \"SP\" && AP_DUNG = \"1\" && MA_TIEU_CHI = \"MA_SP\" && KIEU = \"2\" && MA_GIA_TRI = sp.cbxMaSPNHD.Selected.MA_SAN_PHAM\n                )\n            ) And !IsBlank(sp.cbxMaSPNHD.Selected.MA_SAN_PHAM),\n            Collect(\n                tmpErrorCs,\n                {ID: 20}\n            );\n        );\n        \n// Nếu sản phẩm áp dụng 1 phần\n// Tìm trong danh sách áp dụng theo mã sản phẩm nếu có dữ liệu\n// Tìm trong danh sách loại trừ theo mã sản phẩm nếu có dữ liệu thì -> false, nếu không có thì  -> pass\nIf(\n            !IsBlank(\n                LookUp(\n                    dlChinhSachDTCTCCSCollect,\n                    MA_CHINH_SACH = dk.MA_CHINH_SACH && THANH_PHAN = \"SP\" && AP_DUNG = \"1\" && MA_TIEU_CHI = \"MA_SP\" && MA_GIA_TRI = sp.cbxMaSPNHD.Selected.MA_SAN_PHAM\n                )\n            ) And !IsBlank(\n                LookUp(\n                    dlChinhSachDTCTCCSCollect,\n                    MA_CHINH_SACH = dk.MA_CHINH_SACH && THANH_PHAN = \"SP\" && AP_DUNG = \"2\" && MA_TIEU_CHI = \"MA_SP\" && MA_GIA_TRI = sp.cbxMaSPNHD.Selected.MA_SAN_PHAM\n                )\n            ) And !IsBlank(sp.cbxMaSPNHD.Selected.MA_SAN_PHAM),\n            Collect(\n                tmpErrorCs,\n                {ID: 21}\n            );\n        );\n        // 4.1.2 Kiểm tra thông tin chương trình\n// Nếu chương trình áp dụng cho tất cả và có loại trừ\n// Tìm giá trị loại trừ chương trình nếu có dữ liệu thì false\nIf(\n            IsBlank(\n                LookUp(\n                    dlChinhSachDTCTCCSCollect,\n                    MA_CHINH_SACH = dk.MA_CHINH_SACH && THANH_PHAN = \"SP\" && AP_DUNG = \"1\" && MA_TIEU_CHI = \"MA_CT\"\n                )\n            ) And !IsBlank(\n                LookUp(\n                    dlChinhSachDTCTCCSCollect,\n                    MA_CHINH_SACH = dk.MA_CHINH_SACH && THANH_PHAN = \"SP\" && AP_DUNG = \"2\" && MA_TIEU_CHI = \"MA_CT\" && MA_GIA_TRI = sp.cbxMaCTNHDHide.Selected.MA_CHUONG_TRINH\n                )\n            ) And !IsBlank(sp.cbxMaCTNHDHide.Selected.MA_CHUONG_TRINH),\n            Collect(\n                tmpErrorCs,\n                {ID: 22}\n            );\n        );\n            // Nếu sản phẩm áp dụng 1 phần\n// Tìm trong danh sách áp dụng theo mã sản phẩm nếu không có thì false\nIf(\n            !IsBlank(\n                LookUp(\n                    dlChinhSachDTCTCCSCollect,\n                    MA_CHINH_SACH = dk.MA_CHINH_SACH && THANH_PHAN = \"SP\" && AP_DUNG = \"1\" && MA_TIEU_CHI = \"MA_CT\"\n                )\n            ) And IsBlank(\n                LookUp(\n                    dlChinhSachDTCTCCSCollect,\n                    MA_CHINH_SACH = dk.MA_CHINH_SACH && THANH_PHAN = \"SP\" && AP_DUNG = \"1\" && MA_TIEU_CHI = \"MA_CT\" && KIEU = \"2\" && MA_GIA_TRI = sp.cbxMaCTNHDHide.Selected.MA_CHUONG_TRINH\n                )\n            ) And !IsBlank(sp.cbxMaCTNHDHide.Selected.MA_CHUONG_TRINH),\n            Collect(\n                tmpErrorCs,\n                {ID: 23}\n            );\n        );\n            // Nếu chương trình áp dụng 1 phần\n// Tìm trong danh sách áp dụng theo mã chương trình nếu có dữ liệu\n// Tìm trong danh sách loại trừ theo mã chương trình nếu có dữ liệu thì -> false, nếu không có thì  -> pass\nIf(\n            !IsBlank(\n                LookUp(\n                    dlChinhSachDTCTCCSCollect,\n                    MA_CHINH_SACH = dk.MA_CHINH_SACH && THANH_PHAN = \"SP\" && AP_DUNG = \"1\" && MA_TIEU_CHI = \"MA_CT\" && MA_GIA_TRI = sp.cbxMaCTNHDHide.Selected.MA_CHUONG_TRINH\n                )\n            ) And !IsBlank(\n                LookUp(\n                    dlChinhSachDTCTCCSCollect,\n                    MA_CHINH_SACH = dk.MA_CHINH_SACH && THANH_PHAN = \"SP\" && AP_DUNG = \"2\" && MA_TIEU_CHI = \"MA_CT\" && MA_GIA_TRI = sp.cbxMaCTNHDHide.Selected.MA_CHUONG_TRINH\n                )\n            ) And !IsBlank(sp.cbxMaCTNHDHide.Selected.MA_CHUONG_TRINH),\n            Collect(\n                tmpErrorCs,\n                {ID: 24}\n            );\n        );\n // 4.1.3 Kiểm tra thông tin LHNV\n// Nếu LHNV áp dụng cho tất cả và có loại trừ\n// Tìm giá trị loại trừ LHNV nếu có dữ liệu thì false\nIf(\n            IsBlank(\n                LookUp(\n                    dlChinhSachDTCTCCSCollect,\n                    MA_CHINH_SACH = dk.MA_CHINH_SACH && THANH_PHAN = \"SP\" && AP_DUNG = \"1\" && MA_TIEU_CHI = \"LHNV\"\n                )\n            ) And !IsBlank(\n                LookUp(\n                    dlChinhSachDTCTCCSCollect,\n                    MA_CHINH_SACH = dk.MA_CHINH_SACH && THANH_PHAN = \"SP\" && AP_DUNG = \"2\" && MA_TIEU_CHI = \"LHNV\" && \n                    TEN_GIA_TRI = LookUp(DL_SAN_PHAM,MA_SAN_PHAM=cbxMaSPNHD.Selected.MA_SAN_PHAM,LHNV)\n                )\n            ) And !IsBlank(LookUp(DL_SAN_PHAM,MA_SAN_PHAM=cbxMaSPNHD.Selected.MA_SAN_PHAM,LHNV)),\n            Collect(\n                tmpErrorCs,\n                {ID: 25}\n            );\n        );\n            // Nếu sản phẩm áp dụng 1 phần\n// Tìm trong danh sách áp dụng theo mã sản phẩm nếu không có thì false\nIf(\n            !IsBlank(\n                LookUp(\n                    dlChinhSachDTCTCCSCollect,\n                    MA_CHINH_SACH = dk.MA_CHINH_SACH && THANH_PHAN = \"SP\" && AP_DUNG = \"1\" && MA_TIEU_CHI = \"LHNV\"\n                )\n            ) And IsBlank(\n                LookUp(\n                    dlChinhSachDTCTCCSCollect,\n                    MA_CHINH_SACH = dk.MA_CHINH_SACH && THANH_PHAN = \"SP\" && AP_DUNG = \"1\" && MA_TIEU_CHI = \"LHNV\" && KIEU = \"2\" && \n                    TEN_GIA_TRI = LookUp(DL_SAN_PHAM,MA_SAN_PHAM=cbxMaSPNHD.Selected.MA_SAN_PHAM,LHNV)\n                )\n            ) And !IsBlank(LookUp(DL_SAN_PHAM,MA_SAN_PHAM=cbxMaSPNHD.Selected.MA_SAN_PHAM,LHNV)),\n            Collect(\n                tmpErrorCs,\n                {ID: 26}\n            );\n        );\n        \n// Nếu chương trình áp dụng 1 phần\n// Tìm trong danh sách áp dụng theo mã chương trình nếu có dữ liệu\n// Tìm trong danh sách loại trừ theo mã chương trình nếu có dữ liệu thì -> false, nếu không có thì  -> pass\nIf(\n            !IsBlank(\n                LookUp(\n                    dlChinhSachDTCTCCSCollect,\n                    MA_CHINH_SACH = dk.MA_CHINH_SACH && THANH_PHAN = \"SP\" && AP_DUNG = \"1\" && MA_TIEU_CHI = \"LHNV\" && \n                    TEN_GIA_TRI = LookUp(DL_SAN_PHAM,MA_SAN_PHAM=cbxMaSPNHD.Selected.MA_SAN_PHAM,LHNV)\n                )\n            ) And !IsBlank(\n                LookUp(\n                    dlChinhSachDTCTCCSCollect,\n                    MA_CHINH_SACH = dk.MA_CHINH_SACH && THANH_PHAN = \"SP\" && AP_DUNG = \"2\" && MA_TIEU_CHI = \"LHNV\" && \n                    TEN_GIA_TRI = LookUp(DL_SAN_PHAM,MA_SAN_PHAM=cbxMaSPNHD.Selected.MA_SAN_PHAM,LHNV)\n                )\n            ) And !IsBlank(LookUp(DL_SAN_PHAM,MA_SAN_PHAM=cbxMaSPNHD.Selected.MA_SAN_PHAM,LHNV)),\n            Collect(\n                tmpErrorCs,\n                {ID: 27}\n            );\n        );\n    );\n    \n//4.1.4 Kiểm tra combo sản phẩm\n// lấy danh sách sản phẩm trên hợp đồng\nForAll(\n        Gallery3_2.AllItems As sp,\n        Collect(\n            dsSpKetHop,\n            {MA_SAN_PHAM: sp.cbxMaSPNHD.Selected.MA_SAN_PHAM}\n        )\n    );\n    ForAll(\n        Gallery3_1.AllItems As sp,\n        Collect(\n            dsSpKetHop,\n            {MA_SAN_PHAM: sp.tiMaSPLKNHD_1.Text}\n        )\n    );\n    Collect(\n        GroupedSp,\n        GroupBy(\n            dsSpKetHop,\n            MA_SAN_PHAM,\n            Grouped\n        )\n    );\n    If(\n        CountRows(GroupedSp) > 1,\n        Collect(\n            dsCombosp,\n            Filter(\n                dlChinhSachDTCTCCSCollect,\n                MA_GIA_TRI,\n                MA_CHINH_SACH = dk.MA_CHINH_SACH && THANH_PHAN = \"SP\" && MA_TIEU_CHI = \"MA_COMBO_SP\" && AP_DUNG = \"1\"\n            )\n        );\n        Collect(\n            dsCombospLt,\n            Filter(\n                dlChinhSachDTCTCCSCollect,\n                MA_GIA_TRI,\n                MA_CHINH_SACH = dk.MA_CHINH_SACH && THANH_PHAN = \"SP\" && MA_TIEU_CHI = \"MA_COMBO_SP\" && AP_DUNG = \"2\"\n            )\n        );\n        ForAll(\n            GroupedSp As sp,\n            RemoveIf(\n                dsCombosp,\n                cr282_ma_gia_tri = sp.MA_SAN_PHAM\n            );\n        );\n        ForAll(\n            GroupedSp As sp,\n            RemoveIf(\n                dsCombospLt,\n                cr282_ma_gia_tri = sp.MA_SAN_PHAM\n            );\n        );\n        \n// Nếu COMBO áp dụng cho tất cả và có loại trừ\n// Tìm giá trị loại trừ theo combo sản phẩm nếu có dữ liệu thì false\nIf(\n            IsBlank(\n                LookUp(\n                    dlChinhSachDTCTCCSCollect,\n                    MA_CHINH_SACH = dk.MA_CHINH_SACH && THANH_PHAN = \"SP\" && AP_DUNG = \"1\" && MA_TIEU_CHI = \"MA_COMBO_SP\"\n                )\n            ) And !IsBlank(\n                LookUp(\n                    dlChinhSachDTCTCCSCollect,\n                    MA_CHINH_SACH = dk.MA_CHINH_SACH && THANH_PHAN = \"SP\" && AP_DUNG = \"2\" && MA_TIEU_CHI = \"MA_COMBO_SP\"\n                )\n            ) And CountRows(dsCombospLt) = 0 And CountRows(GroupedSp) = CountRows(\n                Filter(\n                    dlChinhSachDTCTCCSCollect,\n                    MA_CHINH_SACH = dk.MA_CHINH_SACH && THANH_PHAN = \"SP\" && AP_DUNG = \"2\" && MA_TIEU_CHI = \"MA_COMBO_SP\"\n                )\n            ),\n            Collect(\n                tmpErrorCs,\n                {ID: 28}\n            );\n        );\n        \n// Nếu combo sản phẩm áp dụng 1 phần\n// Tìm trong danh sách áp dụng theo COMBO SẢN PHẨM nếu không khớp có thì false\nIf(\n            !IsBlank(\n                LookUp(\n                    dlChinhSachDTCTCCSCollect,\n                    MA_CHINH_SACH = dk.MA_CHINH_SACH && THANH_PHAN = \"SP\" && AP_DUNG = \"1\" && MA_TIEU_CHI = \"MA_COMBO_SP\"\n                )\n            ) And (CountRows(dsCombosp) <> 0),\n            Collect(\n                tmpErrorCs,\n                {ID: 29}\n            );\n        );\n        If(\n            !IsBlank(\n                LookUp(\n                    dlChinhSachDTCTCCSCollect,\n                    MA_CHINH_SACH = dk.MA_CHINH_SACH && THANH_PHAN = \"SP\" && AP_DUNG = \"1\" && MA_TIEU_CHI = \"MA_COMBO_SP\"\n                )\n            ) And CountRows(GroupedSp) <> CountRows(\n                Filter(\n                    dlChinhSachDTCTCCSCollect,\n                    MA_CHINH_SACH = dk.MA_CHINH_SACH && THANH_PHAN = \"SP\" && AP_DUNG = \"1\" && MA_TIEU_CHI = \"MA_COMBO_SP\"\n                )\n            ),\n            Collect(\n                tmpErrorCs,\n                {ID: 30}\n            );\n        );\n    );\n    \n// lấy số sản phẩm trong hợp đồng\nIf(\n        CountRows(tmpErrorCs) <= 0,\n        Collect(\n            tmpPassCs,\n            {ma_chinh_sach: dk.MA_CHINH_SACH}\n        );\n    )\n);\nIf(\n    CountRows(tmpPass) <= 0,\n    UpdateContext({errorMsg: \"Các thông tin không đủ điều kiện để cấp hợp đồng\"})\n);\nIf(\n    CountRows(tmpPassCs) <= 0,\n    UpdateContext({errorMsg: \"Không có chính sách thỏa mãn điều kiện\"})\n);\n// end chính sách áp dụng\nIf(\n    !IsBlank(errorMsg),\n    Notify(\n        errorMsg,\n        NotificationType.Error,\n        5000\n    ),\n    //xu ly chon cs\n    Set(\n        varMaHD_CS,\n        If(\n            IsBlank(tiMaHDNHD.Text),\n            maHopDongFwd,\n            tiMaHDNHD.Text\n        )\n    );\n    Set(varNgayHD, dpNgayHDNHD.SelectedDate);\n    ClearCollect(// lay gia tri cs chung\n        tmpChonTCCSDT,\n        ShowColumns(\n            AddColumns(\n                SortByColumns(\n                    DL_CHINHSACH_CHUNG,\n                    \"cr282_ma_chinh_sach\",\n                    SortOrder.Ascending\n                ),\n                hinh_thuc,\n                \"\",\n                loai_dieu_kien,\n                \"\",\n                loai_cs,\n                \"\",\n                so_tien,\n                0,\n                ty_le,\n                0,\n                so_tien_max,\n                0,\n                donvi_tien,\n                \"\",\n                pass,\n                0,\n                tich_chon,\n                false\n            ),\n            ID,\n            MA_CHINH_SACH,\n            MO_TA,\n            SAN_PHAM,\n            KENH_BAN,\n            KHACH_HANG,\n            PHAM_VI,\n            HIEU_LUC_TU,\n            HIEU_LUC_DEN,\n            hinh_thuc,\n            loai_dieu_kien,\n            loai_cs,\n            so_tien,\n            ty_le,\n            so_tien_max,\n            donvi_tien,\n            pass,\n            tich_chon\n        )\n    );\n    ForAll(//Lay gia tri cs ap dung\n        DL_CHINHSACH_APDUNG As cs,\n        UpdateIf(\n            tmpChonTCCSDT,\n            cr282_ma_chinh_sach = cs.MA_CHINH_SACH,\n            {\n                hinh_thuc: cs.HINH_THUC,\n                loai_dieu_kien: cs.LOAI_DK,\n                loai_cs: cs.ANH_HUONG,\n                so_tien: cs.SO_TIEN,\n                ty_le: cs.TY_LE,\n                so_tien_max: cs.SO_TIEN_TOI_DA,\n                donvi_tien: cs.DONVI_TIEN_TE,\n                tich_chon: If(\n                    !IsBlank(\n                        LookUp(\n                            DL_HOP_DONG_CHON_CS,\n                            MA_CHINH_SACH = cs.MA_CHINH_SACH && MA_HOP_DONG = varMaHD_CS\n                        ).MA_CHINH_SACH\n                    ),\n                    true,\n                    false\n                )\n            }\n        )\n    );\n    ForAll(\n        tmpPassCs As ps,\n        UpdateIf(\n            tmpChonTCCSDT,\n            cr282_ma_chinh_sach = ps.ma_chinh_sach,\n            {pass: 1}\n        )\n    );\n    RemoveIf(\n        tmpChonTCCSDT,\n        pass <> 1\n    );\n    Set(isNhapBGHD,\"1\");\n    Navigate(ChonChinhSach);\n    \n);\n"
                              Size: =11
                              Underline: =true
                              Width: =142
                              X: =24
                              Y: =24
                        - FormKQCS_1:
                            Control: Form@2.4.2
                            Variant: Classic
                            Layout: Vertical
                            Properties:
                              BorderColor: =RGBA(0, 18, 107, 1)
                              DataSource: =DL_HOP_DONG_KETQUA_CS
                              Height: =123
                              Item: =LookUp(DL_HOP_DONG_KETQUA_CS, MA_HOP_DONG=If(!IsBlank(tiMaHDNHD.Text),tiMaHDNHD.Text,maHopDongFwd))
                              Visible: =If(!IsBlank(LookUp(DL_HOP_DONG_KETQUA_CS, MA_HOP_DONG=If(!IsBlank(tiMaHDNHD.Text),tiMaHDNHD.Text,maHopDongFwd)).MA_HOP_DONG), true,false)
                              Width: =1267
                              Y: =251
                            Children:
                              - LOAI_TAC_DONG_DataCard1_1:
                                  Control: TypedDataCard@1.0.6
                                  Variant: ClassicTextualEdit
                                  Properties:
                                    BorderColor: =RGBA(0, 18, 107, 1)
                                    DataField: ="cr282_loai_tac_dong"
                                    Default: =ThisItem.LOAI_TAC_DONG
                                    DisplayName: =DataSourceInfo([@DL_HOP_DONG_KETQUA_CS],DataSourceInfo.DisplayName,cr282_loai_tac_dong)
                                    MaxLength: =DataSourceInfo([@DL_HOP_DONG_KETQUA_CS], DataSourceInfo.MaxLength, cr282_loai_tac_dong)
                                    Required: =false
                                    Update: =DataCardValue21_1.Selected.MA
                                    Width: =326
                                    Y: =0
                                  Children:
                                    - DataCardKey38_1:
                                        Control: Label@2.5.1
                                        Properties:
                                          AutoHeight: =true
                                          BorderColor: =RGBA(0, 0, 0, 1)
                                          Font: =Font.'Open Sans'
                                          Height: =34
                                          Size: =11
                                          Text: ="Loại tác động"
                                          Width: =Parent.Width - 60
                                          Wrap: =false
                                          X: =30
                                          Y: =10
                                    - ErrorMessage35_1:
                                        Control: Label@2.5.1
                                        Properties:
                                          AutoHeight: =true
                                          BorderColor: =RGBA(0, 0, 0, 1)
                                          Color: =RGBA(168, 0, 0, 1)
                                          Font: =Font.'Open Sans'
                                          FontWeight: =FontWeight.Semibold
                                          Height: =10
                                          Live: =Live.Assertive
                                          PaddingBottom: =0
                                          PaddingLeft: =0
                                          PaddingRight: =0
                                          PaddingTop: =0
                                          Size: =14
                                          Text: =Parent.Error
                                          Visible: =Parent.DisplayMode=DisplayMode.Edit
                                          Width: =Parent.Width - 60
                                          X: =30
                                          Y: =DataCardValue21_1.Y + DataCardValue21_1.Height
                                    - StarVisible36_1:
                                        Control: Label@2.5.1
                                        Properties:
                                          Align: =Align.Center
                                          BorderColor: =RGBA(0, 0, 0, 1)
                                          Color: =RGBA(0, 18, 107, 1)
                                          Font: =Font.'Open Sans'
                                          Height: =DataCardKey38_1.Height
                                          Text: ="*"
                                          Visible: =And(Parent.Required, Parent.DisplayMode=DisplayMode.Edit)
                                          Width: =30
                                          Wrap: =false
                                          Y: =DataCardKey38_1.Y
                                    - DataCardValue21_1:
                                        Control: Classic/DropDown@2.3.1
                                        Properties:
                                          BorderColor: =RGBA(0, 18, 107, 1)
                                          ChevronBackground: =RGBA(56, 96, 178, 1)
                                          ChevronDisabledBackground: =RGBA(122, 138, 143, 1)
                                          ChevronFill: =RGBA(255, 255, 255, 1)
                                          ChevronHoverBackground: =ColorFade(RGBA(56, 96, 178, 1), -20%)
                                          ChevronHoverFill: =RGBA(255, 255, 255, 1)
                                          Default: =If(Parent.Default="1","Tăng",If(Parent.Default="2","Giảm"))
                                          DisabledBorderColor: =RGBA(180, 214, 250, 1)
                                          DisabledColor: =RGBA(0, 0, 0, 1)
                                          DisabledFill: =RGBA(214, 221, 224, 1)
                                          DisplayMode: =DisplayMode.Disabled
                                          Font: =Font.'Open Sans'
                                          HoverFill: =RGBA(186, 202, 226, 1)
                                          Items: =[{MA:"1",TEN:"Tăng"},{MA:"2",TEN:"Giảm"}]
                                          Items.Value: =TEN
                                          PressedColor: =RGBA(255, 255, 255, 1)
                                          PressedFill: =RGBA(0, 18, 107, 1)
                                          SelectionColor: =RGBA(255, 255, 255, 1)
                                          SelectionFill: =RGBA(56, 96, 178, 1)
                                          Width: =266
                                          X: =30
                                          Y: =45
                              - KIEU_DU_LIEU_DataCard2_1:
                                  Control: TypedDataCard@1.0.6
                                  Variant: ClassicTextualEdit
                                  Properties:
                                    BorderColor: =RGBA(0, 18, 107, 1)
                                    DataField: ="cr282_kieu_du_lieu"
                                    Default: =ThisItem.KIEU_DU_LIEU
                                    DisplayName: =DataSourceInfo([@DL_HOP_DONG_KETQUA_CS],DataSourceInfo.DisplayName,cr282_kieu_du_lieu)
                                    MaxLength: =DataSourceInfo([@DL_HOP_DONG_KETQUA_CS], DataSourceInfo.MaxLength, cr282_kieu_du_lieu)
                                    Required: =false
                                    Update: =DataCardValue19_1.Selected.MA
                                    Width: =326
                                    X: =1
                                    Y: =0
                                  Children:
                                    - DataCardKey37_1:
                                        Control: Label@2.5.1
                                        Properties:
                                          AutoHeight: =true
                                          BorderColor: =RGBA(0, 0, 0, 1)
                                          Font: =Font.'Open Sans'
                                          Height: =34
                                          Size: =11
                                          Text: ="Kiểu dữ liệu"
                                          Width: =Parent.Width - 60
                                          Wrap: =false
                                          X: =30
                                          Y: =10
                                    - ErrorMessage34_1:
                                        Control: Label@2.5.1
                                        Properties:
                                          AutoHeight: =true
                                          BorderColor: =RGBA(0, 0, 0, 1)
                                          Color: =RGBA(168, 0, 0, 1)
                                          Font: =Font.'Open Sans'
                                          FontWeight: =FontWeight.Semibold
                                          Height: =10
                                          Live: =Live.Assertive
                                          PaddingBottom: =0
                                          PaddingLeft: =0
                                          PaddingRight: =0
                                          PaddingTop: =0
                                          Size: =14
                                          Text: =Parent.Error
                                          Visible: =Parent.DisplayMode=DisplayMode.Edit
                                          Width: =Parent.Width - 60
                                          X: =30
                                          Y: =DataCardValue19_1.Y + DataCardValue19_1.Height
                                    - StarVisible35_1:
                                        Control: Label@2.5.1
                                        Properties:
                                          Align: =Align.Center
                                          BorderColor: =RGBA(0, 0, 0, 1)
                                          Color: =RGBA(0, 18, 107, 1)
                                          Font: =Font.'Open Sans'
                                          Height: =DataCardKey37_1.Height
                                          Text: ="*"
                                          Visible: =And(Parent.Required, Parent.DisplayMode=DisplayMode.Edit)
                                          Width: =30
                                          Wrap: =false
                                          Y: =DataCardKey37_1.Y
                                    - DataCardValue19_1:
                                        Control: Classic/DropDown@2.3.1
                                        Properties:
                                          BorderColor: =RGBA(0, 18, 107, 1)
                                          ChevronBackground: =RGBA(56, 96, 178, 1)
                                          ChevronDisabledBackground: =RGBA(122, 138, 143, 1)
                                          ChevronFill: =RGBA(255, 255, 255, 1)
                                          ChevronHoverBackground: =ColorFade(RGBA(56, 96, 178, 1), -20%)
                                          ChevronHoverFill: =RGBA(255, 255, 255, 1)
                                          Default: =If(Parent.Default="001","Tỷ lệ (%)",If(Parent.Default="002","Số tiền"))
                                          DisabledBorderColor: =RGBA(180, 214, 250, 1)
                                          DisabledColor: =RGBA(0, 0, 0, 1)
                                          DisabledFill: =RGBA(214, 221, 224, 1)
                                          DisplayMode: =DisplayMode.Disabled
                                          Font: =Font.'Open Sans'
                                          HoverFill: =RGBA(186, 202, 226, 1)
                                          Items: =[{MA:"001",TEN:"Tỷ lệ (%)"},{MA:"002",TEN:"Số tiền"}]
                                          Items.Value: =TEN
                                          PressedColor: =RGBA(255, 255, 255, 1)
                                          PressedFill: =RGBA(0, 18, 107, 1)
                                          SelectionColor: =RGBA(255, 255, 255, 1)
                                          SelectionFill: =RGBA(56, 96, 178, 1)
                                          Width: =266
                                          X: =30
                                          Y: =45
                              - GIA_TRI_DataCard1_1:
                                  Control: TypedDataCard@1.0.6
                                  Variant: ClassicNumberEdit
                                  Properties:
                                    BorderColor: =RGBA(0, 18, 107, 1)
                                    DataField: ="cr282_gia_tri"
                                    Default: =ThisItem.GIA_TRI
                                    DisplayName: =DataSourceInfo([@DL_HOP_DONG_KETQUA_CS],DataSourceInfo.DisplayName,cr282_gia_tri)
                                    Required: =false
                                    Update: =Value(DataCardValue14_1.Text)
                                    Width: =326
                                    X: =2
                                    Y: =0
                                  Children:
                                    - DataCardKey35_1:
                                        Control: Label@2.5.1
                                        Properties:
                                          AutoHeight: =true
                                          BorderColor: =RGBA(0, 0, 0, 1)
                                          Font: =Font.'Open Sans'
                                          Height: =34
                                          Size: =11
                                          Text: ="Giá trị"
                                          Width: =Parent.Width - 60
                                          Wrap: =false
                                          X: =30
                                          Y: =10
                                    - DataCardValue14_1:
                                        Control: Classic/TextInput@2.3.2
                                        Properties:
                                          Align: =Align.Right
                                          BorderColor: =If(IsBlank(Parent.Error), Parent.BorderColor, Color.Red)
                                          Default: =Parent.Default
                                          DelayOutput: =true
                                          DisabledBorderColor: =RGBA(180, 214, 250, 1)
                                          DisabledColor: =RGBA(0, 0, 0, 1)
                                          DisabledFill: =RGBA(214, 221, 224, 1)
                                          DisplayMode: =DisplayMode.Disabled
                                          Font: =Font.'Open Sans'
                                          Format: =TextFormat.Number
                                          HoverBorderColor: =RGBA(0, 18, 107, 1)
                                          HoverFill: =RGBA(186, 202, 226, 1)
                                          PaddingLeft: =5
                                          RadiusBottomLeft: =0
                                          RadiusBottomRight: =0
                                          RadiusTopLeft: =0
                                          RadiusTopRight: =0
                                          Size: =11
                                          Tooltip: =Parent.DisplayName
                                          Width: =Parent.Width - 60
                                          X: =30
                                          Y: =DataCardKey35_1.Y + DataCardKey35_1.Height + 5
                                    - ErrorMessage32_1:
                                        Control: Label@2.5.1
                                        Properties:
                                          AutoHeight: =true
                                          BorderColor: =RGBA(0, 0, 0, 1)
                                          Color: =RGBA(168, 0, 0, 1)
                                          Font: =Font.'Open Sans'
                                          FontWeight: =FontWeight.Semibold
                                          Height: =10
                                          Live: =Live.Assertive
                                          PaddingBottom: =0
                                          PaddingLeft: =0
                                          PaddingRight: =0
                                          PaddingTop: =0
                                          Size: =14
                                          Text: =Parent.Error
                                          Visible: =Parent.DisplayMode=DisplayMode.Edit
                                          Width: =Parent.Width - 60
                                          X: =30
                                          Y: =DataCardValue14_1.Y + DataCardValue14_1.Height
                                    - StarVisible33_1:
                                        Control: Label@2.5.1
                                        Properties:
                                          Align: =Align.Center
                                          BorderColor: =RGBA(0, 0, 0, 1)
                                          Color: =RGBA(0, 18, 107, 1)
                                          Font: =Font.'Open Sans'
                                          Height: =DataCardKey35_1.Height
                                          Text: ="*"
                                          Visible: =And(Parent.Required, Parent.DisplayMode=DisplayMode.Edit)
                                          Width: =30
                                          Wrap: =false
                                          Y: =DataCardKey35_1.Y
                              - SO_TIEN_TOI_DA_DataCard1_1:
                                  Control: TypedDataCard@1.0.6
                                  Variant: ClassicNumberEdit
                                  Properties:
                                    BorderColor: =RGBA(0, 18, 107, 1)
                                    DataField: ="cr282_so_tien_toi_da"
                                    Default: =ThisItem.SO_TIEN_TOI_DA
                                    DisplayName: =DataSourceInfo([@DL_HOP_DONG_KETQUA_CS],DataSourceInfo.DisplayName,cr282_so_tien_toi_da)
                                    Required: =false
                                    Update: =Value(DataCardValue23_1.Text)
                                    Visible: =false
                                    Width: =326
                                    X: =3
                                    Y: =0
                                  Children:
                                    - DataCardKey46_1:
                                        Control: Label@2.5.1
                                        Properties:
                                          AutoHeight: =true
                                          BorderColor: =RGBA(0, 0, 0, 1)
                                          Color: =RGBA(0, 18, 107, 1)
                                          Font: =Font.'Open Sans'
                                          Height: =34
                                          Text: ="Số tiền tối đa"
                                          Width: =Parent.Width - 60
                                          Wrap: =false
                                          X: =30
                                          Y: =10
                                    - DataCardValue23_1:
                                        Control: Classic/TextInput@2.3.2
                                        Properties:
                                          Align: =Align.Right
                                          BorderColor: =If(IsBlank(Parent.Error), Parent.BorderColor, Color.Red)
                                          Default: =Parent.Default
                                          DelayOutput: =true
                                          DisabledBorderColor: =RGBA(180, 214, 250, 1)
                                          DisabledColor: =RGBA(0, 0, 0, 1)
                                          DisabledFill: =RGBA(214, 221, 224, 1)
                                          DisplayMode: =DisplayMode.Disabled
                                          Font: =Font.'Open Sans'
                                          Format: =TextFormat.Number
                                          HoverBorderColor: =RGBA(0, 18, 107, 1)
                                          HoverFill: =RGBA(186, 202, 226, 1)
                                          PaddingLeft: =5
                                          RadiusBottomLeft: =0
                                          RadiusBottomRight: =0
                                          RadiusTopLeft: =0
                                          RadiusTopRight: =0
                                          Size: =11
                                          Tooltip: =Parent.DisplayName
                                          Width: =Parent.Width - 60
                                          X: =30
                                          Y: =DataCardKey46_1.Y + DataCardKey46_1.Height + 5
                                    - ErrorMessage36_1:
                                        Control: Label@2.5.1
                                        Properties:
                                          AutoHeight: =true
                                          BorderColor: =RGBA(0, 0, 0, 1)
                                          Color: =RGBA(168, 0, 0, 1)
                                          Font: =Font.'Open Sans'
                                          FontWeight: =FontWeight.Semibold
                                          Height: =10
                                          Live: =Live.Assertive
                                          PaddingBottom: =0
                                          PaddingLeft: =0
                                          PaddingRight: =0
                                          PaddingTop: =0
                                          Size: =14
                                          Text: =Parent.Error
                                          Visible: =Parent.DisplayMode=DisplayMode.Edit
                                          Width: =Parent.Width - 60
                                          X: =30
                                          Y: =DataCardValue23_1.Y + DataCardValue23_1.Height
                                    - StarVisible43_1:
                                        Control: Label@2.5.1
                                        Properties:
                                          Align: =Align.Center
                                          BorderColor: =RGBA(0, 0, 0, 1)
                                          Color: =RGBA(0, 18, 107, 1)
                                          Font: =Font.'Open Sans'
                                          Height: =DataCardKey46_1.Height
                                          Text: ="*"
                                          Visible: =And(Parent.Required, Parent.DisplayMode=DisplayMode.Edit)
                                          Width: =30
                                          Wrap: =false
                                          Y: =DataCardKey46_1.Y
                        - Container6_2:
                            Control: GroupContainer@1.3.0
                            Variant: ManualLayout
                            Properties:
                              DropShadow: =DropShadow.None
                              Height: =186
                              Width: =1267
                              Y: =65
                            Children:
                              - BadgeCanvas1_60:
                                  Control: Badge@0.0.24
                                  Properties:
                                    Content: =""
                                    Height: =40
                                    Width: =1267
                              - TextCanvas2_250:
                                  Control: Text@0.0.50
                                  Properties:
                                    Align: ='TextCanvas.Align'.Center
                                    Height: =40
                                    Size: =10
                                    Text: ="Mã"
                                    Weight: ='TextCanvas.Weight'.Bold
                                    Width: =27
                                    X: =49
                              - TextCanvas2_264:
                                  Control: Text@0.0.50
                                  Properties:
                                    Align: ='TextCanvas.Align'.Center
                                    Height: =40
                                    Size: =10
                                    Text: ="Mô tả"
                                    Weight: ='TextCanvas.Weight'.Bold
                                    Width: =55
                                    X: =406
                              - TextCanvas2_267:
                                  Control: Text@0.0.50
                                  Properties:
                                    Align: ='TextCanvas.Align'.Center
                                    Height: =40
                                    Size: =10
                                    Text: ="Thao tác"
                                    Weight: ='TextCanvas.Weight'.Bold
                                    Width: =55
                                    X: =1177
                              - GalleryCSDaChon:
                                  Control: Gallery@2.15.0
                                  Variant: BrowseLayout_Vertical_TwoTextOneImageVariant_ver5.0
                                  Properties:
                                    BorderColor: =RGBA(255, 255, 255, 1)
                                    Height: =146
                                    Items: =tmpCsDaChon
                                    Width: =1265
                                    X: =2
                                    Y: =40
                                  Children:
                                    - TextMaCS_1:
                                        Control: Classic/TextInput@2.3.2
                                        Properties:
                                          BorderColor: =RGBA(245, 245, 245, 1)
                                          Color: =RGBA(50, 49, 48, 1)
                                          Default: =ThisItem.MA_CHINH_SACH
                                          DisabledBorderColor: =RGBA(180, 214, 250, 1)
                                          DisabledColor: =RGBA(0, 0, 0, 1)
                                          DisabledFill: =RGBA(255, 255, 255, 1)
                                          DisplayMode: =DisplayMode.Disabled
                                          Font: =Font.'Open Sans'
                                          Height: =102
                                          HoverBorderColor: =RGBA(16, 110, 190, 1)
                                          HoverColor: =RGBA(50, 49, 48, 1)
                                          HoverFill: =RGBA(255, 255, 255, 1)
                                          OnSelect: =Select(Parent)
                                          PressedBorderColor: =RGBA(0, 120, 212, 1)
                                          PressedColor: =RGBA(50, 49, 48, 1)
                                          PressedFill: =RGBA(255, 255, 255, 1)
                                          RadiusBottomLeft: =0
                                          RadiusBottomRight: =0
                                          RadiusTopLeft: =0
                                          RadiusTopRight: =0
                                          Size: =11
                                          Width: =103
                                          X: =7
                                          Y: =2
                                    - HtmlMoTa_1:
                                        Control: HtmlViewer@2.1.0
                                        Properties:
                                          BorderColor: =RGBA(180, 214, 250, 1)
                                          BorderStyle: =BorderStyle.Solid
                                          BorderThickness: =2
                                          DisabledBorderColor: =RGBA(180, 214, 250, 1)
                                          DisabledFill: =RGBA(255, 255, 255, 1)
                                          Fill: =RGBA(255, 255, 255, 1)
                                          Font: =Font.'Open Sans'
                                          Height: =102
                                          HtmlText: =ThisItem.MO_TA
                                          OnSelect: =Select(Parent)
                                          Visible: |
                                            =true
                                          Width: =1026
                                          X: =110
                                          Y: =2
                                    - Button2_7:
                                        Control: Classic/Button@2.2.0
                                        Properties:
                                          BorderColor: =ColorFade(Self.Fill, -15%)
                                          Color: =RGBA(255, 255, 255, 1)
                                          DisabledBorderColor: =RGBA(166, 166, 166, 1)
                                          Fill: =RGBA(56, 96, 178, 1)
                                          Font: =Font.'Open Sans'
                                          Height: =32
                                          HoverBorderColor: =ColorFade(Self.BorderColor, 20%)
                                          HoverColor: =RGBA(255, 255, 255, 1)
                                          HoverFill: =ColorFade(RGBA(56, 96, 178, 1), -20%)
                                          OnSelect: =RemoveIf(tmpCsDaChon,ID=ThisItem.ID);
                                          PressedBorderColor: =Self.Fill
                                          PressedColor: =Self.Fill
                                          PressedFill: =Self.Color
                                          Size: =11
                                          Text: ="Xóa"
                                          Width: =80
                                          X: =1165
                                          Y: =37
                  - Container3_9:
                      Control: GroupContainer@1.3.0
                      Variant: ManualLayout
                      Properties:
                        DropShadow: =DropShadow.None
                        Height: =218
                        Width: =1267
                        X: =16
                        Y: =1367
                      Children:
                        - Label3_63:
                            Control: Label@2.5.1
                            Properties:
                              BorderColor: =RGBA(0, 18, 107, 1)
                              Font: =Font.'Open Sans'
                              FontWeight: =FontWeight.Bold
                              Height: =20
                              Size: =11
                              Text: ="7. Thanh toán"
                              Width: =254
                              Y: =4
                        - Gallery3_3:
                            Control: Gallery@2.15.0
                            Variant: VariableHeight
                            Properties:
                              BorderColor: =RGBA(0, 18, 107, 1)
                              Height: =153
                              Items: |-
                                =SortByColumns(
                                    tmpKTTNHDCollect,
                                    "cr282_thoi_han_ttoan",
                                    SortOrder.Ascending
                                )
                              TemplatePadding: =0
                              TemplateSize: =75
                              Width: =611
                              X: =654
                              Y: =60
                            Children:
                              - Label3_80:
                                  Control: Label@2.5.1
                                  Properties:
                                    BorderColor: =RGBA(0, 18, 107, 1)
                                    Font: =Font.'Open Sans'
                                    Height: =25
                                    Size: =11
                                    Text: ="Thời hạn đóng phí"
                                    X: =260
                                    Y: =5
                              - Label3_79:
                                  Control: Label@2.5.1
                                  Properties:
                                    BorderColor: =RGBA(0, 18, 107, 1)
                                    Font: =Font.'Open Sans'
                                    Height: =25
                                    Size: =11
                                    Text: ="Phí thanh toán/kỳ"
                                    Width: =140
                                    X: =8
                                    Y: =5
                              - tiPhiTTNHD:
                                  Control: Classic/TextInput@2.3.2
                                  Properties:
                                    Align: =Align.Right
                                    BorderColor: =RGBA(72, 163, 62, 1)
                                    Default: =ThisItem.PHI_THANH_TOAN
                                    Font: =Font.'Open Sans'
                                    Format: =TextFormat.Number
                                    Height: =32
                                    HoverBorderColor: =RGBA(0, 18, 107, 1)
                                    HoverFill: =RGBA(186, 202, 226, 1)
                                    OnChange: |-
                                      =UpdateIf(
                                          tmpKTTNHDCollect,
                                          ID=ThisItem.ID,
                                          {
                                              PHI_THANH_TOAN:Value(tiPhiTTNHD.Text),
                                              THOI_HAN_TTOAN:dpTHPhiNHD.SelectedDate
                                          }
                                      )
                                    RadiusBottomLeft: =0
                                    RadiusBottomRight: =0
                                    RadiusTopLeft: =0
                                    RadiusTopRight: =0
                                    Size: =11
                                    Width: =230
                                    X: =8
                                    Y: =33
                              - dpTHPhiNHD:
                                  Control: Classic/DatePicker@2.6.0
                                  Properties:
                                    BorderColor: =RGBA(72, 163, 62, 1)
                                    DefaultDate: =ThisItem.THOI_HAN_TTOAN
                                    EndYear: =2200
                                    Font: =Font.'Open Sans'
                                    Format: ="dd/mm/yyyy"
                                    Height: =32
                                    IconBackground: =RGBA(56, 96, 178, 1)
                                    IconFill: =RGBA(255, 255, 255, 1)
                                    InputTextPlaceholder: =
                                    IsEditable: =true
                                    OnChange: |-
                                      =UpdateIf(
                                          tmpKTTNHDCollect,
                                          ID=ThisItem.ID,
                                          {
                                              PHI_THANH_TOAN:Value(tiPhiTTNHD.Text),
                                              THOI_HAN_TTOAN:dpTHPhiNHD.SelectedDate
                                          }
                                      )
                                    Size: =11
                                    StartYear: =1900
                                    Width: =230
                                    X: =260
                                    Y: =33
                              - Button2_6:
                                  Control: Classic/Button@2.2.0
                                  Properties:
                                    BorderColor: =ColorFade(Self.Fill, -15%)
                                    Color: =RGBA(255, 255, 255, 1)
                                    DisabledBorderColor: =RGBA(166, 166, 166, 1)
                                    Fill: =RGBA(56, 96, 178, 1)
                                    Font: =Font.'Open Sans'
                                    Height: =32
                                    HoverBorderColor: =ColorFade(Self.BorderColor, 20%)
                                    HoverColor: =RGBA(255, 255, 255, 1)
                                    HoverFill: =ColorFade(RGBA(56, 96, 178, 1), -20%)
                                    OnSelect: |
                                      =If(
                                          CountIf(tmpKTTNHDCollect,true)>1,
                                          Remove(tmpKTTNHDCollect,ThisItem)
                                      )
                                    PressedBorderColor: =Self.Fill
                                    PressedColor: =Self.Fill
                                    PressedFill: =Self.Color
                                    Size: =11
                                    Text: ="Xóa"
                                    Width: =80
                                    X: =510
                                    Y: =33
                        - tiTongTPNHD:
                            Control: Classic/TextInput@2.3.2
                            Properties:
                              Align: =Align.Right
                              BorderColor: =RGBA(72, 163, 62, 1)
                              Default: =If(IsBlank(First(objHD).TONG_TIEN_PHI) || First(objHD).TONG_TIEN_PHI<0,0,First(objHD).TONG_TIEN_PHI)
                              DisplayMode: =DisplayMode.Disabled
                              Font: =Font.'Open Sans'
                              Format: =TextFormat.Number
                              Height: =32
                              HoverBorderColor: =RGBA(0, 18, 107, 1)
                              HoverFill: =RGBA(186, 202, 226, 1)
                              RadiusBottomLeft: =0
                              RadiusBottomRight: =0
                              RadiusTopLeft: =0
                              RadiusTopRight: =0
                              Size: =11
                              Width: =250
                              X: =30
                              Y: =94
                        - Label3_78:
                            Control: Label@2.5.1
                            Properties:
                              BorderColor: =RGBA(0, 18, 107, 1)
                              Font: =Font.'Open Sans'
                              Height: =25
                              Size: =11
                              Text: ="Tổng tiền phí"
                              Width: =200
                              X: =30
                              Y: =66
                        - tiSTGiamNHD:
                            Control: Classic/TextInput@2.3.2
                            Properties:
                              Align: =Align.Right
                              BorderColor: =RGBA(72, 163, 62, 1)
                              Default: =If(IsBlank(First(objHD).SO_TIEN_GIAM),0,First(objHD).SO_TIEN_GIAM)
                              DisplayMode: =DisplayMode.Disabled
                              Font: =Font.'Open Sans'
                              Format: =TextFormat.Number
                              Height: =32
                              HoverBorderColor: =RGBA(0, 18, 107, 1)
                              HoverFill: =RGBA(186, 202, 226, 1)
                              RadiusBottomLeft: =0
                              RadiusBottomRight: =0
                              RadiusTopLeft: =0
                              RadiusTopRight: =0
                              Size: =11
                              Width: =250
                              X: =30
                              Y: =160
                        - Label3_81:
                            Control: Label@2.5.1
                            Properties:
                              BorderColor: =RGBA(0, 18, 107, 1)
                              Font: =Font.'Open Sans'
                              Height: =25
                              Size: =11
                              Text: ="Số tiền giảm"
                              Width: =200
                              X: =30
                              Y: =132
                        - tiTienSauGiamNHD:
                            Control: Classic/TextInput@2.3.2
                            Properties:
                              Align: =Align.Right
                              BorderColor: =RGBA(72, 163, 62, 1)
                              Default: =If(IsBlank(First(objHD).TIEN_PHI_SAU_GIAM) || First(objHD).TIEN_PHI_SAU_GIAM<0,0,First(objHD).TIEN_PHI_SAU_GIAM)
                              DisplayMode: =DisplayMode.Disabled
                              Font: =Font.'Open Sans'
                              Format: =TextFormat.Number
                              Height: =32
                              HoverBorderColor: =RGBA(0, 18, 107, 1)
                              HoverFill: =RGBA(186, 202, 226, 1)
                              RadiusBottomLeft: =0
                              RadiusBottomRight: =0
                              RadiusTopLeft: =0
                              RadiusTopRight: =0
                              Size: =11
                              Width: =250
                              X: =355
                              Y: =160
                        - Label3_82:
                            Control: Label@2.5.1
                            Properties:
                              BorderColor: =RGBA(0, 18, 107, 1)
                              Font: =Font.'Open Sans'
                              Height: =25
                              Size: =11
                              Text: ="Tổng tiền phí sau giảm"
                              Width: =200
                              X: =355
                              Y: =132
                        - Label3_77:
                            Control: Label@2.5.1
                            Properties:
                              BorderColor: =RGBA(0, 18, 107, 1)
                              Font: =Font.'Open Sans'
                              Height: =25
                              Size: =11
                              Text: ="Mã giảm giá"
                              Width: =200
                              X: =355
                              Y: =66
                        - cbxMaGGNHD:
                            Control: Classic/ComboBox@2.4.0
                            Properties:
                              BorderColor: =RGBA(72, 163, 62, 1)
                              ChevronBackground: =RGBA(56, 96, 178, 1)
                              ChevronFill: =RGBA(255, 255, 255, 1)
                              ChevronHoverBackground: =ColorFade(RGBA(56, 96, 178, 1), -20%)
                              ChevronHoverFill: =RGBA(255, 255, 255, 1)
                              DefaultSelectedItems: =LookUp(dmMaGiamGiaNHDCollect,MA_GIAM_GIA=First(objHD).MA_GIAM_GIA)
                              DisplayFields: =["title"]
                              Font: =Font.'Open Sans'
                              Height: =32
                              HoverFill: =RGBA(186, 202, 226, 1)
                              InputTextPlaceholder: ="Chọn mã giảm giá"
                              IsSearchable: =false
                              Items: =SortByColumns(dmMaGiamGiaNHDCollect,"gia_tri_tong",SortOrder.Descending)
                              PressedColor: =RGBA(255, 255, 255, 1)
                              PressedFill: =RGBA(0, 18, 107, 1)
                              SearchFields: =["title"]
                              SelectMultiple: =false
                              SelectionColor: =RGBA(255, 255, 255, 1)
                              SelectionFill: =RGBA(56, 96, 178, 1)
                              Size: =11
                              Width: =250
                              X: =355
                              Y: =94
                        - Button2_5:
                            Control: Classic/Button@2.2.0
                            Properties:
                              BorderColor: =ColorFade(Self.Fill, -15%)
                              Color: =RGBA(255, 255, 255, 1)
                              DisabledBorderColor: =RGBA(166, 166, 166, 1)
                              Fill: =RGBA(56, 96, 178, 1)
                              Font: =Font.'Open Sans'
                              Height: =32
                              HoverBorderColor: =ColorFade(Self.BorderColor, 20%)
                              HoverColor: =RGBA(255, 255, 255, 1)
                              HoverFill: =ColorFade(RGBA(56, 96, 178, 1), -20%)
                              OnSelect: |-
                                =UpdateContext({
                                    maKTT:Max(DL_HOP_DONG_TTOANS,ID)+1
                                });
                                Collect(
                                    tmpKTTNHDCollect,
                                    {
                                        ID:Text(maKTT)
                                    }
                                );
                              PressedBorderColor: =Self.Fill
                              PressedColor: =Self.Fill
                              PressedFill: =Self.Color
                              Size: =11
                              Text: ="Thêm mới"
                              Width: =98
                              X: =663
                              Y: =20
      - Button2_4:
          Control: Classic/Button@2.2.0
          Properties:
            BorderColor: =ColorFade(Self.Fill, -15%)
            Color: =RGBA(255, 255, 255, 1)
            DisabledBorderColor: =RGBA(166, 166, 166, 1)
            Fill: =RGBA(56, 96, 178, 1)
            Font: =Font.'Open Sans'
            FontWeight: =FontWeight.Bold
            Height: =32
            HoverBorderColor: =ColorFade(Self.BorderColor, 20%)
            HoverColor: =RGBA(255, 255, 255, 1)
            HoverFill: =ColorFade(RGBA(56, 96, 178, 1), -20%)
            OnSelect: "=If(\n    IsBlank(dpNgayHDNHD.SelectedDate),\n    Notify(\n        \"Bắt buộc nhập ngày hợp đồng\",\n        NotificationType.Error,\n        2000\n    ),\n    IsBlank(dpHLTuNHD.SelectedDate),\n    Notify(\n        \"Bắt buộc nhập hiệu lực từ của hợp đồng\",\n        NotificationType.Error,\n        2000\n    ),\n    IsBlank(dpHLDenNHD.SelectedDate),\n    Notify(\n        \"Bắt buộc nhập hiệu lực đến của hợp đồng\",\n        NotificationType.Error,\n        2000\n    ),\n    IsBlank(cbxDVQLNHD.Selected.MA_PHAMVI),\n    Notify(\n        \"Bắt buộc nhập đơn vị quản lý hợp đồng\",\n        NotificationType.Error,\n        2000\n    ),\n    IsBlank(cbxDVTienNHD.Selected.TIEN_TE),\n    Notify(\n        \"Bắt buộc nhập đơn vị tiền\",\n        NotificationType.Error,\n        2000\n    ),\n    IsBlank(cbxLoaiKBNHD.Selected.MA_LOAI_KB),\n    Notify(\n        \"Bắt buộc nhập loại kênh bán\",\n        NotificationType.Error,\n        2000\n    ),\n    IsBlank(cbxMaKBNHD.Selected.MA_KENH_BAN),\n    Notify(\n        \"Bắt buộc nhập mã kênh bán\",\n        NotificationType.Error,\n        2000\n    ),\n    IsBlank(tiTenKBNHD.Text),\n    Notify(\n        \"Bắt buộc nhập tên kênh bán\",\n        NotificationType.Error,\n        2000\n    ),\n    IsBlank(cbxMaKHNHD.Selected.MA_KHACH_HANG),\n    Notify(\n        \"Bắt buộc nhập mã khách hàng\",\n        NotificationType.Error,\n        2000\n    ),\n    IsBlank(tiTenKHNHD.Text),\n    Notify(\n        \"Bắt buộc nhập tên khách hàng\",\n        NotificationType.Error,\n        2000\n    ),\n    dpNgayHDNHD.SelectedDate > dpHLTuNHD.SelectedDate,\n    Notify(\n        \"Ngày hiệu lực từ phải sau hoặc bằng ngày hợp đồng\",\n        NotificationType.Error,\n        2000\n    ),\n    dpHLDenNHD.SelectedDate <= dpHLTuNHD.SelectedDate,\n    Notify(\n        \"Ngày hiệu lực đến phải sau ngày hiệu lực từ\",\n        NotificationType.Error,\n        2000\n    ),\n    (!IsBlank(Sum(tmpKTTNHDCollect,PHI_THANH_TOAN)) && Value(tiTienSauGiamNHD.Text) <> Sum(\n        tmpKTTNHDCollect,\n        PHI_THANH_TOAN\n    )) || (IsBlank(Sum(tmpKTTNHDCollect,PHI_THANH_TOAN)) && Value(tiTienSauGiamNHD.Text) <> 0),\n    Notify(\n        \"Tổng tiền phí (sau miễn giảm) khác tổng phí trên các kỳ thanh toán\",\n        NotificationType.Error,\n        2000\n    ),\n    Refresh(DL_HOP_DONGS);\n    If(\n        CountIf(\n            DL_HOP_DONGS,\n            true\n        ) = 0,\n        UpdateContext({genMaHD: \"HD0001\"}),\n        UpdateContext(\n            {\n                sampleID: \"000\",\n                maxIdHD: Last(\n                    SortByColumns(\n                        DL_HOP_DONGS,\n                        \"cr282_ma_hop_dong\",\n                        SortOrder.Ascending\n                    )\n                ).MA_HOP_DONG\n            }\n        );\n        UpdateContext(\n            {\n                maIdHD: Text(\n                    (Right(\n                        maxIdHD,\n                        4\n                    )) + 1\n                )\n            }\n        );\n        UpdateContext(\n            {\n                genMaHD: Concatenate(\n                    \"HD\",\n                    If(\n                        Len(maIdHD) > 3,\n                        \"\",\n                        Left(\n                            sampleID,\n                            4 - Len(maIdHD)\n                        )\n                    ),\n                    maIdHD\n                )\n            }\n        );\n    );\n    If(\n        IsBlank(First(objHD).MA_HOP_DONG),\n        Patch(\n            DL_HOP_DONGS,\n            {\n                ID: Text(\n                    Max(\n                        DL_HOP_DONGS,\n                        ID\n                    ) + 1\n                ),\n                MA_HOP_DONG: genMaHD,\n                DIA_CHI: tiDChiNHD.Text,\n                DONVI_KENHBAN: cbxDVKBNHD.Selected.MA_DON_VI,\n                DONVI_QUANLY_HD: cbxDVQLNHD.Selected.MA_PHAMVI,\n                DONVI_TIEN: cbxDVTienNHD.Selected.TIEN_TE,\n                EMAIL: tiEmailNHD.Text,\n                GIOI_TINH: cbxGTinhNHD.Selected.MA_GIOI_TINH,\n                HIEU_LUC_DEN: dpHLDenNHD.SelectedDate,\n                HIEU_LUC_TU: dpHLTuNHD.SelectedDate,\n                LOAI_KENH_BAN: cbxLoaiKBNHD.Selected.MA_LOAI_KB,\n                LOAI_KHACH_HANG: cbxLoaiKHNHD.Selected.value,\n                MA_KENH_BAN: cbxMaKBNHD.Selected.MA_KENH_BAN,\n                MA_KHACH_HANG: cbxMaKHNHD.Selected.MA_KHACH_HANG,\n                NGAY_HOP_DONG: dpNgayHDNHD.SelectedDate,\n                NGAY_SINH: dpNSinhNHD.SelectedDate,\n                NGHE_NGHIEP: cbxNgheNHD.Selected.value,\n                SO_DIEN_THOAI: tiSDTNHD.Text,\n                SO_NGUOI_TGIA: tiSoNTGNHD.Text,\n                TEN_KENH_BAN: tiTenKBNHD.Text,\n                TEN_KHACH_HANG: tiTenKHNHD.Text,\n                TRANG_THAI: \"Hoạt động\",\n                TINH_TP_KH: cbxTinhNHD.Selected.MA_PHAMVI,\n                PTHUC_THANH_TOAN: cbxPTTTNHD.Selected.value,\n                NHOM_KHACH_HANG: cbxNhomKHNHD.Selected.MA_NHOM_KH,\n                NHOM_KENH_BAN: nhomKB,\n                TONG_TIEN_PHI: Value(tiTongTPNHD.Text),\n                MA_GIAM_GIA: cbxMaGGNHD.Selected.MA_GIAM_GIA,\n                SO_TIEN_GIAM: Value(tiSTGiamNHD.Text),\n                TIEN_PHI_SAU_GIAM: Value(tiTienSauGiamNHD.Text),\n                LOAI_HOP_DONG:ddLoaiHDNHD.Selected.value,\n                TEN_KHACH_HANG_SAVED:cbxMaKHNHD.Selected.MA_KHACH_HANG\n            }\n        );\n        UpdateIf(\n            objHD,\n            true,\n            {\n                ID: Text(\n                    Max(\n                        DL_HOP_DONGS,\n                        ID\n                    ) + 1\n                ),\n                MA_HOP_DONG: genMaHD,\n                DIA_CHI: tiDChiNHD.Text,\n                DONVI_KENHBAN: cbxDVKBNHD.Selected.MA_DON_VI,\n                DONVI_QUANLY_HD: cbxDVQLNHD.Selected.MA_PHAMVI,\n                DONVI_TIEN: cbxDVTienNHD.Selected.TIEN_TE,\n                EMAIL: tiEmailNHD.Text,\n                GIOI_TINH: cbxGTinhNHD.Selected.MA_GIOI_TINH,\n                HIEU_LUC_DEN: dpHLDenNHD.SelectedDate,\n                HIEU_LUC_TU: dpHLTuNHD.SelectedDate,\n                LOAI_KENH_BAN: cbxLoaiKBNHD.Selected.MA_LOAI_KB,\n                LOAI_KHACH_HANG: cbxLoaiKHNHD.Selected.value,\n                MA_KENH_BAN: cbxMaKBNHD.Selected.MA_KENH_BAN,\n                MA_KHACH_HANG: cbxMaKHNHD.Selected.MA_KHACH_HANG,\n                NGAY_HOP_DONG: dpNgayHDNHD.SelectedDate,\n                NGAY_SINH: dpNSinhNHD.SelectedDate,\n                NGHE_NGHIEP: cbxNgheNHD.Selected.value,\n                SO_DIEN_THOAI: tiSDTNHD.Text,\n                SO_NGUOI_TGIA: tiSoNTGNHD.Text,\n                TEN_KENH_BAN: tiTenKBNHD.Text,\n                TEN_KHACH_HANG: tiTenKHNHD.Text,\n                TRANG_THAI: \"Hoạt động\",\n                TINH_TP_KH: cbxTinhNHD.Selected.MA_PHAMVI,\n                PTHUC_THANH_TOAN: cbxPTTTNHD.Selected.value,\n                NHOM_KHACH_HANG: cbxNhomKHNHD.Selected.MA_NHOM_KH,\n                NHOM_KENH_BAN: nhomKB,\n                TONG_TIEN_PHI: Value(tiTongTPNHD.Text),\n                MA_GIAM_GIA: cbxMaGGNHD.Selected.MA_GIAM_GIA,\n                SO_TIEN_GIAM: Value(tiSTGiamNHD.Text),\n                TIEN_PHI_SAU_GIAM: Value(tiTienSauGiamNHD.Text),\n                LOAI_HOP_DONG:ddLoaiHDNHD.Selected.value,\n                TEN_KHACH_HANG_SAVED:cbxMaKHNHD.Selected.MA_KHACH_HANG\n            }\n        );\n        If(\n            !IsBlank(nhapBGCCPFwd),\n            ForAll(\n                tempSpFull As ds,\n                UpdateIf(\n                    DL_HOP_DONG_SPS,\n                    ID=ds.ID,\n                    {\n                        MA_HOP_DONG:genMaHD\n                    }\n                );\n                UpdateIf(\n                    DL_HOP_DONG_SP_NDBH,\n                    ID_HOPDONG_SP=ds.ID,\n                    {\n                        MA_HOP_DONG:genMaHD\n                    }\n                );\n                UpdateIf(\n                    DL_HOP_DONG_SP_QLCT,\n                    ID_HOPDONG_SP=ds.ID,\n                    {\n                        MA_HOP_DONG:genMaHD\n                    }\n                );\n            )\n        ),\n        UpdateIf(\n            DL_HOP_DONGS,\n            MA_HOP_DONG = tiMaHDNHD.Text,\n            {\n                DIA_CHI: tiDChiNHD.Text,\n                DONVI_KENHBAN: cbxDVKBNHD.Selected.MA_DON_VI,\n                DONVI_QUANLY_HD: cbxDVQLNHD.Selected.MA_PHAMVI,\n                DONVI_TIEN: cbxDVTienNHD.Selected.TIEN_TE,\n                EMAIL: tiEmailNHD.Text,\n                GIOI_TINH: cbxGTinhNHD.Selected.MA_GIOI_TINH,\n                HIEU_LUC_DEN: dpHLDenNHD.SelectedDate,\n                HIEU_LUC_TU: dpHLTuNHD.SelectedDate,\n                LOAI_KENH_BAN: cbxLoaiKBNHD.Selected.MA_LOAI_KB,\n                LOAI_KHACH_HANG: cbxLoaiKHNHD.Selected.value,\n                MA_KENH_BAN: cbxMaKBNHD.Selected.MA_KENH_BAN,\n                MA_KHACH_HANG: cbxMaKHNHD.Selected.MA_KHACH_HANG,\n                NGAY_HOP_DONG: dpNgayHDNHD.SelectedDate,\n                NGAY_SINH: dpNSinhNHD.SelectedDate,\n                NGHE_NGHIEP: cbxNgheNHD.Selected.value,\n                SO_DIEN_THOAI: tiSDTNHD.Text,\n                SO_NGUOI_TGIA: tiSoNTGNHD.Text,\n                TEN_KENH_BAN: tiTenKBNHD.Text,\n                TEN_KHACH_HANG: tiTenKHNHD.Text,\n                TRANG_THAI: \"Hoạt động\",\n                TINH_TP_KH: cbxTinhNHD.Selected.MA_PHAMVI,\n                PTHUC_THANH_TOAN: cbxPTTTNHD.Selected.value,\n                NHOM_KHACH_HANG: cbxNhomKHNHD.Selected.MA_NHOM_KH,\n                NHOM_KENH_BAN: nhomKB,\n                TONG_TIEN_PHI: Value(tiTongTPNHD.Text),\n                MA_GIAM_GIA: cbxMaGGNHD.Selected.MA_GIAM_GIA,\n                SO_TIEN_GIAM: Value(tiSTGiamNHD.Text),\n                TIEN_PHI_SAU_GIAM: Value(tiTienSauGiamNHD.Text),\n                LOAI_HOP_DONG:ddLoaiHDNHD.Selected.value,\n                TEN_KHACH_HANG_SAVED:cbxMaKHNHD.Selected.MA_KHACH_HANG\n            }\n        );\n        UpdateIf(\n            objHD,\n            true,\n            {\n                DIA_CHI: tiDChiNHD.Text,\n                DONVI_KENHBAN: cbxDVKBNHD.Selected.MA_DON_VI,\n                DONVI_QUANLY_HD: cbxDVQLNHD.Selected.MA_PHAMVI,\n                DONVI_TIEN: cbxDVTienNHD.Selected.TIEN_TE,\n                EMAIL: tiEmailNHD.Text,\n                GIOI_TINH: cbxGTinhNHD.Selected.MA_GIOI_TINH,\n                HIEU_LUC_DEN: dpHLDenNHD.SelectedDate,\n                HIEU_LUC_TU: dpHLTuNHD.SelectedDate,\n                LOAI_KENH_BAN: cbxLoaiKBNHD.Selected.MA_LOAI_KB,\n                LOAI_KHACH_HANG: cbxLoaiKHNHD.Selected.value,\n                MA_KENH_BAN: cbxMaKBNHD.Selected.MA_KENH_BAN,\n                MA_KHACH_HANG: cbxMaKHNHD.Selected.MA_KHACH_HANG,\n                NGAY_HOP_DONG: dpNgayHDNHD.SelectedDate,\n                NGAY_SINH: dpNSinhNHD.SelectedDate,\n                NGHE_NGHIEP: cbxNgheNHD.Selected.value,\n                SO_DIEN_THOAI: tiSDTNHD.Text,\n                SO_NGUOI_TGIA: tiSoNTGNHD.Text,\n                TEN_KENH_BAN: tiTenKBNHD.Text,\n                TEN_KHACH_HANG: tiTenKHNHD.Text,\n                TRANG_THAI: \"Hoạt động\",\n                TINH_TP_KH: cbxTinhNHD.Selected.MA_PHAMVI,\n                PTHUC_THANH_TOAN: cbxPTTTNHD.Selected.value,\n                NHOM_KHACH_HANG: cbxNhomKHNHD.Selected.MA_NHOM_KH,\n                NHOM_KENH_BAN: nhomKB,\n                TONG_TIEN_PHI: Value(tiTongTPNHD.Text),\n                MA_GIAM_GIA: cbxMaGGNHD.Selected.MA_GIAM_GIA,\n                SO_TIEN_GIAM: Value(tiSTGiamNHD.Text),\n                TIEN_PHI_SAU_GIAM: Value(tiTienSauGiamNHD.Text),\n                LOAI_HOP_DONG:ddLoaiHDNHD.Selected.value,\n                TEN_KHACH_HANG_SAVED:cbxMaKHNHD.Selected.MA_KHACH_HANG\n            }\n        )\n    );\n    Refresh(DL_HOP_DONG_TTOANS);\n    RemoveIf(\n        DL_HOP_DONG_TTOANS,\n        MA_HOP_DONG = First(objHD).MA_HOP_DONG\n    );\n    ForAll(\n        tmpKTTNHDCollect As ds,\n        Patch(\n            DL_HOP_DONG_TTOANS,\n            {\n                ID: ds.ID,\n                MA_HOP_DONG: First(objHD).MA_HOP_DONG,\n                PHI_THANH_TOAN: ds.PHI_THANH_TOAN,\n                THOI_HAN_TTOAN: ds.THOI_HAN_TTOAN\n            }\n        )\n    );\n    Reset(tiMaHDNHD);\n    Reset(LinkHDLK);\n    //Xu ly muc 6\n    Refresh(DL_HOP_DONG_CHON_CS);\nRemoveIf(\n        DL_HOP_DONG_CHON_CS,\n        MA_HOP_DONG = tiMaHDNHD.Text\n    );\n    Refresh(DL_HOP_DONG_KETQUA_CS);\n    RemoveIf(\n        DL_HOP_DONG_KETQUA_CS,\n        MA_HOP_DONG = tiMaHDNHD.Text\n    );\n    ForAll(\n        GalleryCSDaChon.AllItems As cs,\n        Patch(\n            DL_HOP_DONG_CHON_CS,\n            Defaults(DL_HOP_DONG_CHON_CS),\n            {\n                ID: Max(\n                    DL_HOP_DONG_CHON_CS,\n                    ID\n                ) + 1,\n                MA_CHINH_SACH: cs.TextMaCS_1.Text,\n                MA_HOP_DONG: tiMaHDNHD.Text,\n                SO_TIEN: Value(\n                    LookUp(\n                        DL_CHINHSACH_APDUNG,\n                        MA_CHINH_SACH = cs.TextMaCS_1.Text\n                    ).SO_TIEN\n                ),\n                TY_LE: Value(\n                    LookUp(\n                        DL_CHINHSACH_APDUNG,\n                        MA_CHINH_SACH = cs.TextMaCS_1.Text\n                    ).TY_LE\n                ),\n                SO_TIEN_TOIDA: Value(\n                    LookUp(\n                        DL_CHINHSACH_APDUNG,\n                        MA_CHINH_SACH = cs.TextMaCS_1.Text\n                    ).SO_TIEN_TOI_DA\n                ),\n                MO_TA: cs.HtmlMoTa_1.HtmlText\n            }\n        )\n    );\n    If(\n        !IsEmpty(\n            Filter(\n                DL_HOP_DONG_CHON_CS,\n                MA_HOP_DONG = tiMaHDNHD.Text\n            )\n        ),\n        Patch(\n            DL_HOP_DONG_KETQUA_CS,\n            Defaults(DL_HOP_DONG_KETQUA_CS),\n            {\n                ID: Max(\n                    DL_HOP_DONG_KETQUA_CS,\n                    ID\n                ) + 1,\n                MA_HOP_DONG: tiMaHDNHD.Text,\n                KIEU_DU_LIEU: \"002\",\n                LOAI_TAC_DONG: \"2\",\n                GIA_TRI: Sum(\n                    Filter(\n                        DL_HOP_DONG_CHON_CS,\n                        MA_HOP_DONG = tiMaHDNHD.Text\n                    ),\n                    SO_TIEN\n                )\n            }\n        )\n    );\n    //End muc 6\n    Set(\n        nhapBGCCPFwd,\n        Blank()\n    );\n    Notify(\n        \"Lưu dữ liệu thành công\",\n        NotificationType.Success,\n        2000\n    );\n    \n)"
            PressedBorderColor: =Self.Fill
            PressedColor: =Self.Fill
            PressedFill: =Self.Color
            Size: =11
            Text: ="Lưu hợp đồng"
            Width: =130
            X: =1208
            Y: =716
      - Button3_15:
          Control: Classic/Button@2.2.0
          Properties:
            BorderColor: =ColorFade(Self.Fill, -15%)
            Color: =RGBA(255, 255, 255, 1)
            DisabledBorderColor: =RGBA(166, 166, 166, 1)
            Fill: =RGBA(56, 96, 178, 1)
            Font: =Font.'Open Sans'
            FontWeight: =FontWeight.Bold
            Height: =32
            HoverBorderColor: =ColorFade(Self.BorderColor, 20%)
            HoverColor: =RGBA(255, 255, 255, 1)
            HoverFill: =ColorFade(RGBA(56, 96, 178, 1), -20%)
            OnSelect: =Back();
            PressedBorderColor: =Self.Fill
            PressedColor: =Self.Fill
            PressedFill: =Self.Color
            Size: =11
            Text: ="Quay lại"
            Width: =85
            X: =1000
            Y: =716
      - Button3_16:
          Control: Classic/Button@2.2.0
          Properties:
            BorderColor: =ColorFade(Self.Fill, -15%)
            Color: =RGBA(255, 255, 255, 1)
            DisabledBorderColor: =RGBA(166, 166, 166, 1)
            Fill: =RGBA(56, 96, 178, 1)
            Font: =Font.'Open Sans'
            FontWeight: =FontWeight.Bold
            Height: =32
            HoverBorderColor: =ColorFade(Self.BorderColor, 20%)
            HoverColor: =RGBA(255, 255, 255, 1)
            HoverFill: =ColorFade(RGBA(56, 96, 178, 1), -20%)
            OnSelect: |-
              =//Xu ly muc 6
              Refresh(DL_HOP_DONG_CHON_CS);
              RemoveIf(
                      DL_HOP_DONG_CHON_CS,
                      MA_HOP_DONG = tiMaHDNHD.Text
                  );
                  Refresh(DL_HOP_DONG_KETQUA_CS);
                  RemoveIf(
                      DL_HOP_DONG_KETQUA_CS,
                      MA_HOP_DONG = tiMaHDNHD.Text
                  );
                  ForAll(
                      GalleryCSDaChon.AllItems As cs,
                      Patch(
                          DL_HOP_DONG_CHON_CS,
                          Defaults(DL_HOP_DONG_CHON_CS),
                          {
                              ID: Max(
                                  DL_HOP_DONG_CHON_CS,
                                  ID
                              ) + 1,
                              MA_CHINH_SACH: cs.TextMaCS_1.Text,
                              MA_HOP_DONG: tiMaHDNHD.Text,
                              SO_TIEN: Value(
                                  LookUp(
                                      DL_CHINHSACH_APDUNG,
                                      MA_CHINH_SACH = cs.TextMaCS_1.Text
                                  ).SO_TIEN
                              ),
                              TY_LE: Value(
                                  LookUp(
                                      DL_CHINHSACH_APDUNG,
                                      MA_CHINH_SACH = cs.TextMaCS_1.Text
                                  ).TY_LE
                              ),
                              SO_TIEN_TOIDA: Value(
                                  LookUp(
                                      DL_CHINHSACH_APDUNG,
                                      MA_CHINH_SACH = cs.TextMaCS_1.Text
                                  ).SO_TIEN_TOI_DA
                              ),
                              MO_TA: cs.HtmlMoTa_1.HtmlText
                          }
                      )
                  );
                  If(
                      !IsEmpty(
                          Filter(
                              DL_HOP_DONG_CHON_CS,
                              MA_HOP_DONG = tiMaHDNHD.Text
                          )
                      ),
                      Patch(
                          DL_HOP_DONG_KETQUA_CS,
                          Defaults(DL_HOP_DONG_KETQUA_CS),
                          {
                              ID: Max(
                                  DL_HOP_DONG_KETQUA_CS,
                                  ID
                              ) + 1,
                              MA_HOP_DONG: tiMaHDNHD.Text,
                              KIEU_DU_LIEU: "002",
                              LOAI_TAC_DONG: "2",
                              GIA_TRI: Sum(
                                  Filter(
                                      DL_HOP_DONG_CHON_CS,
                                      MA_HOP_DONG = tiMaHDNHD.Text
                                  ),
                                  SO_TIEN
                              )
                          }
                      )
                  );
                  //End muc 6
              UpdateIf(
                  objHD,
                  true,
                  {
                      TONG_TIEN_PHI:Sum(tmpDSHDSPNHDCollect,TONG_TIEN_PHI)-Sum(Filter(DL_HOP_DONG_KETQUA_CS,MA_HOP_DONG=First(objHD).MA_HOP_DONG),GIA_TRI)
                  }
              );
              UpdateIf(
                  objHD,
                  true,
                  {
                      SO_TIEN_GIAM:If(
                          !IsBlank(cbxMaGGNHD.Selected.TY_LE_GIAM),
                          Value(tiTongTPNHD.Text)*cbxMaGGNHD.Selected.TY_LE_GIAM,
                          !IsBlank(cbxMaGGNHD.Selected.SO_TIEN),
                          cbxMaGGNHD.Selected.SO_TIEN
                      )
                  }
              );
              UpdateIf(
                  objHD,
                  true,
                  {
                      TIEN_PHI_SAU_GIAM:Value(tiTongTPNHD.Text)-Value(tiSTGiamNHD.Text)
                  }
              );
              UpdateIf(
                  tmpKTTNHDCollect,
                  true,
                  {
                      PHI_THANH_TOAN:Trunc((Value(tiTienSauGiamNHD.Text)/CountIf(tmpKTTNHDCollect,true))/1000)*1000
                  }
              );
              If(
                  Mod(Value(tiTienSauGiamNHD.Text),CountIf(tmpKTTNHDCollect,true))<>0,
                  UpdateIf(
                      tmpKTTNHDCollect,
                      ID=Text(Max(tmpKTTNHDCollect,ID)),
                      {
                          PHI_THANH_TOAN:Value(tiTienSauGiamNHD.Text) - Trunc((Value(tiTienSauGiamNHD.Text)/CountIf(tmpKTTNHDCollect,true))/1000)*1000*(CountIf(tmpKTTNHDCollect,true)-1)
                      }
                  );
                  Notify(Mod(Value(tiTienSauGiamNHD.Text),CountIf(tmpKTTNHDCollect,true)),NotificationType.Success,2000);
              )
            PressedBorderColor: =Self.Fill
            PressedColor: =Self.Fill
            PressedFill: =Self.Color
            Size: =11
            Text: ="Tính phí"
            Width: =85
            X: =1107
            Y: =716
